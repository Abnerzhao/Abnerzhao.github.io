<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Abnerzhao</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-08-12T13:39:25.494Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Abnerzhao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>API ç½‘å…³ Kong å®è·µ</title>
    <link href="http://yoursite.com/2019/08/12/kong-api-gateway/"/>
    <id>http://yoursite.com/2019/08/12/kong-api-gateway/</id>
    <published>2019-08-12T13:35:38.000Z</published>
    <updated>2019-08-12T13:39:25.494Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>Kong is a cloud-native, fast, scalable, and distributed Microservice Abstraction Layer (also known as an API Gateway, API Middleware or in some cases Service Mesh). Made available as an open-source project in 2015, its core values are high performance and extensibility.</p>
</blockquote>
<ul>
<li><a href="https://docs.konghq.com/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://github.com/Kong/kong" target="_blank" rel="external">GitHub</a></li>
</ul>
<blockquote>
<h4 id="å®ä½“å¯¹è±¡"><a href="#å®ä½“å¯¹è±¡" class="headerlink" title="å®ä½“å¯¹è±¡"></a>å®ä½“å¯¹è±¡</h4></blockquote>
<ul>
<li>Routerï¼šè¯·æ±‚è½¬å‘è§„åˆ™ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ Service</li>
<li>Servicesï¼šå¤šä¸ª Upstream é›†åˆï¼ŒRouter çš„è½¬å‘ç›®æ ‡</li>
<li>Consumersï¼šæ¶ˆè´¹è€…</li>
<li>Pluginï¼šæ’ä»¶ï¼Œå¯ä»¥æ˜¯å…¨å±€çš„ä¹Ÿå¯ä»¥é…ç½®åˆ°ç‰¹å®šçš„ Routerã€Servicesã€Consumers</li>
<li>Certificateï¼šhttps è¯ä¹¦</li>
<li>Sniï¼šåŸŸåä¸ Certificate çš„ç»‘å®š</li>
<li>Upstreamï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥</li>
<li>Targetï¼šæœ€ç»ˆå¤„ç†è¯·æ±‚çš„åç«¯æœåŠ¡</li>
</ul>
<a id="more"></a>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul>
<li><a href="https://docs.konghq.com/install/centos/?_ga=2.213911703.1402138674.1565577491-1519282909.1548232294" target="_blank" rel="external">CentOS Installation</a></li>
<li><a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="external">PostgreSQL Installation</a></li>
</ul>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># Admin api å¯¹ Kong çš„æ‰€æœ‰æ“ä½œ</div><div class="line">$ curl localhost:8001</div><div class="line"></div><div class="line"># Proxy api æä¾›ç»™å®¢æˆ·ç«¯æˆ–è€…æ¶ˆè´¹è€…å¯¹ä¸Šæ¸¸ service çš„æ¶ˆè´¹æ¥å£</div><div class="line">$ curl localhost:8000</div><div class="line">$ curl localhost:8443 ï¼ˆSSLï¼‰</div></pre></td></tr></table></figure>
<blockquote>
<p>å…·ä½“æ“ä½œè¯·å‚è€ƒï¼š <a href="https://docs.konghq.com/0.14.x/admin-api/" target="_blank" rel="external">Admin API  æ“ä½œæ‰‹å†Œ</a></p>
</blockquote>
<h3 id="æ ¸å¿ƒå®ä½“"><a href="#æ ¸å¿ƒå®ä½“" class="headerlink" title="æ ¸å¿ƒå®ä½“"></a>æ ¸å¿ƒå®ä½“</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl localhost:8001/apis  //service apis</div><div class="line">$ curl localhost:8001/consumers  //æ¶ˆè´¹è€…</div><div class="line">$ curl localhost:8001/plugins  //æ’ä»¶</div></pre></td></tr></table></figure>
<h3 id="å›¾å½¢ç•Œé¢"><a href="#å›¾å½¢ç•Œé¢" class="headerlink" title="å›¾å½¢ç•Œé¢"></a>å›¾å½¢ç•Œé¢</h3><ul>
<li><a href="https://github.com/pantsel/konga" target="_blank" rel="external">konga</a></li>
<li><a href="https://github.com/PGBI/kong-dashboard" target="_blank" rel="external">kong-dashboard</a></li>
</ul>
<h3 id="ç®€å•çš„æ¥å…¥é…ç½®"><a href="#ç®€å•çš„æ¥å…¥é…ç½®" class="headerlink" title="ç®€å•çš„æ¥å…¥é…ç½®"></a>ç®€å•çš„æ¥å…¥é…ç½®</h3><p>æ·»åŠ  API åˆ° Kong ä¸­ï¼Œé¦–å…ˆæ·»åŠ  Service, è¿™ä¸ªæœåŠ¡å°±æ˜¯Kong ç®¡ç†çš„å¾®æœåŠ¡æˆ–è€… Upstream ä¸Šæ¸¸çš„æœåŠ¡ã€‚</p>
<p>æœ¬åœ°æµ‹è¯•ä½¿ç”¨ Flask éƒ¨ç½²ä¸€ä¸ªæœ€ç®€å•çš„ Web åº”ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat web.py</div><div class="line">from flask import Flask</div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line">@app.route(&apos;/&apos;)</div><div class="line">def hello_world():</div><div class="line">    return &apos;Hello, World!&apos;</div><div class="line">    </div><div class="line">$ export FLASK_APP=web.py</div><div class="line">$ flask run</div><div class="line"> * Serving Flask app &quot;web.py&quot;</div><div class="line"> * Environment: production</div><div class="line">   WARNING: This is a development server. Do not use it in a production deployment.</div><div class="line">   Use a production WSGI server instead.</div><div class="line"> * Debug mode: off</div><div class="line"> * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</div></pre></td></tr></table></figure>
<h4 id="æ·»åŠ -Service"><a href="#æ·»åŠ -Service" class="headerlink" title="æ·»åŠ  Service"></a>æ·»åŠ  Service</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X POST \</div><div class="line">  --url http://localhost:8001/services/ \</div><div class="line">  --data &apos;name=example-service&apos; \ </div><div class="line">  --data &apos;url=http://localhost:5000&apos;</div><div class="line"></div><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Mon, 12 Aug 2019 06:28:29 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">Access-Control-Allow-Origin: *</div><div class="line">Server: kong/1.2.1</div><div class="line">Content-Length: 270</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;host&quot;:&quot;localhost&quot;,</div><div class="line">    &quot;created_at&quot;:1565591309,</div><div class="line">    &quot;connect_timeout&quot;:60000,</div><div class="line">    &quot;id&quot;:&quot;00100765-1bb9-45d8-bb38-afb853f6fa37&quot;,</div><div class="line">    &quot;protocol&quot;:&quot;http&quot;,</div><div class="line">    &quot;name&quot;:&quot;example-service&quot;,</div><div class="line">    &quot;read_timeout&quot;:60000,</div><div class="line">    &quot;port&quot;:5000,</div><div class="line">    &quot;path&quot;:null,</div><div class="line">    &quot;updated_at&quot;:1565591309,</div><div class="line">    &quot;retries&quot;:5,</div><div class="line">    &quot;write_timeout&quot;:60000,</div><div class="line">    &quot;tags&quot;:null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç»™-Service-æ·»åŠ -Router"><a href="#ç»™-Service-æ·»åŠ -Router" class="headerlink" title="ç»™ Service æ·»åŠ  Router"></a>ç»™ Service æ·»åŠ  Router</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X POST \</div><div class="line">  --url http://localhost:8001/services/example-service/routes \</div><div class="line">  --data &apos;hosts[]=example.com&apos;</div><div class="line"> </div><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Mon, 12 Aug 2019 06:35:36 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">Access-Control-Allow-Origin: *</div><div class="line">Server: kong/1.2.1</div><div class="line">Content-Length: 393</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;id&quot;:&quot;3daac1d8-7570-414a-b1a9-606cda10d2f1&quot;,</div><div class="line">    &quot;tags&quot;:null,</div><div class="line">    &quot;paths&quot;:null,</div><div class="line">    &quot;destinations&quot;:null,</div><div class="line">    &quot;protocols&quot;:[</div><div class="line">        &quot;http&quot;,</div><div class="line">        &quot;https&quot;</div><div class="line">    ],</div><div class="line">    &quot;created_at&quot;:1565591736,</div><div class="line">    &quot;snis&quot;:null,</div><div class="line">    &quot;hosts&quot;:[</div><div class="line">        &quot;example.com&quot;</div><div class="line">    ],</div><div class="line">    &quot;name&quot;:null,</div><div class="line">    &quot;preserve_host&quot;:false,</div><div class="line">    &quot;regex_priority&quot;:0,</div><div class="line">    &quot;strip_path&quot;:true,</div><div class="line">    &quot;sources&quot;:null,</div><div class="line">    &quot;updated_at&quot;:1565591736,</div><div class="line">    &quot;https_redirect_status_code&quot;:426,</div><div class="line">    &quot;service&quot;:&#123;</div><div class="line">        &quot;id&quot;:&quot;00100765-1bb9-45d8-bb38-afb853f6fa37&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;methods&quot;:null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="é€šè¿‡-Kong-è½¬å‘è¯·æ±‚"><a href="#é€šè¿‡-Kong-è½¬å‘è¯·æ±‚" class="headerlink" title="é€šè¿‡ Kong è½¬å‘è¯·æ±‚"></a>é€šè¿‡ Kong è½¬å‘è¯·æ±‚</h4><p>ç›´æ¥è®¿é—® Kong çš„ Proxy api å³å¯è®¿é—®åˆ° Flask åº”ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X GET \</div><div class="line">  --url http://localhost:8000/ \</div><div class="line">  --header &apos;Host: example.com&apos;</div><div class="line">  </div><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/html; charset=utf-8</div><div class="line">Content-Length: 13</div><div class="line">Connection: keep-alive</div><div class="line">Server: Werkzeug/0.15.5 Python/2.7.11</div><div class="line">Date: Mon, 12 Aug 2019 06:37:10 GMT</div><div class="line">X-Kong-Upstream-Latency: 2</div><div class="line">X-Kong-Proxy-Latency: 1</div><div class="line">Via: kong/1.2.1</div><div class="line"></div><div class="line">Hello, World!</div></pre></td></tr></table></figure>
<h4 id="æ·»åŠ æ’ä»¶"><a href="#æ·»åŠ æ’ä»¶" class="headerlink" title="æ·»åŠ æ’ä»¶"></a>æ·»åŠ æ’ä»¶</h4><p>æ·»åŠ ä¸€ä¸ªæ¥å£éªŒè¯ <code>key-auth</code> æ’ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X POST \</div><div class="line">  --url http://localhost:8001/services/example-service/plugins/ \</div><div class="line">  --data &apos;name=key-auth&apos;</div><div class="line">  </div><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Mon, 12 Aug 2019 06:43:47 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">Access-Control-Allow-Origin: *</div><div class="line">Server: kong/1.2.1</div><div class="line">Content-Length: 365</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;created_at&quot;:1565592227,</div><div class="line">    &quot;config&quot;:&#123;</div><div class="line">        &quot;key_names&quot;:[</div><div class="line">            &quot;apikey&quot;</div><div class="line">        ],</div><div class="line">        &quot;run_on_preflight&quot;:true,</div><div class="line">        &quot;anonymous&quot;:null,</div><div class="line">        &quot;hide_credentials&quot;:false,</div><div class="line">        &quot;key_in_body&quot;:false</div><div class="line">    &#125;,</div><div class="line">    &quot;id&quot;:&quot;54ca5f58-975a-49b4-8c14-d6b4e5add330&quot;,</div><div class="line">    &quot;service&quot;:&#123;</div><div class="line">        &quot;id&quot;:&quot;00100765-1bb9-45d8-bb38-afb853f6fa37&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;name&quot;:&quot;key-auth&quot;,</div><div class="line">    &quot;protocols&quot;:[</div><div class="line">        &quot;http&quot;,</div><div class="line">        &quot;https&quot;</div><div class="line">    ],</div><div class="line">    &quot;enabled&quot;:true,</div><div class="line">    &quot;run_on&quot;:&quot;first&quot;,</div><div class="line">    &quot;consumer&quot;:null,</div><div class="line">    &quot;route&quot;:null,</div><div class="line">    &quot;tags&quot;:null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†æ¬¡è®¿é—®åˆ™æç¤º <code>401 Unauthorized</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X GET \</div><div class="line">  --url http://localhost:8000/ \</div><div class="line">  --header &apos;Host: example.com&apos;</div><div class="line">  </div><div class="line">HTTP/1.1 401 Unauthorized</div><div class="line">Date: Mon, 12 Aug 2019 06:45:24 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">WWW-Authenticate: Key realm=&quot;kong&quot;</div><div class="line">Content-Length: 41</div><div class="line">Server: kong/1.2.1</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;message&quot;:&quot;No API key found in request&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ·»åŠ æ¶ˆè´¹è€…"><a href="#æ·»åŠ æ¶ˆè´¹è€…" class="headerlink" title="æ·»åŠ æ¶ˆè´¹è€…"></a>æ·»åŠ æ¶ˆè´¹è€…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X POST \</div><div class="line">  --url http://localhost:8001/consumers/ \</div><div class="line">  --data &quot;username=Abner&quot;</div><div class="line">  </div><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Mon, 12 Aug 2019 06:51:54 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">Access-Control-Allow-Origin: *</div><div class="line">Server: kong/1.2.1</div><div class="line">Content-Length: 117</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;custom_id&quot;:null,</div><div class="line">    &quot;created_at&quot;:1565592714,</div><div class="line">    &quot;id&quot;:&quot;c3d8a745-5d6f-4966-8678-e6644139e0b7&quot;,</div><div class="line">    &quot;tags&quot;:null,</div><div class="line">    &quot;username&quot;:&quot;Abner&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç»™æ¶ˆè´¹è€…æ·»åŠ -key"><a href="#ç»™æ¶ˆè´¹è€…æ·»åŠ -key" class="headerlink" title="ç»™æ¶ˆè´¹è€…æ·»åŠ  key"></a>ç»™æ¶ˆè´¹è€…æ·»åŠ  key</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -i -X POST \</div><div class="line">  --url http://localhost:8001/consumers/Abner/key-auth/ \</div><div class="line">  --data &apos;key=test&apos;</div><div class="line">  </div><div class="line">HTTP/1.1 201 Created</div><div class="line">Date: Mon, 12 Aug 2019 06:53:42 GMT</div><div class="line">Content-Type: application/json; charset=utf-8</div><div class="line">Connection: keep-alive</div><div class="line">Access-Control-Allow-Origin: *</div><div class="line">Server: kong/1.2.1</div><div class="line">Content-Length: 139</div><div class="line"></div><div class="line">&#123;</div><div class="line">    &quot;key&quot;:&quot;test&quot;,</div><div class="line">    &quot;created_at&quot;:1565592822,</div><div class="line">    &quot;consumer&quot;:&#123;</div><div class="line">        &quot;id&quot;:&quot;c3d8a745-5d6f-4966-8678-e6644139e0b7&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;id&quot;:&quot;d71b6d4d-3f74-489f-a036-d340f4bcc991&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># éªŒè¯</div><div class="line">$ curl -i -X GET \</div><div class="line">  --url http://localhost:8000 \</div><div class="line">  --header &quot;Host: example.com&quot; \</div><div class="line">  --header &quot;apikey: test&quot;</div><div class="line">  </div><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/html; charset=utf-8</div><div class="line">Content-Length: 13</div><div class="line">Connection: keep-alive</div><div class="line">Server: Werkzeug/0.15.5 Python/2.7.11</div><div class="line">Date: Mon, 12 Aug 2019 06:55:51 GMT</div><div class="line">X-Kong-Upstream-Latency: 2</div><div class="line">X-Kong-Proxy-Latency: 2</div><div class="line">Via: kong/1.2.1</div><div class="line"></div><div class="line">Hello, World!</div></pre></td></tr></table></figure>
<h3 id="è´Ÿè½½å‡è¡¡é…ç½®"><a href="#è´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="è´Ÿè½½å‡è¡¡é…ç½®"></a>è´Ÿè½½å‡è¡¡é…ç½®</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Kong é…ç½®å¦‚ä¸‹çš„è´Ÿè½½å‡è¡¡æ•ˆæœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">upstream example &#123;</div><div class="line">    server localhost:5000 weight=100;</div><div class="line">    server localhost:5001 weight=50;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">    listen  80;</div><div class="line">    location /example &#123;</div><div class="line">        proxy_pass http://example;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸»è¦æ¶‰åŠåˆ°çš„ Kong çš„å‡ ä¸ªæ ¸å¿ƒä¸œè¥¿ï¼š</p>
<ul>
<li>upstreamï¼šå’Œ nginx upstream ç›¸åŒï¼Œå¯¹ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡ŒæŠ½è±¡</li>
<li>targetï¼šå…·ä½“çš„ä¸»æœºæˆ–è€…å¾®æœåŠ¡å®ä¾‹ï¼Œ<code>IP + PORT</code> çš„å½¢å¼</li>
<li>serviceï¼šæœåŠ¡å±‚é¢æŠ½è±¡ï¼Œå¯ä»¥æ˜ å°„åˆ°å…·ä½“æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ upstream æ¥å®ç°è´Ÿè½½å‡è¡¡</li>
<li>routerï¼šè·¯ç”±çš„æŠ½è±¡ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ° service</li>
</ul>
<p>é¦–å…ˆæˆ‘ç”¨ Flask å¯åŠ¨ä¸¤ä¸ª web åº”ç”¨ï¼Œåˆ†åˆ«ç›‘å¬ 5000 å’Œ 5001 ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl 0.0.0.0:5000</div><div class="line">server 5000</div><div class="line">$ curl 0.0.0.0:5001</div><div class="line">server 5001</div></pre></td></tr></table></figure>
<h4 id="é…ç½®-upstream-å’Œ-target"><a href="#é…ç½®-upstream-å’Œ-target" class="headerlink" title="é…ç½® upstream å’Œ target"></a>é…ç½® upstream å’Œ target</h4><p>æ·»åŠ  example upstream</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -X POST http://localhost:8001/upstreams \</div><div class="line">  --data &quot;name=example&quot;</div></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸¤ä¸ªè´Ÿè½½å‡è¡¡èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -X POST http://localhost:8001/upstreams/example/targets \</div><div class="line">  --data &quot;target=localhost:5000&quot; \</div><div class="line">  --data &quot;weight=100&quot;</div><div class="line">$ curl -X POST http://localhost:8001/upstreams/example/targets \</div><div class="line">  --data &quot;target=localhost:5001&quot; \</div><div class="line">  --data &quot;weight=50&quot;</div></pre></td></tr></table></figure>
<h4 id="é…ç½®-service-å’Œ-route"><a href="#é…ç½®-service-å’Œ-route" class="headerlink" title="é…ç½® service å’Œ route"></a>é…ç½® service å’Œ route</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl -X POST http://localhost:8001/services\</div><div class="line">  --data &quot;name=example&quot; \</div><div class="line">  --data &quot;host=example&quot;</div><div class="line">&#123;</div><div class="line">    &quot;host&quot;:&quot;example&quot;,</div><div class="line">    &quot;created_at&quot;:1565595520,</div><div class="line">    &quot;connect_timeout&quot;:60000,</div><div class="line">    &quot;id&quot;:&quot;d9873e6e-6dd5-4a5a-accb-40f96865d0a2&quot;,</div><div class="line">    &quot;protocol&quot;:&quot;http&quot;,</div><div class="line">    &quot;name&quot;:&quot;example&quot;,</div><div class="line">    &quot;read_timeout&quot;:60000,</div><div class="line">    &quot;port&quot;:80,</div><div class="line">    &quot;path&quot;:null,</div><div class="line">    &quot;updated_at&quot;:1565595520,</div><div class="line">    &quot;retries&quot;:5,</div><div class="line">    &quot;write_timeout&quot;:60000,</div><div class="line">    &quot;tags&quot;:null</div><div class="line">&#125;</div><div class="line">$ curl -X POST http://localhost:8001/routes \</div><div class="line">  --data &quot;paths[]=/example&quot; \</div><div class="line">  --data &quot;service.id=d9873e6e-6dd5-4a5a-accb-40f96865d0a2&quot;</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ä¸€ä¸ªå…¸å‹çš„è´Ÿè½½å‡è¡¡å·²ç»é…ç½®å®Œæˆï¼Œå®æµ‹æœ‰æ•ˆã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Kong is a cloud-native, fast, scalable, and distributed Microservice Abstraction Layer (also known as an API Gateway, API Middleware or in some cases Service Mesh). Made available as an open-source project in 2015, its core values are high performance and extensibility.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.konghq.com/&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Kong/kong&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;h4 id=&quot;å®ä½“å¯¹è±¡&quot;&gt;&lt;a href=&quot;#å®ä½“å¯¹è±¡&quot; class=&quot;headerlink&quot; title=&quot;å®ä½“å¯¹è±¡&quot;&gt;&lt;/a&gt;å®ä½“å¯¹è±¡&lt;/h4&gt;&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Routerï¼šè¯·æ±‚è½¬å‘è§„åˆ™ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ Service&lt;/li&gt;
&lt;li&gt;Servicesï¼šå¤šä¸ª Upstream é›†åˆï¼ŒRouter çš„è½¬å‘ç›®æ ‡&lt;/li&gt;
&lt;li&gt;Consumersï¼šæ¶ˆè´¹è€…&lt;/li&gt;
&lt;li&gt;Pluginï¼šæ’ä»¶ï¼Œå¯ä»¥æ˜¯å…¨å±€çš„ä¹Ÿå¯ä»¥é…ç½®åˆ°ç‰¹å®šçš„ Routerã€Servicesã€Consumers&lt;/li&gt;
&lt;li&gt;Certificateï¼šhttps è¯ä¹¦&lt;/li&gt;
&lt;li&gt;Sniï¼šåŸŸåä¸ Certificate çš„ç»‘å®š&lt;/li&gt;
&lt;li&gt;Upstreamï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/li&gt;
&lt;li&gt;Targetï¼šæœ€ç»ˆå¤„ç†è¯·æ±‚çš„åç«¯æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Django REST framework ç¼“å­˜</title>
    <link href="http://yoursite.com/2019/08/06/django-rest-framework-cache/"/>
    <id>http://yoursite.com/2019/08/06/django-rest-framework-cache/</id>
    <published>2019-08-06T12:30:05.000Z</published>
    <updated>2019-08-06T14:47:32.944Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å¯¹ DRF çš„æ¥å£è¿›è¡Œç›‘æ§ï¼Œå‘ç°éƒ¨åˆ†é«˜é¢‘è®¿é—®çš„æ¥å£æ€§èƒ½ä¸ä½³ï¼Œå“åº”æ¯”è¾ƒæ…¢ï¼Œäºæ˜¯æƒ³é€šè¿‡ç¼“å­˜å°†æ¥å£æ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="http://chibisov.github.io/drf-extensions/docs/#caching" target="_blank" rel="external">drf-extensions</a></li>
<li><a href="https://drf-cached-instances.readthedocs.io/en/latest/" target="_blank" rel="external">drf-cached-instances</a></li>
<li><a href="https://github.com/Onyo/django-rest-framework-cache" target="_blank" rel="external">django-rest-framework-cache</a></li>
<li><a href="https://www.django-rest-framework.org/api-guide/caching/#using-cache-with-apiview-and-viewsets" target="_blank" rel="external">django cache decorators</a></li>
</ul>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/38320008/how-to-cache-django-rest-framework-api-calls" target="_blank" rel="external">How to cache Django Rest Framework API calls</a></p>
</blockquote>
<a id="more"></a>
<p>å¯è¡Œçš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œå¯ä»¥é€šè¿‡ç»„ä»¶å®ç°ä¹Ÿå¯ä»¥é€šè¿‡ django å†…ç½®çš„è£…é¥°å™¨æ¥å®ç°ã€‚è¿™é‡Œä»¥ <code>django-rest-framework-cache</code> ä¸ºä¾‹ã€‚</p>
<h3 id="django-rest-framework-cache"><a href="#django-rest-framework-cache" class="headerlink" title="django-rest-framework-cache"></a>django-rest-framework-cache</h3><p><code>django-rest-framework-cache</code> æ˜¯é€šè¿‡é‡å†™ <code>Serializer</code> çš„ <code>to_representation</code> æ–¹æ³•æ¥å®ç°ç¼“å­˜çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªåµŒå…¥åˆ°åºåˆ—åŒ–å±‚ç¼“å­˜æ•°æ®çš„å·¥å…·ã€‚<code>django-rest-framework-cache</code> å®‰è£…é…ç½®æ¯”è¾ƒç®€å•ï¼Œèƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pip install rest-framework-cache</div></pre></td></tr></table></figure>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ç¼“å­˜é…ç½®å¯ä»¥å‚è€ƒ <a href="https://docs.djangoproject.com/en/1.11/topics/cache/#setting-up-the-cache" target="_blank" rel="external">Django å®˜æ–¹æ–‡æ¡£</a>ï¼ŒDjango åŸç”Ÿé»˜è®¤æ”¯æŒ Memcachedï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦å…ˆå®‰è£… <code>python-memcached</code> å’Œ <code>memcached</code> ç­‰è½¯ä»¶åŒ…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pip install python-memcached</div><div class="line">$ sudo yum install -y memcached </div><div class="line">$ cat /etc/sysconfig/memcached</div><div class="line">PORT=&quot;11211&quot;</div><div class="line">USER=&quot;memcached&quot;</div><div class="line">MAXCONN=&quot;2000&quot;</div><div class="line">CACHESIZE=&quot;1024&quot;</div><div class="line">OPTIONS=&quot;&quot;</div><div class="line">$ systemctl start memcached</div><div class="line">$ systemctl enable memcached</div></pre></td></tr></table></figure>
<p><strong>settings.py</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">INSTALLED_APPS = (</div><div class="line">    ...</div><div class="line">    &apos;rest_framework_cache&apos;,</div><div class="line">)</div><div class="line"></div><div class="line"># ç¼“å­˜æº</div><div class="line">CACHES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">        &apos;BACKEND&apos;: &apos;django.core.cache.backends.memcached.MemcachedCache&apos;,</div><div class="line">        &apos;LOCATION&apos;: &apos;127.0.0.1:11211&apos;,</div><div class="line">    &#125;,</div><div class="line">    &apos;rest_backend&apos;: &#123;</div><div class="line">        &apos;BACKEND&apos;: &apos;django.core.cache.backends.locmem.LocMemCache&apos;,</div><div class="line">        &apos;LOCATION&apos;: &apos;unique-snowflake&apos;,</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">REST_FRAMEWORK_CACHE = &#123;</div><div class="line">    &apos;DEFAULT_CACHE_BACKEND&apos;: &apos;rest_backend&apos;,</div><div class="line">&#125;</div><div class="line"></div><div class="line"># å…¨å±€è¶…æ—¶æ—¶é—´</div><div class="line">REST_FRAMEWORK_CACHE = &#123;</div><div class="line">    &apos;DEFAULT_CACHE_TIMEOUT&apos;: 86400, # Default is 1 day</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>urls.py</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">from rest_framework_cache.registry import cache_registry</div><div class="line"></div><div class="line">cache_registry.autodiscover()</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>django-rest-framework-cache</code> æ˜¯åœ¨åºåˆ—åŒ–å±‚è¿›è¡Œç¼“å­˜ï¼Œæ‰€ä»¥å°†è¦ç¼“å­˜çš„åºåˆ—åŒ–ç±»æ³¨å†Œåˆ°ç¼“å­˜ä¸­ï¼ŒåŒæ—¶éœ€è¦ä½¿åºåˆ—åŒ–ç±»ç»§æ‰¿äº <code>CachedSerializerMixin</code>ã€‚</p>
<p>å®˜æ–¹ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">from rest_framework import serializers</div><div class="line"></div><div class="line"># You must import the CachedSerializerMixin and cache_registry</div><div class="line">from rest_framework_cache.serializers import CachedSerializerMixin</div><div class="line">from rest_framework_cache.registry import cache_registry</div><div class="line"></div><div class="line">from .models import Comment</div><div class="line"></div><div class="line"></div><div class="line">class CommentSerializer(serializers.ModelSerializer, CachedSerializerMixin):</div><div class="line"></div><div class="line">    class Meta:</div><div class="line">        model = Comment</div><div class="line"></div><div class="line"></div><div class="line">cache_registry.register(CommentSerializer)</div></pre></td></tr></table></figure>
<p>æŒ‰ç…§å®˜æ–¹é…ç½®ä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">TypeError: Error when calling the metaclass bases</div><div class="line">    Cannot create a consistent method resolution</div><div class="line">order (MRO) for bases CachedSerializerMixin, ModelSerializer</div></pre></td></tr></table></figure>
<p>stackoverflow ä¸Šç»™çš„è§£ç­”æ˜¯å› ä¸º Python ç±»ç»§æ‰¿çš„ MRO ç®—æ³•å¯¼è‡´ã€‚ ç”±äº <code>CachedSerializerMixin</code> æ˜¯ç»§æ‰¿äº <code>serializers.ModelSerializer</code>, å¿…é¡»å…ˆç»§æ‰¿åº•å±‚çš„ç±»ï¼Œå†ç»§æ‰¿é«˜å±‚çš„ç±»ã€‚è¿™é‡Œå› ä¸º <code>serializers.ModelSerializer</code> å‡ºç°åœ¨ <code>CachedSerializerMixin</code> ä¹‹å‰å¯¼è‡´æŠ¥é”™ã€‚æœ‰å…´è¶£å¯ä»¥äº†è§£ä¸€ä¸‹ Python å¤šé‡ç»§æ‰¿çš„ <code>C3 çº¿æ€§åŒ–ç®—æ³•ä¸ MRO</code>ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/29214888/typeerror-cannot-create-a-consistent-method-resolution-order-mro" target="_blank" rel="external">TypeError: Cannot create a consistent method resolution order (MRO) </a></p>
</blockquote>
<p>å°†ä¸¤è€…äº¤æ¢é¡ºåºå³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">class CommentSerializer(CachedSerializerMixin, serializers.ModelSerializer):</div></pre></td></tr></table></figure>
<p><code>django-rest-framework-cache</code> å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯¹äºåµŒå¥—çš„å¤–é”®å’Œå¤šå¯¹å¤šçš„æ¨¡å‹ï¼Œæ•°æ®ä¿®æ”¹ä¹‹åä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºç¼“å­˜çš„æ˜¯ <code>Serializer</code> ä¿¡æ¯ï¼Œåªåœ¨è¯¥ <code>Serializer</code> å¯¹åº”çš„ <code>Model</code> å®ä¾‹è¢«ä¿®æ”¹åæ‰ä¼šåˆ·æ–°ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜å·²ç»æœ‰äººæ”¹å†™äº†æ’ä»¶ <a href="https://github.com/yinkh/django-rest-framework-cache" target="_blank" rel="external">django-rest-framework-cache</a>ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://www.yinkh.top/article/62/" target="_blank" rel="external">rest_framework_cache ä¼˜åŒ–æ¥å£è®¿é—®é€Ÿåº¦</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å¯¹ DRF çš„æ¥å£è¿›è¡Œç›‘æ§ï¼Œå‘ç°éƒ¨åˆ†é«˜é¢‘è®¿é—®çš„æ¥å£æ€§èƒ½ä¸ä½³ï¼Œå“åº”æ¯”è¾ƒæ…¢ï¼Œäºæ˜¯æƒ³é€šè¿‡ç¼“å­˜å°†æ¥å£æ€§èƒ½ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://chibisov.github.io/drf-extensions/docs/#caching&quot;&gt;drf-extensions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://drf-cached-instances.readthedocs.io/en/latest/&quot;&gt;drf-cached-instances&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Onyo/django-rest-framework-cache&quot;&gt;django-rest-framework-cache&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.django-rest-framework.org/api-guide/caching/#using-cache-with-apiview-and-viewsets&quot;&gt;django cache decorators&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https://stackoverflow.com/questions/38320008/how-to-cache-django-rest-framework-api-calls&quot;&gt;How to cache Django Rest Framework API calls&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Django" scheme="http://yoursite.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Vue CLI å¿«é€Ÿåˆ›å»º Vue é¡¹ç›®</title>
    <link href="http://yoursite.com/2019/01/19/vue-cli-create-project/"/>
    <id>http://yoursite.com/2019/01/19/vue-cli-create-project/</id>
    <published>2019-01-19T12:49:05.000Z</published>
    <updated>2019-01-20T01:42:51.965Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://cli.vuejs.org/zh/guide/" target="_blank" rel="external">Vue CLI</a> æ˜¯ä¸€ä¸ªåŸºäº Vue.js è¿›è¡Œå¿«é€Ÿå¼€å‘çš„å®Œæ•´ç³»ç»Ÿï¼Œæä¾›ï¼š</p>
<ul>
<li>é€šè¿‡ @vue/cli æ­å»ºäº¤äº’å¼çš„é¡¹ç›®è„šæ‰‹æ¶</li>
<li>é€šè¿‡ @vue/cli + @vue/cli-service-global å¿«é€Ÿå¼€å§‹é›¶é…ç½®åŸå‹å¼€å‘</li>
<li>ä¸€ä¸ªè¿è¡Œæ—¶ä¾èµ– (@vue/cli-service)ï¼Œè¯¥ä¾èµ–<ul>
<li>å¯å‡çº§</li>
<li>åŸºäº webpack æ„å»ºï¼Œå¹¶å¸¦æœ‰åˆç†çš„é»˜è®¤é…ç½®</li>
<li>å¯ä»¥é€šè¿‡é¡¹ç›®å†…çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</li>
<li>å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•</li>
</ul>
</li>
<li>ä¸€ä¸ªä¸°å¯Œçš„å®˜æ–¹æ’ä»¶é›†åˆï¼Œé›†æˆäº†å‰ç«¯ç”Ÿæ€ä¸­æœ€å¥½çš„å·¥å…·</li>
<li>ä¸€å¥—å®Œå…¨å›¾å½¢åŒ–çš„åˆ›å»ºå’Œç®¡ç† Vue.js é¡¹ç›®çš„ç”¨æˆ·ç•Œé¢</li>
</ul>
<a id="more"></a>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Vue CLI éœ€è¦ Node ç¯å¢ƒï¼Œç¡®ä¿å·²ç»å®‰è£… Node ç¯å¢ƒå’Œ npm åŒ…ç®¡ç†å·¥å…·<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ npm install -g @vue/cli</div></pre></td></tr></table></figure></p>
<h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ vue create hello-world</div><div class="line">Vue CLI v3.3.0</div><div class="line">? Please pick a preset: (Use arrow keys)</div><div class="line">â¯ default (babel, eslint)  //é»˜è®¤é€‰é¡¹æä¾› babel å’Œ eslint æ”¯æŒï¼Œé€‚åˆå¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„åŸå‹</div><div class="line">  Manually select features //æ‰‹åŠ¨é€‰æ‹©ç‰¹æ€§ï¼Œæä¾›äº†æ›´å¤šçš„é€‰é¡¹ï¼Œå®ƒä»¬æ˜¯é¢å‘ç”Ÿäº§çš„é¡¹ç›®æ›´åŠ éœ€è¦çš„</div></pre></td></tr></table></figure>
<p>ä¸Šä¸‹é”®é€‰æ‹©ã€Enter é€‰ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒé¡¹æ‰‹åŠ¨é€‰æ‹©ç‰¹æ€§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Vue CLI v3.3.0</div><div class="line">? Please pick a preset: Manually select features</div><div class="line">? Check the features needed for your project: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)</div><div class="line">â¯â—‰ Babel  //æ”¯æŒbabel</div><div class="line"> â—¯ TypeScript  //æ”¯æŒä½¿ç”¨ TypeScript ä¹¦å†™æºç </div><div class="line"> â—¯ Progressive Web App (PWA) Support</div><div class="line"> â—¯ Router //æ”¯æŒ vue-router </div><div class="line"> â—¯ Vuex  //æ”¯æŒ vuex </div><div class="line"> â—¯ CSS Pre-processors  //æ”¯æŒ CSS é¢„å¤„ç†å™¨</div><div class="line"> â—‰ Linter / Formatter  //æ”¯æŒä»£ç é£æ ¼æ£€æŸ¥å’Œæ ¼å¼åŒ–</div><div class="line"> â—¯ Unit Testing  //æ”¯æŒå•å…ƒæµ‹è¯•</div><div class="line"> â—¯ E2E Testing  //æ”¯æŒ E2E æµ‹è¯•</div></pre></td></tr></table></figure>
<p>åŸºäºå¼€å‘å¸¸è§çš„é¡¹ç›®ï¼ŒåŒæ—¶å…¼é¡¾é¡¹ç›®å¥å£®æ€§çš„åŸåˆ™ï¼Œé€‰æ‹©å¦‚ä¸‹é€‰é¡¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Vue CLI v3.3.0</div><div class="line">? Please pick a preset: Manually select features</div><div class="line">? Check the features needed for your project:</div><div class="line"> â—‰ Babel</div><div class="line"> â—‰ TypeScript</div><div class="line"> â—¯ Progressive Web App (PWA) Support</div><div class="line"> â—‰ Router</div><div class="line"> â—‰ Vuex</div><div class="line"> â—‰ CSS Pre-processors</div><div class="line"> â—‰ Linter / Formatter</div><div class="line">â¯â—‰ Unit Testing</div><div class="line"> â—¯ E2E Testing</div></pre></td></tr></table></figure>
<p>å¼€å‘ Vue ç»„ä»¶æ—¶æ˜¯å¦ä½¿ç”¨ class é£æ ¼çš„å†™æ³• ï¼ˆæ˜¯ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Vue CLI v3.3.0</div><div class="line">? Please pick a preset: Manually select features</div><div class="line">? Check the features needed for your project: Babel, TS, Router, Vuex, CSS Pre-processors, Linter, Unit</div><div class="line">? Use class-style component syntax? (Y/n) Y</div></pre></td></tr></table></figure></p>
<p>æ˜¯å¦ä½¿ç”¨ babel å·¥å…·è‡ªåŠ¨ä¸ºè½¬æ¢åçš„ TypeScript ä»£ç æ³¨å…¥ polyfiills ï¼ˆæ˜¯ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Use Babel alongside TypeScript for auto-detected polyfills? (Y/n) Y</div></pre></td></tr></table></figure></p>
<p>vue-router æ˜¯å¦ä½¿ç”¨ history æ¨¡å¼ ï¼ˆå¦ï¼Œä½¿ç”¨é»˜è®¤ hash æ¨¡å¼ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Use history mode for router? (Requires proper server setup for index fallback in production) (Y/n) n</div></pre></td></tr></table></figure></p>
<p>é¡¹ç›®é‡Œé¢ä½¿ç”¨å“ªç§ CSS é¢„å¤„ç†è¯­è¨€ï¼ˆé€‰æ‹©  LESS ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): (Use arrow keys)</div><div class="line">  Sass/SCSS</div><div class="line">â¯ Less</div><div class="line">  Stylus</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹©å“ªä¸ªè‡ªåŠ¨åŒ–ä»£ç æ ¼å¼åŒ–æ£€æµ‹ï¼ˆé€‰æ‹© ESLint + Prettier ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Pick a linter / formatter config: (Use arrow keys)</div><div class="line">  TSLint</div><div class="line">  ESLint with error prevention only</div><div class="line">  ESLint + Airbnb config</div><div class="line">  ESLint + Standard config</div><div class="line">â¯ ESLint + Prettier</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹©ä»€ä¹ˆæ—¶å€™è¿›è¡Œä»£ç è§„åˆ™æ£€æŸ¥<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)</div><div class="line">â¯â—‰ Lint on save //ä¿å­˜å°±æ£€æŸ¥</div><div class="line"> â—¯ Lint and fix on commit // fix å’Œ commit çš„æ—¶å€™æ£€æŸ¥</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹©å•å…ƒæµ‹è¯•å·¥å…· ï¼ˆ é€‰æ‹© Mocha ï¼‰</p>
<p>Mocha æ˜¯æµè¡Œçš„ JavaScript æµ‹è¯•æ¡†æ¶ä¹‹ä¸€ï¼Œé€šè¿‡å®ƒæ·»åŠ å’Œè¿è¡Œæµ‹è¯•ï¼ŒChai æ˜¯æ–­è¨€åº“<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Pick a unit testing solution: (Use arrow keys)</div><div class="line">â¯ Mocha + Chai</div><div class="line">  Jest</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹©é…ç½®æ–‡ä»¶çš„ä½ç½® ï¼ˆ é€‰æ‹©ç‹¬ç«‹æ–‡ä»¶å­˜æ”¾ ï¼‰<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.?</div><div class="line">â¯ In dedicated config files  //é…ç½®å­˜æ”¾ç‹¬ç«‹æ–‡ä»¶</div><div class="line">  In package.json  //é…ç½®å­˜æ”¾ package.json</div></pre></td></tr></table></figure></p>
<p>æ˜¯å¦å°†ä»¥ä¸Šè¿™äº›å°†æ­¤ä¿å­˜ä¸ºæœªæ¥é¡¹ç›®çš„é¢„é…ç½®ï¼Œå¯¹äº MAC ä¿å­˜çš„é…ç½®ä¿¡æ¯ä¼šæ”¾åœ¨ ~/.vuerc é‡Œé¢ ï¼ˆå¦ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">? Save this as a preset for future projects? (y/N)</div></pre></td></tr></table></figure>
<p>ä¸‹ä¸€æ­¥åˆå§‹åŒ– CLI æ’ä»¶<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Vue CLI v3.3.0</div><div class="line">âœ¨  Creating project in /Users/abner/work_space/projects/vue-project/hello-world.</div><div class="line">ğŸ—ƒ  Initializing git repository...</div><div class="line">âš™  Installing CLI plugins. This might take a while...</div><div class="line">......</div></pre></td></tr></table></figure></p>
<h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd hello-world</div><div class="line">$ npm run serve</div></pre></td></tr></table></figure>
<p>æµè§ˆå™¨çœ‹åˆ°çš„é¡µé¢å¦‚ä¸‹ï¼š</p>
<p><img src="/img/vue-cli-01.png" alt=""></p>
<p>ä»£ç ç»“æ„ï¼š</p>
<p><img src="/img/vue-cli-02.png" alt=""></p>
<h3 id="æ‰“åŒ…ä¸Šçº¿"><a href="#æ‰“åŒ…ä¸Šçº¿" class="headerlink" title="æ‰“åŒ…ä¸Šçº¿"></a>æ‰“åŒ…ä¸Šçº¿</h3><p>é¡¹ç›®å¼€å‘å®Œæˆä¹‹åéœ€è¦æ‰“åŒ…ä¸Šçº¿ï¼Œvue-cli ä¹Ÿæä¾›äº†æ‰“åŒ…çš„å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ npm run build</div></pre></td></tr></table></figure></p>
<p>æ‰“åŒ…å¥½çš„é™æ€èµ„æºä¼šä¿å­˜åœ¨ dist ç›®å½•ï¼Œç›´æ¥éƒ¨ç½²åˆ°é™æ€èµ„æºæœåŠ¡å™¨å³å¯ã€‚</p>
<h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ npm run test</div></pre></td></tr></table></figure>
<h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ vue-cli 3.0ï¼Œç›¸æ¯” vue-cli 2.X æœ‰äº›è®¸ä¸åŒ</p>
<ul>
<li>å¯åŠ¨å‘½ä»¤è¡Œæœ‰å˜åŒ–</li>
<li>é…ç½®å¯ä»¥ä¿å­˜</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://cli.vuejs.org/zh/guide/&quot;&gt;Vue CLI&lt;/a&gt; æ˜¯ä¸€ä¸ªåŸºäº Vue.js è¿›è¡Œå¿«é€Ÿå¼€å‘çš„å®Œæ•´ç³»ç»Ÿï¼Œæä¾›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ @vue/cli æ­å»ºäº¤äº’å¼çš„é¡¹ç›®è„šæ‰‹æ¶&lt;/li&gt;
&lt;li&gt;é€šè¿‡ @vue/cli + @vue/cli-service-global å¿«é€Ÿå¼€å§‹é›¶é…ç½®åŸå‹å¼€å‘&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªè¿è¡Œæ—¶ä¾èµ– (@vue/cli-service)ï¼Œè¯¥ä¾èµ–&lt;ul&gt;
&lt;li&gt;å¯å‡çº§&lt;/li&gt;
&lt;li&gt;åŸºäº webpack æ„å»ºï¼Œå¹¶å¸¦æœ‰åˆç†çš„é»˜è®¤é…ç½®&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡é¡¹ç›®å†…çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªä¸°å¯Œçš„å®˜æ–¹æ’ä»¶é›†åˆï¼Œé›†æˆäº†å‰ç«¯ç”Ÿæ€ä¸­æœ€å¥½çš„å·¥å…·&lt;/li&gt;
&lt;li&gt;ä¸€å¥—å®Œå…¨å›¾å½¢åŒ–çš„åˆ›å»ºå’Œç®¡ç† Vue.js é¡¹ç›®çš„ç”¨æˆ·ç•Œé¢&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Vue" scheme="http://yoursite.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Pipenv å¿«é€Ÿä¸Šæ‰‹</title>
    <link href="http://yoursite.com/2019/01/18/pipenv-quick-start/"/>
    <id>http://yoursite.com/2019/01/18/pipenv-quick-start/</id>
    <published>2019-01-18T09:26:22.000Z</published>
    <updated>2019-01-19T12:51:02.110Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://pipenv.readthedocs.io/en/latest/" target="_blank" rel="external">Pipenv</a> æ˜¯ Python å®˜æ–¹æ¨èçš„çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒé›†æˆäº† virtualenvã€pyenv å’Œ pip ä¸‰è€…çš„åŠŸèƒ½ã€‚ Pipenv æ˜¯ requests çš„ä½œè€… Kenneth Reitz å¤§ç¥å¼€å‘äº†ç”¨äºåˆ›å»ºå’Œç®¡ç† Python è™šæ‹Ÿç¯å¢ƒçš„å·¥å…·ã€‚</p>
<p>Pipenv ä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>ä¸ç”¨å†å•ç‹¬ä½¿ç”¨ virtualenv å’Œ pipï¼Œè€Œæ˜¯å°†ä¸¤è€…ç»“åˆ</li>
<li>ä¸ç”¨å†ç»´æŠ¤ requirements.txtï¼Œä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ¥ä»£æ›¿</li>
<li>å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨å¤šä¸ª Python ç‰ˆæœ¬</li>
<li>åœ¨å®‰è£…çš„ pyenv æ¡ä»¶ä¸‹ï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£…éœ€è¦çš„ Python ç‰ˆæœ¬</li>
<li>éšæ—¶æŸ¥çœ‹å›¾å½¢åŒ–çš„ä¾èµ–å…³ç³»</li>
</ul>
<a id="more"></a>
<h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>å’Œæ™®é€šçš„ç¬¬ä¸‰æ–¹åŒ…å®‰è£…ç›¸åŒï¼Œç›´æ¥ä½¿ç”¨ pip å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pip install pipenv</div></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h4><p>è™šæ‹Ÿç¯å¢ƒæ˜¯æ¯ä¸ª Python é¡¹ç›®çš„ç‹¬ç«‹æ‰§è¡Œç¯å¢ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd mytest</div><div class="line">$ pipenv  install</div><div class="line">Creating a virtualenv for this project...</div><div class="line">Pipfile: /root/deploys/mytest/Pipfile</div><div class="line">Using /usr/bin/python (2.7.15) to create virtualenv...</div><div class="line">â ‹ Creating virtual environment...Already using interpreter /usr/bin/python</div><div class="line">New python executable in /root/.local/share/virtualenvs/mytest-2D3nqn7b/bin/python</div><div class="line">Installing setuptools, pip, wheel...</div><div class="line">done.</div><div class="line"></div><div class="line">âœ” Successfully created virtual environment!</div><div class="line">Virtualenv location: /root/.local/share/virtualenvs/mytest-2D3nqn7b</div><div class="line">Creating a Pipfile for this project...</div><div class="line">Pipfile.lock not found, creating...</div><div class="line">Locking [dev-packages] dependencies...</div><div class="line">Locking [packages] dependencies...</div><div class="line">Updated Pipfile.lock (dfae9f)!</div><div class="line">Installing dependencies from Pipfile.lock (dfae9f)...</div><div class="line">  ğŸ   â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰ 0/0 â€” 00:00:00</div><div class="line">To activate this project&apos;s virtualenv, run pipenv shell.</div><div class="line">Alternatively, run a command inside the virtualenv with pipenv run.</div><div class="line">$ ls</div><div class="line">Pipfile  Pipfile.lock</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°é¡¹ç›®çš„ç›®å½•ä¸­åˆ›å»ºäº†è™šæ‹Ÿç¯å¢ƒï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„ Python2 ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®š Python ç‰ˆæœ¬ã€‚Pipenv ä¹Ÿè‡ªåŠ¨ä¸ºæˆ‘ä»¬é€‰æ‹©è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨ä½ç½®ï¼Œåˆ›å»ºå®Œæˆä¹‹åç›®å½•ä¸‹å‡ºç°äº† <code>Pipfile</code> å’Œ <code>Pipfile.lock</code> ä¸¤ä¸ªæ–‡ä»¶ã€‚ </p>
<h4 id="æ¿€æ´»å’Œé€€å‡ºè™šæ‹Ÿç¯å¢ƒ"><a href="#æ¿€æ´»å’Œé€€å‡ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="æ¿€æ´»å’Œé€€å‡ºè™šæ‹Ÿç¯å¢ƒ"></a>æ¿€æ´»å’Œé€€å‡ºè™šæ‹Ÿç¯å¢ƒ</h4><p>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv shell</div></pre></td></tr></table></figure>
<p>é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ exit //æˆ–è€… ctrl+d</div></pre></td></tr></table></figure>
<h4 id="å®‰è£…ç¬¬ä¸‰æ–¹åŒ…"><a href="#å®‰è£…ç¬¬ä¸‰æ–¹åŒ…" class="headerlink" title="å®‰è£…ç¬¬ä¸‰æ–¹åŒ…"></a>å®‰è£…ç¬¬ä¸‰æ–¹åŒ…</h4><p>æ—¢ç„¶ Pipenv èƒ½å¤Ÿæ›¿ä»£ pipï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨ Pipenv å‘½ä»¤æ¥å®‰è£…è½¯ä»¶åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv install requests</div><div class="line">Installing requests...</div><div class="line">Adding requests to Pipfile&apos;s [packages]...</div><div class="line">âœ” Installation Succeeded</div><div class="line">Pipfile.lock (ab273c) out of date, updating to (dfae9f)...</div><div class="line">Locking [dev-packages] dependencies...</div><div class="line">Locking [packages] dependencies...</div><div class="line">âœ” Success!</div><div class="line">Updated Pipfile.lock (ab273c)!</div><div class="line">Installing dependencies from Pipfile.lock (ab273c)...</div><div class="line">  ğŸ   â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰ 5/5 â€” 00:00:02</div><div class="line">To activate this project&apos;s virtualenv, run pipenv shell.</div><div class="line">Alternatively, run a command inside the virtualenv with pipenv run.</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ Pipenv å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ä¸éœ€è¦æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œä¼šç›´æ¥ä¸‹è½½åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ã€‚å¦‚æœä½¿ç”¨ pip å®‰è£…ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¿€æ´»é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒæ‰èƒ½ä¿è¯è½¯ä»¶åŒ…çš„æ­£ç¡®å®‰è£…ã€‚å®‰è£…å®ŒåŒ…ä¹‹åï¼ŒPipfile å’Œ Pipfile.lock ä¸¤ä¸ªæ–‡ä»¶ä¼šè¢«æ›´æ–°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat Pipfile</div><div class="line">[[source]]</div><div class="line">name = &quot;pypi&quot;</div><div class="line">url = &quot;https://pypi.org/simple&quot;</div><div class="line">verify_ssl = true</div><div class="line"></div><div class="line">[dev-packages]</div><div class="line"></div><div class="line">[packages]</div><div class="line">requests = &quot;*&quot;</div><div class="line"></div><div class="line">[requires]</div><div class="line">python_version = &quot;2.7&quot;</div><div class="line">$ cat Pipfile.lock</div><div class="line">&#123;</div><div class="line">    &quot;_meta&quot;: &#123;</div><div class="line">        &quot;hash&quot;: &#123;</div><div class="line">            &quot;sha256&quot;: &quot;9838c8bf3aa442453b393e09e534ba7e1666aab4da1b9b408ecdf3ae58ab273c&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;pipfile-spec&quot;: 6,</div><div class="line">        &quot;requires&quot;: &#123;</div><div class="line">            &quot;python_version&quot;: &quot;2.7&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;sources&quot;: [</div><div class="line">            &#123;</div><div class="line">                &quot;name&quot;: &quot;pypi&quot;,</div><div class="line">                &quot;url&quot;: &quot;https://pypi.org/simple&quot;,</div><div class="line">                &quot;verify_ssl&quot;: true</div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    &quot;default&quot;: &#123;</div><div class="line">        &quot;certifi&quot;: &#123;</div><div class="line">            &quot;hashes&quot;: [</div><div class="line">                &quot;sha256:47f9c83ef4c0c621eaef743f133f09fa8a74a9b75f037e8624f83bd1b6626cb7&quot;,</div><div class="line">                &quot;sha256:993f830721089fef441cdfeb4b2c8c9df86f0c63239f06bd025a76a7daddb033&quot;</div><div class="line">            ],</div><div class="line">            &quot;version&quot;: &quot;==2018.11.29&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;chardet&quot;: &#123;</div><div class="line">            &quot;hashes&quot;: [</div><div class="line">                &quot;sha256:84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae&quot;,</div><div class="line">                &quot;sha256:fc323ffcaeaed0e0a02bf4d117757b98aed530d9ed4531e3e15460124c106691&quot;</div><div class="line">            ],</div><div class="line">            &quot;version&quot;: &quot;==3.0.4&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;idna&quot;: &#123;</div><div class="line">            &quot;hashes&quot;: [</div><div class="line">                &quot;sha256:c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407&quot;,</div><div class="line">                &quot;sha256:ea8b7f6188e6fa117537c3df7da9fc686d485087abf6ac197f9c46432f7e4a3c&quot;</div><div class="line">            ],</div><div class="line">            &quot;version&quot;: &quot;==2.8&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;requests&quot;: &#123;</div><div class="line">            &quot;hashes&quot;: [</div><div class="line">                &quot;sha256:502a824f31acdacb3a35b6690b5fbf0bc41d63a24a45c4004352b0242707598e&quot;,</div><div class="line">                &quot;sha256:7bf2a778576d825600030a110f3c0e3e8edc51dfaafe1c146e39a2027784957b&quot;</div><div class="line">            ],</div><div class="line">            &quot;index&quot;: &quot;pypi&quot;,</div><div class="line">            &quot;version&quot;: &quot;==2.21.0&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;urllib3&quot;: &#123;</div><div class="line">            &quot;hashes&quot;: [</div><div class="line">                &quot;sha256:61bf29cada3fc2fbefad4fdf059ea4bd1b4a86d2b6d15e1c7c0b582b9752fe39&quot;,</div><div class="line">                &quot;sha256:de9529817c93f27c8ccbfead6985011db27bd0ddfcdb2d86f3f663385c6a9c22&quot;</div><div class="line">            ],</div><div class="line">            &quot;version&quot;: &quot;==1.24.1&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;develop&quot;: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Pipfile æ–‡ä»¶ä¸­è®°å½•äº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>pip ä»“åº“åœ°å€</li>
<li>éœ€è¦ä¸‹è½½å“ªäº›åŒ…ï¼Œ * è¡¨ç¤ºå§‹ç»ˆä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œdev-packages è¡¨ç¤ºä¸“ç”¨äºå¼€å‘é˜¶æ®µä½¿ç”¨çš„åŒ…</li>
<li>Python ç‰ˆæœ¬</li>
</ul>
<p>Pipfile.lock æ–‡ä»¶ä¸­è®°å½•äº†åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<ul>
<li>hash å€¼</li>
<li>ä¾èµ–å…³ç³»</li>
</ul>
<p>æœ‰äº† Pipfile æ–‡ä»¶å½“æˆ‘ä»¬æŠŠé¡¹ç›®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œç›´æ¥ pipenv install å°±è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æŠŠåŒ…å®‰è£…å¥½ã€‚</p>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><h4 id="pipenv-é€‰é¡¹"><a href="#pipenv-é€‰é¡¹" class="headerlink" title="pipenv é€‰é¡¹"></a>pipenv é€‰é¡¹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Options:</div><div class="line">  --where             Output project home information. </div><div class="line">  --venv              Output virtualenv information.</div><div class="line">  --py                Output Python interpreter information. </div><div class="line">  --envs              Output Environment Variable options.</div><div class="line">  --rm                Remove the virtualenv.</div><div class="line">  --bare              Minimal output.</div><div class="line">  --completion        Output completion (to be eval&apos;d).</div><div class="line">  --man               Display manpage.</div><div class="line">  --support           Output diagnostic information for use in GitHub issues.</div><div class="line">  --site-packages     Enable site-packages for the virtualenv.  [env var:</div><div class="line">                      PIPENV_SITE_PACKAGES]</div><div class="line">  --python TEXT       Specify which version of Python virtualenv should use.</div><div class="line">  --three / --two     Use Python 3/2 when creating virtualenv.</div><div class="line">  --clear             Clears caches (pipenv, pip, and pip-tools).  [env var:</div><div class="line">                      PIPENV_CLEAR]</div><div class="line">  -v, --verbose       Verbose mode.</div><div class="line">  --pypi-mirror TEXT  Specify a PyPI mirror.</div><div class="line">  --version           Show the version and exit.</div><div class="line">  -h, --help          Show this message and exit.</div></pre></td></tr></table></figure>
<h4 id="pipenv-å‘½ä»¤å‚æ•°"><a href="#pipenv-å‘½ä»¤å‚æ•°" class="headerlink" title="pipenv å‘½ä»¤å‚æ•°"></a>pipenv å‘½ä»¤å‚æ•°</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Commands:</div><div class="line">  check      Checks for security vulnerabilities and against PEP 508 markers</div><div class="line">             provided in Pipfile.</div><div class="line">  clean      Uninstalls all packages not specified in Pipfile.lock.</div><div class="line">  graph      Displays currently-installed dependency graph information.</div><div class="line">  install    Installs provided packages and adds them to Pipfile, or (if no</div><div class="line">             packages are given), installs all packages from Pipfile.</div><div class="line">  lock       Generates Pipfile.lock.</div><div class="line">  open       View a given module in your editor.</div><div class="line">  run        Spawns a command installed into the virtualenv.</div><div class="line">  shell      Spawns a shell within the virtualenv.</div><div class="line">  sync       Installs all packages specified in Pipfile.lock.</div><div class="line">  uninstall  Un-installs a provided package and removes it from Pipfile.</div><div class="line">  update     Runs lock, then sync.</div></pre></td></tr></table></figure>
<h4 id="pipenv-å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹"><a href="#pipenv-å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹" class="headerlink" title="pipenv å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹"></a>pipenv å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹</h4><p>åˆ›å»ºé¡¹ç›®è™šæ‹Ÿç¯å¢ƒæŒ‡å®š Python ç‰ˆæœ¬<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv --python 3.7</div><div class="line">$ pipenv --python 2.7.15</div></pre></td></tr></table></figure></p>
<p>ä¸å¿…æ˜¾å¼æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œç”¨è™šæ‹Ÿæœºç¯å¢ƒæ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv run python -m http.server</div><div class="line">$ pipenv run python test.py</div></pre></td></tr></table></figure>
<p>è½¯ä»¶åŒ…åªå®‰è£…åˆ°å¼€å‘ç¯å¢ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv install pytest --dev</div></pre></td></tr></table></figure>
<p>åˆ é™¤è™šæ‹Ÿç¯å¢ƒï¼Œè¯¥æ“ä½œä¼šæŠŠè™šæ‹Ÿç¯å¢ƒç›®å½•å’Œé‡Œé¢æ‰€æœ‰çš„ä¾èµ–åŒ…åˆ é™¤ï¼Œä½†æ˜¯ Pipfile å’Œ Pipfile.lock æ–‡ä»¶ä¼šä¿ç•™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv --rm</div></pre></td></tr></table></figure>
<p>åˆ é™¤è½¯ä»¶åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv uninstall requests</div></pre></td></tr></table></figure>
<p>ç”Ÿæˆ requirements.txt æ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv lock -r</div><div class="line">$ pipenv lock -r -d //ç”Ÿæˆ dev-packages çš„ requirements.txt</div></pre></td></tr></table></figure>
<p>å¯¼å…¥ requirements.txt </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv install -r requirements.txt</div></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºä¾èµ–æ ‘</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv graph</div></pre></td></tr></table></figure>
<p>å®‰å…¨æ£€æŸ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pipenv check</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://pipenv.readthedocs.io/en/latest/&quot;&gt;Pipenv&lt;/a&gt; æ˜¯ Python å®˜æ–¹æ¨èçš„çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒé›†æˆäº† virtualenvã€pyenv å’Œ pip ä¸‰è€…çš„åŠŸèƒ½ã€‚ Pipenv æ˜¯ requests çš„ä½œè€… Kenneth Reitz å¤§ç¥å¼€å‘äº†ç”¨äºåˆ›å»ºå’Œç®¡ç† Python è™šæ‹Ÿç¯å¢ƒçš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;Pipenv ä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç”¨å†å•ç‹¬ä½¿ç”¨ virtualenv å’Œ pipï¼Œè€Œæ˜¯å°†ä¸¤è€…ç»“åˆ&lt;/li&gt;
&lt;li&gt;ä¸ç”¨å†ç»´æŠ¤ requirements.txtï¼Œä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ¥ä»£æ›¿&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨å¤šä¸ª Python ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;åœ¨å®‰è£…çš„ pyenv æ¡ä»¶ä¸‹ï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£…éœ€è¦çš„ Python ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;éšæ—¶æŸ¥çœ‹å›¾å½¢åŒ–çš„ä¾èµ–å…³ç³»&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>æ‘„å½±çŸ¥è¯†å¿«é€Ÿå…¥é—¨</title>
    <link href="http://yoursite.com/2018/12/23/%E6%91%84%E5%BD%B1%E7%9F%A5%E8%AF%86%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2018/12/23/æ‘„å½±çŸ¥è¯†å¿«é€Ÿå…¥é—¨/</id>
    <published>2018-12-23T13:40:17.000Z</published>
    <updated>2018-12-23T13:43:27.468Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸‰æµçš„æ‘„å½±å¸ˆæ¯”å™¨æï¼ŒäºŒæµçš„æ‘„å½±å¸ˆæ¯”æŠ€æœ¯ï¼Œä¸€æµçš„æ‘„å½±å¸ˆæ¯”æ€æƒ³ã€‚</p>
<blockquote>
<p>â€œç…§ç‰‡ä»æ¥ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå®ƒæ€»æ˜¯åœ¨ä¸æ–­çš„æå‡ºé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå¦‚æœä½ èƒ½ä¸æ–­çš„æå‡ºé—®é¢˜ï¼Œä½ å°±ä¼šä¸æ–­çš„æŒ‰ä¸‹å¿«é—¨ï¼ŒæŠŠä½ çš„æ€æƒ³å’Œç–‘é—®ä¼ è¾¾å‡ºæ¥ã€‚å¦‚æœè§‚ä¼—çœ‹è¿‡ä½ çš„ç…§ç‰‡åä¹Ÿè‰¯ä¹…é©»è¶³ï¼Œæ€è€ƒç€ä½ çš„æ€è€ƒï¼Œç–‘é—®ç€ä½ çš„ç–‘é—®ï¼Œé‚£æ‚¨å°±å¿«æ¥è¿‘æ‘„å½±çš„æœ€é«˜å¢ƒç•Œäº†â€        ã€Šè®ºæ‘„å½±ã€‹</p>
</blockquote>
<h2 id="æ‘„å½±åè¯"><a href="#æ‘„å½±åè¯" class="headerlink" title="æ‘„å½±åè¯"></a>æ‘„å½±åè¯</h2><h3 id="ISO"><a href="#ISO" class="headerlink" title="ISO"></a>ISO</h3><p>ISOï¼ˆæ„Ÿå…‰åº¦ï¼‰æ˜¯CCDï¼ˆCharge Coupled Deviceï¼Œç”µå­æ„Ÿå…‰èŠ¯ç‰‡ï¼‰æˆ–æ˜¯èƒ¶å·å¯¹å…‰çº¿çš„æ•æ„Ÿç¨‹åº¦ã€‚<br><a id="more"></a><br>æ•°ç ç›¸æœºçš„ä¸»èœå•é‡Œéƒ½æœ‰ISOé€‰æ‹©ï¼Œ100ï¼Œ200ï¼Œ400æˆ–è€…800ç­‰ï¼Œæ•°å­—è¶Šå¤§è¶Šæ•æ„Ÿï¼ˆæ„Ÿå…‰åº¦è¶Šé«˜ï¼‰ã€‚å¦‚æœç”¨ISO100çš„èƒ¶å·ï¼Œç›¸æœº2ç§’å¯ä»¥æ­£ç¡®æ›å…‰çš„è¯ï¼ŒåŒæ ·å…‰çº¿æ¡ä»¶ä¸‹ç”¨ISO200çš„èƒ¶å·åªéœ€è¦1ç§’å³å¯ï¼Œç”¨ISO400åˆ™åªè¦0.5ç§’ã€‚é«˜ISOè™½ç„¶é€Ÿåº¦å¿«ä½†å›¾åƒé¢—ç²’ç²—ï¼Œç»ä¸èµ·ç²¾ç»†æ”¾å¤§ã€‚é«˜ISOä¸€èˆ¬åœ¨ä¸‡ä¸å¾—å·²çš„æ—¶å€™æ‰ç”¨ï¼Œ<code>é«˜ISOå›¾ç‰‡è´¨é‡æ˜¯æ•°ç ç›¸æœºæœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚</code></p>
<p>ç®€å•çš„æ¥è¯´ï¼Œæé«˜ISOå°±æ˜¯æé«˜ç”µå­æ”¾å¤§å€æ•°ï¼Œå¾®å¼±çš„å…‰çº¿åªèƒ½äº§ç”Ÿå¾®å¼±çš„ç”µå­ä¿¡å·ï¼Œè¿™ä¸ªæ—¶å€™æ•°ç ç›¸æœºçš„æ”¾å¤§ç”µè·¯å·¥ä½œï¼ŒæŠŠä¿¡å·æ”¾å¤§æ¥å¾—åˆ°æ­£ç¡®çš„æ›å…‰ç…§ç‰‡ï¼Œä½†å™ªç‚¹å¤šï¼Œç»†èŠ‚ä¸¢å¤±ï¼Œé¢œè‰²å¤±çœŸã€‚</p>
<p>åŒæ ·åƒç´ çš„æ™®é€šæ•°ç ç›¸æœºå’Œå•åç›¸æœºçš„é«˜ISOå›¾ç‰‡è´¨é‡å·®åˆ«å¾ˆå¤§ï¼Œä¸»è¦åŸå› æ˜¯æ™®é€šç›¸æœºå’Œå•åç›¸æœºçš„æ„Ÿå…‰èŠ¯ç‰‡å¤§å°ï¼ˆé¢ç§¯ï¼‰ä¸åŒã€‚æ„Ÿå…‰èŠ¯ç‰‡CCDå°±æ˜¯ä¸€ä¸ªå…‰ç”µè½¬æ¢å™¨ï¼ŒæŠŠå…‰ç…§è½¬å˜ä¸ºå¯è®°å½•çš„ç”µå­ä¿¡å·ã€‚å‡å¦‚CCDä¸º1000ä¸‡åƒç´ ï¼Œè¦æ­£ç¡®æ›å…‰ï¼Œæ¯ä¸ªåƒç´ ç‚¹å¿…é¡»è¦æœ‰ä¸€å®šçš„å…‰ç…§å¼ºåº¦ã€‚åŒæ ·çš„æ›å…‰æ—¶é—´ï¼Œé¢ç§¯å¤§çš„CCDæ¥å—çš„é˜³å…‰å¤šï¼Œåˆ†é…åˆ°æ¯ä¸ªåƒç´ ç‚¹çš„å…‰ç…§å……åˆ†ï¼Œè¿™æ ·å›¾ç‰‡çš„ç»†èŠ‚ä¼šæ›´ä¸°å¯Œï¼Œå™ªç‚¹å°‘ï¼Œé¢œè‰²å‡†ç¡®ã€‚<code>åœ¨åŒç­‰æŠ€æœ¯æ¡ä»¶ä¸‹ï¼Œå¦‚åƒç´ ç›¸ç­‰ï¼ŒCCDé¢ç§¯è¶Šå¤§ï¼Œé«˜ISOçš„æˆåƒè´¨é‡è¶Šå¥½ã€‚</code></p>
<h3 id="å¿«é—¨"><a href="#å¿«é—¨" class="headerlink" title="å¿«é—¨"></a>å¿«é—¨</h3><p><code>å¿«é—¨æ˜¯èƒ½å¤Ÿå‡†ç¡®çš„æ§åˆ¶æ›å…‰æ—¶é—´çš„è£…ç½®ã€‚</code></p>
<p>å¿«é—¨æœ‰æœºæ¢°å¿«é—¨ã€ç”µå­å¿«é—¨ä»¥åŠç”µå­æœºæ¢°è”åˆå¿«é—¨ã€‚</p>
<h4 id="å®‰å…¨å¿«é—¨é€Ÿåº¦"><a href="#å®‰å…¨å¿«é—¨é€Ÿåº¦" class="headerlink" title="å®‰å…¨å¿«é—¨é€Ÿåº¦"></a>å®‰å…¨å¿«é—¨é€Ÿåº¦</h4><p>å®‰å…¨é€Ÿåº¦æ˜¯ç„¦è·çš„å€’æ•°ï¼Œå¦‚æœç”¨50mmé•œå¤´ï¼Œå¿«é—¨é€Ÿåº¦ä¸è¦ä½äº1/50ç§’ï¼Œä½¿ç”¨200mmé•œå¤´é€Ÿåº¦ä¸ä½äº1/200ç§’ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¦åˆ™ç…§ç‰‡ä¼šç³Šã€‚</p>
<h3 id="å…‰åœˆ"><a href="#å…‰åœˆ" class="headerlink" title="å…‰åœˆ"></a>å…‰åœˆ</h3><p><code>å…‰åœˆå°±æ˜¯é•œå¤´é‡Œè°ƒèŠ‚è¿›å…‰å­”å¤§å°çš„è£…ç½®ã€‚</code></p>
<p>æ‰€æœ‰ç›¸æœºéƒ½æ˜¯åŸºäºå°å­”æˆåƒåŸç†ï¼šæ‹¿ä¸€ä¸ªå¯†å°ç®±å­ï¼Œåœ¨ä»»ä½•ä¸€é¢é’»ä¸ªå°åœ†å­”ï¼Œçª—å¤–çš„æ™¯è±¡æ¯”å¦‚ä¸€æ£µæ ‘ä»€ä¹ˆçš„ï¼Œå°±ä¼šåœ¨åœ†å­”å¯¹é¢çš„ç®±å†…å£ç”Ÿæˆæ­¤æ ‘çš„å€’å½±ã€‚å‡å¦‚åœ¨ç®±å­å°å­”å¯¹é¢çš„å†…å£æ¶‚ä¸Šæ„Ÿå…‰ææ–™ï¼Œè¿™ä¸ªæœ‰å­”çš„ç®±å­å°±æ˜¯ä¸€å°é’ˆå­”ç›¸æœºã€‚</p>
<p>æ—¢ç„¶ä¸€å°ç…§ç›¸æœºå¯ä»¥ä¸éœ€è¦é•œå¤´ï¼Œä¸ºä»€ä¹ˆç°åœ¨çš„ç›¸æœºå‰é¢ä¸æ˜¯ä¸€ä¸ªå°åœ†å­”è€Œæ˜¯å‡ å—ç»ç’ƒå‘¢ï¼Ÿè€Œä¸”è¿™å‡ å—ç»ç’ƒè¿˜å–å¾—é‚£ä¹ˆè´µã€‚è¿™æ˜¯å› ä¸ºå°å­”è¦æˆåƒçš„è¯ï¼Œå­”å¿…é¡»å¾ˆå°ï¼Œå¦‚æœå­”å¼€å¾—å’Œé—¨ä¸€æ ·å¤§ï¼Œè¿™ä¸ªå­”å°±æˆä¸äº†åƒã€‚å­”å°è¿›å…‰é‡å°±å°ï¼Œé’ˆå­”æ‘„å½±ä¸€å¼ ç…§ç‰‡æ›å…‰å‡ å°æ—¶åˆ°å‡ åä¸ªå°æ—¶éƒ½å¸¸è§ã€‚æˆ‘ä»¬è¦æƒ³åŠæ³•åŠ å¤§è¿›å…‰é‡ã€‚å‡¸é•œæœ‰èšå…‰åŠŸèƒ½ã€‚æŠŠç»ç’ƒå‡¸é•œè£…åˆ°å¤§å­”ä¸Šï¼Œé—®é¢˜ä¸å°±è§£å†³äº†ï¼Ÿ</p>
<p>ç¡®å®å¦‚æ­¤ã€‚é•œå¤´å°±æ˜¯è¿™æ ·è¯ç”Ÿçš„ã€‚ä»Šå¤©çš„å„ç§é•œå¤´éƒ½æ˜¯å‡ å—å‡¹å‡¸é•œçš„æ’åˆ—ç»„åˆï¼Œç„¶åç”¨å¡‘æ–™æˆ–é“çš®ä¸€åŒ…ã€‚æœ‰äº†é•œå¤´ï¼Œå°å­”æˆåƒçš„è¿™ä¸ªå­”ï¼ˆå…‰åœˆï¼‰å°±ä¸å†æ˜¯é’ˆå­”äº†ï¼Œå®ƒå˜æˆäº†æ´ã€‚</p>
<p>å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½éœ€è¦å¤§æ´ã€‚å¤æ—¥æ²™æ»©ä¸Šçƒˆæ—¥å½“å¤´ï¼Œå››å¤„ç™½èŠ±èŠ±ä¸€ç‰‡ï¼Œä¸ºäº†åˆ†æ¸…åˆ°åº•æ˜¯äººè‚‰è¿˜æ˜¯ç™½æ²™ï¼Œæˆ‘ä»¬éœ€è¦çœ¯ç€çœ¼ç›ä»”ç»†è§‚å¯Ÿã€‚é•œå¤´æ˜¯ç…§ç›¸æœºçš„çœ¼ç›ï¼Œè¿™æ—¶å€™ç›¸æœºä¹Ÿéœ€è¦çœ¯èµ·çœ¼ç›ã€‚<code>ä¸ºäº†åº”ä»˜ä¸åŒçš„å…‰çº¿å¼ºåº¦ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»™é•œå¤´è£…ä¸Šèƒ½å¤Ÿè°ƒèŠ‚è¿™ä¸ªæ´å¤§å°çš„è£…ç½®ï¼Œä»¥ä¾¿åœ¨å¼ºå…‰æ—¶ç¼©å°ä¸ºé’ˆå­”ï¼Œå¼±å…‰æ—¶å¼€æˆå¤§æ´ã€‚è¿™ä¸ªè£…ç½®å°±æ˜¯å…‰åœˆï¼ˆApertureï¼‰ã€‚ä¸€ç»„å‡¹å‡¸é•œå†åŠ ä¸Šå…‰åœˆå°±è¯ç”Ÿäº†å®Œæ•´çš„é•œå¤´ã€‚</code></p>
<p>å¸¸è§çš„å…‰åœˆå€¼å¦‚ä¸‹ï¼šF1ï¼ŒF1.4ï¼ŒF2ï¼ŒF2.8ï¼ŒF4ï¼ŒF5.6ï¼ŒF8ï¼ŒF11ï¼ŒF16ï¼ŒF22ï¼ŒF32ï¼ŒF44ï¼ŒF64ã€‚<code>æ¯ä¸¤æŒ¡ç›¸é‚»å…‰åœˆå€¼ä¹‹é—´è¿›å…‰é‡ç›¸å·®ä¸€å€ã€‚ä¾‹å¦‚å…‰åœˆä»F4è°ƒåˆ°F2.8ï¼Œè¿›å…‰é‡ä¾¿å¤šä¸€å€ï¼›ä»F2.8åˆ°F2åˆå¤šä¸€å€ã€‚å…‰åœˆå€¼å’Œå…‰åœˆå®é™…å¤§å°æ˜¯ç›¸åçš„ï¼Œè¿›å…‰é‡æœ€å¤§æ—¶å…‰åœˆä¸ºF1ï¼Œæœ€å°æ—¶ä¸ºF64ã€‚</code></p>
<p><img src="/img/aperture.png" alt=""></p>
<h3 id="æ›å…‰"><a href="#æ›å…‰" class="headerlink" title="æ›å…‰"></a>æ›å…‰</h3><blockquote>
<p>å‡è®¾ä¸€ä¸ªé»‘ä¹ä¹çš„å¯†é—­æˆ¿é—´ï¼Œä¸€é¢å¢™å£ä¸Šå¼€äº†ä¸ªå°åœ†çª—æˆ·ï¼Œåœ¨çª—å¯¹é¢çš„å†…å£ä¸Šå®‰ä¸Šæ„Ÿå…‰ææ–™å°±æ˜¯ä¸€å°å¤§å‹æˆ¿å¼ç…§ç›¸æœºã€‚åœ¨æ²¡æœ‰æ‰“å¼€å°çª—ä¹‹å‰ï¼Œæˆ¿é—´é‡Œæ˜¯é»‘ä¹ä¹çš„ã€‚ä¸Šå¸è¯´ï¼šè¦æœ‰å…‰ã€‚æˆ‘ä»¬æ‰“å¼€å°çª—ï¼Œå…‰çº¿ä»å°å­”è€Œå…¥ï¼Œå°„åˆ°å¯¹é¢å¢™å£çš„èƒ¶å·ä¸Šï¼Œäº§ç”Ÿå…‰åŒ–ååº”ï¼ˆæˆ–CCDå…‰ç”µååº”ï¼‰ï¼Œå›¾åƒå°±è¯ç”Ÿäº†ã€‚æ­¤è¿‡ç¨‹å°±å«æ›å…‰ã€‚è¦æ­£ç¡®æ›å…‰å¿…é¡»ç²¾ç¡®å†³å®šæ›å…‰é‡ï¼Œä¹Ÿå°±æ˜¯è®©å¤šå°‘å…‰è¿›å…¥æˆ¿é—´ã€‚å…‰åœˆå’Œå¿«é—¨éƒ½å¯ä»¥æ§åˆ¶æ›å…‰é‡ã€‚æ›å…‰å°±æ˜¯å…‰åœˆå’Œå¿«é—¨çš„ç»„åˆã€‚å…‰åœˆå¤§å°å…¶å®å°±æ˜¯å°åœ†çª—æˆ·å¼€å¤šå¤§ï¼Œå¿«é—¨ï¼ˆé€Ÿåº¦ï¼‰å°±æ˜¯çª—æˆ·å¼€å¤šä¹…ã€‚è‹¥çª—æˆ·å¼€1/4ï¼Œæ—¶é—´4ç§’èƒ½æ­£ç¡®æ›å…‰ï¼Œå¾ˆæ˜¾ç„¶çª—æˆ·æ‰“å¼€1/2ï¼Œæ—¶é—´2ç§’é’Ÿä¹Ÿèƒ½æ­£ç¡®æ›å…‰ã€‚å¦‚æœçª—æˆ·å…¨å¼€ï¼Œæ›å…‰æ—¶é—´å°±åªè¦1ç§’äº†ã€‚</p>
</blockquote>
<p>ä¸€å¼ æ­£ç¡®æ›å…‰çš„å›¾ç‰‡å¯ä»¥æœ‰Nç§ä¸åŒçš„å…‰åœˆå’Œå¿«é—¨ç»„åˆã€‚</p>
<p>æœ‰ä¸‰ä¸ªå› ç´ èƒ½å½±å“ä¸€å¼ å›¾ç‰‡æ˜¯å¦æ­£ç¡®æ›å…‰ï¼š<code>å…‰åœˆï¼Œå¿«é—¨é€Ÿåº¦ï¼ŒISOã€‚</code>å…¶ä¸­å…‰åœˆå’Œé€Ÿåº¦è”åˆå†³å®šè¿›å…‰é‡ï¼ŒISOå†³å®šCCDæ„Ÿå…‰é€Ÿåº¦ã€‚è¿›å…‰é‡ä¸å¤Ÿåˆ™å¯å¼€å¤§å…‰åœˆæˆ–è€…å¢åŠ æ›å…‰æ—¶é—´ï¼Œè¿˜ä¸å¤Ÿå°±æé«˜ISOã€‚å¤§å…‰åœˆçš„è§£åƒåº¦ä¸å¥½ï¼Œå¿«é—¨é€Ÿåº¦ä½åˆ™å›¾ç‰‡å¯èƒ½ä¼šç³Šï¼Œé«˜ISOå›¾ç‰‡è´¨é‡ä¹Ÿå·®ã€‚</p>
<h3 id="æµ‹å…‰ä¸æµ‹å…‰æ¨¡å¼"><a href="#æµ‹å…‰ä¸æµ‹å…‰æ¨¡å¼" class="headerlink" title="æµ‹å…‰ä¸æµ‹å…‰æ¨¡å¼"></a>æµ‹å…‰ä¸æµ‹å…‰æ¨¡å¼</h3><p>æ›å…‰å’Œæµ‹å…‰æ˜¯ä¸€å¯¹åŒèƒèƒï¼Œä¸æµ‹å®šå…‰ç…§å¼ºåº¦æ­£ç¡®æ›å…‰å°±æ— ä»è°ˆèµ·ã€‚æ‰€æœ‰çš„æ•°ç ç›¸æœºéƒ½å†…ç½®æµ‹å…‰è¡¨ï¼Œå®ƒèƒ½æµ‹é‡å…‰çº¿çš„å¼ºåº¦ï¼Œè‡ªåŠ¨ç»™å‡ºæ­£ç¡®æ›å…‰çš„å…‰åœˆå’Œå¿«é—¨ã€‚æ•°ç ç›¸æœºé‡Œéƒ½æœ‰ä¸€ä¸ªå…‰æ•ç”µé˜»ï¼ˆå…‰ç…§ä¸åŒæ—¶ç”µé˜»ä¸åŒï¼‰ï¼Œç›¸æœºå†…æ ¹æ®ç”µé˜»çš„å˜åŒ–å°±èƒ½ç¡®å®šå…‰çº¿å¼ºåº¦ï¼Œè¿›è€Œç¡®å®šæ›å…‰å€¼ã€‚</p>
<p>æµ‹å…‰æ¨¡å¼ä¸»è¦æœ‰<code>ç‚¹æµ‹å…‰ï¼Œä¸­å¤®é‡ç‚¹æµ‹å…‰ï¼ŒåŒºåŸŸï¼ˆå¹³å‡ï¼‰æµ‹å…‰ä¸‰ç§ã€‚</code></p>
<p>ç‚¹æµ‹å…‰åªæµ‹å–æ™¯æ¡†å†…ä¸­å¤®å°ç‚¹çš„å…‰çº¿å¼ºåº¦ã€‚åŒºåŸŸï¼ˆå¹³å‡ï¼‰æµ‹å…‰åˆ™æŠŠå–æ™¯æ¡†åˆ†ä¸ºå¾ˆå¤šå°å—ï¼Œåˆ†åˆ«å¯¹æ¯å—æµ‹å…‰å†åŠ æƒå¹³å‡å¾—åˆ°å…‰ç…§å¼ºåº¦ã€‚ä¸­å¤®é‡ç‚¹æµ‹å…‰åªæŠŠå–æ™¯æ¡†åˆ†ä¸ºä¸­å¤®åœ†åœˆå’Œå››å‘¨ä¸¤å—åˆ†åˆ«æµ‹å…‰ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨åŒºåŸŸå¹³å‡æµ‹å…‰å³å¯ï¼Œåœ¨æ˜æš—åå·®å¾ˆå¤§æ—¶å¤šé‡‡ç”¨ç‚¹æµ‹å…‰ã€‚</p>
<h3 id="æ›å…‰è¡¥å¿"><a href="#æ›å…‰è¡¥å¿" class="headerlink" title="æ›å…‰è¡¥å¿"></a>æ›å…‰è¡¥å¿</h3><p>æ›å…‰æ˜¯å¦å‡†ç¡®æ˜¯æ ¹æ®ç»éªŒåˆ¤æ–­çš„ã€‚æ€»åŸåˆ™ï¼š<code>ç…§ç‰‡è¦çœŸå®åæ˜ æ‹æ‘„æ—¶çš„ç¯å¢ƒäº®åº¦ã€‚</code>å¦‚æœæ­£åˆé˜³å…‰æˆ·å¤–è¢«æ‹å¾—æ˜æš—å¦‚å¤œï¼Œè¿™å°±æ˜¯æ›å…‰ä¸è¶³ï¼›å¤œæ™¯æ‹å¾—è·Ÿç™½å¤©ä¸€æ ·åˆ™æ˜¯æ›å…‰è¿‡åº¦ã€‚ç›¸æœºè‡ªåŠ¨ç¡®å®šçš„æ›å…‰å€¼90%ä»¥ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œä½†ä¹Ÿæœ‰ä¸å‡†çš„ï¼Œå¦‚é›ªæ™¯åº”è¯¥çº¯ç™½æ‹å‡ºæ¥å´æ˜¯ç°è‰²ï¼Œæˆ–çº¯é»‘çš„ç…¤çƒæ‹å‡ºæ¥å´æ˜¯ç°ç…¤ã€‚</p>
<p>å‡è®¾ä¸¤ä¸ªæç«¯ï¼Œçº¯é»‘ç‰©ä½“åå°„ç‡ä¸ºé›¶ï¼Œçº¯ç™½ç‰©ä½“åå°„ç‡æ˜¯100%ã€‚åœ¨è¿™ä¸¤ä¸ªæç«¯å–ä¸­é—´å€¼å°±æ˜¯ä¸é»‘ä¹Ÿä¸ç™½çš„ç°è‰²ï¼Œç§°æŸ¯è¾¾ç°ï¼Œä¹Ÿç§°18åº¦ä¸­é—´ç°ã€‚</p>
<p>ä»¥å®¢å…ä¸ºä¾‹ï¼Œå¢™å£åˆç™½åˆäº®ï¼Œç”µè§†æœºå±å¹•åˆé»‘åˆæš—ï¼Œå®¶å…·ç­‰äº®åº¦å±…ä¸­ã€‚è¦ä»¥è°çš„äº®åº¦æ¥ç¡®å®šæ›å…‰ï¼Ÿç›¸æœºè‡ªåŠ¨æµ‹å…‰å°±æ˜¯å–å¹³å‡æ•°ï¼Œæœ€åç»™å‡ºä¸€ä¸ªè®©å›¾ç‰‡è¾¾åˆ°ä¸­é—´ç°çš„æ›å…‰å€¼ã€‚</p>
<p>ç›¸æœºçš„è‡ªåŠ¨æµ‹å…‰æ˜¯ä¸ªæ­»è„‘ç­‹ï¼Œå®ƒè®¤ä¸ºå…¨ä¸–ç•Œæ‰€æœ‰åœºæ™¯çš„å¹³å‡äº®åº¦éƒ½æ˜¯18åº¦ä¸­é—´ç°ã€‚å¥½åœ¨å¤§éƒ¨åˆ†ç”Ÿæ´»åœºæ™¯å¹³å‡èµ·æ¥å·®ä¸å¤šä¹Ÿæ˜¯ç°è‰²ã€‚ä½†åœ¨é›ªæ™¯æˆ–è€…ç…¤çƒç­‰çº¯è‰²åœºæ™¯ï¼Œç›¸æœºä¾ç„¶ç»™å‡ºä¸­é—´ç°çš„æ›å…‰å€¼ï¼Œæ‹å‡ºæ¥å°±ä¼šç™½é›ªæˆç°é›ªï¼Œç…¤çƒæˆç°çƒã€‚<code>æ­¤æ—¶æˆ‘ä»¬å°±è¦å¯¹è‡ªåŠ¨æ›å…‰äºˆä»¥ä¿®æ­£ï¼Œå¯¹é›ªæ™¯å¢åŠ æ›å…‰ï¼Œç…¤çƒå‡å°‘æ›å…‰ï¼Œè¿™æ ·æ‰èƒ½æ‹å‡ºäº®åº¦æ­£ç¡®çš„ç…§ç‰‡ã€‚å¢å‡æ›å…‰å€¼å°±å«æ›å…‰è¡¥å¿ã€‚</code></p>
<p><strong>æ›å…‰è¡¥å¿åŸåˆ™ï¼šç™½åŠ é»‘å‡ã€‚å¦‚æœæœ‰å¤§ç‰‡ç™½è‰²ç‰©ä½“æˆ–æœ‰å¼ºç¯ç­‰ç‰¹åˆ«æ˜äº®çš„ç‰©ä½“å°±è¦å¢åŠ æ›å…‰é‡ï¼›æœ‰å¤§ç‰‡é»‘è‰²ç‰©ä½“åˆ™è¦å‡å°‘æ›å…‰é‡ã€‚</strong></p>
<h3 id="ç„¦è·ä¸ç„¦è·è½¬æ¢ç³»æ•°"><a href="#ç„¦è·ä¸ç„¦è·è½¬æ¢ç³»æ•°" class="headerlink" title="ç„¦è·ä¸ç„¦è·è½¬æ¢ç³»æ•°"></a>ç„¦è·ä¸ç„¦è·è½¬æ¢ç³»æ•°</h3><p>é•œå¤´çš„ç„¦è·å°±æ˜¯ä»é•œç‰‡ï¼ˆæˆ–é•œç‰‡ç»„ï¼‰çš„ä¸­å¿ƒåˆ°åº•ç‰‡(CCD)çš„è·ç¦»ï¼Œå•ä½æ¯«ç±³ï¼ˆmmï¼‰ã€‚å¯¹å…¨å¹…135æ•°ç å•åæ¥è¯´ï¼Œ50mmé•œå¤´ä¸ºæ ‡å‡†é•œå¤´ï¼Œç®€ç§°æ ‡å¤´ã€‚<code>æ ‡å¤´ä¸¥æ ¼çš„å®šä¹‰ï¼šç„¦è·ç­‰äºåº•ç‰‡ï¼ˆæˆ–CCDï¼‰å¯¹è§’çº¿é•¿åº¦çš„é•œå¤´ã€‚</code>å•å¼ 135åº•ç‰‡å¯¹è§’çº¿é•¿åº¦ä¸º43mmï¼Œæˆ‘ä»¬æŠŠç„¦è·40-60mmçš„éƒ½ç§°ä¸ºæ ‡å¤´ã€‚</p>
<p>è¯·æ³¨æ„ï¼šä¸€ä¸ªé•œå¤´æ˜¯ä¸æ˜¯æ ‡å¤´ä¸æ˜¯çœ‹ç„¦è·è€Œæ˜¯çœ‹è§†è§’ï¼Œè§†è§’45åº¦å·¦å³å°±æ˜¯æ ‡å‡†é•œå¤´ã€‚å¯¹120ç›¸æœºæ¥è¯´80-110mmç„¦è·çš„é•œå¤´æ‰æ˜¯æ ‡å¤´ã€‚å¯¹Nikon D5000ç­‰éå…¨å¹…æ•°ç å•åï¼Œ35mmæ‰æ˜¯æ ‡å¤´ã€‚</p>
<p><code>å¹¿è§’é•œå¤´ï¼ˆç„¦è·å°äº35mmï¼‰</code>èƒ½å¤Ÿè®©ç…§ç›¸æœºâ€œçœ‹å¾—æ›´å®½å¹¿â€ï¼Œå› ä¸ºå®ƒè§†è§’å¤§ï¼›<code>é•¿ç„¦é•œå¤´ï¼ˆç„¦è·å¤§äº70mmï¼‰</code>èƒ½è®©ç…§ç›¸æœºâ€œçœ‹å¾—æ›´è¿œâ€ï¼Œä½†è§†è§’çª„ã€‚é•¿ç„¦é•œå¤´ä¹Ÿç§°è¿œæ‘„é•œå¤´æˆ–æœ›è¿œé•œå¤´ã€‚å¹¿è§’é•œå¤´éƒ½èº«æçŸ®å°ï¼Œé•¿ç„¦é•œå¤´éƒ½é«˜å¤§å¨çŒ›ã€‚</p>
<h3 id="å…‰å­¦å˜ç„¦ä¸æ•°ç å˜ç„¦"><a href="#å…‰å­¦å˜ç„¦ä¸æ•°ç å˜ç„¦" class="headerlink" title="å…‰å­¦å˜ç„¦ä¸æ•°ç å˜ç„¦"></a>å…‰å­¦å˜ç„¦ä¸æ•°ç å˜ç„¦</h3><p>æ•°ç ç›¸æœºä¸Šéƒ½å†™ç€XXå€å…‰å­¦å˜ç„¦ï¼ˆOptical Zoomï¼‰ã€‚<code>å˜ç„¦å€æ•°ï¼æœ€å¤§ç„¦è·/æœ€å°ç„¦è·ã€‚</code>ä¸€ä¸ª28-280mmé•œå¤´çš„å…‰å­¦å˜ç„¦å€æ•°æ˜¯280mm/28mm=10å€ã€‚å€æ•°è¶Šå¤§é•œç‰‡è¶Šå¤šï¼Œä½“ç§¯ç›¸åº”è¾ƒå¤§ï¼Œç”»è´¨ç›¸å¯¹è¾ƒä½ï¼Œå…‰åœˆç›¸å¯¹è¾ƒå°ã€‚å¦‚Nikon P90å…‰å­¦å˜ç„¦ä¸º26-624mmï¼ˆ24å€ï¼‰ï¼Œä½†å®æµ‹é•œå¤´è¾¹ç¼˜è§£åƒåº¦å·®ï¼Œçœ‹æ¥24å€å·²ç»æ¥è¿‘å…‰å­¦å˜ç„¦ç›®å‰çš„æŠ€æœ¯æé™äº†ã€‚</p>
<p>æ•°ç å˜ç„¦åªæ˜¯ç”µå­æ”¾å¤§ï¼Œè½¯ä»¶ç¨ä½œæ”¹åŠ¨å°±å¯ä»¥ä»ä¸€å€åˆ°ä¸€ä¸‡å€å˜ç„¦ä»»å›è‡ªå–ã€‚å…‰å­¦å˜ç„¦æ‰æ˜¯çœŸæ­£çš„å˜ç„¦ã€‚</p>
<p><img src="/img/zoom.png" alt=""></p>
<h3 id="æ™¯æ·±ä¸å…‰åœˆä¼˜å…ˆ"><a href="#æ™¯æ·±ä¸å…‰åœˆä¼˜å…ˆ" class="headerlink" title="æ™¯æ·±ä¸å…‰åœˆä¼˜å…ˆ"></a>æ™¯æ·±ä¸å…‰åœˆä¼˜å…ˆ</h3><p><code>æ™¯æ·±å°±æ˜¯ç…§ç‰‡ç„¦ç‚¹å‰åå»¶ä¼¸å‡ºæ¥çš„â€œå¯æ¥å—æ¸…æ™°åŒºåŸŸâ€ã€‚</code>å®ƒåªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œç›¸æœºä¸Šå¹¶æ²¡æœ‰ä¸€ä¸ªå¼€å…³å«æ™¯æ·±ã€‚æ¸…æ™°ä¸å¦ä¹Ÿæ²¡æœ‰ç»å¯¹æ ‡å‡†ã€‚ä¸€å¼ åˆå½±è‹¥äººè„¸å¾ˆæ¸…æ™°ï¼Œå‰é¢çš„é²œèŠ±å’Œåé¢å»ºç­‘ç‰©éƒ½æ¨¡ç³Šï¼Œæ¸…æ™°åŒºåŸŸåªé™äºäººï¼Œæˆ‘ä»¬å°±ç§°æ­¤ç…§ç‰‡æ™¯æ·±è¾ƒæµ…ï¼ˆå°ï¼‰ã€‚è‹¥äººé²œèŠ±å’Œå»ºç­‘ç‰©éƒ½æ¸…æ™°ï¼Œç…§ç‰‡çš„æ¸…æ™°åŒºåŸŸå¾ˆå¹¿ï¼Œå°±ç§°æ™¯æ·±å¾ˆå¤§ã€‚é£å…‰æ‘„å½±ä¸€èˆ¬éœ€è¦å¤§æ™¯æ·±ï¼Œå‰åæ™¯ç‰©éƒ½è¦æ¸…æ¥šã€‚</p>
<p>æœ‰ä¸‰ä¸ªå› ç´ å†³å®šæ™¯æ·±ï¼š</p>
<ul>
<li>å…‰åœˆå¤§å°</li>
<li>ç„¦è·é•¿çŸ­</li>
<li>è¢«æ‘„ç‰©ä½“çš„è¿œè¿‘</li>
</ul>
<p>æ™¯æ·±çš„ç¡®å®šåŸåˆ™ï¼š</p>
<ul>
<li>å…‰åœˆè¶Šå¤§ï¼Œæ™¯æ·±è¶Šå°</li>
<li>ç„¦è·è¶Šé•¿ï¼Œæ™¯æ·±è¶Šå°</li>
<li>ç¦»è¢«æ‘„ç‰©ä½“è¶Šè¿‘ï¼Œæ™¯æ·±è¶Šå°</li>
</ul>
<p>è‹¥é•œå¤´çš„æœ€å°å…‰åœˆä¸ºF22ï¼Œè¿™æ—¶å€™æ™¯æ·±æœ€å¤§ï¼Œåœ¨F2.8çš„æ—¶å€™æ™¯æ·±æœ€å°ï¼ˆå¦‚æœæ­¤é•œå¤´æœ€å¤§å…‰åœˆæ˜¯F2.8ï¼‰ã€‚ç„¦è·è¶Šé•¿æ™¯æ·±è¶Šå°è¿™ä¸ªå¥½ç†è§£ï¼Œå¹¿è§’é•œå¤´æ™¯æ·±å¤§ï¼Œé•¿ç„¦é•œå¤´æ™¯æ·±å°ã€‚å®é™…ä¸Š17mmçš„è¶…å¹¿è§’é•œå¤´å¦‚æœä½¿ç”¨F11ä»¥ä¸‹çš„ä¸­å°å…‰åœˆï¼Œéšä¾¿ä½ æœä½•å¤„å¯¹ç„¦ï¼Œå‰åæ™¯ç‰©éƒ½æ¸…æ™°ã€‚200mmæˆ–æ›´é•¿çš„é•œå¤´æ™¯æ·±å¾ˆå°ï¼Œä¸€å®šè¦ä»”ç»†å°å¿ƒå¯¹ç„¦ï¼Œæœ€å¥½åœ¨ä¸‰è§’æ¶ä¸Šæ‹ã€‚ç¦»è¢«æ‘„ç‰©ä½“è¶Šè¿‘ï¼Œæ™¯æ·±è¶Šå°ã€‚æ‰€ä»¥åœ¨è¶…è¿‘è·ç¦»æ‹æ‘„æ—¶è¦ç‰¹åˆ«å°å¿ƒå¯¹ç„¦ï¼Œä¾‹å¦‚ç”¨å¾®è·é•œå¤´æ‹èŠ±èŠ±è‰è‰æˆ–å°ç‹—è„¸éƒ¨ç‰¹å†™ã€‚</p>
<h4 id="å…‰åœˆçš„ä¸‰ä¸ªä½œç”¨"><a href="#å…‰åœˆçš„ä¸‰ä¸ªä½œç”¨" class="headerlink" title="å…‰åœˆçš„ä¸‰ä¸ªä½œç”¨"></a>å…‰åœˆçš„ä¸‰ä¸ªä½œç”¨</h4><ul>
<li><p>æ§åˆ¶è¿›å…‰é‡</p>
</li>
<li><p>æ§åˆ¶æ™¯æ·±ã€‚å…‰åœˆè¶Šå°ï¼Œæ™¯æ·±è¶Šå¤§ã€‚è™½ç„¶ç„¦è·å’Œæ‹æ‘„è¿œè¿‘éƒ½å½±å“æ™¯æ·±ï¼Œä½†ç„¦è·å’Œè¢«æ‘„ç‰©è¿œè¿‘çš„æ”¹å˜åŒæ—¶ä¹Ÿä¼šæ”¹å˜æ„å›¾ã€‚å½“æ„å›¾ç¡®å®šï¼Œèƒ½æ§åˆ¶æ™¯æ·±çš„æ­¦å™¨å°±åªå‰©ä¸‹å…‰åœˆäº†ã€‚</p>
</li>
<li><p>å…‰åœˆå½±å“å›¾ç‰‡çš„æ¸…æ™°åº¦ã€‚ä»»ä½•ä¸€ä¸ªé•œå¤´éƒ½æ˜¯ä¸­ç­‰å…‰åœˆæ—¶æˆåƒæœ€å¥½ï¼ˆæœ€æ¸…æ™°ï¼‰ï¼Œæœ€å¤§å…‰åœˆå’Œæœ€å°å…‰åœˆæ—¶è§£åƒåº¦å·®ã€‚</p>
</li>
</ul>
<h4 id="å…‰åœˆä¼˜å…ˆ"><a href="#å…‰åœˆä¼˜å…ˆ" class="headerlink" title="å…‰åœˆä¼˜å…ˆ"></a>å…‰åœˆä¼˜å…ˆ</h4><p>å…‰åœˆä¼˜å…ˆï¼ˆAperture Priorityï¼‰ï¼šæ‰‹åŠ¨ç¡®å®šå…‰åœˆçš„å¤§å°ï¼Œç›¸æœºä¼šæ ¹æ®è¿™ä¸ªå…‰åœˆå€¼ç¡®å®šèƒ½æ­£ç¡®æ›å…‰çš„å¿«é—¨é€Ÿåº¦ã€‚å¤§å†™çš„Aæˆ–è€…Avå°±ä»£è¡¨å…‰åœˆä¼˜å…ˆæ¨¡å¼ã€‚</p>
<p>æ›å…‰æ˜¯å…‰åœˆå’Œå¿«é—¨çš„ç»„åˆï¼Œå…‰åœˆä¼˜å…ˆå¯¹åº”çš„æ¦‚å¿µæ˜¯<code>å¿«é—¨ä¼˜å…ˆæˆ–é€Ÿåº¦ä¼˜å…ˆï¼šæ‰‹åŠ¨ç¡®å®šå¿«é—¨é€Ÿåº¦ï¼Œç›¸æœºä¼šæ ¹æ®è¿™ä¸ªå¿«é—¨é€Ÿåº¦ç¡®å®šèƒ½æ­£ç¡®æ›å…‰çš„å…‰åœˆå¤§å°ã€‚ç®€å†™ä¸ºTæˆ–Tvã€‚</code>åœ¨æŸäº›æ—¶å€™å¿«é—¨é€Ÿåº¦å¾ˆé‡è¦ï¼Œè¦å®šæ ¼è¿åŠ¨å‘˜å†²åˆºæ’çº¿ï¼Œå¿«é—¨é€Ÿåº¦æœ€å¥½åœ¨1/500ç§’ç”šè‡³æ›´å¿«ï¼›å¦‚æœè¦æŠŠæµæ°´æ‹å¾—å¦‚ä¸èˆ¬æŸ”æ»‘ï¼Œå¿«é—¨é€Ÿåº¦è¦åœ¨0.5ç§’æˆ–è€…æ›´æ…¢ã€‚</p>
<h3 id="ç™½å¹³è¡¡ä¸RAW"><a href="#ç™½å¹³è¡¡ä¸RAW" class="headerlink" title="ç™½å¹³è¡¡ä¸RAW"></a>ç™½å¹³è¡¡ä¸RAW</h3><p>è¦äº†è§£ç™½å¹³è¡¡white balanceå°±å¿…é¡»å…ˆäº†è§£å¦ä¸€ä¸ªæ¦‚å¿µï¼šè‰²æ¸©color temperaturetã€‚æ‰€è°“è‰²æ¸©å°±æ˜¯ä»¥å¼€å°”æ–‡æ¸©åº¦è¡¨ç¤ºå…‰çº¿çš„è‰²å½©ï¼Œå•ä½æ˜¯Kã€‚ç‰©ä½“è¢«åŠ çƒ­åˆ°ä¸€å®šçš„æ¸©åº¦æ—¶å°±ä¼šå‘å‡ºå…‰çº¿ï¼Œæ­¤å…‰çº¿ä¸ä»…å«æœ‰äº®åº¦çš„æˆä»½ï¼Œä¹Ÿå«æœ‰é¢œè‰²çš„æˆä»½ã€‚æ¸©åº¦è¶Šé«˜ï¼Œè“è‰²çš„æˆä»½è¶Šå¤šï¼Œå›¾åƒå°±ä¼šåè“ï¼›æ¸©åº¦è¶Šä½ï¼Œçº¢è‰²çš„æˆä»½å°±è¶Šå¤šï¼Œå›¾åƒå°±ä¼šåçº¢ã€‚</p>
<p><img src="/img/color_temperaturet.png" alt=""></p>
<h4 id="å…‰çº¿è‰²æ¸©"><a href="#å…‰çº¿è‰²æ¸©" class="headerlink" title="å…‰çº¿è‰²æ¸©"></a>å…‰çº¿è‰²æ¸©</h4><p>ä¸åŒè‰²æ¸©çš„å…‰æºä¸‹ç‰©ä½“ä¼šå‘ˆç°ä¸åŒçš„è‰²è°ƒï¼Œåœ¨æ—¥å…‰ç¯ä¸‹æ•´ä½“åç™½ï¼Œåœ¨æ™®é€šç™½ç‚½ç¯ä¸‹æ•´ä½“åé»„ã€‚<code>ç™½å¹³è¡¡å°±æ˜¯ç›¸æœºåœ¨ä¸åŒå…‰æºä¸‹å¯¹ç™½è‰²çš„è¿˜åŸã€‚</code>æœ‰æ—¶å€™ç›¸æœºå¯¹è‰²æ¸©åˆ¤æ–­é”™è¯¯ï¼Œä¸¥é‡åè“æˆ–å‘é»„ã€‚è¿™æ—¶æˆ‘ä»¬å°±è¦æ‰‹åŠ¨è®¾ç½®ç™½å¹³è¡¡ã€‚ä¸‡ä¸€äººè„‘ä¹Ÿåˆ¤æ–­é”™è¯¯æ€ä¹ˆåŠï¼Ÿè¦å½»åº•è§£å†³ç™½å¹³è¡¡å’Œè‰²æ¸©å‡†ç¡®æ€§åªæœ‰ä¸€ä¸ªæ–¹æ¡ˆï¼šé€‰æ‹©RAWå­˜å‚¨æ ¼å¼ã€‚</p>
<p>å¸¸ç”¨çš„å›¾ç‰‡å‹ç¼©å­˜å‚¨æ ¼å¼ä¸ºJPEGæˆ–JPGã€‚ä½†JPEGæ˜¯ä¸€ç§æœ‰æŸå‹ç¼©ï¼ŒæŸäº›ç»†èŠ‚ä¸¢å¤±ã€‚å¤§éƒ¨åˆ†ç›¸æœºéƒ½æœ‰å›¾ç‰‡è´¨é‡é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯JPEGå‹ç¼©æ¯”é€‰æ‹©ï¼Œå‹ç¼©å¾—è¶Šå‰å®³ï¼Œæ–‡ä»¶è¶Šå°ï¼Œä¸€å¼ å¡èƒ½å­˜å‚¨æ›´å¤šç…§ç‰‡ï¼Œä½†ç»†èŠ‚ä¸¢å¤±æ›´å¤šã€‚</p>
<blockquote>
<p>æ•°ç ç›¸æœºCCDç»æ›å…‰äº§ç”Ÿç”µå­ä¿¡å·ï¼Œç›¸æœºæŠŠç”µå­ä¿¡å·è¿›è¡Œå¤„ç†ï¼Œå†ä¼ ç»™å­˜å‚¨å¡ã€‚è¿™äº›å¤„ç†åŒ…æ‹¬ç™½å¹³è¡¡é…ç½®ï¼Œé¢œè‰²é¥±å’Œåº¦çš„å¢å‡ï¼Œé”åº¦å’Œå¯¹æ¯”åº¦å¢å‡ï¼Œé™å™ªç­‰ï¼Œæœ€åå‹ç¼©ä¸ºJPEGæ ¼å¼å­˜å‚¨ã€‚</p>
</blockquote>
<p>RAWè‹±æ–‡æ˜¯åŸå§‹çš„æ„æ€ï¼Œè¿™å¾ˆå¥½åœ°è¯´æ˜äº†RAWå›¾ç‰‡çš„ç‰¹ç‚¹ï¼š<code>å®ƒæ˜¯åŸå§‹çš„ï¼ŒCCDäº§ç”Ÿçš„ç”µå­ä¿¡å·ç›´æ¥ä¼ ç»™å­˜å‚¨å¡ï¼Œæ²¡æœ‰ç»è¿‡ç›¸æœºçš„ä»»ä½•å¤„ç†ï¼Œæ²¡æœ‰ä¸€ç‚¹ç»†èŠ‚ä¸¢å¤±ã€‚</code>æˆ‘ä»¬å›å®¶ååœ¨ç”µè„‘ä¸Šå¯ä»¥ç»™RAWå›¾ç‰‡ä»»æ„é…ç½®è‰²æ¸©ï¼ˆå½»åº•è§£å†³ç™½å¹³è¡¡é—®é¢˜ï¼‰ï¼Œè°ƒæ•´é¢œè‰²ï¼Œé”åº¦ï¼Œå¯¹æ¯”åº¦ï¼Œæ›å…‰ç­‰ç­‰ã€‚æ¡Œé¢ç”µè„‘æ¯”ç›¸æœºå†…çš„å°ç”µè„‘å¼ºå¤§å¾—å¤šï¼ŒåæœŸç²¾å¿ƒå¤„ç†RAWè½¬æ¢æˆçš„JPEGå›¾ç‰‡è‚¯å®šæ¼‚äº®ã€‚</p>
<p>RAWçš„é—®é¢˜è¿˜æ˜¯æ–‡ä»¶å¤ªå¤§ï¼Œè€Œä¸”å¤„ç†è´¹æ—¶é—´ã€‚å¦‚æœæ—…è¡Œåå¤©æ‹äº†ä¸Šåƒå¼ RAWï¼ŒåæœŸå¤„ç†ä¼šè®©äººå¤´å˜å¾—å·¨å¤§ã€‚è¿˜å¥½å¾ˆå¤šç›¸æœºå¯ä»¥åŒæ—¶å­˜å‚¨JPEGå’ŒRAWï¼Œå¦‚æœJPEGå›¾ç‰‡è¿˜ä¸é”™å°±ä¸ç”¨å¤„ç†RAWäº†ã€‚é‡è¦çš„æ‹æ‘„å­˜JPEG+RAWï¼Œä¸€èˆ¬å›¾ç‰‡å­˜JPEGã€‚</p>
<h2 id="åŸºæœ¬æ‘„å½±æ€æƒ³"><a href="#åŸºæœ¬æ‘„å½±æ€æƒ³" class="headerlink" title="åŸºæœ¬æ‘„å½±æ€æƒ³"></a>åŸºæœ¬æ‘„å½±æ€æƒ³</h2><p>ä¸€å¼ å¥½ç…§ç‰‡å¿…é¡»æœ‰ä¸€ä¸ªé²œæ˜çš„ä¸»é¢˜ï¼Œå¹¶ä¸”èƒ½æ­£ç¡®çš„è¡¨è¾¾ä¸»é¢˜ã€‚</p>
<p>ä¸»è¦éœ€ä»ä¸¤æ–¹é¢åŠªåŠ›ï¼š</p>
<ul>
<li><p>ç²¾å¿ƒæ„å›¾</p>
</li>
<li><p>ç†Ÿç»ƒæŒæ¡å…‰åœˆå¿«é—¨ç­‰æŠ€æœ¯æ´»</p>
</li>
</ul>
<h3 id="æ„å›¾çš„åŸåˆ™å’Œæ–¹æ³•"><a href="#æ„å›¾çš„åŸåˆ™å’Œæ–¹æ³•" class="headerlink" title="æ„å›¾çš„åŸåˆ™å’Œæ–¹æ³•"></a>æ„å›¾çš„åŸåˆ™å’Œæ–¹æ³•</h3><p>æ‘„å½±æœ€é‡è¦çš„æ˜¯ï¼šå’Œä¸»é¢˜æ— å…³çš„äº‹ç‰©ä¸€å¾‹æ’é™¤åœ¨å–æ™¯æ¡†ä¹‹å¤–ã€‚åœ¨æŒ‰ä¸‹å¿«é—¨å‰ä¸€å®šè¦æƒ³æƒ³ï¼šèƒ½å¦ç»§ç»­å‡å°‘å–æ™¯æ¡†å†…çš„äº‹ç‰©ï¼Ÿå¦‚æœå†æ’é™¤ä¸€ä¸ªé‚£æˆ‘æƒ³è¡¨è¾¾çš„æ„æ€å°±ä¸å®Œæ•´äº†ï¼Œè¿™æ—¶æ‰å¯ä»¥æŒ‰ä¸‹å¿«é—¨ã€‚<code>æ‘„å½±æ˜¯åšå‡æ³•ã€‚</code></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>ç®€æ´äºŒå­—æ˜¯æ‘„å½±æ„å›¾æœ€åŸºæœ¬çš„åŸåˆ™ã€‚</code>åªæœ‰åœ¨å®Œå…¨è´¯å½»äº†è¿™ä¸ªåŸåˆ™ï¼Œç¡®å®šä¸€å¼ å›¾ç‰‡é‡Œç»å¯¹ä¸èƒ½ç¼ºå°‘çš„äº‹ç‰©ä¹‹åï¼Œæ‰è°ˆå¾—ä¸Šå¦‚ä½•åœ¨å–æ™¯æ¡†é‡Œå¦‚ä½•æ‘†æ”¾è¿™äº›äº‹ç‰©ã€‚</p>
<h4 id="æ„å›¾æ³•"><a href="#æ„å›¾æ³•" class="headerlink" title="æ„å›¾æ³•"></a>æ„å›¾æ³•</h4><p>æœ€é‡è¦çš„æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>é»„é‡‘åˆ†å‰²æ³•</li>
<li>å¯¹ç§°æ³•</li>
<li>æ»¡æ¡†æ³•</li>
</ul>
<h5 id="é»„é‡‘åˆ†å‰²æ³•"><a href="#é»„é‡‘åˆ†å‰²æ³•" class="headerlink" title="é»„é‡‘åˆ†å‰²æ³•"></a>é»„é‡‘åˆ†å‰²æ³•</h5><p>æŠŠä¸€æ¡çº¿åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œä½¿å…¶ä¸­ä¸€éƒ¨åˆ†ä¸å…¨é•¿ä¹‹æ¯”ç­‰äºå¦ä¸€éƒ¨åˆ†ä¸è¿™éƒ¨åˆ†ä¹‹æ¯”ï¼Œå…¶æ¯”å€¼æ˜¯0.618ï¼Œè¿™ä¸ªåˆ†å‰²ç‚¹å°±æ˜¯é»„é‡‘åˆ†å‰²ç‚¹ã€‚é»„é‡‘åˆ†å‰²åœ¨æ‰€æœ‰çš„æ„å›¾åŸåˆ™é‡Œæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªï¼Œå¾ˆå¤šæ•°ç ç›¸æœºåœ¨èœå•é‡Œéƒ½æœ‰æ˜¯å¦æ‰“å¼€æ„å›¾çº¿çš„é€‰æ‹©ï¼Œæ‰“å¼€åæ¶²æ™¶å±å°±ä¼šå‡ºç°ä¹å®«æ ¼ï¼Œå››æ¡çº¿æŠŠå–æ™¯æ¡†é•¿å®½å„ä½œä¸‰ç­‰åˆ†ã€‚<code>æ„å›¾æ—¶æˆ‘ä»¬åº”è¯¥æŠŠç…§ç‰‡ä¸­çš„ä¸»ä½“ï¼ˆè§†è§‰ç„¦ç‚¹ï¼‰æ‘†åœ¨ä¸‰ç­‰åˆ†çº¿ä¸Šæˆ–è€…ä¸‰ç­‰åˆ†çº¿çš„äº¤ç‚¹ä¸Šã€‚</code>é€šä¿—çš„è¯´ï¼Œä¸è¦æŠŠä¸»ä½“æ”¾åœ¨æ­£ä¸­é—´ï¼Œé‚£æ ·ç…§ç‰‡æ˜¾å¾—å¾ˆå‘†æ¿ï¼Œè¦é å·¦å³/ä¸Šä¸‹ä¸€äº›æ‰å¥½çœ‹ã€‚å®é™…æ‹æ‘„ä¸­å¹¶æ²¡æœ‰å¿…è¦ä¸¥æ ¼éµå®ˆ0.618æ¯”1æˆ–è€…1æ¯”3ï¼Œå¤šä¸€ç‚¹å°‘ä¸€ç‚¹å‡å¯ï¼Œåªè¦çœ‹èµ·æ¥èˆ’æœå°±å¥½ã€‚</p>
<p><code>å›¾ç‰‡çš„è§†è§‰ç„¦ç‚¹:</code>è§†è§‰ç„¦ç‚¹å°±æ˜¯ä¸€å¼ å›¾ç‰‡æœ€å¸å¼•äººçš„åœ°æ–¹ã€‚åœ¨çœ‹ä¸€å¼ æœ‰æ˜æ˜¾è§†è§‰ç„¦ç‚¹çš„ç…§ç‰‡æ—¶ï¼Œç¬¬ä¸€çœ¼æˆ‘ä»¬è‚¯å®šä¼šè¢«å›¾ç‰‡æœ€é†’ç›®çš„ç‚¹æ‰€å¸å¼•ï¼Œç„¶åæˆ‘ä»¬ä¼šçœ‹çœ‹å›¾ç‰‡çš„å››å‘¨æœ‰äº›ä»€ä¹ˆï¼Œæœ€åç›®å…‰è¿˜æ˜¯ä¼šé›†ä¸­åˆ°è§†è§‰ç„¦ç‚¹ä¸Šã€‚è¿™å°±æ˜¯æˆ‘ä»¬çœ‹å›¾ç‰‡çš„è§†è§‰ä¹ æƒ¯ï¼šé›†ä¸­-åˆ†æ•£-å†é›†ä¸­ã€‚</p>
<h4 id="å¯¹ç§°æ³•"><a href="#å¯¹ç§°æ³•" class="headerlink" title="å¯¹ç§°æ³•"></a>å¯¹ç§°æ³•</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œ70%ä»¥ä¸Šçš„å›¾ç‰‡å¯ä»¥ç”¨é»„é‡‘åˆ†å‰²æ„å›¾æ³•ï¼Œä½†å¯¹æœ‰äº›å›¾ç‰‡é»„é‡‘åˆ†å‰²å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚å…¸å‹çš„ä¾‹å­æ˜¯å»ºç­‘ã€‚å¤§å¤šæ•°å»ºç­‘éƒ½æ˜¯å¯¹ç§°ç»“æ„ï¼Œå¼ºè¡ŒæŒ‰ç…§é»„é‡‘åˆ†å‰²æ¥æ„å›¾åè€Œç ´åäº†åŸæœ‰çš„ç¾æ„Ÿã€‚æ°´é¢å€’å½±ä¹Ÿæ˜¯ä¸€ä¾‹ã€‚å¯¹å€’å½±å’Œå»ºç­‘ç­‰æœ¬æ¥å¯¹ç§°çš„æ™¯ç‰©æ˜¾ç„¶æˆ‘ä»¬åº”è¯¥é¡ºå…¶è‡ªç„¶é‡‡ç”¨å¯¹ç§°æ„å›¾æ³•ï¼Œä¸€åŠå¯¹ä¸€åŠã€‚å¯¹ç§°å¯ä»¥æ˜¯å·¦å³ï¼Œä¸Šä¸‹ï¼Œä¹Ÿå¯ä»¥æ–œç€å¯¹ç§°ã€‚</p>
<blockquote>
<p>å¯¹ç§°å¹¶ä¸ä¸€å®šè¦æ˜¯åŒä¸€ç±»å‹ç‰©ä½“ï¼ˆå»ºç­‘æˆ–å€’å½±ï¼‰ï¼Œä¸åŒçš„äº‹ç‰©ä¹Ÿå¯ä»¥å¯¹ç§°ï¼Œæˆ–ç§°ä¹‹ä¸ºå¯¹æ¯”ã€‚</p>
</blockquote>
<h4 id="æ»¡æ¡†ä¸ç•™ç™½"><a href="#æ»¡æ¡†ä¸ç•™ç™½" class="headerlink" title="æ»¡æ¡†ä¸ç•™ç™½"></a>æ»¡æ¡†ä¸ç•™ç™½</h4><p>é»„é‡‘åˆ†å‰²åŠ ä¸Šå¯¹ç§°æ„å›¾èƒ½æå®š85%ä»¥ä¸Šçš„å›¾ç‰‡ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€äº›å›¾ç‰‡è®©äººå·¦å³ä¸ºéš¾ã€‚é‚£å°±å¹²è„†æŠŠä¸»ä½“å……æ»¡å–æ™¯æ¡†ï¼Œæ’é™¤ä»»ä½•å…¶ä»–ç‰©ä½“ï¼ˆç®€æ´åˆ°æé™ï¼‰ã€‚è¿™å°±æ˜¯æ»¡æ¡†æ„å›¾åŸåˆ™ã€‚</p>
<p>æ»¡æ¡†å¾€å¾€æ„å‘³ç€æ„å›¾åªå–å±€éƒ¨ï¼Œå¹¶ä¸ä¸€å®šè¦æŠŠä¸»ä½“æ‹å…¨ï¼Œè§‚ä¼—èƒ½æ ¹æ®å±€éƒ¨æƒ³è±¡å…¨å±€ã€‚è¿™æ˜¯ä¸€ç§æç«¯æ„å›¾ï¼Œå®ƒæœ€å¤§é™åº¦åœ°çªå‡ºä¸»é¢˜ã€‚å®ƒçš„ä¼˜ç‚¹ä¹Ÿæ˜¯å®ƒçš„ç¼ºç‚¹ï¼šå¤ªæ»¡äº†ï¼Œè®©äººæ„Ÿè§‰å µå¾—æ…Œã€‚å¤§å¤šæ•°æƒ…å†µä¸‹è¿˜æ˜¯è¦ç»™ç”»é¢ç•™ç‚¹ç©ºå‡ºæ°”ï¼Œè¿™å°±æ˜¯æ„å›¾æ—¶çš„ç•™ç™½ã€‚ç•™å¤šå°‘åˆé€‚ï¼Ÿä¸€èˆ¬æ¥è¯´ç•™1/4æˆ–è€…1/5ã€‚ç•™åœ¨å›¾ç‰‡çš„ä»€ä¹ˆåœ°æ–¹ï¼Ÿå¯ä»¥æ˜¯ä»»ä½•ä½ç½®ã€‚ç•™ç™½å››åˆ†ä¹‹ä¸€åŸåˆ™ä¹Ÿè¦çµæ´»æŒæ¡ï¼Œå¤šä¸€ç‚¹å°‘ä¸€ç‚¹çœ‹å…·ä½“éœ€è¦ã€‚</p>
<p>ç•™ç™½ä¹Ÿå¯ä»¥èµ°æç«¯ï¼Œè¿™å°±æ˜¯ä¸æ»¡æ¡†ç›¸åçš„ç•™ç™½æ„å›¾æ³•ï¼šä¸»ä½“åªåœ¨å–æ™¯æ¡†å†…å ä¸€ä¸ªå°è§’è½ï¼Œå…¶ä»–åœ°æ–¹å¤§é‡ç©ºç™½ã€‚è¿™æ˜¯ä¸€ç§åå‘è¡¬æ‰˜ï¼Œå¤§é‡ç©ºç™½æŠŠè§‚ä¼—çš„æ³¨æ„åŠ›å¸å¼•åˆ°éç©ºç™½å¤„-ç…§ç‰‡è§’è½çš„ä¸»ä½“ä¸Šã€‚ ç•™ç™½å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯æ–¹ä¾¿ç¼–è¾‘æ’ç‰ˆï¼Œç©ºç™½å¤„å¯ä¾›å†™å­—ã€‚å¦‚æœä½ çš„ç…§ç‰‡æ—¥åè¦ç»™æ‚å¿—ç¤¾ï¼Œå¤§é‡ç•™ç™½éœ€è¦é‡ç‚¹è€ƒè™‘ã€‚</p>
<h4 id="å…¶ä»–æ„å›¾æ³¨æ„äº‹é¡¹"><a href="#å…¶ä»–æ„å›¾æ³¨æ„äº‹é¡¹" class="headerlink" title="å…¶ä»–æ„å›¾æ³¨æ„äº‹é¡¹"></a>å…¶ä»–æ„å›¾æ³¨æ„äº‹é¡¹</h4><p>1.å¯»æ‰¾æœ‰è¶£çš„å½¢çŠ¶</p>
<blockquote>
<p>è¿™å¯ä»¥ä»å®è§‚å’Œå¾®è§‚ä¸¤æ–¹é¢å»æ‰¾ã€‚å®è§‚å°±æ˜¯ä»å¤§åœºæ™¯æ‰¾ã€‚é€šå¸¸è¿™æ„å‘³ç€åœ¨ä¸€å¤§ç‰‡æ™¯è§‚ä¸­å–å±€éƒ¨ã€‚æ‘„å½±å°±è¦å……åˆ†å‘æŒ¥è¿™ç§å®è§‚æƒ³è±¡åŠ›ã€‚</p>
<p>å¾®è§‚æ‰¾å½¢çŠ¶å°±æ˜¯è¦è§†åŠ›å¥½ï¼Œçœ¼å…‰æ¯’ï¼Œä»å‡ è‹±å¯¸å‡ å˜ç±³çš„å°é¢ç§¯ä¸Šå‘ç°æœ‰è¶£çš„å½¢çŠ¶ã€‚è¿™é€šå¸¸ä¹Ÿæ˜¯ç‰©ä½“çš„å¾®å°å±€éƒ¨ã€‚å¯»æ‰¾æœ‰è¶£å½¢çŠ¶è¿˜æ˜¯æ„å‘³ç€è¿½æ±‚ç®€æ´ï¼Œä¸è¦è´ªå¤šæ˜¯æ„å›¾çš„æ€»åŸåˆ™ã€‚</p>
</blockquote>
<p>2.å‰æ™¯ä¸èƒŒæ™¯</p>
<blockquote>
<p>å‰æ™¯æŒ‡ç…§ç‰‡ä¸­ä½äºä¸»ä½“å‰é¢ã€é è¿‘é•œå¤´çš„ä»»ä½•æ™¯ç‰©ã€‚å®ƒçš„ä½œç”¨æ˜¯å¢å¼ºç”»é¢çš„ç©ºé—´æ„Ÿï¼Œæé«˜ç”»é¢çš„æ„ŸæŸ“åŠ›ï¼Œä¹Ÿèƒ½èµ·åˆ°äº¤å¾…æ‹æ‘„åœ°ç‚¹ï¼ˆç¯å¢ƒï¼‰çš„ä½œç”¨ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå®ƒä½¿ç…§ç‰‡èƒ½ä¼ è¾¾å°½å¯èƒ½å¤šçš„ä¿¡æ¯ã€‚å¥½çš„å‰æ™¯è¿˜å…¼æœ‰å¼•å¯¼è§†çº¿çš„ä½œç”¨ã€‚</p>
</blockquote>
<p>3.åŒ…å›´æ„å›¾</p>
<blockquote>
<p>æ„å›¾ç®€æ´ç¬¬ä¸€é‡è¦ï¼Œä½†å‡¡äº‹æ²¡æœ‰ç»å¯¹ï¼Œå¦‚æœå…¨æ™¯ä¸å±€éƒ¨éš¾ä»¥å†³å®šï¼Œæˆ–ä¸èƒ½ç¡®å®šæ˜¯å¦åº”è¯¥åŒ…å«æŸä¸€ç‰©ä½“ï¼Œé‚£å°±åŒ…å«ä¸å¦éƒ½æ‹ï¼Œå›å®¶å†ä»”ç»†åˆ†æå“ªå¼ æ•ˆæœå¥½ã€‚åæ­£æ•°ç ç‰‡å­ä¸ç”¨èŠ±é’±ä¹°èƒ¶å·ã€‚åˆ†æå¤šäº†å°±çŸ¥é“ä»¥åå¦‚ä½•å–èˆäº†ã€‚åŒ…å›´æ„å›¾è¿™ä¸ªè¯æ˜¯æˆ‘è‡ªå·±å‘æ˜çš„ï¼Œå’ŒåŒ…å›´æ›å…‰ç›¸å¯¹åº”ã€‚</p>
</blockquote>
<p>4.æ¨ªæ‹ä¸ç«–æ‹</p>
<p><strong>æ€»ä¹‹ï¼Œè§„åˆ™æ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„ï¼Œå±€é™äºæ¡æ¡æ¡†æ¡†æ²¡æœ‰å¿…è¦ã€‚ä¸€å¼ ç…§ç‰‡å¯èƒ½æ¯«æ— æ„å›¾æ³•åˆ™å¯è¨€ï¼Œä¹Ÿå¯èƒ½æ˜¯å¥½å‡ æ¡æ„å›¾æ³•çš„ç»¼åˆã€‚</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://www.midphoto.com/chinese/essays/essays.htm" target="_blank" rel="external">æ•°ç æ—¶ä»£æ—…æ¸¸æ‘„å½±å¿«é€ŸæŒ‡å—</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸‰æµçš„æ‘„å½±å¸ˆæ¯”å™¨æï¼ŒäºŒæµçš„æ‘„å½±å¸ˆæ¯”æŠ€æœ¯ï¼Œä¸€æµçš„æ‘„å½±å¸ˆæ¯”æ€æƒ³ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œç…§ç‰‡ä»æ¥ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå®ƒæ€»æ˜¯åœ¨ä¸æ–­çš„æå‡ºé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå¦‚æœä½ èƒ½ä¸æ–­çš„æå‡ºé—®é¢˜ï¼Œä½ å°±ä¼šä¸æ–­çš„æŒ‰ä¸‹å¿«é—¨ï¼ŒæŠŠä½ çš„æ€æƒ³å’Œç–‘é—®ä¼ è¾¾å‡ºæ¥ã€‚å¦‚æœè§‚ä¼—çœ‹è¿‡ä½ çš„ç…§ç‰‡åä¹Ÿè‰¯ä¹…é©»è¶³ï¼Œæ€è€ƒç€ä½ çš„æ€è€ƒï¼Œç–‘é—®ç€ä½ çš„ç–‘é—®ï¼Œé‚£æ‚¨å°±å¿«æ¥è¿‘æ‘„å½±çš„æœ€é«˜å¢ƒç•Œäº†â€        ã€Šè®ºæ‘„å½±ã€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‘„å½±åè¯&quot;&gt;&lt;a href=&quot;#æ‘„å½±åè¯&quot; class=&quot;headerlink&quot; title=&quot;æ‘„å½±åè¯&quot;&gt;&lt;/a&gt;æ‘„å½±åè¯&lt;/h2&gt;&lt;h3 id=&quot;ISO&quot;&gt;&lt;a href=&quot;#ISO&quot; class=&quot;headerlink&quot; title=&quot;ISO&quot;&gt;&lt;/a&gt;ISO&lt;/h3&gt;&lt;p&gt;ISOï¼ˆæ„Ÿå…‰åº¦ï¼‰æ˜¯CCDï¼ˆCharge Coupled Deviceï¼Œç”µå­æ„Ÿå…‰èŠ¯ç‰‡ï¼‰æˆ–æ˜¯èƒ¶å·å¯¹å…‰çº¿çš„æ•æ„Ÿç¨‹åº¦ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="photo" scheme="http://yoursite.com/tags/photo/"/>
    
  </entry>
  
  <entry>
    <title>Django æœ€ä½³å®è·µ(è¯‘)</title>
    <link href="http://yoursite.com/2018/12/19/django-best-practices/"/>
    <id>http://yoursite.com/2018/12/19/django-best-practices/</id>
    <published>2018-12-19T14:59:08.000Z</published>
    <updated>2018-12-20T00:39:45.695Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ul>
<li>ä½¿ç”¨ <a href="https://pipenv.readthedocs.io" target="_blank" rel="external">Pipenv</a> ç®¡ç†è™šæ‹Ÿç¯å¢ƒ</li>
<li>ä½¿ç”¨ <a href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/#using-a-custom-user-model-when-starting-a-project" target="_blank" rel="external">è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹</a></li>
<li>å°½å¯èƒ½åœ°ä½¿ç”¨<a href="https://docs.djangoproject.com/en/dev/topics/class-based-views/generic-display/" target="_blank" rel="external">é€šç”¨ç±»è§†å›¾ GCBV</a>ï¼Œç„¶åæ‰æ˜¯<a href="https://docs.djangoproject.com/en/dev/topics/class-based-views/" target="_blank" rel="external">ç±»è§†å›¾</a>è€Œä¸æ˜¯å‡½æ•°è§†å›¾</li>
<li>ä½¿ç”¨<a href="https://github.com/joke2k/django-environ" target="_blank" rel="external">ç¯å¢ƒå˜é‡</a>æ¥ç®¡ç†åƒ <code>SECRET_KET</code> è¿™æ ·çš„å˜é‡</li>
<li>ä½¿ç”¨<a href="https://simpleisbetterthancomplex.com/tips/2017/07/03/django-tip-20-working-with-multiple-settings-modules.html" target="_blank" rel="external">å¤š setting æ–‡ä»¶</a>ï¼ŒDEBUG æ¨¡å¼ä¸å…è®¸å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­</li>
<li>æœ¬åœ°ä½¿ç”¨åŸºäº <a href="https://wsvincent.com/django-docker-postgresql/" target="_blank" rel="external">Docker</a> çš„ Postgres æ•°æ®åº“</li>
<li>è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œè¶Šå¤šè¶Šå¥½</li>
</ul>
<a id="more"></a>
<h2 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h2><ul>
<li>ä½¿ç”¨ <a href="https://www.ponycheckup.com/" target="_blank" rel="external">Pony Checkup</a> æ£€æŸ¥ç½‘ç«™çš„å®‰å…¨</li>
<li>å§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆ Django</li>
<li>ç”¨ <a href="https://docs.djangoproject.com/en/2.0/topics/security/#ssl-https" target="_blank" rel="external">SSL/HTTPS</a> éƒ¨ç½²</li>
<li>ä¿®æ”¹ admin çš„ urlï¼Œä¸è¦ä½¿ç”¨é»˜è®¤çš„ <code>/admin/</code></li>
</ul>
<h2 id="ç¬¬ä¸‰æ–¹åŒ…"><a href="#ç¬¬ä¸‰æ–¹åŒ…" class="headerlink" title="ç¬¬ä¸‰æ–¹åŒ…"></a>ç¬¬ä¸‰æ–¹åŒ…</h2><ul>
<li><a href="https://github.com/jazzband/django-debug-toolbar" target="_blank" rel="external">django-debug-toolbar</a> è°ƒè¯•æ¶ˆæ¯å’Œæ•°æ®åº“æŸ¥è¯¢</li>
<li><a href="https://github.com/django-extensions/django-extensions" target="_blank" rel="external">django-extensions</a> æ”¶é›†äº†å¾ˆå¤šæ‰©å±•åº“ï¼Œå°¤å…¶æ˜¯ <code>runserver_plus</code></li>
<li><a href="https://github.com/pennersr/django-allauth" target="_blank" rel="external">django-allauth</a> æä¾›ç¤¾äº¤è®¤è¯å’Œç”¨æˆ·emailç¡®è®¤</li>
<li><a href="https://whitenoise.readthedocs.io" target="_blank" rel="external">Whitenoise</a> ç”¨äºé™æ€æ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨S3ï¼‰</li>
<li><a href="https://sentry.io" target="_blank" rel="external">Sentry</a> è®°å½•é”™è¯¯æ—¥å¿—</li>
</ul>
<h2 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h2><ul>
<li>æœ€æµè¡Œçš„ Django é¡¹ç›®ç›®å½•ç»“æ„ <a href="https://github.com/pydanny/cookiecutter-django" target="_blank" rel="external">cookiecutter-django</a></li>
<li>ä½¿ç”¨ <a href="https://www.django-rest-framework.org/" target="_blank" rel="external">Django Rest Framework</a>æ¥æ„å»º Result API</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://wsvincent.com/django-best-practices/" target="_blank" rel="external">Django Best Practices</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åŸºç¡€&quot;&gt;&lt;a href=&quot;#åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€&quot;&gt;&lt;/a&gt;åŸºç¡€&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&quot;https://pipenv.readthedocs.io&quot;&gt;Pipenv&lt;/a&gt; ç®¡ç†è™šæ‹Ÿç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&quot;https://docs.djangoproject.com/en/dev/topics/auth/customizing/#using-a-custom-user-model-when-starting-a-project&quot;&gt;è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½åœ°ä½¿ç”¨&lt;a href=&quot;https://docs.djangoproject.com/en/dev/topics/class-based-views/generic-display/&quot;&gt;é€šç”¨ç±»è§†å›¾ GCBV&lt;/a&gt;ï¼Œç„¶åæ‰æ˜¯&lt;a href=&quot;https://docs.djangoproject.com/en/dev/topics/class-based-views/&quot;&gt;ç±»è§†å›¾&lt;/a&gt;è€Œä¸æ˜¯å‡½æ•°è§†å›¾&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&quot;https://github.com/joke2k/django-environ&quot;&gt;ç¯å¢ƒå˜é‡&lt;/a&gt;æ¥ç®¡ç†åƒ &lt;code&gt;SECRET_KET&lt;/code&gt; è¿™æ ·çš„å˜é‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&quot;https://simpleisbetterthancomplex.com/tips/2017/07/03/django-tip-20-working-with-multiple-settings-modules.html&quot;&gt;å¤š setting æ–‡ä»¶&lt;/a&gt;ï¼ŒDEBUG æ¨¡å¼ä¸å…è®¸å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­&lt;/li&gt;
&lt;li&gt;æœ¬åœ°ä½¿ç”¨åŸºäº &lt;a href=&quot;https://wsvincent.com/django-docker-postgresql/&quot;&gt;Docker&lt;/a&gt; çš„ Postgres æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œè¶Šå¤šè¶Šå¥½&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Django" scheme="http://yoursite.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>è¯»ã€Œå­¦ä¹ ä¹‹é“ã€</title>
    <link href="http://yoursite.com/2018/09/08/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%81%93/"/>
    <id>http://yoursite.com/2018/09/08/å­¦ä¹ ä¹‹é“/</id>
    <published>2018-09-08T13:51:15.000Z</published>
    <updated>2018-11-14T15:52:42.065Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>å…¬å¸ä¹¦æ¶ä¸Šéšæ‰‹æ‹¿çš„ä¸€æœ¬ä¹¦ï¼Œè±†ç“£çš„è¯„åˆ†è¿˜å¯ä»¥ï¼Œäºæ˜¯èŠ±äº†ä¸€ä¸ªç¤¼æ‹œè¯»å®Œï¼Œé¡ºä¾¿åšç‚¹ç¬”è®°ã€‚</p>
</blockquote>
<p>è¿™æœ¬ä¹¦å¼€ç¯‡å°±æŠ›å‡ºäº†æˆ‘ä»¬æ„ŸåŒèº«å—çš„ä¸€äº›é—®é¢˜ã€‚</p>
<blockquote>
<p>è¯»å®Œä¸€æœ¬ä¹¦ï¼Œå´è®°ä¸å¾—è®²çš„ä»€ä¹ˆï¼Ÿ\<br>å…¬ä¼—å·ã€æŒ‡å¯¼ä¹¦ã€å„ç§çŸ¥è¯†ä»˜è´¹å¹³å°çœ‹äº†å¾ˆå¤šï¼Œå´æ²¡æœ‰å½¢æˆè‡ªå·±çš„å­¦ä¹ ä½“ç³»ï¼Ÿ</p>
</blockquote>
<p>ç½‘ä¸Šä¹‹å‰æœ‰å¥æµè¡Œè¯­ï¼šã€Œä½ çš„åŒé¾„äººæ­£åœ¨æŠ›å¼ƒä½ ã€ï¼Œæˆ‘ä»¬æ¯ä¸ªäººæˆ–å¤šæˆ–å°‘éƒ½æœ‰äº›ç„¦è™‘ã€‚ä¸€æ–¹é¢æ˜¯å¯¹çŸ¥è¯†çš„ç„¦è™‘ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä½è´¨é‡å­¦ä¹ æ–¹å¼å’Œæ–¹æ³•ã€‚ä»¥ä¸ºæœ¬ä¹¦ä¼šå¯¹ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æœ‰å¾ˆå¥½çš„è§£ç­”ï¼Œç»“æœå´æ²¡æœ‰ã€‚</p>
<p>æœ¬ä¹¦çš„ä½œè€…æœ¬ç§‘ä¸“ä¸šæ˜¯ä¿„è¯­ï¼Œä»–å¾ˆå–œæ¬¢æ–‡å­¦è€Œç†å·¥ç§‘æˆç»©å´å¾ˆå·®ã€‚ä½†æ˜¯ä»–æœ€ç»ˆå…‹æœäº†å¯¹ç†å·¥ç§‘ç‰¹åˆ«æ˜¯æ•°å­¦çš„ææƒ§ï¼Œæˆä¸ºäº†ä¸€åå·¥ç¨‹å­¦åšå£«ã€‚æ‰€ä»¥æœ¬ä¹¦æ›´å¤šçš„ä¾§é‡ç‚¹åœ¨äºå¯¹ç†å·¥å­¦ç§‘çš„å­¦ä¹ æ–¹æ³•ä¸Šï¼Œæ¯”è¾ƒé€‚åˆåº”è¯•æ•™è‚²ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä»è„‘ç§‘å­¦å’Œå¿ƒç†å­¦æ–¹é¢çš„ç ”ç©¶æˆæœå¯¹äºä¸åŒå­¦ç§‘çš„å­¦ä¹ è¿˜æ˜¯æœ‰å‚è€ƒä»·å€¼çš„ã€‚</p>
<p>æœ¬ä¹¦ä¸­å¯¹äºæˆ‘è€Œè¨€æœ‰æ”¶è·æœ‰ä»¥ä¸‹äº”ç‚¹ï¼š</p>
<ul>
<li>ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´</li>
<li>å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†</li>
<li>è®°å¿†ç»„å—</li>
<li>æ‹–å»¶ä¸ä¹ æƒ¯</li>
<li>å­¦ä¹ æ³•åˆ™</li>
</ul>
<a id="more"></a>
<h3 id="ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´"><a href="#ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´" class="headerlink" title="ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´"></a>ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´</h3><p>ä¸“æ³¨æ€ç»´ä¹Ÿç§°ä¸“æ³¨æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯æ³¨æ„åŠ›é«˜åº¦é›†ä¸­çš„çŠ¶æ€ã€‚ä¸ä¹‹å¯¹åº”å‘æ•£æ€ç»´åˆ™æ˜¯æ”¾æ¾ä¼‘æ¯çš„çŠ¶æ€ã€‚</p>
<p>ä¸¤ç§æ¨¡å¼åœ¨é¢‘ç¹åœ°åˆ‡æ¢ï¼Œä¸åŒçš„æ¨¡å¼å¤§è„‘çš„å·¥ä½œæ–¹å¼æ˜¯ä¸åŒçš„ã€‚ä¸“æ³¨æ¨¡å¼å¤§è„‘ä¸­åŒºå—è”ç³»ç´§å¯†ï¼Œæ€è·¯æ¸…æ™°ã€‚å‘æ•£æ¨¡å¼å¤§è„‘ä¸­åŒºå—è”ç³»ç¨€ç–ï¼Œä½†æ˜¯å®¹æ˜“äº§ç”Ÿçµæ„Ÿç¢°æ’ã€‚</p>
<p>å°±åƒä¸€ä¸ªèšå…‰ç¯ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å®ƒçš„ç…§æ˜èŒƒå›´ï¼Œå½“ç…§æ˜èŒƒå›´å°æ—¶ï¼Œå…‰çº¿æ¯”è¾ƒé›†ä¸­ï¼Œç©¿é€åŠ›å¼ºï¼›å½“ç…§æ˜èŒƒå›´å¤§æ—¶ï¼Œå…‰çº¿å¾®å¼±ï¼Œä½†æ˜¯èƒ½çœ‹åˆ°çš„è§†é‡å¹¿ã€‚</p>
<p>æˆ‘ä»¬è¦æœ‰æ„è¯†çš„ä¸»åŠ¨è¿›è¡Œæ€ç»´æ¨¡å¼çš„åˆ‡æ¢ï¼Œè¿™æ ·æœ‰ä¸¤ç‚¹å¥½å¤„ï¼š</p>
<p>1.é¿å¼€æ€ç»´å®šåŠ¿</p>
<p>2.ç•™å‡ºæ— æ„è¯†çš„æ€è€ƒé˜¶æ®µ</p>
<p>ç¬¬ä¸€ç‚¹å¾ˆå¥½è§£é‡Šï¼Œç¬¬äºŒç‚¹çš„æ„æ€å…¶å®æ˜¯åœ¨ä¸¤ä¸ªä¸“æ³¨å­¦ä¹ æœŸä¹‹é—´ç©ºå‡ºæ—¶é—´ï¼Œè®©ç¥ç»æ¨¡å‹å¾—ä»¥å·©å›ºã€‚å°±åƒç Œå¢™ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨æ°´æ³¥è¿›è¡Œç²˜åˆï¼Œæ°´æ³¥æ˜¯éœ€è¦æ—¶é—´å¹²å›ºå‡ç»“çš„ã€‚ä¹¦ä¸­ç§°ä¹‹ä¸º<code>ç¥ç»ç –å—</code>å’Œ<code>æ€ç»´æ°´æ³¥</code>ã€‚</p>
<h3 id="å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†"><a href="#å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†" class="headerlink" title="å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†"></a>å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†</h3><p>å·¥ä½œè®°å¿†æŒ‡çš„æ˜¯å¤§è„‘ä¸­å¯¹æ­£åœ¨å¤„ç†çš„ä¿¡æ¯è¿›è¡Œç¬æ—¶ä»¥åŠæœ‰æ„è¯†åŠ å·¥çš„è®°å¿†ï¼Œè€Œé•¿æœŸè®°å¿†å¦‚åŒä»“åº“ï¼Œä¸€ç›´ä¿å­˜åœ¨æˆ‘ä»¬å¤§è„‘ä¸­çš„è®°å¿†ã€‚ä»è®¡ç®—æœºçš„è§’åº¦æ¥ç†è§£å·¥ä½œè®°å¿†å°±æ˜¯å†…å­˜ï¼Œæœºå™¨é‡å¯å†…å­˜é‡Œçš„æ•°æ®å°±æ¶ˆå¤±äº†ï¼Œè€Œé•¿æœŸè®°å¿†æ˜¯ç¡¬ç›˜ï¼Œæ•°æ®ä¼šä¸€ç›´ä¿å­˜ã€‚</p>
<p>å¤§è„‘çš„è®°å¿†ç»„å—æ˜¯æœ‰é™çš„ï¼Œå°±åƒå†…å­˜çš„å¤§å°ä¸€æ ·ã€‚ä½†æ˜¯ç¡¬ç›˜çš„å®¹é‡å¯æ¯”å†…å­˜å¤§å¾—å¤šä¹Ÿå»‰ä»·å¾—å¤šã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å·¥ä½œè®°å¿†è½¬åŒ–ä¸ºé•¿æœŸè®°å¿†ã€‚ä¹¦ä¸­ä»‹ç»çš„æ–¹æ³•æ˜¯<code>é—´éš”é‡å¤æ³•</code>ï¼Œå¤§å®¶éƒ½çŸ¥é“è‰¾å®¾æµ©æ–¯è®°å¿†æ›²çº¿ï¼Œæƒ³è¦å¢å¼ºè®°å¿†ä¹Ÿå°±åªèƒ½å¤šé‡å¤ç»ƒä¹ äº†ã€‚ä¸è¿‡ä¹¦ä¸­è¿˜ç»™å‡ºäº†å…¶ä»–å¢å¼ºè®°å¿†åŠ›çš„å¥½æ–¹æ³•ï¼š</p>
<ul>
<li>æ¯”å–»å’Œå½¢è±¡åŒ–</li>
<li>åˆ›å»ºæ„ç¾¤ï¼šé€šè¿‡ç»„åˆæ„æˆæŸç§å…³ç³»ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æ„ä¹‰ç¾¤ä½“</li>
<li>ç¼–æ•…äº‹</li>
<li>è‚Œè‚‰è®°å¿†</li>
</ul>
<h3 id="è®°å¿†ç»„å—"><a href="#è®°å¿†ç»„å—" class="headerlink" title="è®°å¿†ç»„å—"></a>è®°å¿†ç»„å—</h3><p>ç»„å—æŒ‡çš„æ˜¯ä¿¡æ¯ç¢ç‰‡ç»„æˆçš„é›†åˆï¼Œè¦ç†Ÿç»ƒæŒæ¡æ•°å­¦å’Œç§‘å­¦çŸ¥è¯†ï¼Œéœ€è¦é€šè¿‡æ„ä¹‰å°†åˆ†æ•£çš„ä¿¡æ¯ç¢ç‰‡ç»„åˆèµ·æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ›å»ºç»„å—ã€‚</p>
<p>ç›¸ä¿¡å¤§å®¶éƒ½ç©è¿‡æ‹¼å›¾ï¼Œé€šè¿‡æ‹¼å›¾æˆ‘ä»¬å¯ä»¥å¾ˆå¥½åœ°ç†è§£å¦‚ä½•æ„æˆç»„å—ã€‚æ‚ä¹±çš„æ‹¼å›¾ç¢ç‰‡ä»£è¡¨çš„æ˜¯åŸå§‹ä¿¡æ¯ï¼Œåªæœ‰ç†è§£æ¯ä¸ªæ‹¼å›¾å—åœ¨å…¨å±€çš„ä½ç½®ï¼Œå³ç†è§£æ¯ä¸ªå›¾å—çš„æ¦‚å¿µå’Œå…³ç³»ï¼Œæ‹¼å›¾ç¢ç‰‡æ‰ä¼šå½¢æˆå‡¹å‡¸çŠ¶çš„äº’é”è¾¹ç¼˜ã€‚ä¸åŠ ç†è§£é‚£ä¹ˆæ˜¯æ— æ³•æ‹¼æ¥å‡ºå®Œæ•´çš„å›¾å½¢ã€‚</p>
<h4 id="å¦‚ä½•æ„å»ºè®°å¿†ç»„å—"><a href="#å¦‚ä½•æ„å»ºè®°å¿†ç»„å—" class="headerlink" title="å¦‚ä½•æ„å»ºè®°å¿†ç»„å—"></a>å¦‚ä½•æ„å»ºè®°å¿†ç»„å—</h4><p>1.ä¸“æ³¨æ¨¡å¼</p>
<p>2.ç†è§£</p>
<p>3.é‡å¤ç»ƒä¹ </p>
<blockquote>
<p>æ„å»ºç»„å—æ˜¯ä¸€ç§ä»ä¸‹è‡³ä¸Šçš„å­¦ä¹ è¿‡ç¨‹ï¼Œæ€»è§ˆå…¨å±€åˆ™æ˜¯ä¸€ç§ä»ä¸Šè‡³ä¸‹çš„å­¦ä¹ è¿‡ç¨‹</p>
</blockquote>
<p><img src="/img/13112312312312.png" alt=""></p>
<h3 id="æ‹–å»¶ä¸ä¹ æƒ¯"><a href="#æ‹–å»¶ä¸ä¹ æƒ¯" class="headerlink" title="æ‹–å»¶ä¸ä¹ æƒ¯"></a>æ‹–å»¶ä¸ä¹ æƒ¯</h3><h4 id="æ‹–å»¶çš„å½¢æˆ"><a href="#æ‹–å»¶çš„å½¢æˆ" class="headerlink" title="æ‹–å»¶çš„å½¢æˆ"></a>æ‹–å»¶çš„å½¢æˆ</h4><p>äººè®¨åŒåšè‡ªå·±ä¸æ“…é•¿çš„äº‹ï¼Œå¦‚æœæ˜¯æ“…é•¿çš„äº‹å¾€å¾€ä¹åœ¨å…¶ä¸­ã€‚åšä¸æ€ä¹ˆå–œæ¬¢çš„äº‹æƒ…ä¼šæ¿€æ´»å¤§è„‘ä¸­çš„ç—›è§‰ä¸­æ¢ï¼Œé©±ä½¿æˆ‘ä»¬è½¬ç§»åˆ°ä»¤è‡ªå·±å¼€å¿ƒçš„äº‹æƒ…ä¸Šï¼Œè·å¾—æš‚æ—¶çš„æ„Ÿè§‰è‰¯å¥½ã€‚è€Œä¸“æ³¨åšäº‹æƒ…éœ€è¦è·å¾—é¡½å¼ºçš„æ„å¿—åŠ›ï¼Œéœ€è¦è°ƒç”¨å¤§é‡çš„ç¥ç»èµ„æºã€‚è½¬ç§»åˆ°è½»æ¾æ„‰æ‚¦çš„äº‹æƒ…å´æ˜¯ç®€å•è½»æ¾çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é™·å…¥æ‹–å»¶ï¼Œæ¸æ¸çš„æ‹–å»¶ä¹Ÿä¼šå˜æˆä¸€ç§ä¹ æƒ¯ã€‚</p>
<h3 id="ä¹ æƒ¯çš„ç»„æˆ"><a href="#ä¹ æƒ¯çš„ç»„æˆ" class="headerlink" title="ä¹ æƒ¯çš„ç»„æˆ"></a>ä¹ æƒ¯çš„ç»„æˆ</h3><p>1.ä¿¡å·ï¼šä¹ æƒ¯åŠ¨ä½œçš„è§¦å‘ç‚¹</p>
<p>2.ååº”ç¨‹åºï¼šæ¥æ”¶ä¿¡å·æš—ç¤ºæ—¶åšå‡ºçš„å¸¸è§„æ€§ã€ä¹ æƒ¯æ€§çš„ååº”</p>
<p>3.å¥–åŠ±æœºåˆ¶ï¼šä¹ æƒ¯å¾—ä»¥å‘å±•å’Œç»§ç»­æ˜¯å› ä¸ºå®ƒèƒ½æ¿€åŠ±äººï¼Œä½¿äººæ„Ÿåˆ°æ„‰æ‚¦ï¼ˆæ‹–å»¶ä½¿æˆ‘ä»¬è½¬ç§»åˆ°æ›´æ„‰æ‚¦çš„äº‹æƒ…ä¸Šèƒ½è¿…é€Ÿå¾—åˆ°è¿™ç§å¥–åŠ±ï¼‰</p>
<p>4.ä¿¡å¿µï¼šç›¸ä¿¡ä¹ æƒ¯çš„åŠ›é‡ï¼Œæ­£å‘å¾ªç¯</p>
<h4 id="æ”¹å˜æ‹–å»¶çš„ä¹ æƒ¯"><a href="#æ”¹å˜æ‹–å»¶çš„ä¹ æƒ¯" class="headerlink" title="æ”¹å˜æ‹–å»¶çš„ä¹ æƒ¯"></a>æ”¹å˜æ‹–å»¶çš„ä¹ æƒ¯</h4><p>1.ä¿¡å·ï¼šå¯¹æ‹–å»¶ä¿¡å·è¿›è¡Œå±è”½ï¼Œé˜²æ­¢å¹²æ‰°ã€‚å°†é‚£äº›èƒ½å¤Ÿè®©æˆ‘ä»¬è½¬ç§»åˆ°è½»æ¾æ„‰æ‚¦çš„ä¿¡å·å±è”½ã€‚</p>
<p>2.ååº”ç¨‹åºï¼šåˆ¶å®šè®¡åˆ’ï¼Œå› ä¸ºè¿™ä¸€æ­¥éœ€è¦æ„å¿—åŠ›çš„ä»‹å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¶å®šè®¡åˆ’æ¥è¿›è¡Œçº¦æŸ</p>
<p>3.å¥–åŠ±æœºåˆ¶ï¼šç”¨å…¶ä»–æ»¡è¶³æ„Ÿæ›¿ä»£</p>
<p>4.ä¿¡å¿µï¼šå¯¹æ–°ç³»ç»Ÿæ•ˆæœåšä¿¡ä¸ç–‘ï¼Œç›¸ä¿¡ä¸€åˆ‡çš„æ”¹å˜ä¼šè‰¯æ€§å‘å±•</p>
<h3 id="å­¦ä¹ æ³•åˆ™"><a href="#å­¦ä¹ æ³•åˆ™" class="headerlink" title="å­¦ä¹ æ³•åˆ™"></a>å­¦ä¹ æ³•åˆ™</h3><p>ä¹¦çš„æœ€åç»™å‡ºäº†åæ¡å­¦ä¹ æ³•åˆ™ï¼š</p>
<p>1.è¿ç”¨å›æƒ³</p>
<p>2.è‡ªæˆ‘æµ‹è¯•</p>
<p>3.å¯¹é—®é¢˜è¿›è¡Œç»„å—</p>
<p>4.é—´éš”é‡å¤</p>
<p>5.ä½¿ç”¨ä¸åŒè§£é¢˜æŠ€å·§</p>
<p>6.æ³¨æ„ä¼‘æ¯</p>
<p>7.ä½¿ç”¨è§£é‡Šæ€§çš„æé—®å’Œç±»æ¯”</p>
<p>8.ä¸“æ³¨</p>
<p>9.å›°éš¾çš„äº‹æƒ…æœ€å…ˆåš</p>
<p>10.å¿ƒç†å¯¹ç…§</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€å•å°ç»“ä¸€ä¸‹å°±æ˜¯ï¼š<code>ä¸¤ç§æ€ç»´æ¨¡å¼ã€ä¸¤ç§è®°å¿†ç±»å‹ã€ä¸¤ç§å­¦ä¹ æ¨¡å¼</code>ã€‚é™¤äº†è¿™äº›æ¦‚å¿µå’Œæ–¹æ³•ä¹‹å¤–ï¼Œä¹¦ä¸­è¿˜æœ‰å¾ˆå¤šæ¡ˆä¾‹å’Œç§‘å­¦å®éªŒçš„ç»“æœï¼Œä¸€æ–¹é¢ç”¨æ¥ä½è¯ä½œè€…çš„è§‚ç‚¹ï¼Œå¦ä¸€æ–¹é¢è®©è¯»è€…æ›´åŠ å®¹æ˜“ç†è§£ã€‚è™½ç„¶ä¹¦ä¸­æœ‰äº›è§‚ç‚¹å’Œæ–¹æ³•æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œå¦‚ä»€ä¹ˆç•ªèŒ„å·¥ä½œæ³•ã€å›æƒ³ç»ƒä¹ ï¼Œä¸è¿‡å¯¹äºå­¦ä¹ ä¹‹é“ä½œè€…è¿˜æ˜¯æœ‰æå‡ºäº†å¾ˆå¤šå»ºè®¾æ€§çš„æ„è§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å…¬å¸ä¹¦æ¶ä¸Šéšæ‰‹æ‹¿çš„ä¸€æœ¬ä¹¦ï¼Œè±†ç“£çš„è¯„åˆ†è¿˜å¯ä»¥ï¼Œäºæ˜¯èŠ±äº†ä¸€ä¸ªç¤¼æ‹œè¯»å®Œï¼Œé¡ºä¾¿åšç‚¹ç¬”è®°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æœ¬ä¹¦å¼€ç¯‡å°±æŠ›å‡ºäº†æˆ‘ä»¬æ„ŸåŒèº«å—çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯»å®Œä¸€æœ¬ä¹¦ï¼Œå´è®°ä¸å¾—è®²çš„ä»€ä¹ˆï¼Ÿ\&lt;br&gt;å…¬ä¼—å·ã€æŒ‡å¯¼ä¹¦ã€å„ç§çŸ¥è¯†ä»˜è´¹å¹³å°çœ‹äº†å¾ˆå¤šï¼Œå´æ²¡æœ‰å½¢æˆè‡ªå·±çš„å­¦ä¹ ä½“ç³»ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç½‘ä¸Šä¹‹å‰æœ‰å¥æµè¡Œè¯­ï¼šã€Œä½ çš„åŒé¾„äººæ­£åœ¨æŠ›å¼ƒä½ ã€ï¼Œæˆ‘ä»¬æ¯ä¸ªäººæˆ–å¤šæˆ–å°‘éƒ½æœ‰äº›ç„¦è™‘ã€‚ä¸€æ–¹é¢æ˜¯å¯¹çŸ¥è¯†çš„ç„¦è™‘ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä½è´¨é‡å­¦ä¹ æ–¹å¼å’Œæ–¹æ³•ã€‚ä»¥ä¸ºæœ¬ä¹¦ä¼šå¯¹ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æœ‰å¾ˆå¥½çš„è§£ç­”ï¼Œç»“æœå´æ²¡æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦çš„ä½œè€…æœ¬ç§‘ä¸“ä¸šæ˜¯ä¿„è¯­ï¼Œä»–å¾ˆå–œæ¬¢æ–‡å­¦è€Œç†å·¥ç§‘æˆç»©å´å¾ˆå·®ã€‚ä½†æ˜¯ä»–æœ€ç»ˆå…‹æœäº†å¯¹ç†å·¥ç§‘ç‰¹åˆ«æ˜¯æ•°å­¦çš„ææƒ§ï¼Œæˆä¸ºäº†ä¸€åå·¥ç¨‹å­¦åšå£«ã€‚æ‰€ä»¥æœ¬ä¹¦æ›´å¤šçš„ä¾§é‡ç‚¹åœ¨äºå¯¹ç†å·¥å­¦ç§‘çš„å­¦ä¹ æ–¹æ³•ä¸Šï¼Œæ¯”è¾ƒé€‚åˆåº”è¯•æ•™è‚²ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä»è„‘ç§‘å­¦å’Œå¿ƒç†å­¦æ–¹é¢çš„ç ”ç©¶æˆæœå¯¹äºä¸åŒå­¦ç§‘çš„å­¦ä¹ è¿˜æ˜¯æœ‰å‚è€ƒä»·å€¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¹¦ä¸­å¯¹äºæˆ‘è€Œè¨€æœ‰æ”¶è·æœ‰ä»¥ä¸‹äº”ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸“æ³¨æ€ç»´å’Œå‘æ•£æ€ç»´&lt;/li&gt;
&lt;li&gt;å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†&lt;/li&gt;
&lt;li&gt;è®°å¿†ç»„å—&lt;/li&gt;
&lt;li&gt;æ‹–å»¶ä¸ä¹ æƒ¯&lt;/li&gt;
&lt;li&gt;å­¦ä¹ æ³•åˆ™&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="book" scheme="http://yoursite.com/tags/book/"/>
    
  </entry>
  
  <entry>
    <title>QuerySet API å­¦ä¹ ç¬”è®°</title>
    <link href="http://yoursite.com/2018/08/19/QuerySet-API-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2018/08/19/QuerySet-API-å­¦ä¹ ç¬”è®°/</id>
    <published>2018-08-19T04:51:03.000Z</published>
    <updated>2018-08-19T04:52:12.089Z</updated>
    
    <content type="html"><![CDATA[<h3 id="QuerySets-evaluated"><a href="#QuerySets-evaluated" class="headerlink" title="QuerySets evaluated"></a>QuerySets evaluated</h3><p>å¯ä»¥åˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’æŸ¥è¯¢é›†è€Œä¸ç”¨çœŸå®æ“ä½œæ•°æ®åº“ã€‚åœ¨ä½ å¯¹æŸ¥è¯¢é›†åšæ±‚å€¼ä¹‹å‰ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å®é™…çš„æ•°æ®åº“æ“ä½œã€‚</p>
<p>å¯¹äºæŸ¥è¯¢é›†æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæ±‚å€¼ï¼š</p>
<ul>
<li>Iteration</li>
<li>Slicing</li>
<li>Pickling/Caching</li>
<li>repr()</li>
<li>len()</li>
<li>list()</li>
<li>bool()</li>
</ul>
<h3 id="QuerySet-API"><a href="#QuerySet-API" class="headerlink" title="QuerySet API"></a>QuerySet API</h3><h4 id="è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•"><a href="#è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•" class="headerlink" title="è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•"></a>è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•</h4><ul>
<li>filter</li>
</ul>
<p>è¿”å›ä¸€ä¸ªæ–°çš„ QuerySet åŒ…å«ç»™å®šå‚æ•°çš„æŸ¥è¯¢åŒ¹é…å¯¹è±¡ï¼Œæ›´å¤æ‚çš„æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ Q å¯¹è±¡ã€‚</p>
<ul>
<li>exclude</li>
</ul>
<p>è¿”å›ä¸€ä¸ªæ–°çš„ QuerySetï¼Œå®ƒåŒ…å«ä¸æ»¡è¶³ç»™å®šçš„æŸ¥æ‰¾å‚æ•°çš„å¯¹è±¡ï¼Œæ›´å¤æ‚çš„æŸ¥è¯¢åŒæ ·å¯ä»¥ä½¿ç”¨ Q å¯¹è±¡ã€‚</p>
<a id="more"></a>
<ul>
<li>annotate</li>
</ul>
<p>ä½¿ç”¨æä¾›çš„æŸ¥è¯¢è¡¨è¾¾å¼ç»™ QuerySet çš„æ¯ä¸ªå¯¹è±¡å¢åŠ æ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºå¢åŠ ä¸€ä¸ªæ–°çš„å±æ€§ã€‚</p>
<p>æŸ¥è¯¢è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å€¼ã€æ¨¡å‹ï¼ˆæˆ–å…³è”æ¨¡å‹ï¼‰å­—æ®µçš„ä¸€ä¸ªå¼•ç”¨æˆ–å¯¹æŸ¥è¯¢é›†ä¸­çš„å¯¹è±¡ä¸€ä¸ªèšåˆå‡½æ•°ï¼ˆå¹³å‡å€¼ã€å’Œç­‰ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.db.models import Count</div><div class="line">&gt;&gt;&gt; q = Blog.objects.annotate(Count(&apos;entry&apos;))</div><div class="line">&gt;&gt;&gt; q[0].name</div><div class="line">&apos;Blogasaurus&apos;</div><div class="line">&gt;&gt;&gt; q[0].entry__count # æ–°å¢çš„ entry__count å±æ€§</div><div class="line">42</div><div class="line"></div><div class="line"># æŒ‡å®šæ³¨é‡Šåç§°</div><div class="line">&gt;&gt;&gt; q = Blog.objects.annotate(number_of_entries=Count(&apos;entry&apos;))</div><div class="line">&gt;&gt;&gt; q[0].number_of_entries</div><div class="line">42</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ annotate éœ€è¦ç”¨ django.db.models çš„ç»Ÿè®¡æ–¹æ³•ã€‚é™¤äº† Count ç»Ÿè®¡æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ Maxã€Minã€Sumã€Avg ç­‰æ–¹æ³•ã€‚</p>
<ul>
<li>order_by</li>
</ul>
<p>æŒ‡å®š QuerySet æ’åº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># å‡åº</div><div class="line">&gt;&gt;&gt; Author.objects.filter().order_by(&apos;name&apos;)</div><div class="line">&lt;QuerySet [&lt;Author: abner&gt;, &lt;Author: mike&gt;]&gt;</div><div class="line"> </div><div class="line"># é™åº</div><div class="line">&gt;&gt;&gt; Author.objects.filter().order_by(&apos;-name&apos;)</div><div class="line">&lt;QuerySet [&lt;Author: mike&gt;, &lt;Author: abner&gt;]&gt;</div><div class="line"></div><div class="line"># éšæœºæ’åºï¼Œä¸æ¨èä½¿ç”¨(é€Ÿåº¦æ…¢ã€æŸ¥è¯¢æ˜‚è´µ)</div><div class="line">&gt;&gt;&gt; Author.objects.order_by(&apos;?&apos;)</div></pre></td></tr></table></figure>
<ul>
<li>reverse</li>
</ul>
<p>åå‘æ’åº QuerySet ä¸­è¿”å›çš„å…ƒç´ </p>
<ul>
<li>distinct</li>
</ul>
<p>è¿”å›ä¸€ä¸ªæ–°çš„ QuerySet å¹¶å»é™¤æŸ¥è¯¢ç»“æœä¸­çš„é‡å¤çš„è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; CompileRules.objects.values(&apos;business__name&apos;).distinct()</div><div class="line">&lt;QuerySet [&#123;&apos;business__name&apos;: &apos;img.ppdai.com&apos;&#125;, &#123;&apos;business__name&apos;: &apos;api.alert.risk.ppdaicorp.com&apos;&#125;, &#123;&apos;business__name&apos;: &apos;api.antifraud.risk.ppdaicorp.com&apos;&#125;, &#123;&apos;business__name&apos;: &apos;chargingjob.ppdapi.com&apos;&#125;]&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; rules = CompileRules.objects.distinct().values_list(&apos;business__name&apos;)</div><div class="line">&gt;&gt;&gt; [i[0] for i in rules]</div><div class="line">[&apos;img.ppdai.com&apos;,&apos;api.alert.risk.ppdaicorp.com&apos;,&apos;api.antifraud.risk.ppdaicorp.com&apos;,&apos;chargingjob.ppdapi.com&apos;]</div></pre></td></tr></table></figure>
<ul>
<li>values</li>
</ul>
<p>æŠŠ QuerySets å½“ä½œè¿­ä»£å™¨ä½¿ç”¨ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œè€Œä¸æ˜¯æ¨¡å‹å®ä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; Author.objects.filter(name=&apos;abner&apos;).values()</div><div class="line">&lt;QuerySet [&#123;&apos;id&apos;: 2, &apos;name&apos;: &apos;abner&apos;, &apos;email&apos;: &apos;abner@163.com&apos;&#125;, &#123;&apos;id&apos;: 3, &apos;name&apos;: &apos;abner&apos;, &apos;email&apos;: &apos;abner@qq.com&apos;&#125;]&gt;</div><div class="line"></div><div class="line"></div><div class="line"># æŒ‡å®šå­—æ®µ</div><div class="line">&gt;&gt;&gt; Author.objects.values(&apos;name&apos;)</div><div class="line">&lt;QuerySet [&#123;&apos;name&apos;: &apos;abner&apos;&#125;,&#123;&apos;name&apos;: &apos;abner&apos;&#125;,v&#123;&apos;name&apos;: &apos;mike&apos;&#125;]&gt;</div><div class="line"></div><div class="line"></div><div class="line"># æ•°æ®åº“å‡½æ•°ï¼ŒLower è¿”å›å°å†™å½¢å¼</div><div class="line">&gt;&gt;&gt; from django.db.models.functions import Lower</div><div class="line">&gt;&gt;&gt; Author.objects.values(lower=Lower(&apos;name&apos;))</div><div class="line">&lt;QuerySet [&#123;&apos;lower&apos;: &apos;dkey&apos;&#125;, &#123;&apos;lower&apos;: &apos;jerry&apos;&#125;, &#123;&apos;lower&apos;: &apos;jerry&apos;&#125;]&gt;</div></pre></td></tr></table></figure>
<ul>
<li>values_list</li>
</ul>
<p>ä»¥å…ƒç»„çš„å½¢å¼è¿”å›æŸ¥è¯¢é›†ï¼Œå¯ä»¥è¿”å›ç‰¹å®šå­—æ®µçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨çš„å½¢å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; Business.objects.filter(level=1).values_list(&apos;id&apos;, &apos;name&apos;)</div><div class="line">&lt;TreeQuerySet [(3, &apos;å€Ÿå…¥è¿è¥&apos;), (106, &apos;å€Ÿå…¥å€Ÿè´·&apos;), (219, &apos;æ•°æ®å†³ç­–å¹³å°&apos;), (225, &apos;æ•°æ®æ¶æ„&apos;), (234, &apos;æµ‹è¯•&apos;)]&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; Business.objects.filter(level=1).values_list(&apos;name&apos;, flat=True)</div><div class="line">&lt;TreeQuerySet [&apos;å€Ÿå…¥è¿è¥&apos;, &apos;å€Ÿå…¥å€Ÿè´·&apos;, &apos;æ•°æ®å†³ç­–å¹³å°&apos;, &apos;æ•°æ®æ¶æ„&apos;, &apos;æµ‹è¯•&apos;]&gt;</div></pre></td></tr></table></figure>
<ul>
<li>dates</li>
</ul>
<blockquote>
<p>dates(field, kind, order=â€™ASCâ€™)</p>
</blockquote>
<p>è¿”å› datetime.date å¯¹è±¡åˆ—è¡¨ï¼ŒæŸ¥è¯¢çš„å­—æ®µåº”è¯¥æ˜¯ DateField æ¨¡å‹ï¼Œkindåº”ä¸ºâ€yearâ€ã€â€monthâ€æˆ–â€dayâ€ã€‚éšå¼çš„æ˜¯å‡åºæ’åº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">1.year:è¿”å›å­—æ®µä¸åŒå¹´ä»½å€¼åˆ—è¡¨</div><div class="line">2.month:è¿”å›å­—æ®µæ‰€æœ‰ä¸åŒå¹´/æœˆå€¼åˆ—è¡¨</div><div class="line">3.day:è¿”å›å­—æ®µæ‰€æœ‰ä¸åŒå¹´/æœˆ/æ—¥å€¼åˆ—è¡¨</div></pre></td></tr></table></figure>
<ul>
<li>datetimes</li>
</ul>
<blockquote>
<p>datetimes(field_name, kind, order=â€™ASCâ€™, tzinfo=None)</p>
</blockquote>
<p>è¿”å› datetime.datetimes å¯¹è±¡åˆ—è¡¨ï¼ŒæŸ¥è¯¢çš„å­—æ®µåº”è¯¥æ˜¯ DateField æ¨¡å‹ï¼Œkindåº”ä¸ºâ€yearâ€ã€â€monthâ€æˆ–â€dayâ€ã€‚éšå¼çš„æ˜¯å‡åºæ’åº</p>
<ul>
<li>none</li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªä¸è¿”å›ä»»ä½•å¯¹è±¡çš„æŸ¥è¯¢é›†ï¼Œè®¿é—®ç»“æœæ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•æŸ¥è¯¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; Entry.objects.none()</div><div class="line">[]</div><div class="line">&gt;&gt;&gt; from django.db.models.query import EmptyQuerySet</div><div class="line">&gt;&gt;&gt; isinstance(Entry.objects.none(), EmptyQuerySet)</div><div class="line">True</div></pre></td></tr></table></figure>
<ul>
<li>all</li>
</ul>
<p>æ‰€æœ‰æŸ¥è¯¢é›†</p>
<ul>
<li>select_related</li>
</ul>
<blockquote>
<p>å¯¹äº ForeignKey å’Œ OneToOneField ç­‰å­—æ®µï¼Œé€šè¿‡æ·»åŠ  select_relatedï¼Œå¯ä»¥æŠŠç›¸å…³çš„å¯¹è±¡åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­æŸ¥å‡ºï¼Œä¹‹åä½¿ç”¨æ—¶å°±ä¸éœ€è¦å†æ¬¡æŸ¥æ•°æ®åº“</p>
</blockquote>
<p>è¿”å›ä¸€ä¸ªæ–°çš„æŸ¥è¯¢é›†ï¼Œæ²¿ç€å¤–é”®æŸ¥è¯¢å…³è”å¯¹è±¡çš„æ•°æ®ã€‚å®ƒä¼šç”Ÿæˆä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢å¹¶å¼•èµ·æ€§èƒ½çš„æŸè€—ï¼Œä½†æ˜¯åœ¨ä»¥åä½¿ç”¨å¤–é”®å…³ç³»æ—¶å°†ä¸éœ€è¦æ•°æ®åº“æŸ¥è¯¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># æ™®é€šæŸ¥è¯¢</div><div class="line"># Hits the database.</div><div class="line">e = Entry.objects.get(id=5)</div><div class="line"># Hits the database again to get the related Blog object.</div><div class="line">b = e.blog</div><div class="line"></div><div class="line">#select_related æŸ¥è¯¢ </div><div class="line"># Hits the database.</div><div class="line">e = Entry.objects.select_related(&apos;blog&apos;).get(id=5)</div><div class="line"># Doesn&apos;t hit the database, because e.blog has been prepopulated</div><div class="line"># in the previous query.</div><div class="line">b = e.blog</div></pre></td></tr></table></figure>
<ul>
<li>prefetch_related</li>
</ul>
<blockquote>
<p>prefetch_related å¯¹äºç›¸å…³å¯¹è±¡ä¼šè¿›è¡Œä¸€æ¬¡ç‹¬ç«‹çš„æŸ¥è¯¢ï¼Œç„¶ååœ¨ Python ä¸­æŠŠå¯¹è±¡å…³è”èµ·æ¥ã€‚æ‰€ä»¥prefetch_relatedå¯ä»¥ç”¨äºmany-to-many and many-to-oneå…³ç³»</p>
</blockquote>
<ul>
<li>extra</li>
</ul>
<blockquote>
<p>extra(select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</p>
</blockquote>
<p>æœ‰äº›æƒ…å†µä¸‹ï¼ŒDjangoçš„æŸ¥è¯¢è¯­æ³•éš¾ä»¥ç®€å•çš„è¡¨è¾¾å¤æ‚çš„ WHERE å­å¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µ, Django æä¾›äº† extra() QuerySet ä¿®æ”¹æœºåˆ¶ â€” å®ƒèƒ½åœ¨ QuerySetç”Ÿæˆçš„SQLä»å¥ä¸­æ³¨å…¥æ–°å­å¥</p>
<p>extraå¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°,ä¾‹å¦‚ select, where or tablesã€‚ è¿™äº›å‚æ•°éƒ½ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ä½ è‡³å°‘è¦ä½¿ç”¨ä¸€ä¸ª</p>
<ul>
<li>defer</li>
</ul>
<p>æ’é™¤ä¸éœ€è¦çš„å­—æ®µï¼Œé™ä½æ€§èƒ½æŸè€—</p>
<ul>
<li>only</li>
</ul>
<p>ä»…é€‰æ‹©éœ€è¦çš„å­—æ®µ</p>
<ul>
<li>using</li>
</ul>
<blockquote>
<p>using(alias) // alias æ•°æ®åº“åˆ«å</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨å¤šä¸ªæ•°æ®åº“ï¼Œæ”¹æ–¹æ³•å¯ä»¥æ§åˆ¶ä»å“ªä¸ªæ•°æ®åº“ä¸Šæ±‚å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># queries the database with the &apos;default&apos; alias.</div><div class="line">&gt;&gt;&gt; Entry.objects.all()</div><div class="line"></div><div class="line"># queries the database with the &apos;backup&apos; alias</div><div class="line">&gt;&gt;&gt; Entry.objects.using(&apos;backup&apos;)</div></pre></td></tr></table></figure>
<ul>
<li>select_for_update</li>
</ul>
<p>è¿”å›ä¸€ä¸ª queryset ï¼Œä¼šé”å®šç›¸å…³è¡Œç›´åˆ°äº‹åŠ¡ç»“æŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">entries = Entry.objects.select_for_update().filter(author=request.user)</div></pre></td></tr></table></figure>
<p>æ‰€æœ‰åŒ¹é…çš„è¡Œå°†è¢«é”å®šï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡é”é˜²æ­¢æ•°æ®è¢«å…¶å®ƒäº‹åŠ¡ä¿®æ”¹ã€‚</p>
<ul>
<li>raw</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªåŸå§‹çš„SQL æŸ¥è¯¢ï¼Œæ‰§è¡Œå®ƒå¹¶è¿”å›ä¸€ä¸ªdjango.db.models.query.RawQuerySet å®ä¾‹</p>
<p>Djangoæä¾›ä¸¤ç§æ–¹æ³•ä½¿ç”¨åŸå§‹SQLè¿›è¡ŒæŸ¥è¯¢ï¼šä¸€ç§æ˜¯ä½¿ç”¨Manager.raw()æ–¹æ³•ï¼Œè¿›è¡ŒåŸå§‹æŸ¥è¯¢å¹¶è¿”å›æ¨¡å‹å®ä¾‹ï¼›å¦ä¸€ç§æ˜¯å®Œå…¨é¿å¼€æ¨¡å‹å±‚ï¼Œç›´æ¥æ‰§è¡Œè‡ªå®šä¹‰çš„SQLè¯­å¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; raw = Author.objects.raw(&apos;select * from polls_author&apos;)</div><div class="line">&gt;&gt;&gt; type(raw)</div><div class="line">&lt;class &apos;django.db.models.query.RawQuerySet&apos;&gt;</div></pre></td></tr></table></figure>
<h4 id="ä¸è¿”å›æ–°çš„æŸ¥è¯¢é›†"><a href="#ä¸è¿”å›æ–°çš„æŸ¥è¯¢é›†" class="headerlink" title="ä¸è¿”å›æ–°çš„æŸ¥è¯¢é›†"></a>ä¸è¿”å›æ–°çš„æŸ¥è¯¢é›†</h4><ul>
<li>get</li>
</ul>
<p>è¿”å›æŒ‰ç…§å‚æ•°åŒ¹é…çš„å¯¹è±¡</p>
<ul>
<li>create</li>
</ul>
<p>åˆ›å»ºå¹¶ä¿å­˜å¯¹è±¡</p>
<ul>
<li>get_or_create</li>
</ul>
<p>é€šè¿‡ç»™å®šå‚æ•°æ¥æŸ¥è¯¢å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<p>è¿”å›ä¸€ä¸ªç”±(object, created)ç»„æˆçš„å…ƒç»„ï¼Œå…ƒç»„ä¸­çš„object æ˜¯ä¸€ä¸ªæŸ¥è¯¢åˆ°çš„æˆ–è€…æ˜¯è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œ created æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°çš„å¯¹è±¡çš„å¸ƒå°”å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">try:</div><div class="line">    obj = Person.objects.get(first_name=&apos;John&apos;, last_name=&apos;Lennon&apos;)</div><div class="line">except Person.DoesNotExist:</div><div class="line">    obj = Person(first_name=&apos;John&apos;, last_name=&apos;Lennon&apos;, birthday=date(1940, 10, 9))</div><div class="line">    obj.save()</div><div class="line">    </div><div class="line"># use get_or_create</div><div class="line">obj, created = Person.objects.get_or_create(first_name=&apos;John&apos;, last_name=&apos;Lennon&apos;,</div><div class="line">                  defaults=&#123;&apos;birthday&apos;: date(1940, 10, 9)&#125;)</div></pre></td></tr></table></figure>
<p>ä»»ä½•ä¼ é€’ç»™ get_or_create() çš„å…³é”®å­—å‚æ•°ï¼Œé™¤äº†ä¸€ä¸ªå¯é€‰çš„defaultsï¼Œéƒ½å°†ä¼ é€’ç»™get() è°ƒç”¨</p>
<blockquote>
<p>get_or_create() åœ¨Django è§†å›¾ä¸­çš„ä½¿ç”¨ã€‚è¯·ç¡®ä¿åªåœ¨POST è¯·æ±‚ä¸­ä½¿ç”¨ï¼Œé™¤éä½ æœ‰å……åˆ†çš„ç†ç”±ã€‚GET è¯·æ±‚ä¸åº”è¯¥å¯¹æ•°æ®æœ‰ä»»ä½•å½±å“ã€‚è€ŒPOST åˆ™ç”¨äºå¯¹æ•°æ®äº§ç”Ÿå½±å“çš„è¯·æ±‚</p>
</blockquote>
<ul>
<li>update_or_create</li>
</ul>
<p>é€šè¿‡ç»™å®šå‚æ•°æ¥æ›´æ–°å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<p>ä¸€ä¸ªé€šè¿‡ç»™å‡ºçš„kwargs æ¥æ›´æ–°å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•ï¼Œ å¦‚æœéœ€è¦çš„è¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚defaults æ˜¯ä¸€ä¸ªç”± (field, value) å¯¹ç»„æˆçš„å­—å…¸ï¼Œç”¨äºæ›´æ–°å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">try:</div><div class="line">    obj = Person.objects.get(first_name=&apos;John&apos;, last_name=&apos;Lennon&apos;)</div><div class="line">    for key, value in updated_values.iteritems():</div><div class="line">        setattr(obj, key, value)</div><div class="line">    obj.save()</div><div class="line">except Person.DoesNotExist:</div><div class="line">    updated_values.update(&#123;&apos;first_name&apos;: &apos;John&apos;, &apos;last_name&apos;: &apos;Lennon&apos;&#125;)</div><div class="line">    obj = Person(**updated_values)</div><div class="line">    obj.save()</div><div class="line">    </div><div class="line"></div><div class="line"># use update_or_create</div><div class="line">obj, created = Person.objects.update_or_create(</div><div class="line">    first_name=&apos;John&apos;, last_name=&apos;Lennon&apos;, defaults=updated_values)</div></pre></td></tr></table></figure>
<blockquote>
<p>å’Œä¸Šæ–‡æè¿°çš„get_or_create() ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹å¼å®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå¦‚æœæ•°æ®åº“å±‚çº§æ²¡æœ‰å‰ç½®å”¯ä¸€æ€§å®ƒä¼šè®©å¤šè¡ŒåŒæ—¶æ’å…¥ã€‚</p>
</blockquote>
<ul>
<li>bulk_create</li>
</ul>
<p>æ‰¹é‡å†™å…¥æ•°æ®</p>
<ul>
<li>count</li>
</ul>
<p>è¿”å› QuerySet å¯¹è±¡ä¸ªæ•°</p>
<ul>
<li>in_bulk</li>
</ul>
<p>è·å–ä¸»é”®å€¼çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›å°†æ¯ä¸ªä¸»é”®å€¼æ˜ å°„åˆ°å…·æœ‰ç»™å®šIDçš„å¯¹è±¡çš„å®ä¾‹çš„å­—å…¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; Blog.objects.in_bulk([1])</div><div class="line">&#123;1: &lt;Blog: Beatles Blog&gt;&#125;</div><div class="line">&gt;&gt;&gt; Blog.objects.in_bulk([1, 2])</div><div class="line">&#123;1: &lt;Blog: Beatles Blog&gt;, 2: &lt;Blog: Cheddar Talk&gt;&#125;</div><div class="line">&gt;&gt;&gt; Blog.objects.in_bulk([])</div><div class="line">&#123;&#125;</div></pre></td></tr></table></figure>
<ul>
<li>iterator</li>
<li>latest:ä½¿ç”¨ä½œä¸ºæ—¥æœŸå­—æ®µæä¾›çš„field_nameï¼ŒæŒ‰æ—¥æœŸè¿”å›è¡¨ä¸­çš„æœ€æ–°å¯¹è±¡</li>
<li>earliest</li>
<li>first</li>
<li>last</li>
<li>aggregate:èšåˆæŸ¥è¯¢</li>
</ul>
<p>è¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ ¹æ®QuerySet è®¡ç®—å¾—åˆ°çš„èšåˆå€¼ï¼ˆå¹³å‡æ•°ã€å’Œç­‰ç­‰ï¼‰ã€‚aggregate() çš„æ¯ä¸ªå‚æ•°æŒ‡å®šè¿”å›çš„å­—å…¸ä¸­å°†è¦åŒ…å«çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.db.models import Count</div><div class="line">&gt;&gt;&gt; q = Blog.objects.aggregate(Count(&apos;entry&apos;))</div><div class="line">&#123;&apos;entry__count&apos;: 16&#125;</div><div class="line"></div><div class="line">&gt;&gt;&gt; q = Blog.objects.aggregate(number_of_entries=Count(&apos;entry&apos;))</div><div class="line">&#123;&apos;number_of_entries&apos;: 16&#125;</div></pre></td></tr></table></figure>
<ul>
<li>exists</li>
</ul>
<p>exists() ç”¨äºæœå¯»å¯¹è±¡æ˜¯å¦åœ¨QuerySet ä¸­ä»¥åŠQuerySet æ˜¯å¦å­˜åœ¨ä»»ä½•å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯QuerySet æ¯”è¾ƒå¤§çš„æ—¶å€™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># exists æ–¹æ³•æ¯”æ™®é€šæ–¹æ³•å¿«</div><div class="line">entry = Entry.objects.get(pk=123)</div><div class="line">if some_queryset.filter(pk=entry.pk).exists():</div><div class="line">    print(&quot;Entry contained in queryset&quot;)</div><div class="line">    </div><div class="line"># æ™®é€šæ–¹æ³•</div><div class="line">if entry in some_queryset:</div><div class="line">   print(&quot;Entry contained in QuerySet&quot;)    </div><div class="line">   </div><div class="line"># åˆ¤æ–­ queryset æ˜¯å¦å«æœ‰å¯¹è±¡ï¼Œexists æ¯”æ™®é€šåˆ¤æ–­å¿«ç‰¹åˆ«æ˜¯æŸ¥è¯¢é›†æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹   </div><div class="line">if some_queryset.exists():</div><div class="line">    print(&quot;There is at least one object in some_queryset&quot;)</div><div class="line">    </div><div class="line">if some_queryset:</div><div class="line">    print(&quot;There is at least one object in some_queryset&quot;)</div></pre></td></tr></table></figure>
<ul>
<li>update</li>
</ul>
<p>å¯¹æŒ‡å®šçš„å­—æ®µæ‰§è¡ŒSQLæ›´æ–°æŸ¥è¯¢ï¼Œå¹¶è¿”å›åŒ¹é…çš„è¡Œæ•°</p>
<ul>
<li>delete</li>
</ul>
<p>å¯¹QuerySetä¸­çš„æ‰€æœ‰è¡Œæ‰§è¡ŒSQLåˆ é™¤æŸ¥è¯¢</p>
<ul>
<li>as_manager</li>
</ul>
<h4 id="å­—æ®µæŸ¥æ‰¾"><a href="#å­—æ®µæŸ¥æ‰¾" class="headerlink" title="å­—æ®µæŸ¥æ‰¾"></a>å­—æ®µæŸ¥æ‰¾</h4><table>
<thead>
<tr>
<th style="text-align:left">æ–¹æ³•</th>
<th style="text-align:left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">exact</td>
<td style="text-align:left">ç²¾ç¡®åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">iexact</td>
<td style="text-align:left">å¿½ç•¥å¤§å°å†™ç²¾ç¡®åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">contains</td>
<td style="text-align:left">åŒ…å«å…³ç³»</td>
</tr>
<tr>
<td style="text-align:left">icontains</td>
<td style="text-align:left">å¿½ç•¥å¤§å°å†™åŒ…å«å…³ç³»</td>
</tr>
<tr>
<td style="text-align:left">in</td>
<td style="text-align:left">åœ¨ç»™å®šçš„åˆ—è¡¨</td>
</tr>
<tr>
<td style="text-align:left">gt</td>
<td style="text-align:left">å¤§äº</td>
</tr>
<tr>
<td style="text-align:left">gte</td>
<td style="text-align:left">å¤§äºç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">lt</td>
<td style="text-align:left">å°äº</td>
</tr>
<tr>
<td style="text-align:left">lte</td>
<td style="text-align:left">å°äºç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">startswith</td>
<td style="text-align:left">åŒºåˆ†å¤§å°å†™ï¼Œä»å¼€å§‹ä½ç½®åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">istartswith</td>
<td style="text-align:left">ä¸åŒºåˆ†å¤§å°å†™ï¼Œä»å¼€å§‹ä½ç½®åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">endswith</td>
<td style="text-align:left">åŒºåˆ†å¤§å°å†™ï¼Œä»ç»“æŸä½ç½®åŒ¹</td>
</tr>
<tr>
<td style="text-align:left">iendswith</td>
<td style="text-align:left">ä¸åŒºåˆ†å¤§å°å†™ï¼Œä»ç»“æŸä½ç½®åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">range</td>
<td style="text-align:left">èŒƒå›´æµ‹è¯•ï¼ˆåŒ…å«äºä¹‹ä¸­ï¼‰</td>
</tr>
<tr>
<td style="text-align:left">year</td>
<td style="text-align:left">å¯¹äºæ—¥æœŸå’Œæ—¥æœŸæ—¶é—´å­—æ®µï¼Œå¹´ä»½åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">month</td>
<td style="text-align:left">å¯¹äºæ—¥æœŸå’Œæ—¥æœŸæ—¶é—´å­—æ®µï¼Œæœˆä»½åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">day</td>
<td style="text-align:left">å¯¹äºæ—¥æœŸå’Œæ—¥æœŸæ—¶é—´å­—æ®µï¼Œå¤©æ•°åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">week_day</td>
<td style="text-align:left">æ˜ŸæœŸåŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">hour</td>
<td style="text-align:left">å¯¹äºæ—¥æœŸæ—¶é—´å­—æ®µï¼Œç²¾ç¡®çš„å°æ—¶åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">minute</td>
<td style="text-align:left">å¯¹äºæ—¥æœŸæ—¶é—´å­—æ®µï¼Œç²¾ç¡®çš„åˆ†é’ŸåŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">second</td>
<td style="text-align:left">å¯¹äºdatetimeå­—æ®µï¼Œç²¾ç¡®çš„ç§’åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:left">isnull</td>
<td style="text-align:left">åˆ¤æ–­å­—æ®µå€¼ä¸º True æˆ– False</td>
</tr>
<tr>
<td style="text-align:left">search</td>
<td style="text-align:left">ä¸€ä¸ªBooleanç±»å‹çš„å…¨æ–‡æœç´¢ï¼Œä»¥å…¨æ–‡æœç´¢çš„ä¼˜åŠ¿</td>
</tr>
<tr>
<td style="text-align:left">regex</td>
<td style="text-align:left">æ­£åˆ™è¡¨è¾¾å¼</td>
</tr>
<tr>
<td style="text-align:left">iregex</td>
<td style="text-align:left">ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</td>
</tr>
</tbody>
</table>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="https://wizardforcel.gitbooks.io/django-chinese-docs-18/content/2_2_2_QuerySet%20method%20reference.html" target="_blank" rel="external">Django 1.8 ä¸­æ–‡æ–‡æ¡£</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;QuerySets-evaluated&quot;&gt;&lt;a href=&quot;#QuerySets-evaluated&quot; class=&quot;headerlink&quot; title=&quot;QuerySets evaluated&quot;&gt;&lt;/a&gt;QuerySets evaluated&lt;/h3&gt;&lt;p&gt;å¯ä»¥åˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’æŸ¥è¯¢é›†è€Œä¸ç”¨çœŸå®æ“ä½œæ•°æ®åº“ã€‚åœ¨ä½ å¯¹æŸ¥è¯¢é›†åšæ±‚å€¼ä¹‹å‰ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å®é™…çš„æ•°æ®åº“æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæŸ¥è¯¢é›†æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæ±‚å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Iteration&lt;/li&gt;
&lt;li&gt;Slicing&lt;/li&gt;
&lt;li&gt;Pickling/Caching&lt;/li&gt;
&lt;li&gt;repr()&lt;/li&gt;
&lt;li&gt;len()&lt;/li&gt;
&lt;li&gt;list()&lt;/li&gt;
&lt;li&gt;bool()&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;QuerySet-API&quot;&gt;&lt;a href=&quot;#QuerySet-API&quot; class=&quot;headerlink&quot; title=&quot;QuerySet API&quot;&gt;&lt;/a&gt;QuerySet API&lt;/h3&gt;&lt;h4 id=&quot;è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•&quot;&gt;&lt;a href=&quot;#è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•&quot;&gt;&lt;/a&gt;è¿”å›æ–°çš„æŸ¥è¯¢é›†æ–¹æ³•&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;filter&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿”å›ä¸€ä¸ªæ–°çš„ QuerySet åŒ…å«ç»™å®šå‚æ•°çš„æŸ¥è¯¢åŒ¹é…å¯¹è±¡ï¼Œæ›´å¤æ‚çš„æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ Q å¯¹è±¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;exclude&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿”å›ä¸€ä¸ªæ–°çš„ QuerySetï¼Œå®ƒåŒ…å«ä¸æ»¡è¶³ç»™å®šçš„æŸ¥æ‰¾å‚æ•°çš„å¯¹è±¡ï¼Œæ›´å¤æ‚çš„æŸ¥è¯¢åŒæ ·å¯ä»¥ä½¿ç”¨ Q å¯¹è±¡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Django" scheme="http://yoursite.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>è±†ç“£æˆ¿æºçˆ¬è™«å°è®°</title>
    <link href="http://yoursite.com/2018/04/05/douban-spider/"/>
    <id>http://yoursite.com/2018/04/05/douban-spider/</id>
    <published>2018-04-05T06:03:55.000Z</published>
    <updated>2018-11-14T15:51:00.816Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åˆè¦å¼€å§‹æ‰¾æˆ¿ï¼Œæ¥ä¸Šæµ·ä¸‰å¹´ä¸åˆ°å·²ç»æ˜¯ç¬¬ä¸‰æ¬¡æ¬å®¶ï¼ŒçœŸæ˜¯å±…å¤§ä¸æ˜“ã€‚ç°åœ¨ä½çš„æˆ¿å­æ˜¯åœ¨è±†ç“£å°ç»„ä¸Šæ‰¾çš„ï¼Œè±†ç“£ä¸Šä¸ªäººæˆ¿æºè¾ƒå¤šï¼Œä½†æ˜¯è±†ç“£å°ç»„æ²¡æœ‰å¯¹æˆ¿æºä¿¡æ¯è¿›è¡Œåˆ†ç±»ï¼Œæ‰¾èµ·æ¥æ¯”è¾ƒè´¹æ—¶ï¼Œç´¢æ€§å†™äº†ä¸ªç®€å•çš„çˆ¬è™«ï¼Œæ ¹æ®å…³é”®å­—æ¥æ‰¾æˆ¿ã€‚ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº›ç°æˆçš„ä»£ç å®ç°ï¼Œæƒ³ç€è¿˜æ˜¯è‡ªå·±å®è·µä¸€ä¸‹ã€‚</p>
<p>Python æ–°æ‰‹ä¸Šè·¯â€¦</p>
<h3 id="è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥"><a href="#è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥" class="headerlink" title="è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥"></a>è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥</h3><p>å…ˆæœç´¢ä¸€ä¸‹ä¸Šæµ·çš„ç§Ÿæˆ¿å°ç»„</p>
<p><img src="/img/270B4257-2781-4F04-A000001F-A539B7F1791D.png" alt=""></p>
<p>æ‰¾å‡ ä¸ªäººæ•°è¾ƒå¤šå’Œæ´»è·ƒåº¦é«˜çš„å°ç»„ï¼Œè¿›å…¥å°ç»„è®¨è®ºé¡µé¢ï¼Œè§‚å¯Ÿ URL çš„è§„å¾‹ã€‚<br><a id="more"></a><br><img src="/img/1D40CBE0-36C5-45E4-9B42-0E7823ADF269.png" alt=""><br><img src="/img/7BD30596-ABF6-428C-BF7B-D232B1C6605D.png" alt=""></p>
<p>ç”±æ­¤å¯çŸ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>https://www.douban.com/group/&lt;ç»„å&gt;/disscussion</code> æ¥è·å–ä¸åŒç»„çš„æˆ¿æºå¸–å­ä¿¡æ¯ï¼Œæˆ‘é€‰å–äº†äº”ä¸ªå°ç»„è¿›è¡Œçˆ¬å–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">In [1]: import os</div><div class="line">In [2]: group_list = [&apos;shanghaizufang&apos;, &apos;homeatshanghai&apos;, &apos;383972&apos;, &apos;shzf&apos;, &apos;251101&apos;]</div><div class="line">In [3]: index_url = [os.path.join(&apos;https://www.douban.com/group&apos;, i, &apos;discussion&apos;) for i in group_list]</div><div class="line">In [4]: index_url</div><div class="line">Out[4]:</div><div class="line">[&apos;https://www.douban.com/group/shanghaizufang/discussion&apos;,</div><div class="line"> &apos;https://www.douban.com/group/homeatshanghai/discussion&apos;,</div><div class="line"> &apos;https://www.douban.com/group/383972/discussion&apos;,</div><div class="line"> &apos;https://www.douban.com/group/shzf/discussion&apos;,</div><div class="line"> &apos;https://www.douban.com/group/251101/discussion&apos;]</div></pre></td></tr></table></figure>
<h3 id="èµ„æºå®šä½"><a href="#èµ„æºå®šä½" class="headerlink" title="èµ„æºå®šä½"></a>èµ„æºå®šä½</h3><p>é€šè¿‡æŸ¥çœ‹é¡µé¢å…ƒç´ ä¿¡æ¯ï¼Œæ‰¾åˆ°æ¯ä¸ªå¸–å­æ ‡é¢˜æ‰€å¯¹åº”çš„ç½‘é¡µä»£ç ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°æ¯ä¸ªæˆ¿æºæ ‡é¢˜å¯¹åº”çš„æ˜¯ä¸€ä¸ª <code>class</code> å±æ€§ä¸º <code>title</code> çš„ <code>td</code> æ ‡è®°ã€‚</p>
<p><img src="/img/59E824C2-AC6A-45F4-86D4-2582065E92A5.png" alt=""></p>
<p>ä½¿ç”¨ <code>BeautifulSoup</code> å°è¯•è·å–ä¸€ä¸‹å°ç»„è®¨è®ºä¸­å¸–å­æ ‡é¢˜ç½‘é¡µä»£ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">In [1]: import requests</div><div class="line">In [2]: from bs4 import BeautifulSoup</div><div class="line">In [3]: url = &apos;https://www.douban.com/group/shanghaizufang/discussion&apos;</div><div class="line">In [4]: headers = &#123;&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 &apos;</div><div class="line">   ...:                                  &apos;(KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36&apos;&#125;</div><div class="line">In [5]: res = requests.get(url, headers=headers)</div><div class="line">In [6]: soup = BeautifulSoup(res.text, &apos;html.parser&apos;)</div><div class="line">In [7]: title_list = soup.find_all(&apos;td&apos;, class_=&apos;title&apos;)</div><div class="line">In [8]: for tl in title_list:</div><div class="line">    ...:     print(tl)</div><div class="line">    ...:</div><div class="line">&lt;td class=&quot;title&quot;&gt;</div><div class="line">&lt;a class=&quot;&quot; href=&quot;https://www.douban.com/group/topic/114471599/&quot; title=&quot;é»„æµ¦åŒºä¸´åœ°é“4å·13å·çº¿å•é—´å‡ºç§Ÿã€‚2300ï¼æ— ä¸­ä»‹ï¼Œå¯æœˆç§Ÿï¼&quot;&gt;</div><div class="line">                       é»„æµ¦åŒºä¸´åœ°é“4å·13å·çº¿å•é—´å‡ºç§Ÿã€‚2300ï¼æ— ä¸­ä»‹ï¼Œå¯...</div><div class="line">                    &lt;/a&gt;</div><div class="line">&lt;/td&gt;</div><div class="line">&lt;td class=&quot;title&quot;&gt;</div><div class="line">&lt;a class=&quot;&quot; href=&quot;https://www.douban.com/group/topic/113810667/&quot; title=&quot;â€”â€”æœ‰é˜³å°Â·æˆ¿é—´ç©ºé—´å¤§Â·ä½ä»·å‡ºç§ŸÂ·2260å…ƒÂ·æ­£å—Â·ç”µæ¢¯æˆ¿Â·æ­¥è¡Œ6åˆ†é’Ÿåˆ°7å·çº¿Â·ã€Šç›’é©¬ç”Ÿé²œÂ·DFCå½±é™¢Â·å¤§åé”¦ç»£å›½é™…ã€‹éš”å£Â·é”¦ç»£ååŸ2è¡—åŒº&quot;&gt;</div><div class="line">                       â€”â€”æœ‰é˜³å°Â·æˆ¿é—´ç©ºé—´å¤§Â·ä½ä»·å‡ºç§ŸÂ·2260å…ƒÂ·æ­£å—...</div><div class="line">                    &lt;/a&gt;</div><div class="line">&lt;/td&gt;</div><div class="line">&lt;td class=&quot;title&quot;&gt;</div><div class="line">&lt;a class=&quot;&quot; href=&quot;https://www.douban.com/group/topic/111282163/&quot; title=&quot;7å·çº¿æ¨é«˜å—è·¯___åŒ—è‰¾è·¯1200å¼„è¶…å¤§1å®¤_æ­£å—_å¤§é£˜çª—_2790å…ƒ&quot;&gt;</div><div class="line">                       7å·çº¿æ¨é«˜å—è·¯___åŒ—è‰¾è·¯1200å¼„è¶…å¤§1å®¤_æ­£å—_å¤§é£˜çª—...</div><div class="line">                    &lt;/a&gt;</div><div class="line">&lt;/td&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="å…³é”®å­—è¿‡æ»¤"><a href="#å…³é”®å­—è¿‡æ»¤" class="headerlink" title="å…³é”®å­—è¿‡æ»¤"></a>å…³é”®å­—è¿‡æ»¤</h3><p>é€šè¿‡ <code>BeautifulSoup</code> æˆ‘ä»¬å·²ç»æˆåŠŸè·å–åˆ°å¸–å­æ ‡é¢˜ç›¸å…³ç½‘é¡µä»£ç ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŒ¹é…æˆ‘ä»¬çš„å…³é”®å­—å¹¶æŠŠå¯¹åº”æ ‡é¢˜çš„ url ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨ä¸€é¡µé¡µå»æ‰¾æˆ¿æºä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">In [9]: for tl in title_list:</div><div class="line">    ...:     print(tl.a[&apos;title&apos;], tl.a[&apos;href&apos;])</div><div class="line">    ...:</div><div class="line">ç´§é æ¼•æ²³æ³¾åœ°é“12å·çº¿è™¹æ¢…è·¯ç«™å¤ç¾å°åŒºç²¾è£…ä¸€å®¤æˆ·éšæ—¶çœ‹æˆ¿ https://www.douban.com/group/topic/114690388/</div><div class="line">ã€æ€§ä»·æ¯”æœ€é«˜ã€‘ã€2/4/6/9ã€‘ä¸–çºªå¤§é“åœ°é“ç«™å£200ç±³å†…ï¼Œ2018.4.5èµ·ä¸‰å¤©å†…ã€å‡ºç§Ÿã€‘æœ‰æ•ˆ https://www.douban.com/group/topic/114031302/</div><div class="line">é™†å®¶å˜´ï¼Œ2å·çº¿ä¸œæ˜Œè·¯ç«™ï¼Œç²¾è£…å—åŒ—ä¸¤æˆ¿ä¸€å…ï¼Œ5400å…ƒå¯è°ˆï¼Œä¹³å±±å››æ‘ https://www.douban.com/group/topic/114838496/</div><div class="line">7å·çº¿30ç§’___é«˜ç§‘è¥¿è·¯2111å¼„ï¼ˆç‹¬ç«‹é˜³å°_æ´—æ¼±ï¼‰2890 https://www.douban.com/group/topic/111749919/</div><div class="line">1å·çº¿å¤–ç¯è·¯ç«™______ä¸»å§æœå—ã€è¿‘åœ°é“ https://www.douban.com/group/topic/115006334/</div><div class="line">7å·çº¿__æˆå±±è·¯2388å¼„(é«˜æ¡£å°åŒºï¼‰__ç¯å¢ƒç¾_2090å…ƒ https://www.douban.com/group/topic/111343989/</div><div class="line">1500å…ƒå°±èƒ½ç§Ÿåˆ°ç¤¾åŒºä¸€å±…å®¤/å¤å¼ä½ä»·ç«çƒ­å‡ºç§ŸING https://www.douban.com/group/topic/114031502/</div><div class="line">1å·çº¿â¤ï¸è²èŠ±è·¯ç«™â¤ï¸æœå—+è½åœ°çª—ï¼ˆ4åˆ†é’Ÿåˆ°åœ°é“ï¼‰___2200Â¥ https://www.douban.com/group/topic/115010633/</div><div class="line">å·¥ä½œè°ƒåŠ¨2469å·çº¿å¾·å¹³è·¯åœ°é“ç«™ä¸¤æˆ¿ï¼ä»·æ ¼å¯åˆ€ https://www.douban.com/group/topic/114668639/</div><div class="line">2å·çº¿ æ·è™¹è·¯ç«™ é€šåå°åŒº æœå—ä¸»å§å¸¦é£˜çª— éšæ—¶å…¥ä½ ç²¾è£…å…¨é… å¯åšé¥­ å‡Œç©ºé¦–é€‰éšæ—¶å…¥ä½å…ˆåˆ°å…ˆå¾— 2700/æœˆ https://www.douban.com/group/topic/114638949/</div><div class="line">3å·çº¿é“åŠ›è·¯ç«™ï¼Œå®ä½“å¢™ä¸€å®¤å¸¦ç‹¬ç«‹å«ç”Ÿé—´ï¼Œå¯ä»¥åšé¥­ï¼Œå‡ºç§Ÿ1900å…ƒã€‚ https://www.douban.com/group/topic/115000070/</div><div class="line">1å·çº¿è²èŠ±è·¯ç«™_____æ­¥è¡Œ2åˆ†é’Ÿï¼ˆè¥¿ç­ç‰™åå›­å°åŒºï¼‰ https://www.douban.com/group/topic/115009200/</div><div class="line">â€”è½åœ°å¤§é˜³å°Â·2780å…ƒÂ·è±ªè£…â€”æµ·å½’é¦–é€‰æˆ¿â€”æ•äº®çš„å¤§æˆ¿å­ã€Šé™†å®¶å˜´Â·é”¦ç»£é‡Œã€‹é«˜æ¡£å°åŒºâ€”ç”µæ¢¯æˆ¿ https://www.douban.com/group/topic/113808306/</div><div class="line">é™å®‰é«˜è£å°åŒºæœå—å¸¦é˜³å°ä¸»å§å‡ºç§Ÿ&lt;é™å¥³ç”Ÿ&gt;3100/æœˆï¼Œç›´æ¥å’Œæˆ¿ä¸œç­¾åˆåŒ https://www.douban.com/group/topic/114799989/</div><div class="line">1å·çº¿â¤ï¸å¤–ç¯è·¯ç«™ã€ä¸»å§ç‹¬å«ã€‘åœ°é“å£__ ä¸Šæµ·é˜³åŸå°åŒº https://www.douban.com/group/topic/115008659/</div><div class="line">äº”è§’åœºé™„è¿‘ä¸»å§å‡ºç§Ÿï¼Œå¸‚å…‰è·¯70å¼„å°åŒºï¼Œé™å¥³ç”Ÿ https://www.douban.com/group/topic/113345605/</div><div class="line">7å·çº¿_åŒ—è‰¾è·¯1200å¼„__æ­£å—æ¸©é¦¨_å¹²å‡€å®‰é™ï¼š1690å…ƒï¼ˆç§Ÿå¥³ç”Ÿï¼‰ https://www.douban.com/group/topic/112014980/</div><div class="line">7å·çº¿é”¦ç»£è·¯ç«™ã€å±±å§†ä¼šå‘˜åº—ã€‘æ—è¾¹  æœå—ç²¾è£…å¤§1å®¤ å¸¦é£˜çª—__2490å…ƒ https://www.douban.com/group/topic/111243092/</div><div class="line">ä¸€ä¸‰å››å…«å·çº¿ä¸Šæµ·ç«è½¦ç«™é™„è¿‘ ï¼ˆ2400ï¼‰é™ä¸€ä¸ªå¥³ç”Ÿ ï¼ˆå®å›¾ä¸ªå›¾ï¼‰æœ‰å¨æˆ¿ æœå—ä¸»å§ https://www.douban.com/group/topic/114856540/</div><div class="line">ä¸€å®¤ä¸€å…ä¸€å¨ä¸€å«æ•´ç§Ÿï¼7å·çº¿ï¼Œä¸Šæµ·å¤§å­¦åœ°é“ç«™ï¼6åˆ†é’Ÿï¼ https://www.douban.com/group/topic/114814137/</div><div class="line">ã€æ— ä¸­ä»‹ã€‘2å·çº¿ ä¸­å±±å…¬å›­å’Œ8å·çº¿ç¿”æ®·è·¯ï¼ˆé è¿‘10å·çº¿äº”è§’å¹¿åœºï¼‰åŠ9å·çº¿æ¾æ±Ÿå¤§å­¦åŸç«™ä¸€å®¤æˆ· https://www.douban.com/group/topic/114031377/</div><div class="line">ä¸ƒå·çº¿å—é™ˆè·¯ï¼Œæ•´ç§Ÿä¸¤æˆ¿ä¸¤å…ï¼Œä¾¿å®œå‡ºç§Ÿï¼ https://www.douban.com/group/topic/113826619/</div><div class="line">7å·çº¿__åŒ—è‰¾è·¯1200å¼„__è¶…å¤§ä¸€å®¤ï¼Œéå¸¸æ¸©é¦¨ï¼š2490å…ƒ https://www.douban.com/group/topic/112276783/</div><div class="line">2/4/6/9å·çº¿ä¸–çºªå¤§é“ç«™ï¼Œç²¾è£…åŒå—ä¸¤æˆ¿ä¸€å…ï¼Œ6600å…ƒå¯è°ˆï¼Œæ¢…å›­äº”è¡—åŠ https://www.douban.com/group/topic/114883174/</div><div class="line">è¿™åº”è¯¥æ˜¯å¾å®¶æ±‡æœ€å¥½çš„å…¬å¯“ https://www.douban.com/group/topic/113839494/</div><div class="line"></div><div class="line">In [10]: keyword = &apos;1å·çº¿&apos;</div><div class="line">In [11]: for tl in title_list:</div><div class="line">    ...:     if keyword in tl.a[&apos;title&apos;]:</div><div class="line">    ...:         print(tl.a[&apos;title&apos;], tl.a[&apos;href&apos;])</div><div class="line">    ...:</div><div class="line">1å·çº¿å¤–ç¯è·¯ç«™______ä¸»å§æœå—ã€è¿‘åœ°é“ https://www.douban.com/group/topic/115006334/</div><div class="line">1å·çº¿â¤ï¸è²èŠ±è·¯ç«™â¤ï¸æœå—+è½åœ°çª—ï¼ˆ4åˆ†é’Ÿåˆ°åœ°é“ï¼‰___2200Â¥ https://www.douban.com/group/topic/115010633/</div><div class="line">1å·çº¿è²èŠ±è·¯ç«™_____æ­¥è¡Œ2åˆ†é’Ÿï¼ˆè¥¿ç­ç‰™åå›­å°åŒºï¼‰ https://www.douban.com/group/topic/115009200/</div><div class="line">1å·çº¿â¤ï¸å¤–ç¯è·¯ç«™ã€ä¸»å§ç‹¬å«ã€‘åœ°é“å£__ ä¸Šæµ·é˜³åŸå°åŒº https://www.douban.com/group/topic/115008659/</div></pre></td></tr></table></figure>
<h3 id="é¡µç æ§åˆ¶"><a href="#é¡µç æ§åˆ¶" class="headerlink" title="é¡µç æ§åˆ¶"></a>é¡µç æ§åˆ¶</h3><p>ä»¥ä¸Šæµ·ç§Ÿæˆ¿å°ç»„ä¸ºä¾‹ï¼Œä¹‹å‰æµ‹è¯•çˆ¬å–çš„è·¯å¾„æ˜¯ <code>https://www.douban.com/group/shanghaizufang/discussion</code> é»˜è®¤åªä¼šçˆ¬å–ç¬¬ä¸€é¡µçš„ 25 æ¡ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³çˆ¬å–æ›´å¤šçš„ä¿¡æ¯ï¼Œå¦‚ä½•æ§åˆ¶çˆ¬å–çš„é¡µç å‘¢ï¼Ÿ</p>
<p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/40E19CBD-E356-4CFA-B635-A430631C84D0.png" alt=""></p>
<p>é€šè¿‡ã€€<code>class</code> å±æ€§ä¸º <code>next</code> çš„ <code>span</code>ã€€æ ‡è®°å¯ä»¥è·å–åˆ°ä¸‹ä¸€é¡µçš„é“¾æ¥åœ°å€ï¼Œ<code>https://www.douban.com/group/shanghaizufang/discussion?start=25</code> è¡¨ç¤ºç¬¬äºŒé¡µä»ç¬¬ 25 æ¡è®°å½•å¼€å§‹å±•ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ§åˆ¶è¦çˆ¬å–çš„ä¿¡æ¯æ¡æ•°ã€‚</p>
<h3 id="ä»£ç æ¦‚è§ˆ"><a href="#ä»£ç æ¦‚è§ˆ" class="headerlink" title="ä»£ç æ¦‚è§ˆ"></a>ä»£ç æ¦‚è§ˆ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># -*- coding:utf-8 -*-</div><div class="line"></div><div class="line">import os</div><div class="line">import requests</div><div class="line">import time</div><div class="line">from bs4 import BeautifulSoup</div><div class="line"></div><div class="line"></div><div class="line">class DouBanHouseSpider(object):</div><div class="line"></div><div class="line">    &quot;&quot;&quot;</div><div class="line">    æŠ“å–è±†ç“£å°ç»„æˆ¿æºä¿¡æ¯</div><div class="line"></div><div class="line">     Attributes:</div><div class="line">        key_word: æˆ¿æºæ ‡é¢˜å…³é”®å­—</div><div class="line">        page_num: æ¯ä¸ªå°ç»„çš„æŠ“å–é¡µæ•°</div><div class="line">        group_list: è±†ç“£å°ç»„åˆ—è¡¨</div><div class="line">        index_url: è±†ç“£å°ç»„åˆ—è¡¨é“¾æ¥</div><div class="line">        data: å­˜æ”¾æŠ“å–ç»“æœ</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    def __init__(self, key_word, page_num):</div><div class="line">        self.key_word = key_word</div><div class="line">        self.page_num = page_num</div><div class="line">        self.group_list = [&apos;shanghaizufang&apos;, &apos;homeatshanghai&apos;, &apos;383972&apos;, &apos;shzf&apos;, &apos;251101&apos;]</div><div class="line">        self.index_url = [os.path.join(&apos;https://www.douban.com/group&apos;, i, &apos;discussion&apos;) for i in self.group_list]</div><div class="line">        self.data = &#123;&#125;</div><div class="line">        print(&apos;è±†ç“£æˆ¿æºçˆ¬è™«å‡†å¤‡å°±ç»ª, å¼€å§‹çˆ¬å–æ•°æ®...&apos;)</div><div class="line"></div><div class="line">    def get_url_content(self, url):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        æ ¹æ® url æŠ“å–é¡µé¢æ•°æ®</div><div class="line"></div><div class="line">        Args:</div><div class="line">            url: è±†ç“£å°ç»„é“¾æ¥</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        try:</div><div class="line">            time.sleep(1)</div><div class="line">            headers = &#123;&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 &apos;</div><div class="line">                                     &apos;(KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36&apos;&#125;</div><div class="line">            res = requests.get(url, headers=headers)</div><div class="line">            soup = BeautifulSoup(res.text, &apos;html.parser&apos;)</div><div class="line">            title_list = soup(&apos;td&apos;, class_=&apos;title&apos;)</div><div class="line">            for tl in title_list:</div><div class="line">                if self.key_word in tl.a.attrs[&apos;title&apos;]:</div><div class="line">                    self.data[tl.a.attrs[&apos;title&apos;]] = tl.a.attrs[&apos;href&apos;]</div><div class="line">            next_page = soup(&apos;span&apos;, class_=&apos;next&apos;)</div><div class="line">            if next_page:</div><div class="line">                next_url = next_page[0].link.attrs[&apos;href&apos;]</div><div class="line">                end_title = next_url.split(&apos;=&apos;)[1]</div><div class="line">                if int(end_title) &lt; (self.page_num * 25):</div><div class="line">                    self.get_url_content(next_url)</div><div class="line">        except Exception as e:</div><div class="line">            print(&apos;æŠ“å–è¿‡ç¨‹æŠ¥é”™ï¼š%s&apos; % e)</div><div class="line"></div><div class="line">    def start_spider(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        çˆ¬è™«å…¥å£</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        for i in self.index_url:</div><div class="line">            self.get_url_content(i)</div><div class="line">        for k, v in self.data.items():</div><div class="line">            print(&apos;æ ‡é¢˜ï¼š%s, é“¾æ¥åœ°å€ï¼š%s&apos;%(k,v))</div><div class="line"></div><div class="line"></div><div class="line">def main():</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    ä¸»å‡½æ•°</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    print(&quot;&quot;&quot;</div><div class="line">            ###############################</div><div class="line">                è±†ç“£æˆ¿æºå°ç»„çˆ¬è™«</div><div class="line">                Author: Abnerzhao</div><div class="line">                Version: 0.0.1</div><div class="line">                Date: 2018-04-04</div><div class="line">            ###############################</div><div class="line">        &quot;&quot;&quot;)</div><div class="line">    key_word = input(&apos;è¯·è¾“å…¥æ‰¾æˆ¿å…³é”®å­—ï¼š&apos;)</div><div class="line">    page_num = input(&apos;è¯·è¾“å…¥æŠ“å–é¡µé¢æ•°ï¼š&apos;)</div><div class="line">    if not key_word:</div><div class="line">        key_word = &apos;1å·çº¿&apos;</div><div class="line">    if not page_num:</div><div class="line">        page_num = 5</div><div class="line">    house_spider = DouBanHouseSpider(key_word, int(page_num))</div><div class="line">    house_spider.start_spider()</div><div class="line">    print(&apos;è±†ç“£æˆ¿æºçˆ¬è™«çˆ¬å–ç»“æŸ...&apos;)</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<blockquote>
<p>è¯·ä½¿ç”¨ Python3ï¼Œ<a href="https://github.com/Abnerzhao/spider/blob/master/douban/douban_spider_exp1.py" target="_blank" rel="external">çˆ¬è™«æºç åœ°å€</a></p>
</blockquote>
<p>æ‰§è¡Œæ•ˆæœï¼š</p>
<p><img src="/img/BAFCA92D-6F56-478A-B94E-8D18830BB546.png" alt=""></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ªçˆ¬è™«å¾ˆç®€å•ï¼Œæ²¡æœ‰è¿›è¡Œæ¨¡æ‹Ÿç™»é™†ä¹Ÿèƒ½æŠ“å–ï¼Œå½“æŠ“å–é¡µé¢æ•°è¾ƒå¤§æ—¶ä¼šè€—æ—¶è¾ƒé•¿ã€‚åŒä¸€ä¸ªæˆ¿æºä¿¡æ¯å¯èƒ½åœ¨ä¸åŒçš„å°ç»„ä¸­éƒ½æœ‰ï¼Œæ‰€ä»¥é€šè¿‡ä¸€ä¸ªå­—å…¸æ¥ä¿å­˜æŠ“å–çš„æ ‡é¢˜å’Œé“¾æ¥ï¼Œé¿å…é‡å¤çš„æ ‡é¢˜ã€‚</p>
<p>åç»­å¾…ä¼˜åŒ–çš„åœ°æ–¹:</p>
<ul>
<li>æ¨¡æ‹Ÿç™»é™†</li>
<li>æ”¯æŒå¤šä¸ªå…³é”®å­—</li>
<li>å¤šçº¿ç¨‹</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åˆè¦å¼€å§‹æ‰¾æˆ¿ï¼Œæ¥ä¸Šæµ·ä¸‰å¹´ä¸åˆ°å·²ç»æ˜¯ç¬¬ä¸‰æ¬¡æ¬å®¶ï¼ŒçœŸæ˜¯å±…å¤§ä¸æ˜“ã€‚ç°åœ¨ä½çš„æˆ¿å­æ˜¯åœ¨è±†ç“£å°ç»„ä¸Šæ‰¾çš„ï¼Œè±†ç“£ä¸Šä¸ªäººæˆ¿æºè¾ƒå¤šï¼Œä½†æ˜¯è±†ç“£å°ç»„æ²¡æœ‰å¯¹æˆ¿æºä¿¡æ¯è¿›è¡Œåˆ†ç±»ï¼Œæ‰¾èµ·æ¥æ¯”è¾ƒè´¹æ—¶ï¼Œç´¢æ€§å†™äº†ä¸ªç®€å•çš„çˆ¬è™«ï¼Œæ ¹æ®å…³é”®å­—æ¥æ‰¾æˆ¿ã€‚ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº›ç°æˆçš„ä»£ç å®ç°ï¼Œæƒ³ç€è¿˜æ˜¯è‡ªå·±å®è·µä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Python æ–°æ‰‹ä¸Šè·¯â€¦&lt;/p&gt;
&lt;h3 id=&quot;è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥&quot;&gt;&lt;a href=&quot;#è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥&quot;&gt;&lt;/a&gt;è·å–è±†ç“£æˆ¿æºå°ç»„é“¾æ¥&lt;/h3&gt;&lt;p&gt;å…ˆæœç´¢ä¸€ä¸‹ä¸Šæµ·çš„ç§Ÿæˆ¿å°ç»„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/270B4257-2781-4F04-A000001F-A539B7F1791D.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ‰¾å‡ ä¸ªäººæ•°è¾ƒå¤šå’Œæ´»è·ƒåº¦é«˜çš„å°ç»„ï¼Œè¿›å…¥å°ç»„è®¨è®ºé¡µé¢ï¼Œè§‚å¯Ÿ URL çš„è§„å¾‹ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Celery åå°æ‰§è¡Œæ–¹æ³•</title>
    <link href="http://yoursite.com/2018/03/25/celery-background/"/>
    <id>http://yoursite.com/2018/03/25/celery-background/</id>
    <published>2018-03-25T06:40:10.000Z</published>
    <updated>2018-03-25T06:44:18.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="init-script"><a href="#init-script" class="headerlink" title="init-script"></a>init-script</h3><p>1.å…ˆä¸‹è½½ä¸¤ä¸ªè„šæœ¬æ–‡ä»¶ <a href="https://github.com/celery/celery/tree/3.1/extra/generic-init.d/" target="_blank" rel="external">generic-init.d</a>ï¼Œæˆ‘çš„é¡¹ç›®é‡Œæœ‰å®šæ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸¤ä¸ªéƒ½éœ€è¦ç”¨åˆ°</p>
<p>2.åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat /etc/default/celeryd</div><div class="line"># Names of nodes to start</div><div class="line">#   most people will only start one node:</div><div class="line"></div><div class="line">CELERYD_NODES=&quot;worker1&quot; # work ä»»åŠ¡èŠ‚ç‚¹</div><div class="line"></div><div class="line">#   but you can also start multiple and configure settings</div><div class="line">#   for each in CELERYD_OPTS</div><div class="line">#CELERYD_NODES=&quot;worker1 worker2 worker3&quot;</div><div class="line">#   alternatively, you can specify the number of nodes to start:</div><div class="line">#CELERYD_NODES=10</div><div class="line"></div><div class="line"># Absolute or relative path to the &apos;celery&apos; command:</div><div class="line"></div><div class="line">CELERY_BIN=&quot;/home/prod/softwares/python/bin/celery&quot; # celery å‘½ä»¤çš„ç»å¯¹è·¯å¾„</div><div class="line"></div><div class="line"># App instance to use</div><div class="line"># comment out this line if you don&apos;t use an app</div><div class="line"></div><div class="line">CELERY_APP=&quot;wfstar&quot; # åº”ç”¨å®ä¾‹</div><div class="line"></div><div class="line"># or fully qualified:</div><div class="line">#CELERY_APP=&quot;proj.tasks:app&quot;</div><div class="line"></div><div class="line"># Where to chdir at start.</div><div class="line">CELERYD_CHDIR=&quot;/home/prod/deploys/wfstar&quot; # é¡¹ç›®ç›®å½•</div><div class="line"></div><div class="line"># Extra command-line arguments to the worker</div><div class="line"></div><div class="line">CELERYD_OPTS=&quot;--time-limit=300 --concurrency=8&quot; # å‘½ä»¤è¡Œå‚æ•°ï¼Œæ›´å¤šè¯·å‚è€ƒ man æ‰‹å†Œ </div><div class="line"></div><div class="line"># Configure node-specific settings by appending node name to arguments:</div><div class="line">#CELERYD_OPTS=&quot;--time-limit=300 -c 8 -c:worker2 4 -c:worker3 2 -Ofair:worker1&quot;</div><div class="line"># Set logging level to DEBUG</div><div class="line">#CELERYD_LOG_LEVEL=&quot;DEBUG&quot;</div><div class="line"></div><div class="line"># %n will be replaced with the first part of the nodename</div><div class="line"></div><div class="line">CELERYD_LOG_FILE=&quot;/var/log/celery/%n%I.log&quot;</div><div class="line">CELERYD_PID_FILE=&quot;/var/run/celery/%n.pid&quot;</div><div class="line"></div><div class="line"># Workers should run as an unprivileged user.</div><div class="line">#   You need to create this user manually (or you can choose</div><div class="line">#   a user/group combination that already exists (e.g., nobody).</div><div class="line"></div><div class="line">CELERYD_USER=&quot;prod&quot;</div><div class="line">CELERYD_GROUP=&quot;prod&quot;</div><div class="line"></div><div class="line"># If enabled pid and log directories will be created if missing,</div><div class="line"># and owned by the userid/group configured.</div><div class="line">CELERY_CREATE_DIRS=1  # è‡ªåŠ¨åˆ›å»ºæ—¥å¿—å’Œ pid æ–‡ä»¶</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>3.å°†ä¸‹è½½çš„ <code>celeryd</code> å’Œ <code>celerybeat</code> æ‹·è´åˆ° /etc/init.d ç›®å½•å¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™</p>
<blockquote>
<p>æ³¨æ„éƒ¨åˆ†å†…å®¹çš„ä¿®æ”¹ï¼Œå¦‚æ‰§è¡Œç”¨æˆ·</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat /etc/init.d/celeryd</div><div class="line">...</div><div class="line">DEFAULT_USER=&quot;prod&quot;</div><div class="line">DEFAULT_PID_FILE=&quot;/var/run/celery/%n.pid&quot;</div><div class="line">DEFAULT_LOG_FILE=&quot;/var/log/celery/%n.log&quot;</div><div class="line">DEFAULT_LOG_LEVEL=&quot;INFO&quot;</div><div class="line">DEFAULT_NODES=&quot;celery&quot;</div><div class="line">DEFAULT_CELERYD=&quot;-m celery worker --detach&quot;</div><div class="line">...</div><div class="line">$ cat /etc/init.d/celerybeat</div><div class="line">...</div><div class="line">CELERY_BIN=$&#123;CELERY_BIN:-&quot;celery&quot;&#125;</div><div class="line">DEFAULT_USER=&quot;prod&quot;</div><div class="line">DEFAULT_PID_FILE=&quot;/var/run/celery/beat.pid&quot;</div><div class="line">DEFAULT_LOG_FILE=&quot;/var/log/celery/beat.log&quot;</div><div class="line">DEFAULT_LOG_LEVEL=&quot;INFO&quot;</div><div class="line">DEFAULT_CELERYBEAT=&quot;$CELERY_BIN beat&quot;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>4.å¯åŠ¨ work å’Œ beat</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo /etc/init.d/celeryd start</div><div class="line">$ sudo /etc/init.d/celerybeat start</div></pre></td></tr></table></figure>
<h3 id="supervisord"><a href="#supervisord" class="headerlink" title="supervisord"></a>supervisord</h3><p>1.å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo apt-get install supervisor # å› ä¸ºæˆ‘è¿™é‡Œçš„é¡¹ç›®ç”¨çš„æ˜¯ Python3ï¼Œæ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ pip å®‰è£…</div></pre></td></tr></table></figure>
<p>2.é…ç½®</p>
<p>åœ¨ <code>/etc/supervisor/conf.d</code> æ–°å»ºé…ç½®æ–‡ä»¶ <code>celery_wfstar_worker.conf</code> å’Œ <code>celery_wfstar_beat.conf</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat /etc/supervisor/conf.d/celery_wfstar_worker.conf</div><div class="line">[program:wfstar_worker] </div><div class="line">command=/home/prod/deploys/wfstart_env/bin/celery -A wfstar worker -l info # æ‰§è¡Œå‘½ä»¤</div><div class="line">directory=/home/prod/deploys/wfstar  # è¿è¡Œç›®å½•</div><div class="line">user=prod  # æ‰§è¡Œç”¨æˆ·</div><div class="line">numprocs=1 # å¯åŠ¨è¿›ç¨‹æ•°</div><div class="line">stdout_logfile=/home/prod/deploys/wfstar/logs/celery.log # æ ‡å‡†è¾“å‡ºæ—¥å¿—</div><div class="line">redirect_stderr=true # å°† stderr çš„æ—¥å¿—ä¼šå†™å…¥ stdout æ—¥å¿—æ–‡ä»¶ä¸­</div><div class="line">autostart=true # supervisor å¯åŠ¨ï¼Œç¨‹åºè‡ªåŠ¨å¯åŠ¨</div><div class="line">autorestart=true # è‡ªåŠ¨é‡å¯</div><div class="line">startsecs=10 # è¿›ç¨‹å¯åŠ¨ 10s åï¼ŒçŠ¶æ€ä¸º running åˆ™ä¸ºå¯åŠ¨æˆåŠŸ</div><div class="line">stopwaitsecs = 600 </div><div class="line">killasgroup=true</div><div class="line">priority=998 # ä¼˜å…ˆçº§</div><div class="line">stopsignal=QUIT # åœæ­¢ä¿¡å·</div><div class="line"></div><div class="line">$ cat /etc/supervisor/conf.d/celery_wfstar_beat.conf</div><div class="line">[program:wfstar_beat]</div><div class="line">command=/home/prod/deploys/wfstart_env/bin/celery -A wfstar beat -l info</div><div class="line">directory=/home/prod/deploys/wfstar</div><div class="line">user=prod</div><div class="line">numprocs=1</div><div class="line">stdout_logfile=/home/prod/deploys/wfstar/logs/celerybeat.log</div><div class="line">redirect_stderr=true</div><div class="line">autostart=true</div><div class="line">autorestart=true</div><div class="line">startsecs=10</div><div class="line">stopwaitsecs = 600</div><div class="line">killasgroup=true</div><div class="line">priority=999</div><div class="line">stopsignal=QUIT</div></pre></td></tr></table></figure>
<p>é…ç½®æ–‡ä»¶å¯å‚è€ƒ <a href="https://github.com/celery/celery/tree/master/extra/supervisord" target="_blank" rel="external">github celery supervisord configure</a></p>
<p>3.å¯åŠ¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo supervisorctl reread</div><div class="line">$ sudo supervisorctl update</div><div class="line">$ sudo supervisorctl start all</div><div class="line">$ sudo supervisorctl status</div><div class="line">wfstar_beat                      RUNNING   pid 16752, uptime 0:00:34</div><div class="line">wfstar_worker                    RUNNING   pid 16751, uptime 0:00:34</div></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://pythad.github.io/articles/2016-12/how-to-run-celery-as-a-daemon-in-production" target="_blank" rel="external">How to run celery as a daemon</a></p>
<p><a href="https://yangchy.com/2018/01/17/Celery-%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/" target="_blank" rel="external">Celery åå°è¿è¡Œ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;init-script&quot;&gt;&lt;a href=&quot;#init-script&quot; class=&quot;headerlink&quot; title=&quot;init-script&quot;&gt;&lt;/a&gt;init-script&lt;/h3&gt;&lt;p&gt;1.å…ˆä¸‹è½½ä¸¤ä¸ªè„šæœ¬æ–‡ä»¶ &lt;a href=&quot;https://github.com/celery/celery/tree/3.1/extra/generic-init.d/&quot;&gt;generic-init.d&lt;/a&gt;ï¼Œæˆ‘çš„é¡¹ç›®é‡Œæœ‰å®šæ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸¤ä¸ªéƒ½éœ€è¦ç”¨åˆ°&lt;/p&gt;
&lt;p&gt;2.åˆ›å»ºé…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ cat /etc/default/celeryd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Names of nodes to start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   most people will only start one node:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_NODES=&amp;quot;worker1&amp;quot; # work ä»»åŠ¡èŠ‚ç‚¹&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   but you can also start multiple and configure settings&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   for each in CELERYD_OPTS&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#CELERYD_NODES=&amp;quot;worker1 worker2 worker3&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   alternatively, you can specify the number of nodes to start:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#CELERYD_NODES=10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Absolute or relative path to the &amp;apos;celery&amp;apos; command:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERY_BIN=&amp;quot;/home/prod/softwares/python/bin/celery&amp;quot; # celery å‘½ä»¤çš„ç»å¯¹è·¯å¾„&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# App instance to use&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# comment out this line if you don&amp;apos;t use an app&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERY_APP=&amp;quot;wfstar&amp;quot; # åº”ç”¨å®ä¾‹&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# or fully qualified:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#CELERY_APP=&amp;quot;proj.tasks:app&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Where to chdir at start.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_CHDIR=&amp;quot;/home/prod/deploys/wfstar&amp;quot; # é¡¹ç›®ç›®å½•&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Extra command-line arguments to the worker&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_OPTS=&amp;quot;--time-limit=300 --concurrency=8&amp;quot; # å‘½ä»¤è¡Œå‚æ•°ï¼Œæ›´å¤šè¯·å‚è€ƒ man æ‰‹å†Œ &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Configure node-specific settings by appending node name to arguments:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#CELERYD_OPTS=&amp;quot;--time-limit=300 -c 8 -c:worker2 4 -c:worker3 2 -Ofair:worker1&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Set logging level to DEBUG&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#CELERYD_LOG_LEVEL=&amp;quot;DEBUG&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# %n will be replaced with the first part of the nodename&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_LOG_FILE=&amp;quot;/var/log/celery/%n%I.log&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_PID_FILE=&amp;quot;/var/run/celery/%n.pid&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# Workers should run as an unprivileged user.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   You need to create this user manually (or you can choose&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#   a user/group combination that already exists (e.g., nobody).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_USER=&amp;quot;prod&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERYD_GROUP=&amp;quot;prod&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# If enabled pid and log directories will be created if missing,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# and owned by the userid/group configured.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;CELERY_CREATE_DIRS=1  # è‡ªåŠ¨åˆ›å»ºæ—¥å¿—å’Œ pid æ–‡ä»¶&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="celery" scheme="http://yoursite.com/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>Django Celery å®šæ—¶ä»»åŠ¡ç¬”è®°</title>
    <link href="http://yoursite.com/2018/02/25/django-celery-notes/"/>
    <id>http://yoursite.com/2018/02/25/django-celery-notes/</id>
    <published>2018-02-25T09:49:43.000Z</published>
    <updated>2018-03-25T09:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><ul>
<li>Python 2.7</li>
<li>Djang 1.10</li>
<li>celery 4.1.0</li>
<li>RabbitMQ 3.2.4</li>
</ul>
<h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º-Django-é¡¹ç›®"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º-Django-é¡¹ç›®" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º Django é¡¹ç›®"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º Django é¡¹ç›®</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ virtualenv django-exp</div><div class="line">$ source django-exp/bin/activate</div><div class="line">$ pip intall django==1.10</div><div class="line">$ django-admin startproject myproject</div><div class="line">$ cd myproject/</div><div class="line">$ django-admin startapp myapp</div><div class="line">$ tree</div><div class="line">.</div><div class="line">â”œâ”€â”€ manage.py</div><div class="line">â”œâ”€â”€ myapp</div><div class="line">â”‚Â Â  â”œâ”€â”€ admin.py</div><div class="line">â”‚Â Â  â”œâ”€â”€ apps.py</div><div class="line">â”‚Â Â  â”œâ”€â”€ __init__.py</div><div class="line">â”‚Â Â  â”œâ”€â”€ migrations</div><div class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.py</div><div class="line">â”‚Â Â  â”œâ”€â”€ models.py</div><div class="line">â”‚Â Â  â”œâ”€â”€ tests.py</div><div class="line">â”‚Â Â  â””â”€â”€ views.py</div><div class="line">â””â”€â”€ myproject</div><div class="line">    â”œâ”€â”€ __init__.py</div><div class="line">    â”œâ”€â”€ settings.py</div><div class="line">    â”œâ”€â”€ urls.py</div><div class="line">    â””â”€â”€ wsgi.py</div><div class="line">$ pip install celery</div><div class="line">$ pip install pysqlite</div><div class="line">$ sudo apt-get install rabbitmq-server</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="é…ç½®-Celery"><a href="#é…ç½®-Celery" class="headerlink" title="é…ç½® Celery"></a>é…ç½® Celery</h4><ul>
<li><code>myproject/celery.py</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat myproject/celery.py</div><div class="line">from __future__ import absolute_import, unicode_literals</div><div class="line">import os</div><div class="line">from celery import Celery</div><div class="line">from django.conf import settings</div><div class="line"></div><div class="line"># set the default Django settings module for the &apos;celery&apos; program.</div><div class="line">os.environ.setdefault(&apos;DJANGO_SETTINGS_MODULE&apos;, &apos;myproject.settings&apos;)</div><div class="line"></div><div class="line">app = Celery(&apos;myproject&apos;)</div><div class="line"></div><div class="line"># Using a string here means the worker don&apos;t have to serialize</div><div class="line"># the configuration object to child processes.</div><div class="line"># - namespace=&apos;CELERY&apos; means all celery-related configuration keys</div><div class="line">#   should have a `CELERY_` prefix.</div><div class="line">app.config_from_object(&apos;django.conf:settings&apos;)</div><div class="line"></div><div class="line"># Load task modules from all registered Django app configs.</div><div class="line">app.autodiscover_tasks(lambda: settings.INSTALLED_APPS)</div><div class="line"></div><div class="line"></div><div class="line">@app.task(bind=True)</div><div class="line">def debug_task(self):</div><div class="line">    print(&apos;Request: &#123;0!r&#125;&apos;.format(self.request))</div></pre></td></tr></table></figure>
<ul>
<li><code>myproject/__init__.py</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat myproject/__init__.py</div><div class="line">from __future__ import absolute_import, unicode_literals</div><div class="line"></div><div class="line"># This will make sure the app is always imported when</div><div class="line"># Django starts so that shared_task will use this app.</div><div class="line">from .celery import app as celery_app</div><div class="line"></div><div class="line">__all__ = [&apos;celery_app&apos;]</div></pre></td></tr></table></figure>
<ul>
<li><code>myapp/tasks.py</code> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat myapp/tasks.py</div><div class="line">from __future__ import absolute_import, unicode_literals</div><div class="line">from celery.task.schedules import crontab</div><div class="line">from celery.decorators import periodic_task</div><div class="line"></div><div class="line">@periodic_task(run_every=(crontab(minute=&quot;*/1&quot;))) # æ¯éš”ä¸€åˆ†é’Ÿå†™å…¥ hello world</div><div class="line">def hello_world():</div><div class="line">    with open(&quot;/tmp/output.txt&quot;, &quot;a&quot;) as f:</div><div class="line">        f.write(&quot;hello world&quot;)</div><div class="line">        f.write(&quot;\n&quot;)</div></pre></td></tr></table></figure>
<ul>
<li><code>myproject/setting.py</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat myproject/setting.py</div><div class="line">...</div><div class="line">CELERY_BROKER_URL = &apos;amqp://localhost&apos;</div><div class="line">CELERY_ACCEPT_CONTENT = [&apos;application/json&apos;]</div><div class="line">CELERY_RESULT_SERIALIZER = &apos;json&apos;</div><div class="line">CELERY_TASK_SERIALIZER = &apos;json&apos;</div><div class="line"></div><div class="line">INSTALLED_APPS = [</div><div class="line">    &apos;django.contrib.admin&apos;,</div><div class="line">    &apos;django.contrib.auth&apos;,</div><div class="line">    &apos;django.contrib.contenttypes&apos;,</div><div class="line">    &apos;django.contrib.sessions&apos;,</div><div class="line">    &apos;django.contrib.messages&apos;,</div><div class="line">    &apos;django.contrib.staticfiles&apos;,</div><div class="line">    &apos;myapp&apos;,</div><div class="line">]</div><div class="line">...</div><div class="line">LANGUAGE_CODE = &apos;en-us&apos;</div><div class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</div><div class="line">USE_I18N = True</div><div class="line">USE_L10N = True</div><div class="line">USE_TZ = False</div><div class="line">...</div></pre></td></tr></table></figure>
<h4 id="åŒæ­¥æ•°æ®åº“"><a href="#åŒæ­¥æ•°æ®åº“" class="headerlink" title="åŒæ­¥æ•°æ®åº“"></a>åŒæ­¥æ•°æ®åº“</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ python manage.py makemigrations</div><div class="line">$ python manage.py migrate</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨-worker-å’Œ-beat"><a href="#å¯åŠ¨-worker-å’Œ-beat" class="headerlink" title="å¯åŠ¨ worker å’Œ beat"></a>å¯åŠ¨ worker å’Œ beat</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ celery -A myproject worker -l info -B</div><div class="line">...</div><div class="line">[2018-02-25 16:59:00,000: INFO/Beat] Scheduler: Sending due task myapp.tasks.hello_world (myapp.tasks.hello_world)</div><div class="line">[2018-02-25 16:59:00,008: INFO/MainProcess] Received task: myapp.tasks.hello_world[e1aa8b70-586d-4a2b-b598-64c322b211a7]</div><div class="line">[2018-02-25 16:59:00,010: INFO/MainProcess] Task myapp.tasks.hello_world[e1aa8b70-586d-4a2b-b598-64c322b211a7] succeeded in 0.00109826028347s: None</div><div class="line">[2018-02-25 17:00:00,056: INFO/Beat] Scheduler: Sending due task myapp.tasks.hello_world (myapp.tasks.hello_world)</div><div class="line">[2018-02-25 17:00:00,058: INFO/MainProcess] Received task: myapp.tasks.hello_world[78ec725f-61b7-4fe6-a1c1-b2c60fb9ffed]</div><div class="line">[2018-02-25 17:00:00,060: INFO/MainProcess] Task myapp.tasks.hello_world[78ec725f-61b7-4fe6-a1c1-b2c60fb9ffed] succeeded in 0.000685669481754s: None</div><div class="line">$ tail /tmp/output.txt</div><div class="line">hello world</div><div class="line">hello world</div><div class="line">hello world</div><div class="line">hello world</div><div class="line">hello world</div></pre></td></tr></table></figure>
<p>é™¤äº†ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ admin åå°è®¾ç½®è®¡åˆ’ä»»åŠ¡ï¼Œä¸è¿‡éœ€è¦å®‰è£… <code>django-celery</code> å¹¶è®¾ç½® Database-backedï¼Œå…·ä½“è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://docs.celeryproject.org/en/v4.0.2/django/first-steps-with-django.html" target="_blank" rel="external">Using Celery with Django</a></p>
<p><a href="http://www.marinamele.com/2014/02/how-to-install-celery-on-django-and.html" target="_blank" rel="external">How to install Celery on Django and Create a Periodic Task</a></p>
<p><a href="https://medium.com/@yehandjoe/celery-4-periodic-task-in-django-9f6b5a8c21c7" target="_blank" rel="external">Celery 4 Periodic Task in Django</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;/a&gt;ç¯å¢ƒå‡†å¤‡&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Python 2.7&lt;/li&gt;
&lt;li&gt;Djang 1.10&lt;/li&gt;
&lt;li&gt;celery 4.1.0&lt;/li&gt;
&lt;li&gt;RabbitMQ 3.2.4&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;å¼€å§‹&quot;&gt;&lt;a href=&quot;#å¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹&quot;&gt;&lt;/a&gt;å¼€å§‹&lt;/h3&gt;&lt;h4 id=&quot;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º-Django-é¡¹ç›®&quot;&gt;&lt;a href=&quot;#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º-Django-é¡¹ç›®&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º Django é¡¹ç›®&quot;&gt;&lt;/a&gt;åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œæ„å»º Django é¡¹ç›®&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ virtualenv django-exp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ source django-exp/bin/activate&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ pip intall django==1.10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ django-admin startproject myproject&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ cd myproject/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ django-admin startapp myapp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ tree&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”œâ”€â”€ manage.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”œâ”€â”€ myapp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ admin.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ apps.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ __init__.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ migrations&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ models.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â”œâ”€â”€ tests.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â”‚Â Â  â””â”€â”€ views.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;â””â”€â”€ myproject&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    â”œâ”€â”€ __init__.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    â”œâ”€â”€ settings.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    â”œâ”€â”€ urls.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    â””â”€â”€ wsgi.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ pip install celery&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ pip install pysqlite&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ sudo apt-get install rabbitmq-server&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="celery" scheme="http://yoursite.com/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Sphinx + GitHub + Read the Docsæ­å»ºwiki</title>
    <link href="http://yoursite.com/2017/10/14/quickstart-wiki/"/>
    <id>http://yoursite.com/2017/10/14/quickstart-wiki/</id>
    <published>2017-10-14T07:54:01.000Z</published>
    <updated>2018-11-14T15:49:08.127Z</updated>
    
    <content type="html"><![CDATA[<p>Sphinx æ˜¯ä¸€ä¸ªåŸºäº ReStructuredText çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œæœ‰å¾ˆå¤šå¼€æºå·¥ç¨‹éƒ½é‡‡ç”¨sphinxä½œä¸ºæ–‡æ¡£ç”Ÿæˆç³»ç»Ÿï¼Œæœ€æœ‰åçš„å°±æ˜¯ python å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>Read the Docsæ˜¯ä¸€ä¸ªåœ¨çº¿æ–‡æ¡£æ‰˜ç®¡æœåŠ¡ï¼Œå¯ä»¥ä»å„ç§ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­å¯¼å…¥æ–‡æ¡£ã€‚æ”¯æŒ webhooksï¼Œå½“ä½ æäº¤ä»£ç æ—¶ï¼Œæ–‡æ¡£å°†è¢«è‡ªåŠ¨æ„å»ºã€‚</p>
<p>Sphinx + GitHub + ReadtheDocs ä½œä¸ºä¸€ä¸ªæ–‡æ¡£å†™ä½œå·¥å…·ï¼Œ ç”¨ Sphinx ç”Ÿæˆæ–‡æ¡£ï¼ŒGitHub æ‰˜ç®¡æ–‡æ¡£ï¼Œå†å¯¼å…¥åˆ° ReadtheDocsã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·å†™æ–‡æ¡£ã€è®°ç¬”è®°ç­‰ã€‚</p>
<h3 id="æ­å»ºè¿‡ç¨‹"><a href="#æ­å»ºè¿‡ç¨‹" class="headerlink" title="æ­å»ºè¿‡ç¨‹"></a>æ­å»ºè¿‡ç¨‹</h3><h4 id="å®‰è£…-Sphinx"><a href="#å®‰è£…-Sphinx" class="headerlink" title="å®‰è£… Sphinx"></a>å®‰è£… Sphinx</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo pip install sphinx</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="åˆ›å»ºwikiç›®å½•"><a href="#åˆ›å»ºwikiç›®å½•" class="headerlink" title="åˆ›å»ºwikiç›®å½•"></a>åˆ›å»ºwikiç›®å½•</h4><p>ä½¿ç”¨ sphinx è‡ªå¸¦çš„é…ç½®å·¥å…· <code>sphinx-quickstart</code> å¿«é€Ÿåˆ›å»ºå·¥ç¨‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ mkdir mywiki</div><div class="line">$ sphinx-quickstart  //å¤§éƒ¨åˆ†ä½¿ç”¨é»˜è®¤é€‰é¡¹ï¼Œç›´æ¥æŒ‰å›è½¦å³å¯</div><div class="line">Welcome to the Sphinx 1.6.3 quickstart utility.</div><div class="line">...</div><div class="line"># åˆ†ç¦»sourceå’Œbuildç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†</div><div class="line">&gt; Separate source and build directories (y/n) [n]: y</div><div class="line"></div><div class="line"># æŒ‡å®šå·¥ç¨‹åã€ä½œè€…åã€ç‰ˆæœ¬å·ã€è¯­è¨€</div><div class="line">The project name will occur in several places in the built documentation.</div><div class="line">&gt; Project name: mywiki</div><div class="line">&gt; Author name(s): abnerzhao</div><div class="line">&gt; Project version []: 0.1</div><div class="line">&gt; Project release [0.1]:</div><div class="line">&gt; Project language [en]: zh_CN</div><div class="line">...</div><div class="line">Creating file ./source/conf.py.</div><div class="line">Creating file ./source/index.rst.</div><div class="line">Creating file ./Makefile.</div><div class="line">Creating file ./make.bat.</div><div class="line"></div><div class="line">Finished: An initial directory structure has been created.</div><div class="line">...</div><div class="line">$ ls</div><div class="line">Makefile build    make.bat source</div></pre></td></tr></table></figure>
<p>åˆ›å»ºå®Œæˆåï¼Œmywikiç›®å½•æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<ul>
<li>buildç›®å½•ï¼šè¿è¡Œmakeå‘½ä»¤åï¼Œç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•é‡Œé¢</li>
<li>sourceç›®å½•ï¼šæ”¾ç½®æ–‡æ¡£çš„æºæ–‡ä»¶</li>
<li>make.batï¼šæ‰¹å¤„ç†å‘½ä»¤</li>
<li>Makefile</li>
</ul>
<h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><p>conf.py æ–‡ä»¶åŒ…å«äº† sphinx å·¥ç¨‹çš„æ‰€æœ‰é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬ä¸€äº›æ— æ³•åœ¨ sphinx-quickstart ä¸­è¿›è¡Œè®¾ç½®çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ vi source/conf.py</div><div class="line">...</div><div class="line">html_theme = &apos;sphinx_rtd_theme&apos; # è¾“å‡ºhtmlçš„ä¸»é¢˜</div><div class="line">...</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-github-è¿›è¡Œç‰ˆæœ¬æ§åˆ¶"><a href="#ä½¿ç”¨-github-è¿›è¡Œç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="ä½¿ç”¨ github è¿›è¡Œç‰ˆæœ¬æ§åˆ¶"></a>ä½¿ç”¨ github è¿›è¡Œç‰ˆæœ¬æ§åˆ¶</h4><p>é¦–å…ˆåœ¨ github åˆ›å»ºæ–°çš„ä»“åº“ mywikiï¼Œç„¶åå°†æœ¬åœ°çš„ mywiki/source ç›®å½• push åˆ° mywiki è¿œç¨‹ä»“åº“ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd source</div><div class="line">$ echo &quot;# mywiki&quot; &gt;&gt; README.md</div><div class="line">$ git init</div><div class="line">$ git add .</div><div class="line">$ git commit -m &quot;first commit&quot;</div><div class="line">$ git remote add origin git@github.com:[yourusename]/mywiki.git</div><div class="line">$ git push -u origin master</div></pre></td></tr></table></figure>
<h4 id="å¯¼å…¥åˆ°-ReadtheDocs"><a href="#å¯¼å…¥åˆ°-ReadtheDocs" class="headerlink" title="å¯¼å…¥åˆ° ReadtheDocs"></a>å¯¼å…¥åˆ° ReadtheDocs</h4><p>é¦–å…ˆåˆ° github ä¸­é€‰æ‹© mywiki ä»“åº“ï¼ŒSettings / Services / Add ReadTheDocs</p>
<p><img src="/img/B18863C1-6A9F-4A72-95C0-2580B1E75983.png" alt=""></p>
<p>ç„¶ååˆ° ReadtheDocs ç½‘ç«™ import mywiki ä»“åº“ï¼Œå¯¼å…¥æˆåŠŸåå¯çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼š</p>
<p><img src="/img/C1184CE3-2FA6-4898-ADAE-3072C6E8FF4E.png" alt=""></p>
<h4 id="æ„å»ºæ–‡æ¡£"><a href="#æ„å»ºæ–‡æ¡£" class="headerlink" title="æ„å»ºæ–‡æ¡£"></a>æ„å»ºæ–‡æ¡£</h4><p>ç°åœ¨ mywiki ç›®å½•åªæœ‰é»˜è®¤å†…å®¹ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ·»åŠ å†…å®¹ï¼Œç„¶åæ„å»ºã€‚æ„å»ºæ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>å‘½ä»¤è¡Œæ‰§è¡Œ <code>make html</code> </li>
<li>ReadtheDocs ç½‘ç«™æ‰‹åŠ¨æ„å»º</li>
</ul>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹é»˜è®¤æ„å»ºå‡ºæ¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œæ‰§è¡Œ<code>make html</code> æˆåŠŸåï¼Œå³å¯åˆ° ReadtheDocs ç½‘ç«™é˜…è¯»æ–‡æ¡£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd /Users/Mr-zhao/mywiki</div><div class="line">$ ls</div><div class="line">Makefile build    make.bat source</div><div class="line">$ make html</div></pre></td></tr></table></figure>
<p><img src="/img/4CE490E0-C3D4-448A-9A69-0BC2FFF95A1D.png" alt=""></p>
<p>ç®€å•çš„ wiki å°±åŸºæœ¬æ­å»ºå®Œæˆäº†ï¼Œåç»­æˆ‘ä»¬éœ€è¦æ·»åŠ å†…å®¹ã€‚ä¸è¿‡è¿™ç©æ„ä½¿ç”¨çš„ reStructureText è¯­æ³•è€Œä¸æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ Markdownï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="http://pandoc.org/try/" target="_blank" rel="external">pandoc</a> è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚reStructureText çš„è¯­æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<h4 id="å¼€å§‹å†™-wiki"><a href="#å¼€å§‹å†™-wiki" class="headerlink" title="å¼€å§‹å†™ wiki"></a>å¼€å§‹å†™ wiki</h4><p>ç®€å•æ·»åŠ äº›å†…å®¹ï¼Œçœ‹çœ‹æ•ˆæœ<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat /Users/Mr-zhao/mywiki/index.rst</div><div class="line">.. mywiki documentation master file, created by</div><div class="line">   sphinx-quickstart on Sat Oct 14 14:26:23 2017.</div><div class="line">   You can adapt this file completely to your liking, but it should at least</div><div class="line">   contain the root `toctree` directive.</div><div class="line"></div><div class="line">Abnerzhao&apos;s Wiki</div><div class="line">=============================================</div><div class="line"></div><div class="line">.. toctree::</div><div class="line">   :maxdepth: 2</div><div class="line">   :glob:</div><div class="line"></div><div class="line">   programming/index</div><div class="line"></div><div class="line">$ cd /Users/Mr-zhao/mywiki/source/programming </div><div class="line">$ cat index.rst</div><div class="line">ä¸€ã€ç¼–ç¨‹</div><div class="line">==================</div><div class="line"></div><div class="line">.. toctree::</div><div class="line">    :maxdepth: 2</div><div class="line">    :glob:</div><div class="line"></div><div class="line">    python.rst</div><div class="line">$ cat python.rst</div><div class="line"></div><div class="line">1. Python</div><div class="line">----------</div><div class="line"></div><div class="line">1.1 åŸºç¡€çŸ¥è¯†</div><div class="line">~~~~~~~~~~~~~~</div><div class="line"></div><div class="line">1.2 çˆ¬è™«</div><div class="line">~~~~~~~~~~</div><div class="line"></div><div class="line">1.3 Web</div><div class="line">~~~~~~~~~</div><div class="line">$ cd /Users/Mr-zhao/mywiki</div><div class="line">$ make html</div></pre></td></tr></table></figure></p>
<p>å†æ¬¡æŸ¥çœ‹æ–‡æ¡£ï¼š</p>
<p><img src="/img/B35BA734-C452-44C1-AF8A-ACE9243D9D58.png" alt=""></p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Sphinx + GitHub + ReadtheDocs æ€»ä½“çš„ä½¿ç”¨æ„Ÿå—æ¯” GitBook è¦å¥½ï¼ŒGitBook ä½¿ç”¨èµ·æ¥æ€»æ„Ÿè§‰å¾ˆæ…¢ã€‚å¹³æ—¶å†™åšå®¢è®°ç‚¹ä¸œè¥¿éƒ½æ¯”è¾ƒçç¢ï¼Œä½¿ç”¨ Sphinx æ›´è§„èŒƒç³»ç»Ÿäº›ã€‚</p>
<p>å·¥å…·å€’æ˜¯æ­å»ºå¥½ï¼Œèƒ½å¦åšæŒç³»ç»Ÿåœ°æ€»ç»“æ¢³ç†çŸ¥è¯†ï¼ŒEmmâ€¦.è¿™æ˜¯ä¸ªé—®é¢˜ï¼</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://zh-sphinx-doc.readthedocs.io/en/latest/contents.html" target="_blank" rel="external">Sphinxä½¿ç”¨æ‰‹å†Œ</a><br><a href="http://jwch.sdut.edu.cn/book/tool/UseSphinx.html#id5" target="_blank" rel="external">ä½¿ç”¨sphinxè®°ç¬”è®°</a><br><a href="http://www.jianshu.com/p/78e9e1b8553a" target="_blank" rel="external">å¦‚ä½•ç”¨ ReadtheDocsã€Sphinx å¿«é€Ÿæ­å»ºå†™ä¹¦ç¯å¢ƒ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Sphinx æ˜¯ä¸€ä¸ªåŸºäº ReStructuredText çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œæœ‰å¾ˆå¤šå¼€æºå·¥ç¨‹éƒ½é‡‡ç”¨sphinxä½œä¸ºæ–‡æ¡£ç”Ÿæˆç³»ç»Ÿï¼Œæœ€æœ‰åçš„å°±æ˜¯ python å®˜æ–¹æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;Read the Docsæ˜¯ä¸€ä¸ªåœ¨çº¿æ–‡æ¡£æ‰˜ç®¡æœåŠ¡ï¼Œå¯ä»¥ä»å„ç§ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­å¯¼å…¥æ–‡æ¡£ã€‚æ”¯æŒ webhooksï¼Œå½“ä½ æäº¤ä»£ç æ—¶ï¼Œæ–‡æ¡£å°†è¢«è‡ªåŠ¨æ„å»ºã€‚&lt;/p&gt;
&lt;p&gt;Sphinx + GitHub + ReadtheDocs ä½œä¸ºä¸€ä¸ªæ–‡æ¡£å†™ä½œå·¥å…·ï¼Œ ç”¨ Sphinx ç”Ÿæˆæ–‡æ¡£ï¼ŒGitHub æ‰˜ç®¡æ–‡æ¡£ï¼Œå†å¯¼å…¥åˆ° ReadtheDocsã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·å†™æ–‡æ¡£ã€è®°ç¬”è®°ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ­å»ºè¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#æ­å»ºè¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;æ­å»ºè¿‡ç¨‹&quot;&gt;&lt;/a&gt;æ­å»ºè¿‡ç¨‹&lt;/h3&gt;&lt;h4 id=&quot;å®‰è£…-Sphinx&quot;&gt;&lt;a href=&quot;#å®‰è£…-Sphinx&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£… Sphinx&quot;&gt;&lt;/a&gt;å®‰è£… Sphinx&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ sudo pip install sphinx&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="wiki" scheme="http://yoursite.com/tags/wiki/"/>
    
  </entry>
  
  <entry>
    <title>Python Torndb ç®€å•ä½¿ç”¨</title>
    <link href="http://yoursite.com/2017/09/26/python-torndb/"/>
    <id>http://yoursite.com/2017/09/26/python-torndb/</id>
    <published>2017-09-26T09:54:46.000Z</published>
    <updated>2017-09-26T10:03:57.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p><a href="http://torndb.readthedocs.io/en/latest/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>é‡Šä¹‰ï¼š</p>
<blockquote>
<p>A lightweight wrapper around MySQLdb.<br>Originally part of the Tornado framework. The tornado.database module is slated for removal in Tornado 3.0, and it is now available separately as torndb.</p>
</blockquote>
<p>torndb æ˜¯ä¸€ä¸ªåŸºäº MySQLdb å°è£…çš„è½»é‡çº§æ¨¡å—ã€‚</p>
<p>è¿›ä¸€æ­¥äº†è§£è¯·é˜…è¯»æºç ï¼š<a href="https://github.com/bdarnell/torndb" target="_blank" rel="external">GitHub æºç åœ°å€</a></p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pip install torndb</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h4><blockquote>
<p>torndb.Connection(host, database, user=None, password=None, max_idle_time=25200, connect_timeout=0, time_zone=â€™+0:00â€™, charset=â€™utf8â€™, sql_mode=â€™TRADITIONALâ€™, **kwargs)</p>
</blockquote>
<p>é»˜è®¤çš„å­—ç¬¦é›†ä¸º <code>utf8</code>ï¼Œé»˜è®¤æ—¶åŒºä¸º <code>time_zone=&#39;+0:00&#39;</code>ï¼Œé»˜è®¤è¿æ¥æ•°æ®åº“çš„ç«¯å£ä¸º <code>3306</code>ï¼Œå¦‚æœé 3306 ç«¯å£åˆ™å°†ç«¯å£åŠ åœ¨ host åé¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> torndb</div><div class="line">In [<span class="number">2</span>]: db = torndb.Connection(<span class="string">'127.0.0.1:3808'</span>, <span class="string">'test'</span>, user=<span class="string">'root'</span>, password=<span class="string">'123123'</span>)</div></pre></td></tr></table></figure>
<h4 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h4><p>torndb å¯¹æ•°æ®åº“å¢åˆ æŸ¥æ”¹çš„ä½¿ç”¨è¾ƒ MySQLdb è¦ç®€æ´äº›ï¼ŒæŠŠ commitã€cursor éƒ½éšè—äº†ï¼ŒæŸ¥è¯¢è¿”å›çš„ç»“æœç›´æ¥å¤„ç†æˆå­—å…¸ï¼Œå¯ç›´æ¥é€šè¿‡å­—å…¸çš„å½¢å¼è·å–æ•°æ®åº“è¡¨ä¸­å¯¹åº”å­—æ®µå†…å®¹ã€‚</p>
<p>select æ“ä½œå¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>getï¼šè¿”å›ä¸€æ¡æŸ¥è¯¢ç»“æœï¼Œå¦‚æœ‰å¤šæ¡ç»“æœè¿”å›åˆ™æŠ›å‡ºå¼‚å¸¸</li>
<li>queryï¼šè¿”å›å¤šæ¡æŸ¥è¯¢ç»“æœ</li>
</ul>
<p>insertã€updateã€delete æ“ä½œä¸€èˆ¬éƒ½ä¹ æƒ¯ä½¿ç”¨ execute æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼šinsertã€insertmanyã€updateã€updatemanyã€deleteã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> torndb</div><div class="line">In [<span class="number">2</span>]: db = torndb.Connection(<span class="string">'127.0.0.1:3808'</span>, <span class="string">'test'</span>, user=<span class="string">'root'</span>, password=<span class="string">'123123'</span>)</div><div class="line"></div><div class="line"><span class="comment"># å»ºè¡¨</span></div><div class="line">In [<span class="number">3</span>]: sql = <span class="string">'create table userinfo(id int auto_increment, username varchar(30), email varchar(75), primary key (id))'</span></div><div class="line">In [<span class="number">4</span>]: db.execute(sql)</div><div class="line">Out[<span class="number">4</span>]: <span class="number">0L</span></div><div class="line"></div><div class="line"><span class="comment"># æ’å…¥æ•°æ®</span></div><div class="line">In [<span class="number">5</span>]: sql = <span class="string">'insert into userinfo(username, email) values(%s,%s)'</span></div><div class="line">In [<span class="number">6</span>]: db.execute(sql, <span class="string">'abner.zhao'</span>, <span class="string">'opsanberzhao@163.com'</span>)</div><div class="line">Out[<span class="number">6</span>]: <span class="number">1L</span></div><div class="line"></div><div class="line">In [<span class="number">7</span>]: db.execute(sql, <span class="string">'mike.zhang'</span>, <span class="string">'mikezhang@gmail.com'</span>)</div><div class="line">Out[<span class="number">7</span>]: <span class="number">2L</span></div><div class="line"></div><div class="line"><span class="comment"># æŸ¥è¯¢å¤šæ¡è®°å½•</span></div><div class="line">In [<span class="number">8</span>]: sql = <span class="string">'select username,email from userinfo'</span></div><div class="line">In [<span class="number">9</span>]: db.query(sql)</div><div class="line">Out[<span class="number">9</span>]:</div><div class="line">[&#123;<span class="string">'email'</span>: <span class="string">u'opsanberzhao@163.com'</span>, <span class="string">'username'</span>: <span class="string">u'abner.zhao'</span>&#125;,</div><div class="line"> &#123;<span class="string">'email'</span>: <span class="string">u'mikezhang@gmail.com'</span>, <span class="string">'username'</span>: <span class="string">u'mike.zhang'</span>&#125;]</div><div class="line"></div><div class="line"><span class="comment"># æŸ¥è¯¢å•æ¡è®°å½•</span></div><div class="line">In [<span class="number">10</span>]: sql = <span class="string">'select email from userinfo where username=%s'</span></div><div class="line">In [<span class="number">11</span>]: db.get(sql,<span class="string">'abner.zhao'</span>)</div><div class="line">Out[<span class="number">11</span>]: &#123;<span class="string">'email'</span>: <span class="string">u'opsanberzhao@163.com'</span>&#125;</div><div class="line"></div><div class="line"><span class="comment"># æ›´æ–°</span></div><div class="line">In [<span class="number">12</span>]: sql = <span class="string">'update userinfo set username="mike.zhao" where id=%s'</span></div><div class="line">In [<span class="number">13</span>]: db.execute(sql, <span class="number">2</span>)</div><div class="line">Out[<span class="number">13</span>]: <span class="number">0L</span></div><div class="line"></div><div class="line"><span class="comment"># åˆ é™¤</span></div><div class="line">In [<span class="number">14</span>]: sql = <span class="string">'delete from userinfo  where id=%s'</span></div><div class="line">In [<span class="number">15</span>]: db.execute(sql, <span class="number">2</span>)</div><div class="line">Out[<span class="number">15</span>]: <span class="number">0L</span></div></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨ä½¿ç”¨ MySQLdb è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šå‡ºç°<code>2006ï¼Œ&#39;MySQL server has gone away&#39;</code>ï¼Œtorndb èƒ½å¾ˆå¥½çš„è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>torndb æ¯æ¬¡è·å– cursor çš„æ—¶å€™ä¼šæ£€æŸ¥é“¾æ¥æ˜¯å¦å­˜åœ¨æˆ–é“¾æ¥çš„ idle_time æ˜¯å¦è¶…è¿‡äº† max_idle_timeï¼Œè¶…è¿‡äº†åˆ™ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªæ–°çš„é“¾æ¥ã€‚è€Œ MySQLdb çš„è·å– cursor æ—¶å´ä¸ä¼šé‡æ–°å»ºç«‹é“¾æ¥ã€‚ä¸è¿‡ MySQLdb æä¾›äº†ping æ–¹æ³•æ¥æ£€æŸ¥ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œ torndb ä½¿ç”¨ä½“éªŒæ¯” MySQLdb å¥½ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.neotitans.com/resources/python/mysql-python-connection-error-2006.html" target="_blank" rel="external">mysql-python-connection-error-2006</a></p>
<p><a href="http://torndb.readthedocs.io/en/latest/" target="_blank" rel="external">torndb doc</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://torndb.readthedocs.io/en/latest/&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;é‡Šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A lightweight wrapper around MySQLdb.&lt;br&gt;Originally part of the Tornado framework. The tornado.database module is slated for removal in Tornado 3.0, and it is now available separately as torndb.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;torndb æ˜¯ä¸€ä¸ªåŸºäº MySQLdb å°è£…çš„è½»é‡çº§æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ä¸€æ­¥äº†è§£è¯·é˜…è¯»æºç ï¼š&lt;a href=&quot;https://github.com/bdarnell/torndb&quot;&gt;GitHub æºç åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨&quot;&gt;&lt;/a&gt;ä½¿ç”¨&lt;/h3&gt;&lt;h4 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ pip install torndb&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 14.04 SVN æœåŠ¡å¿«é€Ÿæ­å»º</title>
    <link href="http://yoursite.com/2017/09/04/set-up-svn-server/"/>
    <id>http://yoursite.com/2017/09/04/set-up-svn-server/</id>
    <published>2017-09-04T14:05:18.000Z</published>
    <updated>2018-11-14T15:47:37.499Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è½¯ä»¶åŒ…å®‰è£…"><a href="#è½¯ä»¶åŒ…å®‰è£…" class="headerlink" title="è½¯ä»¶åŒ…å®‰è£…"></a>è½¯ä»¶åŒ…å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo apt-get install subversion apache2 libapache2-svn apache2-utils</div></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºä»“åº“ç›®å½•"><a href="#åˆ›å»ºä»“åº“ç›®å½•" class="headerlink" title="åˆ›å»ºä»“åº“ç›®å½•"></a>åˆ›å»ºä»“åº“ç›®å½•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo mkdir -p /home/abner/svn</div><div class="line">$ sudo svnadmin create /home/abner/svn/test_project</div><div class="line">$ sudo svnadmin create /home/abner/svn/ops</div><div class="line">$ sudo chown -R www-data:www-data /home/abner/svn</div></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><code>/etc/apache2/mods-available/dav_svn.conf</code> æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;Location /svn&gt;</div><div class="line">    DAV svn   # å¯ç”¨ä»“åº“</div><div class="line">    SVNListParentPath on # è·¯å¾„ä¸‹æœ‰å¤šä¸ªä»“åº“</div><div class="line">    SVNParentPath /home/abner/svn # ä»“åº“è·¯å¾„</div><div class="line">    SVNAdvertiseV2Protocol off # ç¦ç”¨ V2 åè®®</div><div class="line">    AuthType Basic </div><div class="line">    AuthName &quot;Subversion repository&quot;  </div><div class="line">    AuthUserFile /home/abner/svn/passwd # ç”¨æˆ·éªŒè¯æ–‡ä»¶</div><div class="line">    AuthzSVNAccessFile /home/abner/svn/auth # æƒé™éªŒè¯æ–‡ä»¶</div><div class="line">    Require valid-user # éœ€è¦æœ‰æ•ˆç”¨æˆ·ï¼Œç¦æ­¢åŒ¿åè®¿é—®</div><div class="line">&lt;/Location&gt;</div></pre></td></tr></table></figure></p>
<h3 id="ç”¨æˆ·å’Œæƒé™è®¾ç½®"><a href="#ç”¨æˆ·å’Œæƒé™è®¾ç½®" class="headerlink" title="ç”¨æˆ·å’Œæƒé™è®¾ç½®"></a>ç”¨æˆ·å’Œæƒé™è®¾ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo htpasswd -c /home/abner/svn/passwd mike</div><div class="line">New password:</div><div class="line">Re-type new password:</div><div class="line">Adding password for user mike</div><div class="line">$ cat /home/abner/svn/passwd</div><div class="line">mike:$apr1$nfAtmtla$ZguuxNODA.nRu3wsUq1Qv/</div><div class="line">$ sudo htpasswd  /home/abner/svn/passwd abner # æ–°å¢ç”¨æˆ·ï¼Œæ— éœ€ -c é€‰é¡¹</div><div class="line">$ cat /home/abner/svn/auth</div><div class="line">[groups]</div><div class="line">administrator=mike,abner</div><div class="line">[test:/]</div><div class="line">@administrator=rw</div><div class="line">[test_project:/]</div><div class="line">@administrator=rw</div><div class="line">[ops:/]</div><div class="line">@administrator=rw</div></pre></td></tr></table></figure>
<h3 id="è®¿é—®ä»“åº“ç›®å½•"><a href="#è®¿é—®ä»“åº“ç›®å½•" class="headerlink" title="è®¿é—®ä»“åº“ç›®å½•"></a>è®¿é—®ä»“åº“ç›®å½•</h3><p>æµè§ˆå™¨è®¿é—® <a href="http://127.0.0.1/svn/" target="_blank" rel="external">http://127.0.0.1/svn/</a></p>
<p><img src="/img/DA0DAFAC-78BE-43CF-8316-3D1BBAD0D585.png" alt=""></p>
<h3 id="å®¢æˆ·ç«¯æ“ä½œ"><a href="#å®¢æˆ·ç«¯æ“ä½œ" class="headerlink" title="å®¢æˆ·ç«¯æ“ä½œ"></a>å®¢æˆ·ç«¯æ“ä½œ</h3><p>å®¢æˆ·ç«¯ä½¿ç”¨ svn å‘½ä»¤æ‹‰å–ä»£ç <br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ svn checkout username=abner http://127.0.0.1/svn/ops</div></pre></td></tr></table></figure></p>
<blockquote>
<p>æ›´å¤š htpasswdã€svnadmin å’Œ svn å‘½ä»¤å‚æ•°å’Œä½¿ç”¨è¯·å‚è€ƒmanæ‰‹å†Œ</p>
</blockquote>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://help.ubuntu.com/community/Subversion" target="_blank" rel="external">Subversion - Community Help Wiki - Official Ubuntu Documentation</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è½¯ä»¶åŒ…å®‰è£…&quot;&gt;&lt;a href=&quot;#è½¯ä»¶åŒ…å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;è½¯ä»¶åŒ…å®‰è£…&quot;&gt;&lt;/a&gt;è½¯ä»¶åŒ…å®‰è£…&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ sudo apt-get install subversion apache2 libapache2-svn apache2-utils&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;åˆ›å»ºä»“åº“ç›®å½•&quot;&gt;&lt;a href=&quot;#åˆ›å»ºä»“åº“ç›®å½•&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºä»“åº“ç›®å½•&quot;&gt;&lt;/a&gt;åˆ›å»ºä»“åº“ç›®å½•&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ sudo mkdir -p /home/abner/svn&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ sudo svnadmin create /home/abner/svn/test_project&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ sudo svnadmin create /home/abner/svn/ops&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ sudo chown -R www-data:www-data /home/abner/svn&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ä¿®æ”¹é…ç½®æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#ä¿®æ”¹é…ç½®æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;ä¿®æ”¹é…ç½®æ–‡ä»¶&quot;&gt;&lt;/a&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/h3&gt;&lt;p&gt;&lt;code&gt;/etc/apache2/mods-available/dav_svn.conf&lt;/code&gt; æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š&lt;br&gt;
    
    </summary>
    
    
      <category term="svn" scheme="http://yoursite.com/tags/svn/"/>
    
  </entry>
  
  <entry>
    <title>Ansible å›è°ƒæ’ä»¶ç®€å•ä½¿ç”¨</title>
    <link href="http://yoursite.com/2017/04/11/ansible-callback-plugins/"/>
    <id>http://yoursite.com/2017/04/11/ansible-callback-plugins/</id>
    <published>2017-04-11T12:20:44.000Z</published>
    <updated>2018-11-14T15:47:08.759Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Developing-Plugins"><a href="#Developing-Plugins" class="headerlink" title="Developing Plugins"></a>Developing Plugins</h2><p>æ’ä»¶æ˜¯å¢å¼ºansibleæ ¸å¿ƒåŠŸèƒ½çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨æ’ä»¶ï¼Œç¼–å†™æ’ä»¶ä»£ç ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ansibleçš„æ‰§è¡Œç»“æœè¿›è¡Œåˆ†æï¼Œæ ¹æ®è¿”å›ç»“æœå‘é€é‚®ä»¶ï¼Œå†™å…¥æ—¥å¿—ç­‰éƒ½å¯ä»¥é€šè¿‡æ’ä»¶å®ç°ã€‚</p>
<h3 id="æ’ä»¶åˆ—è¡¨"><a href="#æ’ä»¶åˆ—è¡¨" class="headerlink" title="æ’ä»¶åˆ—è¡¨"></a>æ’ä»¶åˆ—è¡¨</h3><ul>
<li><strong>Action plugins</strong> are front ends to modules and can execute actions on the controller before calling the modules themselves.ï¼ˆæ“ä½œæ’ä»¶ï¼Œè°ƒç”¨æ¨¡å—ä¹‹å‰æ‰§è¡Œæ“ä½œï¼‰</li>
<li><strong>Cache plugins</strong> are used to keep a cache of â€˜factsâ€™ to avoid costly fact-gathering operations.ï¼ˆç¼“å­˜æ’ä»¶ï¼Œç¼“å­˜ä¸»æœºfactså˜é‡ï¼‰</li>
<li><strong>Callback plugins</strong> enable you to hook into Ansible events for display or logging purposes.ï¼ˆå›è°ƒæ’ä»¶ï¼Œå¯¹äº‹ä»¶è¿›è¡Œæ˜¾ç¤ºå’Œè®°å½•ï¼Œè¿™ä¸ªå¸¸ç”¨ï¼‰<a id="more"></a></li>
<li><strong>Connection plugins</strong> define how to communicate with inventory hosts.ï¼ˆè¿æ¥æ’ä»¶ï¼Œå®šä¹‰å¦‚ä½•ä¸èŠ‚ç‚¹ä¸»æœºé€šä¿¡ï¼‰</li>
<li><strong>Filters plugins</strong> allow you to manipulate data inside Ansible plays and/or templates. This is a Jinja2 feature; Ansible ships extra filter plugins.ï¼ˆè¿‡æ»¤æ’ä»¶ï¼ŒJinja2åŠŸèƒ½ï¼‰</li>
<li><strong>Lookup plugins</strong> are used to pull data from an external source. These are implemented using a custom Jinja2 function.ï¼ˆæŸ¥æ‰¾æ’ä»¶ç”¨äºä»å¤–éƒ¨æºæå–æ•°æ®ï¼‰</li>
<li><strong>Strategy plugins</strong> control the flow of a play and execution logic.ï¼ˆç­–ç•¥æ’ä»¶ï¼‰</li>
<li><strong>Shell plugins</strong> deal with low-level commands and formatting for the different shells Ansible can encounter on remote hosts.ï¼ˆshellæ’ä»¶å¤„ç†ä½çº§åˆ«å‘½ä»¤å’Œæ ¼å¼åŒ–ï¼‰</li>
<li><strong>Test plugins</strong> allow you to validate data inside Ansible plays and/or templates. This is a Jinja2 feature; Ansible ships extra test plugins.ï¼ˆæµ‹è¯•æ’ä»¶ï¼‰</li>
<li><strong>Vars plugins</strong> inject additional variable data into Ansible runs that did not come from an inventory, playbook, or the command line.ï¼ˆVarsæ’ä»¶ï¼‰</li>
</ul>
<h2 id="Callback-plugins"><a href="#Callback-plugins" class="headerlink" title="Callback plugins"></a>Callback plugins</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨å›è°ƒæ’ä»¶æ¯”è¾ƒå¤šä¸€ç‚¹ï¼Œé€šè¿‡callbackæ’ä»¶ï¼Œå¯ä»¥å®ç°å›è°ƒåŠŸèƒ½ï¼Œé‡Œé¢å®šä¹‰äº†è‹¥å¹²åœºæ™¯ï¼Œå¦‚ä¸»æœºä¸å¯è¾¾ï¼Œæ‰§è¡Œä»»åŠ¡å¤±è´¥ï¼Œæ‰§è¡Œä»»åŠ¡æˆåŠŸç­‰ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åœ¨ä¸åŒçš„åœºæ™¯è§¦å‘ä¸åŒçš„æ“ä½œã€‚</p>
<h3 id="è®¾ç½®å›è°ƒåŠŸèƒ½å‚æ•°"><a href="#è®¾ç½®å›è°ƒåŠŸèƒ½å‚æ•°" class="headerlink" title="è®¾ç½®å›è°ƒåŠŸèƒ½å‚æ•°"></a>è®¾ç½®å›è°ƒåŠŸèƒ½å‚æ•°</h3><p>è¯¥åŠŸèƒ½ansibleé»˜è®¤æ˜¯å…³é—­çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">$ cat /etc/ansible/ansible.cfg </div><div class="line">...</div><div class="line">bin_ansible_callbacks = <span class="keyword">True</span> <span class="comment">#åŠ è½½åŠŸèƒ½</span></div><div class="line"></div><div class="line"><span class="comment"># set plugin path directories here, separate with colons å®šä¹‰æ’ä»¶ä½ç½®</span></div><div class="line">action_plugins     = /usr/share/ansible_plugins/action_plugins</div><div class="line">callback_plugins   = /usr/share/ansible_plugins/callback_plugins</div><div class="line">connection_plugins = /usr/share/ansible_plugins/connection_plugins</div><div class="line">lookup_plugins     = /usr/share/ansible_plugins/lookup_plugins</div><div class="line">vars_plugins       = /usr/share/ansible_plugins/vars_plugins</div><div class="line">filter_plugins     = /usr/share/ansible_plugins/filter_plugins</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="ç¼–å†™å›è°ƒè„šæœ¬"><a href="#ç¼–å†™å›è°ƒè„šæœ¬" class="headerlink" title="ç¼–å†™å›è°ƒè„šæœ¬"></a>ç¼–å†™å›è°ƒè„šæœ¬</h3><p>ç¼–å†™å›è°ƒè„šæœ¬æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ç›®å½•ä¸­ï¼Œå¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰§è¡Œç»“æœå†™å…¥æœ¬åœ°æ–‡ä»¶ã€æ•°æ®åº“æˆ–å‘é‚®ä»¶ç­‰ç­‰ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ä¼šå°†ç»“æœå†™å…¥æ—¥å¿—æˆ–è·Ÿè¸ªè®°å½•æ‰§è¡Œçš„è¿›åº¦å’Œå¼‚å¸¸ã€‚</p>
<h4 id="å†™å…¥æœ¬åœ°æ–‡ä»¶"><a href="#å†™å…¥æœ¬åœ°æ–‡ä»¶" class="headerlink" title="å†™å…¥æœ¬åœ°æ–‡ä»¶"></a>å†™å…¥æœ¬åœ°æ–‡ä»¶</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line">result_file = <span class="string">'/tmp/result'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallbackModule</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_ok</span><span class="params">(self, host, res)</span>:</span></div><div class="line">        <span class="keyword">with</span> open(result_file,<span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(<span class="string">'success\n'</span>)</div><div class="line">            f.write(str(host))</div><div class="line">            f.write(json.dumps(res, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>)))</div><div class="line">            f.write(<span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_failed</span><span class="params">(self, host, res, ignore_errors=False)</span>:</span></div><div class="line">        <span class="keyword">with</span> open(result_file, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(<span class="string">'failed\n'</span>)</div><div class="line">            f.write(str(host))</div><div class="line">            f.write(json.dumps(res, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>)))</div><div class="line">            f.write(<span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_unreachable</span><span class="params">(self,host,res)</span>:</span></div><div class="line">        <span class="keyword">with</span> open(result_file, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(<span class="string">'unreachable\n'</span>)</div><div class="line">            f.write(str(host))</div><div class="line">            f.write(json.dumps(res, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>)))</div><div class="line">            f.write(<span class="string">'\n'</span>)</div></pre></td></tr></table></figure>
<p>æµ‹è¯•<br><figure class="highlight"><table><tr><td class="code"><pre><div class="line">$ ansible-playbook  -i hosts test.yml</div><div class="line"></div><div class="line">PLAY [default_group] **********************************************************</div><div class="line"></div><div class="line">TASK: [test | cp test auto install script] ************************************</div><div class="line">ok: [172.31.30.178]</div><div class="line"></div><div class="line">TASK: [test | install test] ***************************************************</div><div class="line">changed: [172.31.30.178]</div><div class="line"></div><div class="line">PLAY RECAP ********************************************************************</div><div class="line">172.31.30.178              : ok=2    changed=1    unreachable=0    failed=0</div><div class="line"></div><div class="line">#åˆ¶é€ ä¸€ä¸ªunreachableé”™è¯¯</div><div class="line">$ ansible-playbook  -i hosts  test.yml</div><div class="line"></div><div class="line">PLAY [default_group] **********************************************************</div><div class="line"></div><div class="line">TASK: [test | cp test auto install script] ************************************</div><div class="line">fatal: [172.31.30.178] =&gt; SSH encountered an unknown error during the connection. We recommend you re-run the command using -vvvv, which will enable SSH debugging output to help diagnose the issue</div><div class="line"></div><div class="line">FATAL: all hosts have already failed -- aborting</div><div class="line"></div><div class="line">PLAY RECAP ********************************************************************</div><div class="line">           to retry, use: --limit @/root/startoftwares.retry</div><div class="line"></div><div class="line">172.31.30.178              : ok=0    changed=0    unreachable=1    failed=0</div><div class="line"></div><div class="line">#æŸ¥çœ‹ç»“æœ</div><div class="line">$ cat /tmp/result</div><div class="line">success</div><div class="line">172.31.30.178&#123;</div><div class="line">    "changed": false,</div><div class="line">    "dest": "/tmp/test.sh",</div><div class="line">    "gid": 1000,</div><div class="line">    "group": "ubuntu",</div><div class="line">    "invocation": &#123;</div><div class="line">        "module_args": "src=test.sh dest=/tmp/test.sh owner=ubuntu group=ubuntu mode=0755",</div><div class="line">        "module_name": "copy"</div><div class="line">    &#125;,</div><div class="line">    "md5sum": "da1bd2e811a9909b96b09c3988deaec6",</div><div class="line">    "mode": "0755",</div><div class="line">    "owner": "ubuntu",</div><div class="line">    "path": "/tmp/test.sh",</div><div class="line">    "size": 58,</div><div class="line">    "state": "file",</div><div class="line">    "uid": 1000</div><div class="line">&#125;</div><div class="line">success</div><div class="line">172.31.30.178&#123;</div><div class="line">    "changed": true,</div><div class="line">    "cmd": "bash /tmp/test.sh",</div><div class="line">    "delta": "0:00:03.004104",</div><div class="line">    "end": "2017-04-11 10:48:20.429600",</div><div class="line">    "invocation": &#123;</div><div class="line">        "module_args": "bash /tmp/test.sh",</div><div class="line">        "module_name": "shell"</div><div class="line">    &#125;,</div><div class="line">    "rc": 0,</div><div class="line">    "start": "2017-04-11 10:48:17.425496",</div><div class="line">    "stderr": "",</div><div class="line">    "stdout": ""</div><div class="line">&#125;</div><div class="line">unreachable</div><div class="line">172.31.30.178"SSH encountered an unknown error during the connection. We recommend you re-run the command using -vvvv, which will enable SSH debugging output to help diagnose the issue"</div></pre></td></tr></table></figure></p>
<h4 id="å‘é‚®ä»¶"><a href="#å‘é‚®ä»¶" class="headerlink" title="å‘é‚®ä»¶"></a>å‘é‚®ä»¶</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> smtplib</div><div class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">mail_host=<span class="string">"smtp.xxx.com"</span></div><div class="line">mail_user=<span class="string">"xxxxx@xxx.com"</span></div><div class="line">mail_pass=<span class="string">"xxxxxxx"</span></div><div class="line">user_to = <span class="string">"xxxxx@xxx.com"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(context)</span>:</span></div><div class="line">    msg = MIMEText(context, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>)</div><div class="line">    msg[<span class="string">'From'</span>] = mail_user</div><div class="line">    msg[<span class="string">'To'</span>] = user_to</div><div class="line">    msg[<span class="string">'Subject'</span>] = <span class="string">'Ansible error mail'</span></div><div class="line">    server = smtplib.SMTP(mail_host, <span class="number">25</span>)</div><div class="line">    server.login(mail_user, mail_pass)</div><div class="line">    server.sendmail(mail_user, user_to, msg.as_string())</div><div class="line">    server.quit()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallbackModule</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_ok</span><span class="params">(self, host, res)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_failed</span><span class="params">(self, host, res, ignore_errors=False)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runner_on_unreachable</span><span class="params">(self,host,res)</span>:</span></div><div class="line">        <span class="keyword">if</span> isinstance(res,basestring):</div><div class="line">            context = <span class="string">'An error occured for host '</span> + host + <span class="string">' with the following message:\n\n'</span> + res</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            context = <span class="string">'An error occured for host'</span> + host + <span class="string">' with the following message:\n\n'</span> + str(res)</div><div class="line">        send_mail(context)</div></pre></td></tr></table></figure>
<p>æµ‹è¯•</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">$ ansible-playbook  -i hosts  test.yml</div><div class="line"></div><div class="line">PLAY [default_group] **********************************************************</div><div class="line"></div><div class="line">TASK: [test | cp test auto install script] ************************************</div><div class="line">fatal: [172.31.30.178] =&gt; SSH encountered an unknown error during the connection. We recommend you re-run the command using -vvvv, which will enable SSH debugging output to help diagnose the issue</div><div class="line"></div><div class="line">FATAL: all hosts have already failed -- aborting</div><div class="line"></div><div class="line">PLAY RECAP ********************************************************************</div><div class="line">           to retry, use: --limit @/root/startoftwares.retry</div><div class="line"></div><div class="line">172.31.30.178              : ok=0    changed=0    unreachable=1    failed=0</div></pre></td></tr></table></figure>
<p>æŸ¥æ”¶é‚®ä»¶</p>
<p><img src="/img/B028FB3F-50E6-4B04-8969-BDCFD20ECAEB.png" alt=""></p>
<p>ä»¥ä¸Šè„šæœ¬éƒ½å†™çš„æ¯”è¾ƒç®€å•ï¼Œå»ºè®®å‚è€ƒ:<a href="https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins" target="_blank" rel="external">å®˜æ–¹æ’ä»¶ä»£ç æ ·ä¾‹</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://docs.ansible.com/ansible/dev_guide/developing_plugins.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a><br><a href="http://ansible-tran.readthedocs.io/en/latest/docs/intro_configuration.html#bin-ansible-callbacks" target="_blank" rel="external">ä¸­æ–‡æ–‡æ¡£é…ç½®æ–‡ä»¶å‚æ•°è¯¦è§£</a><br><a href="http://rfyiamcool.blog.51cto.com/1030776/1440624" target="_blank" rel="external">ansibleè°ƒç”¨callbacksæ’ä»¶å®ç°ç»“æœnosqlè¾“å‡ºå›è°ƒ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Developing-Plugins&quot;&gt;&lt;a href=&quot;#Developing-Plugins&quot; class=&quot;headerlink&quot; title=&quot;Developing Plugins&quot;&gt;&lt;/a&gt;Developing Plugins&lt;/h2&gt;&lt;p&gt;æ’ä»¶æ˜¯å¢å¼ºansibleæ ¸å¿ƒåŠŸèƒ½çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨æ’ä»¶ï¼Œç¼–å†™æ’ä»¶ä»£ç ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ansibleçš„æ‰§è¡Œç»“æœè¿›è¡Œåˆ†æï¼Œæ ¹æ®è¿”å›ç»“æœå‘é€é‚®ä»¶ï¼Œå†™å…¥æ—¥å¿—ç­‰éƒ½å¯ä»¥é€šè¿‡æ’ä»¶å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ’ä»¶åˆ—è¡¨&quot;&gt;&lt;a href=&quot;#æ’ä»¶åˆ—è¡¨&quot; class=&quot;headerlink&quot; title=&quot;æ’ä»¶åˆ—è¡¨&quot;&gt;&lt;/a&gt;æ’ä»¶åˆ—è¡¨&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Action plugins&lt;/strong&gt; are front ends to modules and can execute actions on the controller before calling the modules themselves.ï¼ˆæ“ä½œæ’ä»¶ï¼Œè°ƒç”¨æ¨¡å—ä¹‹å‰æ‰§è¡Œæ“ä½œï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cache plugins&lt;/strong&gt; are used to keep a cache of â€˜factsâ€™ to avoid costly fact-gathering operations.ï¼ˆç¼“å­˜æ’ä»¶ï¼Œç¼“å­˜ä¸»æœºfactså˜é‡ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Callback plugins&lt;/strong&gt; enable you to hook into Ansible events for display or logging purposes.ï¼ˆå›è°ƒæ’ä»¶ï¼Œå¯¹äº‹ä»¶è¿›è¡Œæ˜¾ç¤ºå’Œè®°å½•ï¼Œè¿™ä¸ªå¸¸ç”¨ï¼‰
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Pythonæ­£åˆ™è¡¨è¾¾å¼</title>
    <link href="http://yoursite.com/2017/03/05/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>http://yoursite.com/2017/03/05/Pythonæ­£åˆ™è¡¨è¾¾å¼/</id>
    <published>2017-03-05T09:13:36.000Z</published>
    <updated>2017-06-23T15:30:28.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€äº›ç”±å­—ç¬¦å’Œç‰¹æ®Šç¬¦å·ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå®ƒä»¬æô°€è¿°äº†è¿™äº›å­—ç¬¦å’Œå­—ç¬¦çš„æŸç§é‡å¤æ–¹å¼ï¼Œå› æ­¤èƒ½æŒ‰æŸç§æ¨¡å¼åŒ¹é…ä¸€ä¸ªæœ‰ç›¸ä¼¼ç‰¹å¾çš„å­—ç¬¦ä¸²çš„é›†åˆã€‚</strong>æ­£åˆ™è¡¨è¾¾å¼ä¸ºé«˜çº§æ–‡æœ¬æ¨¡å¼åŒ¹é…ï¼Œä»¥åŠæœç´¢-æ›¿ä»£ç­‰åŠŸèƒ½ô°ä¾›äº†åŸºç¡€ã€‚</p>
<h2 id="å…ƒå­—ç¬¦"><a href="#å…ƒå­—ç¬¦" class="headerlink" title="å…ƒå­—ç¬¦"></a>å…ƒå­—ç¬¦</h2><p>å…ƒå­—ç¬¦æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­è§„å®šçš„ç‰¹æ®Šä»£ç ï¼Œæœ‰ç‰¹å®šçš„å«ä¹‰å’ŒåŒ¹é…æ•ˆæœ</p>
<p><strong>å¸¸ç”¨çš„å…ƒå­—ç¬¦</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">ä»£ç </th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">.</td>
<td style="text-align:left">åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align:left">\w</td>
<td style="text-align:left">åŒ¹é…å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿æˆ–æ±‰å­—</td>
</tr>
<tr>
<td style="text-align:left">\s</td>
<td style="text-align:left">åŒ¹é…ä»»æ„çš„ç©ºç™½ç¬¦(åŒ…æ‹¬ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦(Tab)ï¼Œæ¢è¡Œç¬¦ï¼Œä¸­æ–‡å…¨è§’ç©ºæ ¼ç­‰)</td>
</tr>
<tr>
<td style="text-align:left">\d</td>
<td style="text-align:left">åŒ¹é…æ•°å­—</td>
</tr>
<tr>
<td style="text-align:left">\b</td>
<td style="text-align:left">åŒ¹é…å•è¯çš„å¼€å§‹æˆ–ç»“æŸ(ç©ºæ ¼ã€æ ‡ç‚¹ã€æ¢è¡Œéƒ½ç®—æ˜¯å•è¯çš„åˆ†å‰²)</td>
</tr>
<tr>
<td style="text-align:left">^</td>
<td style="text-align:left">åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
</tr>
<tr>
<td style="text-align:left">$</td>
<td style="text-align:left">åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p><code>\ba\w*\b</code>: åŒ¹é…ä»¥å­—æ¯aå¼€å¤´çš„å•è¯â€”â€”å…ˆæ˜¯æŸä¸ªå•è¯å¼€å§‹å¤„(\b)ï¼Œç„¶åæ˜¯å­—æ¯a,ç„¶åæ˜¯ä»»æ„æ•°é‡çš„å­—æ¯æˆ–æ•°å­—(\w*)ï¼Œæœ€åæ˜¯å•è¯ç»“æŸå¤„(\b)</p>
<p><code>\d+</code>: åŒ¹é…1ä¸ªæˆ–æ›´å¤šè¿ç»­çš„æ•°å­—ã€‚è¿™é‡Œçš„+æ˜¯å’Œ<em>ç±»ä¼¼çš„å…ƒå­—ç¬¦ï¼Œä¸åŒçš„æ˜¯\</em>åŒ¹é…é‡å¤ä»»æ„æ¬¡(å¯èƒ½æ˜¯0æ¬¡)ï¼Œè€Œ+åˆ™åŒ¹é…é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡</p>
<p><code>\b\w{6}\b</code>: åŒ¹é…åˆšå¥½6ä¸ªå­—ç¬¦çš„å•è¯</p>
<p><code>^\d{5,12}$</code>: åŒ¹é…5ä½åˆ°12ä½æ•°å­—</p>
<h3 id="é‡å¤"><a href="#é‡å¤" class="headerlink" title="é‡å¤"></a>é‡å¤</h3><p><strong>å¸¸ç”¨çš„é™å®šç¬¦(æŒ‡å®šæ•°é‡çš„ä»£ç )</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">ä»£ç </th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">é‡å¤é›¶æ¬¡æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">é‡å¤ä¸€æ¬¡æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td style="text-align:left">?</td>
<td style="text-align:left">é‡å¤é›¶æ¬¡æˆ–ä¸€æ¬¡</td>
</tr>
<tr>
<td style="text-align:left">{n}</td>
<td style="text-align:left">é‡å¤næ¬¡</td>
</tr>
<tr>
<td style="text-align:left">{n,}</td>
<td style="text-align:left">é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td style="text-align:left">{n,m}</td>
<td style="text-align:left">é‡å¤nåˆ°mæ¬¡</td>
</tr>
</tbody>
</table>
<p><strong>ç¤ºä¾‹ï¼š</strong><br>Windows\d+: åŒ¹é…Windowsåé¢è·Ÿ1ä¸ªæˆ–æ›´å¤šæ•°å­—<br>^\w+: åŒ¹é…ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯</p>
<h3 id="åä¹‰"><a href="#åä¹‰" class="headerlink" title="åä¹‰"></a>åä¹‰</h3><p><strong>å¸¸ç”¨çš„åä¹‰ä»£ç </strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">ä»£ç </th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">\W</td>
<td style="text-align:left">åŒ¹é…ä»»æ„ä¸æ˜¯å­—æ¯ï¼Œæ•°å­—ï¼Œä¸‹åˆ’çº¿ï¼Œæ±‰å­—çš„å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align:left">\S</td>
<td style="text-align:left">åŒ¹é…ä»»æ„ä¸æ˜¯ç©ºç™½ç¬¦çš„å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align:left">\D</td>
<td style="text-align:left">åŒ¹é…ä»»æ„éæ•°å­—çš„å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align:left">\B</td>
<td style="text-align:left">åŒ¹é…ä¸æ˜¯å•è¯å¼€å¤´æˆ–ç»“æŸçš„ä½ç½®</td>
</tr>
<tr>
<td style="text-align:left">[^x]</td>
<td style="text-align:left">åŒ¹é…é™¤äº†xä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td style="text-align:left">[^aeiou]</td>
<td style="text-align:left">åŒ¹é…é™¤äº†aeiouè¿™å‡ ä¸ªå­—æ¯ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
</tr>
</tbody>
</table>
<h2 id="å­—ç¬¦ç±»"><a href="#å­—ç¬¦ç±»" class="headerlink" title="å­—ç¬¦ç±»"></a>å­—ç¬¦ç±»</h2><p>æˆ‘ä»¬è¦æƒ³æŸ¥æ‰¾æ•°å­—ï¼Œå­—æ¯æˆ–æ•°å­—ï¼Œç©ºç™½è¿™äº›å¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨å…ƒå­—ç¬¦å¯¹åº”çš„å­—ç¬¦é›†åˆå³å¯å®ç°ã€‚ä½†æ˜¯å¦‚æœæƒ³è¦åŒ¹é…æ²¡æœ‰é¢„å®šä¹‰å…ƒå­—ç¬¦çš„å­—ç¬¦é›†åˆ(æ¯”å¦‚å…ƒéŸ³å­—æ¯a,e,i,o,u),åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™æ—¶æˆ‘ä»¬éœ€è¦åœ¨æ–¹æ‹¬å·<code>[]</code>ä¸­åˆ—å‡ºæƒ³è¦åŒ¹é…çš„å­—ç¬¦é›†åˆã€‚å¦‚[aeiou]å°±åŒ¹é…ä»»ä½•ä¸€ä¸ªè‹±æ–‡å…ƒéŸ³å­—æ¯ï¼Œ[.?!]åŒ¹é…æ ‡ç‚¹ç¬¦å·(.æˆ–?æˆ–!)ã€‚</p>
<p>[0-9]ä»£è¡¨çš„å«æ„ä¸\då°±æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼šä¸€ä½æ•°å­—ï¼›åŒç†[a-z0-9A-Z_]ä¹Ÿå®Œå…¨ç­‰åŒäº\wï¼ˆå¦‚æœåªè€ƒè™‘è‹±æ–‡çš„è¯ï¼‰</p>
<p>\(?0\d{2}[) -]?\d{8}:åŒ¹é…å‡ ç§æ ¼å¼çš„ç”µè¯å·ç ï¼Œåƒ(010)88886666ï¼Œæˆ–022-22334455ï¼Œæˆ–02912345678ç­‰</p>
<h3 id="åˆ†ææ¡ä»¶"><a href="#åˆ†ææ¡ä»¶" class="headerlink" title="åˆ†ææ¡ä»¶"></a>åˆ†ææ¡ä»¶</h3><p>æ­£åˆ™è¡¨è¾¾å¼é‡Œçš„åˆ†ææ¡ä»¶æŒ‡çš„æ˜¯æœ‰å‡ ç§è§„åˆ™ï¼Œå¦‚æœæ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ç§è§„åˆ™éƒ½åº”è¯¥å½“æˆåŒ¹é…ï¼Œå…·ä½“æ–¹æ³•æ˜¯ç”¨<code>|</code>æŠŠä¸åŒçš„è§„åˆ™åˆ†éš”å¼€ï¼ŒåŒ¹é…åˆ†ææ¡ä»¶æ—¶ï¼Œå°†ä¼šä»å·¦åˆ°å³åœ°æµ‹è¯•æ¯ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³äº†æŸä¸ªåˆ†æçš„è¯ï¼Œå°±ä¸ä¼šå»å†ç®¡å…¶å®ƒçš„æ¡ä»¶äº†</p>
<p><code>0\d{2}-\d{8}|0\d{3}-\d{7}</code>è¿™ä¸ªè¡¨è¾¾å¼èƒ½åŒ¹é…ä¸¤ç§ä»¥è¿å­—å·åˆ†éš”çš„ç”µè¯å·ç ï¼šä¸€ç§æ˜¯ä¸‰ä½åŒºå·ï¼Œ8ä½æœ¬åœ°å·(å¦‚010-12345678)ï¼Œä¸€ç§æ˜¯4ä½åŒºå·ï¼Œ7ä½æœ¬åœ°å·(0376-2233445)</p>
<p><code>\\(?0\d{2}\)?[- ]?\d{8}|0\d{2}[-]?\d{8}</code>è¿™ä¸ªè¡¨è¾¾å¼åŒ¹é…3ä½åŒºå·çš„ç”µè¯å·ç ï¼Œå…¶ä¸­åŒºå·å¯ä»¥ç”¨å°æ‹¬å·æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ï¼ŒåŒºå·ä¸æœ¬åœ°å·é—´å¯ä»¥ç”¨è¿å­—å·æˆ–ç©ºæ ¼é—´éš”ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰é—´éš”</p>
<h3 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h3><p>é‡å¤å•ä¸ªå­—ç¬¦åœ¨åé¢åŠ ä¸Šé™å®šç¬¦å°±è¡Œäº†ï¼Œå¦‚æœæƒ³è¦é‡å¤å¤šä¸ªå­—ç¬¦é‚£ä¹ˆå°±éœ€è¦ç”¨<code>å°æ‹¬å·</code>æ¥æŒ‡å®šå­è¡¨è¾¾å¼(ä¹Ÿå«åšåˆ†ç»„)ï¼Œç„¶åä½ å°±å¯ä»¥æŒ‡å®šè¿™ä¸ªå­è¡¨è¾¾å¼çš„é‡å¤æ¬¡æ•°äº†ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹å­è¡¨è¾¾å¼è¿›è¡Œå…¶å®ƒä¸€äº›æ“ä½œã€‚</p>
<p>(\d{1,3}.){3}ï¼š\d{1,3}åŒ¹é…1åˆ°3ä½çš„æ•°å­—ï¼Œ(\d{1,3}.){3}åŒ¹é…ä¸‰ä½æ•°å­—åŠ ä¸Šä¸€ä¸ªè‹±æ–‡å¥å·(è¿™ä¸ªæ•´ä½“ä¹Ÿå°±æ˜¯è¿™ä¸ªåˆ†ç»„)é‡å¤3æ¬¡</p>
<h3 id="å­—ç¬¦è½¬ä¹‰"><a href="#å­—ç¬¦è½¬ä¹‰" class="headerlink" title="å­—ç¬¦è½¬ä¹‰"></a>å­—ç¬¦è½¬ä¹‰</h3><p>ä½¿ç”¨åæ–œæ <code>\</code>æ¥å–æ¶ˆå…ƒå­—ç¬¦çš„ç‰¹æ®Šå«ä¹‰</p>
<p>ä¾‹å¦‚ï¼šdeerchao\.netåŒ¹é…deerchao.netï¼ŒC:\\WindowsåŒ¹é…C:\Windows</p>
<h2 id="reæ¨¡å—"><a href="#reæ¨¡å—" class="headerlink" title="reæ¨¡å—"></a>reæ¨¡å—</h2><p>Python é€šè¿‡æ ‡å‡†åº“çš„ re æ¨¡å—æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p><strong>å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼å‡½æ•°ä¸æ–¹æ³•</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">å‡½æ•°/æ–¹æ³•</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">re æ¨¡å—çš„å‡½æ•°</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">compile(pattern,flags=0)</td>
<td style="text-align:left">å¯¹æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ pattern è¿›è¡Œç¼–è¯‘,flagsæ˜¯å¯é€‰æ ‡å¿—ç¬¦,å¹¶è¿”å›ä¸€ä¸ª regex å¯¹è±¡</td>
</tr>
<tr>
<td style="text-align:left">re æ¨¡å—çš„å‡½æ•°å’Œ regex å¯¹è±¡çš„æ–¹æ³•</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">match(pattern,string, flags=0)</td>
<td style="text-align:left">å°è¯•ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ pattern åŒ¹é…å­—ç¬¦ä¸² string,flags æ˜¯å¯é€‰æ ‡å¿—ç¬¦,å¦‚æœåŒ¹é…æˆåŠŸ,åˆ™è¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡;å¦åˆ™è¿”å› None</td>
</tr>
<tr>
<td style="text-align:left">search(pattern,string, flags=0)</td>
<td style="text-align:left">åœ¨å­—ç¬¦ä¸² string ä¸­æŸ¥æ‰¾æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ pattern çš„ç¬¬ä¸€æ¬¡å‡ºç°,flags æ˜¯å¯é€‰æ ‡å¿—ç¬¦,å¦‚æœåŒ¹é…æˆåŠŸ,åˆ™è¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡;å¦åˆ™è¿”å› None</td>
</tr>
<tr>
<td style="text-align:left">findall(pattern,string[,flags])</td>
<td style="text-align:left">åœ¨å­—ç¬¦ä¸² string ä¸­æŸ¥æ‰¾æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ pattern çš„æ‰€æœ‰å‡ºç°;è¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡çš„åˆ—è¡¨</td>
</tr>
<tr>
<td style="text-align:left">finditer(pattern,string[, flags])</td>
<td style="text-align:left">å’Œ findall()ç›¸åŒ,ä½†è¿”å›çš„ä¸æ˜¯åˆ—è¡¨è€Œæ˜¯è¿­ä»£å™¨;å¯¹ äºæ¯ä¸ªåŒ¹é…,è¯¥è¿­ä»£å™¨è¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡</td>
</tr>
<tr>
<td style="text-align:left">åŒ¹é…å¯¹è±¡çš„æ–¹æ³•</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">split(pattern,string, max=0)</td>
<td style="text-align:left">æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼ pattern ä¸­çš„åˆ†éš”ç¬¦æŠŠå­—ç¬¦ string åˆ†å‰²ä¸ºä¸€ä¸ªåˆ—è¡¨,è¿”å›æˆåŠŸåŒ¹é…çš„åˆ—è¡¨,æœ€å¤šåˆ†å‰² max æ¬¡(é»˜è®¤æ˜¯åˆ†å‰²æ‰€æœ‰åŒ¹é…çš„åœ°æ–¹)</td>
</tr>
<tr>
<td style="text-align:left">sub(pattern, repl, string, max=0)</td>
<td style="text-align:left">æŠŠå­—ç¬¦ä¸² string ä¸­æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ pattern çš„åœ°æ–¹æ›¿æ¢æˆå­—ç¬¦ä¸² repl,å¦‚æœ max çš„å€¼æ²¡æœ‰ç»™å‡º,åˆ™å¯¹æ‰€æœ‰åŒ¹é…çš„åœ°æ–¹è¿›è¡Œæ›¿æ¢</td>
</tr>
<tr>
<td style="text-align:left">group(num=0)</td>
<td style="text-align:left">è¿”å›å…¨éƒ¨åŒ¹é…å¯¹è±¡(æˆ–æŒ‡å®šç¼–å·æ˜¯ num çš„å­ç»„)</td>
</tr>
<tr>
<td style="text-align:left">groups()</td>
<td style="text-align:left">è¿”å›ä¸€ä¸ªåŒ…å«å…¨éƒ¨åŒ¹é…çš„å­ç»„çš„å…ƒç»„(å¦‚æœæ²¡æœ‰æˆåŠŸåŒ¹é…,å°±è¿”å›ä¸€ä¸ªç©ºå…ƒç»„)</td>
</tr>
</tbody>
</table>
<p>å°†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ ·å¼ç¼–è¯‘ä¸ºPythonä¸­æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚ç”±äºæ­£åˆ™è¡¨è¾¾å¼åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«å¤šæ¬¡ç”¨äºæ¯”è¾ƒï¼Œé€šè¿‡re.compile()è¿›è¡Œé¢„ç¼–è¯‘å¯ä»¥æå‡æ€§èƒ½ã€‚ô°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; import re</div><div class="line">&gt;&gt;&gt; p = re.compile(&apos;[a-z]+&apos;)</div><div class="line">&gt;&gt;&gt; p</div><div class="line">&lt;_sre.SRE_Pattern object at 0x108174df0&gt;</div><div class="line">&gt;&gt;&gt; a = p.match(&apos;abc&apos;)</div><div class="line">&gt;&gt;&gt; a</div><div class="line">&lt;_sre.SRE_Match object at 0x10823c9f0&gt;</div><div class="line">&gt;&gt;&gt; re.match(p,&apos;abc&apos;)</div><div class="line">&lt;_sre.SRE_Match object at 0x10823ca58&gt;</div><div class="line">&gt;&gt;&gt; re.match(p,&apos;123&apos;)  #åŒ¹é…å¤±è´¥è¿”å›None</div><div class="line">&gt;&gt;&gt;</div><div class="line">#ä¸ä½¿ç”¨compileåŒæ ·å¯ä»¥</div><div class="line">&gt;&gt;&gt; re.match(r&apos;[a-z]+&apos;,&apos;abc&apos;)</div><div class="line">&lt;_sre.SRE_Match object at 0x10823c988&gt;</div><div class="line">&gt;&gt;&gt; re.match(r&apos;[a-z]+&apos;,&apos;123&apos;)</div></pre></td></tr></table></figure>
<h3 id="åŒ¹é…å¯¹è±¡å’Œæ–¹æ³•"><a href="#åŒ¹é…å¯¹è±¡å’Œæ–¹æ³•" class="headerlink" title="åŒ¹é…å¯¹è±¡å’Œæ–¹æ³•"></a>åŒ¹é…å¯¹è±¡å’Œæ–¹æ³•</h3><p>åœ¨å¤„ç†æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œé™¤regexå¯¹è±¡å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§å¯¹è±¡ç±»å‹-åŒ¹é…å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡æ˜¯åœ¨match() æˆ– search()è¢«æˆåŠŸè°ƒç”¨ä¹‹åæ‰€è¿”å›çš„ç»“æœã€‚åŒ¹é…å¯¹è±¡æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•:<strong>group() å’Œ groups()</strong></p>
<p>group()æ–¹æ³•è¿”å›æ‰€æœ‰åŒ¹é…å¯¹è±¡æˆ–æ˜¯æ ¹æ®è¦æ±‚è¿”å›æŸä¸ªç‰¹å®šå­ç»„ã€‚<br>groups()è¿”å›ä¸€ä¸ªåŒ…å«å”¯ä¸€æˆ–æ‰€æœ‰å­ç»„çš„å…ƒç»„ã€‚å¦‚æœæ­£åˆ™è¡¨è¾¾å¼ä¸­æ²¡æœ‰å­ç»„çš„è¯, groups() å°†è¿”å›ä¸€ä¸ªç©ºå…ƒç»„,è€Œ group()ä»ä¼šè¿”å›å…¨éƒ¨åŒ¹é…å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m = re.match(<span class="string">r'^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$'</span>, <span class="string">'010-12345'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m</div><div class="line">&lt;_sre.SRE_Match object at <span class="number">0x1082483e8</span>&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.group() <span class="comment">#è¿”å›æ‰€æœ‰åŒ¹é…ç»“æœ</span></div><div class="line"><span class="string">'010-12345'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">0</span>) <span class="comment">#åŸå§‹å­—ç¬¦ä¸² </span></div><div class="line"><span class="string">'010-12345'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">1</span>) </div><div class="line"><span class="string">'010'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">2</span>)</div><div class="line"><span class="string">'12345'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>m.groups() <span class="comment">#è¿”å›åŒ…å«å­ç»„çš„å…ƒç»„</span></div><div class="line">(<span class="string">'010'</span>, <span class="string">'12345'</span>)</div></pre></td></tr></table></figure>
<h3 id="re-matchå’Œre-search"><a href="#re-matchå’Œre-search" class="headerlink" title="re.matchå’Œre.search"></a>re.matchå’Œre.search</h3><p><strong>re.matchå’Œre.searchçš„åŒºåˆ«ï¼š</strong><br>re.matchåªåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œå¦‚æœå­—ç¬¦ä¸²å¼€å§‹ä¸ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™åŒ¹é…å¤±è´¥ï¼Œå‡½æ•°è¿”å›Noneï¼›è€Œre.searchåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.match(<span class="string">'foo'</span>, <span class="string">'seafood'</span>) <span class="comment">#åŒ¹é…å¤±è´¥è¿”å›None</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.search(<span class="string">'foo'</span>, <span class="string">'seafood'</span>) <span class="comment">#åŒ¹é…æˆåŠŸ</span></div><div class="line">&lt;_sre.SRE_Match object at <span class="number">0x10823ca58</span>&gt;</div></pre></td></tr></table></figure>
<p><strong>findall():</strong>æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰ç¬¦åˆçš„å­å­—ç¬¦ä¸²åˆ—è¡¨<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">'foo'</span>, <span class="string">'fooseafood'</span>)</div><div class="line">[<span class="string">'foo'</span>, <span class="string">'foo'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">'foo'</span>, <span class="string">'foofooseafood'</span>)</div><div class="line">[<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'foo'</span>]</div></pre></td></tr></table></figure></p>
<p>findall()å’Œ search()ç›¸ä¼¼ä¹‹å¤„åœ¨äºäºŒè€…éƒ½æ‰§è¡Œå­—ç¬¦ä¸²æœç´¢ï¼Œä½† findall()å’Œ match()ä¸ search()ä¸åŒä¹‹å¤„æ˜¯,findall()æ€»è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<h3 id="åˆ‡åˆ†å’Œæ›¿æ¢"><a href="#åˆ‡åˆ†å’Œæ›¿æ¢" class="headerlink" title="åˆ‡åˆ†å’Œæ›¿æ¢"></a>åˆ‡åˆ†å’Œæ›¿æ¢</h3><p><strong>re.split()</strong>:æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›åˆ†å‰²åçš„æ‰€æœ‰å­å­—ç¬¦ä¸²åˆ—è¡¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = re.split(<span class="string">r'\s+'</span>, <span class="string">'a b   c'</span>) </div><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">r'\s+'</span>, <span class="string">'a b   c'</span>)</div><div class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">r'[\s\,\;]'</span>,<span class="string">'a,b,c d;e'</span>)</div><div class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</div></pre></td></tr></table></figure>
<p><strong>re.subn()å’Œre.sub()</strong><br>å°†æŸå­—ç¬¦ä¸²ä¸­æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„éƒ¨åˆ†è¿›è¡Œæ›¿æ¢ï¼Œç”¨æ¥æ›¿æ¢çš„éƒ¨åˆ†é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,ä½†ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°,è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªç”¨æ¥æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚subn()å’Œsub()ä¸€æ ·,ä½†å®ƒè¿˜è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ›¿æ¢æ¬¡ æ•°çš„æ•°å­—,æ›¿æ¢åçš„å­—ç¬¦ä¸²å’Œè¡¨ç¤ºæ›¿æ¢æ¬¡æ•°çš„æ•°å­—ä½œä¸ºä¸€ä¸ªå…ƒç»„çš„å…ƒç´ è¿”å›ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"> &gt;&gt;&gt; re.sub(&apos;[ae]&apos;, &apos;X&apos;, &apos;abcdef&apos;)</div><div class="line">&apos;XbcdXf&apos;</div><div class="line">&gt;&gt;&gt; re.subn(&apos;[ae]&apos;, &apos;X&apos;, &apos;abcdef&apos;)</div><div class="line">(&apos;XbcdXf&apos;, 2)</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="external">æ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹</a><br><a href="https://docs.python.org/2/library/re.html" target="_blank" rel="external">Pythonå®˜æ–¹æ–‡æ¡£</a><br><a href="https://book.douban.com/subject/3112503/" target="_blank" rel="external">Pythonæ ¸å¿ƒç¼–ç¨‹</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€äº›ç”±å­—ç¬¦å’Œç‰¹æ®Šç¬¦å·ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå®ƒä»¬æô°€è¿°äº†è¿™äº›å­—ç¬¦å’Œå­—ç¬¦çš„æŸç§é‡å¤æ–¹å¼ï¼Œå› æ­¤èƒ½æŒ‰æŸç§æ¨¡å¼åŒ¹é…ä¸€ä¸ªæœ‰ç›¸ä¼¼ç‰¹å¾çš„å­—ç¬¦ä¸²çš„é›†åˆã€‚&lt;/strong&gt;æ­£åˆ™è¡¨è¾¾å¼ä¸ºé«˜çº§æ–‡æœ¬æ¨¡å¼åŒ¹é…ï¼Œä»¥åŠæœç´¢-æ›¿ä»£ç­‰åŠŸèƒ½ô°ä¾›äº†åŸºç¡€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å…ƒå­—ç¬¦&quot;&gt;&lt;a href=&quot;#å…ƒå­—ç¬¦&quot; class=&quot;headerlink&quot; title=&quot;å…ƒå­—ç¬¦&quot;&gt;&lt;/a&gt;å…ƒå­—ç¬¦&lt;/h2&gt;&lt;p&gt;å…ƒå­—ç¬¦æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­è§„å®šçš„ç‰¹æ®Šä»£ç ï¼Œæœ‰ç‰¹å®šçš„å«ä¹‰å’ŒåŒ¹é…æ•ˆæœ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨çš„å…ƒå­—ç¬¦&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;ä»£ç &lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;.&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;\w&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿æˆ–æ±‰å­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;\s&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…ä»»æ„çš„ç©ºç™½ç¬¦(åŒ…æ‹¬ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦(Tab)ï¼Œæ¢è¡Œç¬¦ï¼Œä¸­æ–‡å…¨è§’ç©ºæ ¼ç­‰)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;\d&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…æ•°å­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;\b&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…å•è¯çš„å¼€å§‹æˆ–ç»“æŸ(ç©ºæ ¼ã€æ ‡ç‚¹ã€æ¢è¡Œéƒ½ç®—æ˜¯å•è¯çš„åˆ†å‰²)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;^&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;$&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Dev" scheme="http://yoursite.com/categories/Dev/"/>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix Low-level discovery</title>
    <link href="http://yoursite.com/2017/01/21/low-level-discovery/"/>
    <id>http://yoursite.com/2017/01/21/low-level-discovery/</id>
    <published>2017-01-21T14:13:32.000Z</published>
    <updated>2018-11-14T15:46:33.071Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>Low-level discovery provides a way to automatically create items, triggers, and graphs for different entities on a computer. For instance, Zabbix can automatically start monitoring file systems or network interfaces on your machine, without the need to create items for each file system or network interface manually. </p>
<p>In Zabbix, four types of item discovery are supported out of the box:</p>
<ul>
<li>discovery of file systems;</li>
<li>discovery of network interfaces;</li>
<li>discovery of CPUs and CPU cores;</li>
<li>discovery of SNMP OIDs.</li>
</ul>
<p>A user can define their own types of discovery, provided they follow a particular JSON protocol.</p>
</blockquote>
<a id="more"></a>
<p>ç®€è€Œè¨€ä¹‹ï¼Œzabbixçš„ä½æ°´å¹³å‘ç°å°±æ˜¯å‡å°‘æˆ‘ä»¬çš„é‡å¤æ“ä½œï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒçš„ç›‘æ§å®ä¾‹è‡ªåŠ¨æ·»åŠ ç›‘æ§é¡¹ã€è§¦å‘å™¨å’Œå›¾å½¢ã€‚<br><code>vfs.fs.discovery</code>å’Œ<code>net.if.discovery</code>å°±æ˜¯zabbixè‡ªå¸¦çš„è‡ªåŠ¨å‘ç°é”®å€¼ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«agentç«¯çš„æ–‡ä»¶æŒ‚è½½æƒ…å†µå’Œç½‘å¡ä¿¡æ¯ã€‚è¿˜æœ‰åŸºäºSNMP OIDçš„è‡ªåŠ¨å‘ç°é”®å€¼ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«äº¤æ¢æœºçš„æ‰€æœ‰ç«¯å£ä¿¡æ¯ã€‚<br>å½“æˆ‘ä»¬çš„ä¸€ä¸ªæœåŠ¡æœ‰å¤šä¸ªç«¯å£éœ€è¦ç›‘æ§æ—¶ï¼Œæˆ‘é€šå¸¸æ˜¯å…ˆåœ¨agentç«¯å†™å¥½ç›‘æ§è„šæœ¬ï¼Œå®šä¹‰é”®å€¼ï¼Œç„¶åå†ä¸ºæ¯ä¸ªç«¯å£æ–°å»ºç›‘æ§é¡¹ã€è§¦å‘å™¨å’Œå›¾å½¢ï¼ˆå½“ç„¶ä½ å¯ä»¥ç›´æ¥å…‹éš†ï¼‰ï¼Œä½†è¿˜æ˜¯å…ä¸äº†ä¸€äº›é‡å¤æ“ä½œã€‚ä¸‹é¢å°±é€šè¿‡ä¸€ä¸ªä¾‹å­çœ‹ä¸€ä¸‹Low-level discoveryæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<h3 id="ç›‘æ§éœ€æ±‚ï¼š"><a href="#ç›‘æ§éœ€æ±‚ï¼š" class="headerlink" title="ç›‘æ§éœ€æ±‚ï¼š"></a>ç›‘æ§éœ€æ±‚ï¼š</h3><p>ç›‘æ§udpç«¯å£12222-12229çš„ç«¯å£çŠ¶æ€</p>
<h3 id="å®ç°æ­¥éª¤ï¼š"><a href="#å®ç°æ­¥éª¤ï¼š" class="headerlink" title="å®ç°æ­¥éª¤ï¼š"></a>å®ç°æ­¥éª¤ï¼š</h3><h4 id="1-ä»¥jsonæ ¼å¼è‡ªå®šä¹‰å‘ç°ç±»å‹"><a href="#1-ä»¥jsonæ ¼å¼è‡ªå®šä¹‰å‘ç°ç±»å‹" class="headerlink" title="1.ä»¥jsonæ ¼å¼è‡ªå®šä¹‰å‘ç°ç±»å‹"></a>1.ä»¥jsonæ ¼å¼è‡ªå®šä¹‰å‘ç°ç±»å‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">$ cat udpport_discovery.py</div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> sys,datetime,socket</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    zbxkey = sys.argv[<span class="number">1</span>]</div><div class="line">    zbx_d = &#123;&#125;</div><div class="line">    zbx_d[<span class="string">"data"</span>] = []</div><div class="line">    host_name = socket.gethostname().lower()</div><div class="line"></div><div class="line">    res = [<span class="string">'12222'</span>, <span class="string">'12223'</span>, <span class="string">'12224'</span>, <span class="string">'12225'</span>, <span class="string">'12226'</span>, <span class="string">'12227'</span>, <span class="string">'12228'</span>, <span class="string">'12229'</span>]</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> res:</div><div class="line">        d = &#123;&#125;</div><div class="line">        d[<span class="string">"&#123;#%s&#125;"</span> % zbxkey] = line</div><div class="line">        zbx_d[<span class="string">"data"</span>].append(d)</div><div class="line">    <span class="keyword">print</span> str(zbx_d).replace(<span class="string">"'"</span>,<span class="string">'"'</span>)</div></pre></td></tr></table></figure>
<h4 id="2-å®šä¹‰é…ç½®æ–‡ä»¶"><a href="#2-å®šä¹‰é…ç½®æ–‡ä»¶" class="headerlink" title="2.å®šä¹‰é…ç½®æ–‡ä»¶"></a>2.å®šä¹‰é…ç½®æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat udp_port.conf</div><div class="line">#############Template_Udp#############</div><div class="line">UserParameter=status[*],/home/prod/softwares/zabbix/etc/zabbix_agentd.conf.d/udp_port.sh $1</div><div class="line">UserParameter=discovery.udpport,/home/prod/softwares/zabbix/etc/zabbix_agentd.conf.d/udpport_discovery.py PORT</div></pre></td></tr></table></figure>
<h4 id="3-æ£€æµ‹è‡ªå®šä¹‰é”®å€¼"><a href="#3-æ£€æµ‹è‡ªå®šä¹‰é”®å€¼" class="headerlink" title="3.æ£€æµ‹è‡ªå®šä¹‰é”®å€¼"></a>3.æ£€æµ‹è‡ªå®šä¹‰é”®å€¼</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ python udpport_discovery.py PORT</div><div class="line">&#123;&quot;data&quot;: [&#123;&quot;&#123;#PORT&#125;&quot;: &quot;12222&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12223&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12224&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12225&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12226&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12227&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12228&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12229&quot;&#125;]&#125;</div></pre></td></tr></table></figure>
<p>zabbix serverç«¯æµ‹è¯•ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ ./zabbix_get -s 10.0.0.206 -k discovery.udpport</div><div class="line">&#123;&quot;data&quot;: [&#123;&quot;&#123;#PORT&#125;&quot;: &quot;12222&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12223&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12224&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12225&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12226&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12227&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12228&quot;&#125;, &#123;&quot;&#123;#PORT&#125;&quot;: &quot;12229&quot;&#125;]&#125;</div></pre></td></tr></table></figure></p>
<h4 id="4-ç¼–å†™ç›‘æ§è„šæœ¬"><a href="#4-ç¼–å†™ç›‘æ§è„šæœ¬" class="headerlink" title="4.ç¼–å†™ç›‘æ§è„šæœ¬"></a>4.ç¼–å†™ç›‘æ§è„šæœ¬</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat udp_port.sh</div><div class="line">Port=$1</div><div class="line">case $Port in</div><div class="line">        12222)   netstat -nupl | grep 12222 |wc -l;;</div><div class="line">        12223)   netstat -nupl | grep 12223 |wc -l;;</div><div class="line">        12224)   netstat -nupl | grep 12224 |wc -l;;</div><div class="line">        12225)   netstat -nupl | grep 12225 |wc -l;;</div><div class="line">        12226)   netstat -nupl | grep 12226 |wc -l;;</div><div class="line">        12227)   netstat -nupl | grep 12227 |wc -l;;</div><div class="line">        12228)   netstat -nupl | grep 12228 |wc -l;;</div><div class="line">        12229)   netstat -nupl | grep 12229 |wc -l;;</div><div class="line">        *) echo Error; exit 1;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<h4 id="5-webæ·»åŠ æ¨¡æ¿"><a href="#5-webæ·»åŠ æ¨¡æ¿" class="headerlink" title="5.webæ·»åŠ æ¨¡æ¿"></a>5.webæ·»åŠ æ¨¡æ¿</h4><p><img src="/img/01256527-8987-40C4-9C65-2FC6D1D8610F.png" alt=""></p>
<p><img src="/img/E604037B-096A-4789-9AB3-A47B14020FB2.png" alt=""></p>
<h4 id="6-å°†æ¨¡æ¿å…³è”å¯¹åº”æœºå™¨"><a href="#6-å°†æ¨¡æ¿å…³è”å¯¹åº”æœºå™¨" class="headerlink" title="6.å°†æ¨¡æ¿å…³è”å¯¹åº”æœºå™¨"></a>6.å°†æ¨¡æ¿å…³è”å¯¹åº”æœºå™¨</h4><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.zabbix.com/documentation/2.4/manual/discovery/low_level_discovery" target="_blank" rel="external">LDDå®˜æ–¹æ–‡æ¡£</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Low-level discovery provides a way to automatically create items, triggers, and graphs for different entities on a computer. For instance, Zabbix can automatically start monitoring file systems or network interfaces on your machine, without the need to create items for each file system or network interface manually. &lt;/p&gt;
&lt;p&gt;In Zabbix, four types of item discovery are supported out of the box:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;discovery of file systems;&lt;/li&gt;
&lt;li&gt;discovery of network interfaces;&lt;/li&gt;
&lt;li&gt;discovery of CPUs and CPU cores;&lt;/li&gt;
&lt;li&gt;discovery of SNMP OIDs.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A user can define their own types of discovery, provided they follow a particular JSON protocol.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
    
      <category term="zabbix" scheme="http://yoursite.com/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Python datetimeé‚£ç‚¹äº‹</title>
    <link href="http://yoursite.com/2016/11/16/python-datetime/"/>
    <id>http://yoursite.com/2016/11/16/python-datetime/</id>
    <published>2016-11-16T13:08:40.000Z</published>
    <updated>2018-11-14T15:46:03.685Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºdatetimeæ—¶é—´æ“ä½œåœ¨æ—¥å¸¸å·¥ä½œä¸­ä¹Ÿæ²¡æœ‰ç»å¸¸ç”¨åˆ°ï¼Œä½†æ˜¯æ¯æ¬¡è¦ç”¨æ—¶å´åˆæƒ³ä¸èµ·æ¥ï¼Œä¸å…¶é‡å¤æŸ¥æ–‡æ¡£ä¸å¦‚æ€»ç»“ä¸€ä¸‹å¤‡å¿˜ã€‚æœ¬æ–‡åªç®€å•è®°å½•äº†å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œä¸åŒç±»å‹æ ¼å¼ä¹‹é—´çš„è½¬æ¢(å¦‚æ—¶é—´å¯¹è±¡ç±»å‹ã€å­—ç¬¦ä¸²ã€timestampã€time tupleç±»å‹ï¼‰ä»¥åŠæ—¶åŒºé—®é¢˜ç­‰æš‚æœªæ·±å…¥äº†è§£ã€‚</p>
<h2 id="datetimeæ¨¡å—"><a href="#datetimeæ¨¡å—" class="headerlink" title="datetimeæ¨¡å—"></a>datetimeæ¨¡å—</h2><p>datetime æ¨¡å—ä¸»è¦ç”¨æ¥æ“ä½œæ—¥æœŸå’Œæ—¶é—´</p>
<h3 id="dateæ—¥æœŸå¯¹è±¡"><a href="#dateæ—¥æœŸå¯¹è±¡" class="headerlink" title="dateæ—¥æœŸå¯¹è±¡"></a>dateæ—¥æœŸå¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="keyword">print</span> datetime.date.today()  //è¿”å›å½“å‰æœ¬åœ°æ—¥æœŸ</div><div class="line"><span class="keyword">print</span> datetime.date(<span class="number">2016</span>,<span class="number">11</span>,<span class="number">16</span>) //ç”Ÿæˆæ—¥æœŸå¯¹è±¡</div><div class="line"></div><div class="line">//stdout</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="timeæ—¶é—´å¯¹è±¡"><a href="#timeæ—¶é—´å¯¹è±¡" class="headerlink" title="timeæ—¶é—´å¯¹è±¡"></a>timeæ—¶é—´å¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line">Time = datetime.time(<span class="number">12</span>,<span class="number">24</span>,<span class="number">50</span>) //ç”Ÿæˆæ—¶é—´å¯¹è±¡</div><div class="line"><span class="keyword">print</span> Time</div><div class="line"><span class="keyword">print</span> Time.hour</div><div class="line"><span class="keyword">print</span> Time.minute</div><div class="line"><span class="keyword">print</span> Time.second</div><div class="line"></div><div class="line">//stdout</div><div class="line"><span class="number">12</span>:<span class="number">24</span>:<span class="number">50</span></div><div class="line"><span class="number">12</span></div><div class="line"><span class="number">24</span></div><div class="line"><span class="number">50</span></div></pre></td></tr></table></figure>
<h3 id="datetimeæ—¥æœŸæ—¶é—´å¯¹è±¡"><a href="#datetimeæ—¥æœŸæ—¶é—´å¯¹è±¡" class="headerlink" title="datetimeæ—¥æœŸæ—¶é—´å¯¹è±¡"></a>datetimeæ—¥æœŸæ—¶é—´å¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="keyword">print</span> datetime.datetime(<span class="number">2016</span>,<span class="number">11</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">50</span>) //ç”Ÿæˆdatetimeå¯¹è±¡</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() //è¿”å›å½“å‰æ—¥æœŸæ—¶é—´</div><div class="line"><span class="keyword">print</span> datetime.datetime.now().strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>) //å¯¹å½“å‰æ—¶é—´æ ¼å¼åŒ–å¹¶è¿”å›å­—ç¬¦ä¸²(å°†datetimeå¯¹è±¡è½¬æ¢ä¸ºstr)</div><div class="line"><span class="keyword">print</span> datetime.datetime.now().ctime() //è¿”å›å½“å‰æ—¶é—´å­—ç¬¦ä¸²</div><div class="line"><span class="keyword">print</span> datetime.datetime.strptime(<span class="string">'2016-11-16 16:13:43'</span>,<span class="string">'%Y-%m-%d %H:%M:%S'</span>)//å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºdatetimeå¯¹è±¡</div><div class="line"></div><div class="line">//stdout</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">12</span>:<span class="number">24</span>:<span class="number">50</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">47.913755</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">47</span></div><div class="line">Wed Nov <span class="number">16</span> <span class="number">16</span>:<span class="number">58</span>:<span class="number">47</span> <span class="number">2016</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">16</span>:<span class="number">13</span>:<span class="number">43</span></div></pre></td></tr></table></figure>
<h3 id="timedeltaå¯¹è±¡"><a href="#timedeltaå¯¹è±¡" class="headerlink" title="timedeltaå¯¹è±¡"></a>timedeltaå¯¹è±¡</h3><p>timedeltaå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ—¶é—´æ®µï¼Œå³ä¸¤ä¸ªæ—¥æœŸ (date) æˆ–æ—¶é—´ (time) ä¹‹é—´çš„å·®ã€‚åˆ©ç”¨timedeltaå¯å®ç°æ—¶é—´çš„ç›¸åŠ å‡ï¼Œå½“ç„¶æ—¶é—´å¯¹è±¡æœ¬èº«å°±èƒ½ç›´æ¥è¿›è¡Œç®—æœ¯è¿ç®—å’Œæ¯”è¾ƒè¿ç®—ã€‚</p>
<blockquote>
<p>datetime.timedelta([days[, seconds[, microseconds[, milliseconds[, minutes[, hours[, weeks]]]]]]])</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="keyword">print</span> datetime.date.today() + datetime.timedelta(days=<span class="number">3</span>) //<span class="number">3</span>å¤©å</div><div class="line"><span class="keyword">print</span> datetime.date.today() - datetime.timedelta(days=<span class="number">3</span>) //<span class="number">3</span>å¤©å‰</div><div class="line"><span class="keyword">print</span> datetime.date.today() + datetime.timedelta(days=<span class="number">-3</span>) //<span class="number">3</span>å¤©å‰(å‚æ•°å¯ä¸ºè´Ÿ)</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() + datetime.timedelta(weeks=<span class="number">1</span>) //<span class="number">1</span>ä¸ªæ˜ŸæœŸå</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() + datetime.timedelta(days=<span class="number">1</span>) //æ˜å¤©</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() + datetime.timedelta(hours=<span class="number">3</span>) //<span class="number">3</span>å°æ—¶å</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() + datetime.timedelta(minutes=<span class="number">5</span>) //<span class="number">5</span>åˆ†é’Ÿå</div><div class="line"><span class="keyword">print</span> datetime.datetime.now() + datetime.timedelta(seconds=<span class="number">60</span>) //<span class="number">60</span>ç§’</div><div class="line"></div><div class="line">//stdout</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-19</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-13</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-13</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-23</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">26.311780</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-17</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">26.311797</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">20</span>:<span class="number">14</span>:<span class="number">26.311806</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">17</span>:<span class="number">19</span>:<span class="number">26.311815</span></div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">17</span>:<span class="number">15</span>:<span class="number">26.311823</span></div></pre></td></tr></table></figure>
<h2 id="timeæ¨¡å—"><a href="#timeæ¨¡å—" class="headerlink" title="timeæ¨¡å—"></a>timeæ¨¡å—</h2><p>timeæ¨¡å—æä¾›æ—¶é—´ç›¸å…³çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="keyword">print</span> time.ctime() //è¿”å›å½“å‰æ—¶é—´å­—ç¬¦ä¸²</div><div class="line"><span class="keyword">print</span> time.localtime() //è¿”å›å½“å‰æ—¶é—´timetuple</div><div class="line">time.sleep(<span class="number">10</span>) //ç¡çœ <span class="number">10</span>ç§’</div><div class="line"><span class="keyword">print</span> time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>) //æ ¼å¼åŒ–å¹¶è¿”å›å­—ç¬¦ä¸²</div><div class="line"></div><div class="line">//stdout</div><div class="line">Wed Nov <span class="number">16</span> <span class="number">17</span>:<span class="number">25</span>:<span class="number">50</span> <span class="number">2016</span></div><div class="line">time.struct_time(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">11</span>, tm_mday=<span class="number">16</span>, tm_hour=<span class="number">17</span>, tm_min=<span class="number">25</span>, tm_sec=<span class="number">50</span>, tm_wday=<span class="number">2</span>, tm_yday=<span class="number">321</span>, tm_isdst=<span class="number">0</span>)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-16</span> <span class="number">17</span>:<span class="number">26</span>:<span class="number">00</span></div></pre></td></tr></table></figure>
<h2 id="strftime-æ ¼å¼åŒ–å­—ç¬¦ä¸²å«ä¹‰"><a href="#strftime-æ ¼å¼åŒ–å­—ç¬¦ä¸²å«ä¹‰" class="headerlink" title="strftime()æ ¼å¼åŒ–å­—ç¬¦ä¸²å«ä¹‰"></a>strftime()æ ¼å¼åŒ–å­—ç¬¦ä¸²å«ä¹‰</h2><table>
<thead>
<tr>
<th>Directive</th>
<th>Meaning</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>%a</td>
<td>æ˜ŸæœŸåç§°ç®€å†™</td>
<td>Sun, Mon, â€¦, Sat</td>
</tr>
<tr>
<td>%A</td>
<td>æ˜ŸæœŸåç§°çš„å…¨ç§°</td>
<td>Sunday, Monday, â€¦, Saturday</td>
</tr>
<tr>
<td>%w</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„æ˜ŸæœŸ[0è¡¨ç¤ºæ˜ŸæœŸæ—¥]</td>
<td>0, 1, â€¦, 6</td>
</tr>
<tr>
<td>%d</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„ä¸€ä¸ªæœˆçš„ç¬¬å‡ å¤©</td>
<td>01, 02, â€¦, 31</td>
</tr>
<tr>
<td>%b</td>
<td>æœˆä»½åç§°çš„ç®€å†™</td>
<td>Jan, Feb, â€¦, Dec</td>
</tr>
<tr>
<td>%B</td>
<td>æœˆä»½åç§°çš„å…¨ç§°</td>
<td>January, February, â€¦, December</td>
</tr>
<tr>
<td>%m</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„æœˆä»½</td>
<td>01, 02, â€¦, 12</td>
</tr>
<tr>
<td>%y</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„å¹´ä»½ï¼Œä¸å¸¦æœ‰ä¸–çºª</td>
<td>00, 01, â€¦, 99</td>
</tr>
<tr>
<td>%Y</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„å¹´ä»½ï¼Œå¸¦æœ‰ä¸–çºª</td>
<td>1970, 1988, 2001, 2013</td>
</tr>
<tr>
<td>%H</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„å°æ—¶ï¼ˆ24å°æ—¶åˆ¶ï¼‰</td>
<td>00, 01, â€¦, 23</td>
</tr>
<tr>
<td>%I</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„å°æ—¶ï¼ˆ12å°æ—¶åˆ¶ï¼‰</td>
<td>01, 02, â€¦, 12</td>
</tr>
<tr>
<td>%p</td>
<td>AM or PM</td>
<td>AM, PM</td>
</tr>
<tr>
<td>%M</td>
<td>åè¿›åˆ¶æ•°è¡¨ç¤ºçš„åˆ†é’Ÿ</td>
<td>00, 01, â€¦, 59</td>
</tr>
<tr>
<td>%S</td>
<td>åè¿›åˆ¶è¡¨ç¤ºçš„ç§’æ•°</td>
<td>00, 01, â€¦, 59</td>
</tr>
</tbody>
</table>
<h2 id="æ•°æ®ç±»å‹è½¬æ¢"><a href="#æ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="æ•°æ®ç±»å‹è½¬æ¢"></a>æ•°æ®ç±»å‹è½¬æ¢</h2><p><img src="/img/C24469F5-B517-4D77-963E-37A6BC4B56AC.png" alt=""></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://docs.python.org/2/library/datetime.html" target="_blank" rel="external">datetimeå®˜æ–¹æ–‡æ¡£</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…³äºdatetimeæ—¶é—´æ“ä½œåœ¨æ—¥å¸¸å·¥ä½œä¸­ä¹Ÿæ²¡æœ‰ç»å¸¸ç”¨åˆ°ï¼Œä½†æ˜¯æ¯æ¬¡è¦ç”¨æ—¶å´åˆæƒ³ä¸èµ·æ¥ï¼Œä¸å…¶é‡å¤æŸ¥æ–‡æ¡£ä¸å¦‚æ€»ç»“ä¸€ä¸‹å¤‡å¿˜ã€‚æœ¬æ–‡åªç®€å•è®°å½•äº†å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œä¸åŒç±»å‹æ ¼å¼ä¹‹é—´çš„è½¬æ¢(å¦‚æ—¶é—´å¯¹è±¡ç±»å‹ã€å­—ç¬¦ä¸²ã€timestampã€time tupleç±»å‹ï¼‰ä»¥åŠæ—¶åŒºé—®é¢˜ç­‰æš‚æœªæ·±å…¥äº†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&quot;datetimeæ¨¡å—&quot;&gt;&lt;a href=&quot;#datetimeæ¨¡å—&quot; class=&quot;headerlink&quot; title=&quot;datetimeæ¨¡å—&quot;&gt;&lt;/a&gt;datetimeæ¨¡å—&lt;/h2&gt;&lt;p&gt;datetime æ¨¡å—ä¸»è¦ç”¨æ¥æ“ä½œæ—¥æœŸå’Œæ—¶é—´&lt;/p&gt;
&lt;h3 id=&quot;dateæ—¥æœŸå¯¹è±¡&quot;&gt;&lt;a href=&quot;#dateæ—¥æœŸå¯¹è±¡&quot; class=&quot;headerlink&quot; title=&quot;dateæ—¥æœŸå¯¹è±¡&quot;&gt;&lt;/a&gt;dateæ—¥æœŸå¯¹è±¡&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; datetime&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; datetime.date.today()  //è¿”å›å½“å‰æœ¬åœ°æ—¥æœŸ&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; datetime.date(&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;) //ç”Ÿæˆæ—¥æœŸå¯¹è±¡&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;//stdout&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-11&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-16&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-11&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-16&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="datetime" scheme="http://yoursite.com/tags/datetime/"/>
    
  </entry>
  
  <entry>
    <title>å°è¯•Ansible Python API</title>
    <link href="http://yoursite.com/2016/11/04/ansible-python-api/"/>
    <id>http://yoursite.com/2016/11/04/ansible-python-api/</id>
    <published>2016-11-04T10:49:12.000Z</published>
    <updated>2017-06-21T15:37:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h2><h3 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">// ping æ¨¡å—</div><div class="line">$ ansible localhost -m ping</div><div class="line">localhost | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div><div class="line">// shell æ¨¡å—</div><div class="line">$ ansible localhost -m shell -a &apos;uptime&apos;</div><div class="line">localhost | success | rc=0 &gt;&gt;</div><div class="line">11:00:11 up 66 days, 23:34,  1 user,  load average: 0.00, 0.01, 0.05</div></pre></td></tr></table></figure>
<h3 id="Python-API"><a href="#Python-API" class="headerlink" title="Python API"></a>Python API</h3><p>é€šè¿‡ansible.runneræ¨¡å—æ¥å®ç°</p>
<a id="more"></a>
<h4 id="ä½¿ç”¨APIå®ç°pingæ¨¡å—åŠŸèƒ½ï¼š"><a href="#ä½¿ç”¨APIå®ç°pingæ¨¡å—åŠŸèƒ½ï¼š" class="headerlink" title="ä½¿ç”¨APIå®ç°pingæ¨¡å—åŠŸèƒ½ï¼š"></a>ä½¿ç”¨APIå®ç°pingæ¨¡å—åŠŸèƒ½ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> ansible.runner</div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line">runner = ansible.runner.Runner(</div><div class="line">    module_name=<span class="string">'ping'</span>,  //æ¨¡å—å</div><div class="line">    module_args=<span class="string">''</span>,  //æ¨¡å—å‚æ•°</div><div class="line">    pattern=<span class="string">'localhost'</span>,  //åŒ¹é…ä¸»æœºæˆ–ä¸»æœºç»„</div><div class="line">    forks=<span class="number">2</span> //å¤šçº¿ç¨‹</div><div class="line">)</div><div class="line">data = runner.run()</div><div class="line"><span class="keyword">print</span> data  //æ‰“å°è¾“å‡ºç»“æœé»˜è®¤jsonæ ¼å¼</div><div class="line"></div><div class="line">//stdout</div><div class="line">&#123;<span class="string">'dark'</span>: &#123;&#125;, <span class="string">'contacted'</span>: &#123;<span class="string">'localhost'</span>: &#123;<span class="string">'invocation'</span>: &#123;<span class="string">'module_name'</span>: <span class="string">'ping'</span>, <span class="string">'module_args'</span>: <span class="string">''</span>&#125;, <span class="string">u'changed'</span>: <span class="keyword">False</span>, <span class="string">u'ping'</span>: <span class="string">u'pong'</span>&#125;&#125;&#125;</div></pre></td></tr></table></figure>
<p>ç”±äºè¾“å‡ºç»“æœé»˜è®¤æ˜¯jsonæ ¼å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¼å¼åŒ–ä¸€ä¸‹ï¼Œè®©å®ƒæ›´ç¾è§‚</p>
<blockquote>
<p>sort_keys  <code>æŒ‰keyæ’åº</code><br>indent <code>ç¼©è¿›</code><br>separators <code>æŒ‡å®šåˆ†éš”ç¬¦(é»˜è®¤åˆ†éš”ç¬¦&#39;, &#39;,ä½¿ç”¨&#39;,&#39;,&#39;: &#39; é¿å…å°¾éƒ¨ç©ºæ ¼)</code></p>
</blockquote>
<p>ä¸Šä¾‹ä¸­çš„è¾“å‡ºæ ¼å¼åŒ–ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">print</span> json.dumps(data, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>)) //å¯¹jsonæ ¼å¼åŒ–è¾“å‡º</div><div class="line">//stdout</div><div class="line">&#123;</div><div class="line">    <span class="string">"contacted"</span>: &#123;</div><div class="line">        <span class="string">"localhost"</span>: &#123;</div><div class="line">            <span class="string">"changed"</span>: false,</div><div class="line">            <span class="string">"invocation"</span>: &#123;</div><div class="line">                <span class="string">"module_args"</span>: <span class="string">""</span>,</div><div class="line">                <span class="string">"module_name"</span>: <span class="string">"ping"</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">"ping"</span>: <span class="string">"pong"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"dark"</span>: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="ä½¿ç”¨APIå®ç°shellæ¨¡å—åŠŸèƒ½"><a href="#ä½¿ç”¨APIå®ç°shellæ¨¡å—åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨APIå®ç°shellæ¨¡å—åŠŸèƒ½"></a>ä½¿ç”¨APIå®ç°shellæ¨¡å—åŠŸèƒ½</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> ansible.runner</div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line">runner = ansible.runner.Runner(</div><div class="line">   module_name=<span class="string">'shell'</span>,</div><div class="line">   module_args=<span class="string">'uptime'</span>,</div><div class="line">   pattern=<span class="string">'localhost'</span>,</div><div class="line">   forks=<span class="number">2</span></div><div class="line">)</div><div class="line">data = runner.run()</div><div class="line"><span class="keyword">print</span> json.dumps(data, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>))</div><div class="line"></div><div class="line">//stdout</div><div class="line">&#123;</div><div class="line">    <span class="string">"contacted"</span>: &#123;</div><div class="line">        <span class="string">"localhost"</span>: &#123;</div><div class="line">            <span class="string">"changed"</span>: true,</div><div class="line">            <span class="string">"cmd"</span>: <span class="string">"uptime"</span>,</div><div class="line">            <span class="string">"delta"</span>: <span class="string">"0:00:00.002573"</span>,</div><div class="line">            <span class="string">"end"</span>: <span class="string">"2016-11-04 14:57:26.549208"</span>,</div><div class="line">            <span class="string">"invocation"</span>: &#123;</div><div class="line">                <span class="string">"module_args"</span>: <span class="string">"uptime"</span>,</div><div class="line">                <span class="string">"module_name"</span>: <span class="string">"shell"</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">"rc"</span>: <span class="number">0</span>,</div><div class="line">            <span class="string">"start"</span>: <span class="string">"2016-11-04 14:57:26.546635"</span>,</div><div class="line">            <span class="string">"stderr"</span>: <span class="string">""</span>,</div><div class="line">            <span class="string">"stdout"</span>: <span class="string">" 14:57:26 up 67 days,  3:31,  1 user,  load average: 0.00, 0.06, 0.07"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"dark"</span>: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ‰“å°stdout"><a href="#æ‰“å°stdout" class="headerlink" title="æ‰“å°stdout"></a>æ‰“å°stdout</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> ansible.runner</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">(contacted)</span>:</span></div><div class="line">    <span class="keyword">for</span> k,v <span class="keyword">in</span> contacted.items():</div><div class="line">        <span class="keyword">if</span> k == <span class="string">'stdout'</span>:</div><div class="line">            <span class="keyword">print</span> v</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping_module</span><span class="params">()</span>:</span></div><div class="line">    runner = ansible.runner.Runner(</div><div class="line">        module_name=<span class="string">'ping'</span>,</div><div class="line">        module_args=<span class="string">''</span>,</div><div class="line">        pattern=<span class="string">'localhost'</span>,</div><div class="line">        forks=<span class="number">2</span></div><div class="line">        )</div><div class="line">    data = runner.run()</div><div class="line">    <span class="keyword">print</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell_module</span><span class="params">()</span>:</span></div><div class="line">    runner = ansible.runner.Runner(</div><div class="line">        module_name=<span class="string">'shell'</span>,</div><div class="line">        module_args=<span class="string">'uptime'</span>,</div><div class="line">        pattern=<span class="string">'localhost'</span>,</div><div class="line">        forks=<span class="number">2</span></div><div class="line">        )</div><div class="line">    data = runner.run()</div><div class="line">    result(data[<span class="string">'contacted'</span>][<span class="string">'localhost'</span>])</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    shell_module()</div><div class="line"></div><div class="line">//stdout</div><div class="line"><span class="number">15</span>:<span class="number">34</span>:<span class="number">09</span> up <span class="number">67</span> days,  <span class="number">4</span>:<span class="number">07</span>,  <span class="number">1</span> user,  load average: <span class="number">0.00</span>, <span class="number">0.01</span>, <span class="number">0.05</span></div></pre></td></tr></table></figure>
<h2 id="playbook"><a href="#playbook" class="headerlink" title="playbook"></a>playbook</h2><p>playbookæè¿°äº†åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„ç­–ç•¥æˆ–ä¸€ç»„ä»»åŠ¡</p>
<p>ä¸€ä¸ªplaybookæ–‡ä»¶ç”±ä¸€ä¸ªæˆ–å¤šä¸ªplayç»„æˆï¼Œæ¯ä¸ªplayå®šä¹‰äº†ä¸€ç³»åˆ—çš„taskï¼Œæ¯ä¸ªtaské€šè¿‡ansibleçš„æ¨¡å—æ¥å®ç°ç‰¹å®šçš„åŠŸèƒ½</p>
<p>exp.yml (<code>playbookä½¿ç”¨YAMLè¯­è¨€ç¼–å†™ï¼Œæ–‡ä»¶åä»¥.yamlæˆ–.ymlç»“å°¾</code>)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- hosts: localhost_group   //ä¸»æœºç»„</div><div class="line">  tasks:</div><div class="line">  - name: kernel release info  //task1</div><div class="line">    command: uname -a</div><div class="line"></div><div class="line">  - name: memory info  //task2</div><div class="line">    shell: free -m</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªplaybookå¯ä»¥æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯å’Œå†…å­˜ä¿¡æ¯</p>
<h3 id="ansible-playbookå‘½ä»¤"><a href="#ansible-playbookå‘½ä»¤" class="headerlink" title="ansible-playbookå‘½ä»¤"></a>ansible-playbookå‘½ä»¤</h3><p>å‘½ä»¤è¡Œæ‰§è¡Œplaybook<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">$ ansible-playbook  -i /etc/ansible/hosts  test.yml</div><div class="line"></div><div class="line">PLAY [localhost_group] ********************************************************</div><div class="line"></div><div class="line">GATHERING FACTS ***************************************************************</div><div class="line">ok: [localhost]</div><div class="line"></div><div class="line">TASK: [kernel info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line"></div><div class="line">TASK: [memory info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line"></div><div class="line">PLAY RECAP ********************************************************************</div><div class="line">localhost                  : ok=3    changed=2    unreachable=0    failed=0</div></pre></td></tr></table></figure></p>
<h3 id="Python-API-1"><a href="#Python-API-1" class="headerlink" title="Python API"></a>Python API</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># encoding=utf8</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> ansible.runner</div><div class="line"><span class="keyword">import</span> ansible.playbook</div><div class="line"><span class="keyword">import</span> ansible.inventory</div><div class="line"><span class="keyword">from</span> ansible <span class="keyword">import</span> callbacks</div><div class="line"><span class="keyword">from</span> ansible <span class="keyword">import</span> utils</div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line">playbook_path = <span class="string">"/home/ubuntu/scripts/exp.yml"</span></div><div class="line"></div><div class="line"><span class="comment">##æ·»åŠ ä¸»æœºä¿¡æ¯</span></div><div class="line">host = ansible.inventory.host.Host(</div><div class="line">    name = <span class="string">'localhost'</span></div><div class="line">    )</div><div class="line"></div><div class="line"><span class="comment">##è®¾ç½®ä¸»æœºç»„å¹¶æ·»åŠ ä¸»æœº</span></div><div class="line">group = ansible.inventory.group.Group(</div><div class="line">    name = <span class="string">'localhost_group'</span></div><div class="line">    )</div><div class="line">group.add_host(host)</div><div class="line"></div><div class="line"><span class="comment">##ä¸»æœºåˆ—è¡¨</span></div><div class="line">example_inventory = ansible.inventory.Inventory()</div><div class="line">example_inventory.add_group(group)</div><div class="line"></div><div class="line"><span class="comment">#å›è°ƒä¿¡æ¯</span></div><div class="line">stats = callbacks.AggregateStats()</div><div class="line">playbook_cb = callbacks.PlaybookCallbacks(verbose=utils.VERBOSITY)</div><div class="line">runner_cb = callbacks.PlaybookRunnerCallbacks(stats, verbose=utils.VERBOSITY)</div><div class="line"></div><div class="line"><span class="comment">#åˆ›å»ºå®ä¾‹ï¼Œplaybookä½äºplaybook_path</span></div><div class="line">pb = ansible.playbook.PlayBook(</div><div class="line">    playbook = playbook_path,</div><div class="line">    stats = stats,</div><div class="line">    callbacks = playbook_cb,</div><div class="line">    runner_callbacks = runner_cb,</div><div class="line">    inventory = example_inventory,</div><div class="line">    subset = <span class="string">'all'</span>,</div><div class="line">    )</div><div class="line"></div><div class="line"><span class="comment">#è¿è¡Œplaybook</span></div><div class="line">pr = pb.run()</div><div class="line"></div><div class="line"><span class="comment">#æ‰“å°ç»“æœ</span></div><div class="line"><span class="keyword">print</span> json.dumps(pr, sort_keys=<span class="keyword">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">','</span>, <span class="string">': '</span>))</div></pre></td></tr></table></figure>
<p>//stdout</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">PLAY [localhost_group] ********************************************************</div><div class="line"></div><div class="line">GATHERING FACTS ***************************************************************</div><div class="line">ok: [localhost]</div><div class="line"></div><div class="line">TASK: [kernel info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line"></div><div class="line">TASK: [memory info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line">&#123;</div><div class="line">    &quot;localhost&quot;: &#123;</div><div class="line">    &quot;changed&quot;: 2,</div><div class="line">    &quot;failures&quot;: 0,</div><div class="line">    &quot;ok&quot;: 3,</div><div class="line">    &quot;skipped&quot;: 0,</div><div class="line">    &quot;unreachable&quot;: 0</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ansible-runneræ›´å¤šä¿¡æ¯"><a href="#ansible-runneræ›´å¤šä¿¡æ¯" class="headerlink" title="ansible.runneræ›´å¤šä¿¡æ¯"></a>ansible.runneræ›´å¤šä¿¡æ¯</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> ansible.runner</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(ansible.runner)</div><div class="line">[<span class="string">'C'</span>, <span class="string">'DefaultRunnerCallbacks'</span>, <span class="string">'HAS_ATFORK'</span>, <span class="string">'HostVars'</span>, <span class="string">'ModuleReplacer'</span>, <span class="string">'OUTPUT_LOCKFILE'</span>, <span class="string">'PROCESS_LOCKFILE'</span>, <span class="string">'Queue'</span>, <span class="string">'ReturnData'</span>, <span class="string">'Runner'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__file__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__path__'</span>, <span class="string">'_executor_hook'</span>, <span class="string">'ansible'</span>, <span class="string">'atfork'</span>, <span class="string">'base64'</span>, <span class="string">'check_conditional'</span>, <span class="string">'collections'</span>, <span class="string">'connection'</span>, <span class="string">'errors'</span>, <span class="string">'getpass'</span>, <span class="string">'jinja2'</span>, <span class="string">'module_common'</span>, <span class="string">'module_replacer'</span>, <span class="string">'multiprocessing'</span>, <span class="string">'multiprocessing_runner'</span>, <span class="string">'os'</span>, <span class="string">'pipes'</span>, <span class="string">'poller'</span>, <span class="string">'pwd'</span>, <span class="string">'random'</span>, <span class="string">'return_data'</span>, <span class="string">'signal'</span>, <span class="string">'socket'</span>, <span class="string">'split_args'</span>, <span class="string">'string_functions'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'tempfile'</span>, <span class="string">'template'</span>, <span class="string">'time'</span>, <span class="string">'traceback'</span>, <span class="string">'utils'</span>, <span class="string">'vv'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>help(ansible.runner.Runner)</div></pre></td></tr></table></figure>
<h4 id="Python-yaml-æ¨¡å—è‡ªå®šä¹‰playbook"><a href="#Python-yaml-æ¨¡å—è‡ªå®šä¹‰playbook" class="headerlink" title="Python yaml æ¨¡å—è‡ªå®šä¹‰playbook"></a>Python yaml æ¨¡å—è‡ªå®šä¹‰playbook</h4><p>define_yaml.py<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> yaml</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">playbook_path = <span class="string">'/home/ubuntu/scripts'</span></div><div class="line"></div><div class="line">Yml_args = &#123;&#125;</div><div class="line">Yml = []</div><div class="line">Yml_args[<span class="string">"gather_facts"</span>] = <span class="keyword">False</span></div><div class="line">Yml_args[<span class="string">"hosts"</span>] = <span class="string">"localhost_group"</span></div><div class="line">Yml_args[<span class="string">"remote_user"</span>] = <span class="string">"ubuntu"</span></div><div class="line">Yml_task = []</div><div class="line">Yml_task.append(&#123;<span class="string">'shell'</span>: <span class="string">'uptime'</span>, <span class="string">'name'</span>: <span class="string">'uptime info'</span>&#125;)</div><div class="line">Yml_task.append(&#123;<span class="string">'shell'</span>: <span class="string">'free -m'</span>, <span class="string">'name'</span>: <span class="string">'memory info'</span>&#125;)</div><div class="line">Yml_args[<span class="string">"tasks"</span>] = Yml_task</div><div class="line">Yml.append(Yml_args)</div><div class="line">Yml = yaml.dump(Yml)</div><div class="line">Yml_path = os.path.join(playbook_path, <span class="string">"exp.yml"</span>)</div><div class="line"><span class="keyword">with</span> open(Yml_path, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">    f.write(Yml)</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œå¹¶æ£€æµ‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ python define_yaml.py</div><div class="line"></div><div class="line">$ ansible-playbook  -i /etc/ansible/hosts  exp.yml</div><div class="line"></div><div class="line">PLAY [localhost_group] ********************************************************</div><div class="line"></div><div class="line">TASK: [uptime info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line"></div><div class="line">TASK: [memory info] ***********************************************************</div><div class="line">changed: [localhost]</div><div class="line"></div><div class="line">PLAY RECAP ********************************************************************</div><div class="line">localhost                  : ok=2    changed=2    unreachable=0    failed=0</div><div class="line"></div><div class="line">$ cat exp.yml</div><div class="line">- gather_facts: false</div><div class="line">  hosts: localhost_group</div><div class="line">  remote_user: ubuntu</div><div class="line">  tasks:</div><div class="line">  - &#123;name: uptime info, shell: uptime&#125;</div><div class="line">  - &#123;name: memory info, shell: free -m&#125;</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://docs.ansible.com/ansible/dev_guide/developing_api.html" target="_blank" rel="external">Ansible Python API</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ¨¡å—&quot;&gt;&lt;a href=&quot;#æ¨¡å—&quot; class=&quot;headerlink&quot; title=&quot;æ¨¡å—&quot;&gt;&lt;/a&gt;æ¨¡å—&lt;/h2&gt;&lt;h3 id=&quot;å‘½ä»¤è¡Œ&quot;&gt;&lt;a href=&quot;#å‘½ä»¤è¡Œ&quot; class=&quot;headerlink&quot; title=&quot;å‘½ä»¤è¡Œ&quot;&gt;&lt;/a&gt;å‘½ä»¤è¡Œ&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;// ping æ¨¡å—&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ ansible localhost -m ping&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;localhost | success &amp;gt;&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;quot;changed&amp;quot;: false,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;quot;ping&amp;quot;: &amp;quot;pong&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// shell æ¨¡å—&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ ansible localhost -m shell -a &amp;apos;uptime&amp;apos;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;localhost | success | rc=0 &amp;gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11:00:11 up 66 days, 23:34,  1 user,  load average: 0.00, 0.01, 0.05&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Python-API&quot;&gt;&lt;a href=&quot;#Python-API&quot; class=&quot;headerlink&quot; title=&quot;Python API&quot;&gt;&lt;/a&gt;Python API&lt;/h3&gt;&lt;p&gt;é€šè¿‡ansible.runneræ¨¡å—æ¥å®ç°&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AnsibleåŸºç¡€çŸ¥è¯†å¤‡å¿˜</title>
    <link href="http://yoursite.com/2016/05/20/ansible/"/>
    <id>http://yoursite.com/2016/05/20/ansible/</id>
    <published>2016-05-20T08:25:38.000Z</published>
    <updated>2018-11-14T15:45:28.599Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ä½“ç³»ç»“æ„"><a href="#ä¸€ã€ä½“ç³»ç»“æ„" class="headerlink" title="ä¸€ã€ä½“ç³»ç»“æ„"></a>ä¸€ã€ä½“ç³»ç»“æ„</h2><p>ansibleæ˜¯ä¸€æ¬¾åŸºäºpythonå¼€å‘ï¼Œæ‰åˆäº†ä¼—å¤šè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·åŠŸèƒ½çš„è½»é‡çº§è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œç›®å‰å®ç°äº†é™¤ç³»ç»Ÿå®‰è£…ä»¥å¤–çš„æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ä»»åŠ¡æ‰§è¡ŒåŠæ‰¹é‡ç¨‹åºéƒ¨ç½²ç­‰åŠŸèƒ½ã€‚</p>
<p><img src="/img/25.png" alt=""></p>
<ul>
<li>Inventoryï¼šä¸»æœºåº“ï¼Œå®šä¹‰å¯æ§åˆ¶çš„ä¸»æœº</li>
<li>Modulesï¼šåŸºäºæ¨¡å—åŒ–è®¾è®¡ï¼Œé€šè¿‡æ¨¡å—æ¥å®ç°æ‰¹é‡éƒ¨ç½²</li>
<li>playbookï¼šå‰§æœ¬ï¼Œä½¿ç”¨YAMLç¼–å†™çš„å£°æ˜æ€§çš„é…ç½®æ–‡ä»¶</li>
<li>plugins: æ’ä»¶ï¼Œå®Œæˆæ—¥å¿—è®°å½•ã€é‚®ä»¶ç­‰åŠŸèƒ½</li>
</ul>
<a id="more"></a>
<h2 id="äºŒã€-ç‰¹ç‚¹"><a href="#äºŒã€-ç‰¹ç‚¹" class="headerlink" title="äºŒã€ ç‰¹ç‚¹"></a>äºŒã€ ç‰¹ç‚¹</h2><ul>
<li>é«˜åº¦æ¨¡å—åŒ–ï¼Œå€ŸåŠ©æ¨¡å—å®Œæˆå„ç§ä»»åŠ¡</li>
<li>agentlessï¼Œæ— éœ€åœ¨è¢«æ§åˆ¶ç«¯å®‰è£…agent</li>
<li>é»˜è®¤åŸºäºsshåè®®å‘è¢«æ§åˆ¶ç«¯å‘é€æ“ä½œæŒ‡ä»¤<ul>
<li>åŸºäºå¯†é’¥è®¤è¯</li>
<li>åœ¨inventoryæ–‡ä»¶ä¸­æŒ‡å®šè´¦å·å’Œå¯†ç </li>
</ul>
</li>
<li>æ‰¹é‡ä»»åŠ¡æ‰§è¡Œå¯å†™æˆå‰§æœ¬playbook</li>
<li>å¹‚ç­‰æ€§ï¼šä¸ä¼šé‡å¤æ‰§è¡Œç›¸åŒæ“ä½œ</li>
</ul>
<h2 id="ä¸‰ã€ç®€å•ä½¿ç”¨"><a href="#ä¸‰ã€ç®€å•ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ç®€å•ä½¿ç”¨"></a>ä¸‰ã€ç®€å•ä½¿ç”¨</h2><h3 id="3-1-sshå…å¯†é’¥ç™»å½•"><a href="#3-1-sshå…å¯†é’¥ç™»å½•" class="headerlink" title="3.1 sshå…å¯†é’¥ç™»å½•"></a>3.1 sshå…å¯†é’¥ç™»å½•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ssh-keygen -t rsa -P &apos;&apos;</div><div class="line"># ssh-copy-id  -i /root/.ssh/id_rsa.pub  10.249.6.64</div><div class="line"># ssh-copy-id  -i /root/.ssh/id_rsa.pub  10.48.156.8</div></pre></td></tr></table></figure>
<h3 id="3-2-å¸¸ç”¨å‘½ä»¤"><a href="#3-2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="3.2 å¸¸ç”¨å‘½ä»¤"></a>3.2 å¸¸ç”¨å‘½ä»¤</h3><h4 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Options:</div><div class="line"></div><div class="line">   -l, --list            List available modules  //åˆ—å‡ºæ‰€æœ‰æ¨¡å—</div><div class="line">   -s, --snippet         Show playbook snippet for specified module(s) //æŸ¥çœ‹æŒ‡å®šæ¨¡å—ç”¨æ³•</div><div class="line"></div><div class="line">// æ›´å¤šä¿¡æ¯è¯·å‚è€ƒmanualæ‰‹å†Œ</div></pre></td></tr></table></figure>
<h4 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h4><blockquote>
<p>ansible <host-pattern>  [-f forks][-m module_name] [-a args] [options]</host-pattern></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Options:</div><div class="line"></div><div class="line">    -a MODULE_ARGS, --args=MODULE_ARGS</div><div class="line">                        module arguments   // ä¼ é€’æ¨¡å—å‚æ•°</div><div class="line">    -f FORKS, --forks=FORKS  // æŒ‡å®šå¹¶å‘æ•°</div><div class="line">                        specify number of parallel processes to use</div><div class="line">                        (default=5)</div><div class="line">    -i INVENTORY, --inventory-file=INVENTORY</div><div class="line">                        specify inventory host file</div><div class="line">                        (default=/etc/ansible/hosts)</div><div class="line">    -m MODULE_NAME, --module-name=MODULE_NAME</div><div class="line">                        module name to execute (default=command)</div><div class="line">//æ›´å¤šä¿¡æ¯è¯·å‚è€ƒmanualæ‰‹å†Œ</div></pre></td></tr></table></figure>
<h4 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible-playbook"></a>ansible-playbook</h4><blockquote>
<p>ansible-playbook <filename.yml> â€¦ [options]</filename.yml></p>
</blockquote>
<h2 id="å››ã€æ¨¡å—"><a href="#å››ã€æ¨¡å—" class="headerlink" title="å››ã€æ¨¡å—"></a>å››ã€æ¨¡å—</h2><h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><p>å‘½ä»¤æ¨¡å—: ansibleé»˜è®¤æ¨¡å—ï¼Œç”¨äºåœ¨è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œcommandæ¨¡å—å¹¶ä¸æ”¯æŒshellå˜é‡å’Œç®¡é“ç­‰ï¼Œè‹¥æƒ³ä½¿ç”¨shellæ¥æ‰§è¡Œï¼Œåº”ä½¿ç”¨shellæ¨¡å—ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep ^command</div><div class="line">command              Executes a command on a remote node</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m command -a &quot;date&quot;</div><div class="line">10.249.6.64 | success | rc=0 &gt;&gt;</div><div class="line">Wed May 11 21:21:35 CST 2016</div></pre></td></tr></table></figure>
<h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><p>pingæ¨¡å—ï¼šæµ‹è¯•æŒ‡å®šä¸»æœºæ˜¯å¦èƒ½è¿æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep  -w ^ping</div><div class="line">ping                 Try to connect to host and return `pong&apos; on success.</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m ping</div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: false,</div><div class="line">    &quot;ping&quot;: &quot;pong&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="cron"><a href="#cron" class="headerlink" title="cron"></a>cron</h3><p>è®¡åˆ’ä»»åŠ¡æ¨¡å— ï¼šç®¡ç†è®¡åˆ’ä»»åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep  ^cron</div><div class="line">cron                 Manage cron.d and crontab entries.</div><div class="line"></div><div class="line"># ansible-doc  -s cron</div><div class="line">- name: Manage cron.d and crontab entries.</div><div class="line">action: cron</div><div class="line">    backup                 # If set, create a backup of the crontab before it is modified. The location of the backup is returned in the `backup&apos; variable by this module.</div><div class="line">    cron_file              # If specified, uses this file in cron.d instead of an individual user&apos;s crontab.</div><div class="line">    day                    # Day of the month the job should run ( 1-31, *, */2, etc )</div><div class="line">    hour                   # Hour when the job should run ( 0-23, *, */2, etc )</div><div class="line">    job                    # The command to execute. Required if state=present.</div><div class="line">    minute                 # Minute when the job should run ( 0-59, *, */2, etc )</div><div class="line">    month                  # Month of the year the job should run ( 1-12, *, */2, etc )</div><div class="line">    name                   # Description of a crontab entry.</div><div class="line">    reboot                 # If the job should be run at reboot. This option is deprecated. Users should use special_time.</div><div class="line">    special_time           # Special time specification nickname.</div><div class="line">    state                  # Whether to ensure the job is present or absent.</div><div class="line">    user                   # The specific user who&apos;s crontab should be modified.</div><div class="line">    weekday                # Day of the week that the job should run ( 0-7 for Sunday - Saturday, *, etc )</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m cron -a &apos;name=&quot;sync time&quot; minute=&quot;*/10&quot; \</div><div class="line">  job=&quot;/usr/sbin/ntpdate 0.centos.pool.ntp.org &amp;&amp; hwclock -w&quot; &apos;</div><div class="line"></div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: true,</div><div class="line">    &quot;jobs&quot;: [</div><div class="line">    &quot;sync time&quot;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>ç”¨æˆ·æ¨¡å—ï¼šç®¡ç†ç”¨æˆ·è´¦æˆ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep ^user</div><div class="line">user                 Manage user accounts</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m user -a &apos;name=work shell=/bin/bash home=/home/www&apos;   //æ·»åŠ ç”¨æˆ·</div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: true,</div><div class="line">    &quot;comment&quot;: &quot;&quot;,</div><div class="line">    &quot;createhome&quot;: true,</div><div class="line">    &quot;group&quot;: 500,</div><div class="line">    &quot;home&quot;: &quot;/home/www&quot;,</div><div class="line">    &quot;name&quot;: &quot;work&quot;,</div><div class="line">    &quot;shell&quot;: &quot;/bin/bash&quot;,</div><div class="line">    &quot;state&quot;: &quot;present&quot;,</div><div class="line">    &quot;system&quot;: false,</div><div class="line">    &quot;uid&quot;: 500</div><div class="line">&#125;</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m user -a &apos;name=work state=absent&apos;  // åˆ é™¤ç”¨æˆ·</div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: true,</div><div class="line">    &quot;force&quot;: false,</div><div class="line">    &quot;name&quot;: &quot;work&quot;,</div><div class="line">    &quot;remove&quot;: false,</div><div class="line">    &quot;state&quot;: &quot;absent&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><p>copyæ¨¡å—ï¼šæ–‡ä»¶å¤åˆ¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#  ansible-doc -l | grep ^copy</div><div class="line">copy                 Copies files to remote locations.</div><div class="line"></div><div class="line"># ansible-doc -s copy</div><div class="line">- name: Copies files to remote locations.</div><div class="line">action: copy</div><div class="line">    backup                 # Create a backup file including the timestamp information so you can get the original file back if you somehow clobbered it incorrectly.</div><div class="line">    content                # When used instead of &apos;src&apos;, sets the contents of a file directly to the specified value.</div><div class="line">    dest=                  # Remote absolute path where the file should be copied to. If src is a directory, this must be a directory too.</div><div class="line">    directory_mode         # When doing a recursive copy set the mode for the directories. If this is not set we will default the system defaults.</div><div class="line">    force                  # the default is `yes&apos;, which will replace the remote file when contents are different than the source.  If `no&apos;, the file will only be transferred if the destination does not exist.</div><div class="line">    src                    # Local path to a file to copy to the remote server; can be absolute or relative. If path is a directory, it is copied recursively. In this case, if path ends with &quot;/&quot;, only inside contents of that directory are copied to destination. Otherwise, if it does not end with &quot;/&quot;, the directory itself with all contents is copied. This behavior is similar to Rsync.</div><div class="line">    validate               # The validation command to run before copying into place.  The path to the file to validate is passed in via &apos;%s&apos; which must be present as in the visudo example below. The command is passed securely so shell features like expansion and pipes won&apos;t work.</div><div class="line"></div><div class="line"># ansible 10.249.6.64 -m copy -a &quot;src=/root/test.txt dest=/tmp/&quot;</div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: true,</div><div class="line">    &quot;dest&quot;: &quot;/tmp/test.txt&quot;,</div><div class="line">    &quot;gid&quot;: 0,</div><div class="line">    &quot;group&quot;: &quot;root&quot;,</div><div class="line">    &quot;md5sum&quot;: &quot;d41d8cd98f00b204e9800998ecf8427e&quot;,</div><div class="line">    &quot;mode&quot;: &quot;0644&quot;,</div><div class="line">    &quot;owner&quot;: &quot;root&quot;,</div><div class="line">    &quot;size&quot;: 0,</div><div class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1463662606.99-26627840524349/source&quot;,</div><div class="line">    &quot;state&quot;: &quot;file&quot;,</div><div class="line">    &quot;uid&quot;: 0</div><div class="line">&#125;</div><div class="line"># ansible 10.249.6.64 -m copy -a &quot;content=&apos;hello world&apos; dest=/tmp/test.txt&quot;</div><div class="line"># ansible 10.249.6.64 -m copy -a &apos;src=/root/test.txt dest=/tmp/test.txt owner=evans group=evans mode=600 backup=yes&apos;</div></pre></td></tr></table></figure>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>fileæ¨¡å—ï¼šæ–‡ä»¶æ¨¡å—ï¼Œè®¾ç½®æ–‡ä»¶å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep -w ^file</div><div class="line">file                 Sets attributes of files</div><div class="line"># ansible 10.249.6.64 -m file -a &quot;src=/tmp/test.txt path=/tmp/test.link state=link&quot;</div><div class="line"># ansible 10.249.6.64 -m file -a &quot;owner=evans group=evans mode=600 path=/tmp/test.txt&quot;</div></pre></td></tr></table></figure>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>serviceæ¨¡å—ï¼š æœåŠ¡æ¨¡å—ï¼Œç®¡ç†ç³»ç»ŸæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep ^service</div><div class="line">service              Manage services.</div><div class="line"># ansible-doc -s service</div><div class="line">- name: Manage services.</div><div class="line">  action: service</div><div class="line">    arguments              # Additional arguments provided on the command line</div><div class="line">    enabled                # Whether the service should start on boot. *At least one of state and enabled are required.*</div><div class="line">    name=                  # Name of the service.</div><div class="line">    pattern                # If the service does not respond to the status command, name a substring to look for as would be found in the output of the `ps&apos; command as a stand-in for a status result.  If the string is found, the service will be assumed to be running.</div><div class="line">    runlevel               # For OpenRC init scripts (ex: Gentoo) only.  The runlevel that this service belongs to.</div><div class="line">    sleep                  # If the service is being `restarted&apos; then sleep this many seconds between the stop and start command. This helps to workaround badly behaving init scripts that exit immediately after signaling a process to stop.</div><div class="line">    state                  # `started&apos;/`stopped&apos; are idempotent actions that will not run commands unless necessary.  `restarted&apos; will always bounce the service.  `reloaded&apos; will always reload. *At least one of state and enabled are required.*</div><div class="line"># ansible 10.249.6.64 -m service -a &quot;name=mysqld state=restarted enabled=true&quot;  //é‡å¯mysqlæœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</div></pre></td></tr></table></figure>
<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p>shellæ¨¡å—ï¼šè¿œç¨‹æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible 10.249.6.64 -m shell -a &apos;date&apos;</div><div class="line">10.249.6.64 | success | rc=0 &gt;&gt;</div><div class="line">Thu May 19 21:20:51 CST 2016</div></pre></td></tr></table></figure>
<h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><p>scriptæ¨¡å—ï¼šè„šæœ¬æ¨¡å—ï¼Œè¿œç¨‹ä¸»æœºè¿è¡Œè„šæœ¬<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc  -l | grep ^script</div><div class="line">script               Runs a local script on a remote node after transferring it..</div><div class="line"># ansible 10.249.6.64 -m script -a &apos;/root/test.sh&apos;  //åœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œè„šæœ¬ï¼Œå¹¶æ²¡æœ‰æ‹·è´åˆ°æŒ‡å®šç›®å½•</div><div class="line">10.249.6.64 | success &gt;&gt; &#123;</div><div class="line">    &quot;changed&quot;: true,</div><div class="line">    &quot;rc&quot;: 0,</div><div class="line">    &quot;stderr&quot;: &quot;&quot;,</div><div class="line">    &quot;stdout&quot;: &quot;&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="yumã€apt"><a href="#yumã€apt" class="headerlink" title="yumã€apt"></a>yumã€apt</h3><p>yumæ¨¡å—å’Œaptæ¨¡å—ï¼šåŒ…ç®¡ç†æ¨¡å—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">yum                  Manages packages with the `yum&apos; package manager</div><div class="line">apt                  Manages apt-packages</div><div class="line"># ansible 10.249.6.64 -m yum -a &quot;name=tree state=present&quot;</div><div class="line"># ansible 10.249.6.43 -m apt -a &quot;name=tree state=present&quot;</div><div class="line"># ansible 10.249.6.43 -m apt -a &quot;name=tree state=absent&quot;</div></pre></td></tr></table></figure>
<blockquote>
<p> state<br>Whether to install (<code>present&#39;,</code>latestâ€™), or remove (`absentâ€™) a package.</p>
</blockquote>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><p>setupæ¨¡å—ï¼šæ”¶é›†ä¸»æœºä¿¡æ¯ï¼Œplaybookè¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨setupæ¨¡å—æ”¶é›†è¿œç¨‹ä¸»æœºçš„ç›¸å…³ä¿¡æ¯ï¼ˆç§°ä¸ºfactsï¼Œå¦‚æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€ipåœ°å€ã€cpuæ•°é‡ç­‰ï¼‰ï¼Œè¿™äº›ä¿¡æ¯ä¿å­˜äºå˜é‡ä¸­ï¼Œå¯åœ¨playbookä¸­å¼•ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ansible-doc -l | grep  setup</div><div class="line">setup                Gathers facts about remote hosts</div><div class="line"># ansible-doc -s setup</div><div class="line">- name: Gathers facts about remote hosts</div><div class="line">    action: setup</div><div class="line">    fact_path              # path used for local ansible facts (*.fact) - files in this dir will be run (if executable) and their results be added to ansible_local facts if a file is not executable it is read. File/results format can be json or ini-format</div><div class="line">    filter                 # if supplied, only return facts that match this shell-style (fnmatch) wildcard.</div><div class="line"># ansible 10.249.6.43 -m setup</div><div class="line"># ansible 10.249.6.43 -m setup -a &apos;filter=ansible_eth0&apos;   //è¿‡æ»¤ä¿¡æ¯</div><div class="line"># ansible 10.249.6.64 -m setup --tree /tmp/test.txt  //å°†æ”¶é›†çš„ä¿¡æ¯è¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶</div></pre></td></tr></table></figure>
<p>æ›´å¤šæ¨¡å—ä¿¡æ¯è¯·æŸ¥çœ‹ï¼š<a href="http://docs.ansible.com/ansible/list_of_all_modules.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="äº”ã€playbook"><a href="#äº”ã€playbook" class="headerlink" title="äº”ã€playbook"></a>äº”ã€playbook</h2><h3 id="5-1-YAML"><a href="#5-1-YAML" class="headerlink" title="5.1 YAML"></a>5.1 YAML</h3><p>YAMLæ˜¯ä¸€ç§å¯è¯»æ€§é«˜çš„ç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„è¯­è¨€ï¼Œå…¶è¯­æ³•å’Œå…¶ä»–é«˜é˜¶è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•è¡¨è¾¾æ¸…å•ã€æ•£åˆ—è¡¨ã€æ ‡é‡ç­‰æ•°æ®ç»“æ„ã€‚</p>
<p>æ‰€æœ‰çš„yamlæ–‡ä»¶éƒ½ä»¥â€â€”â€œå¼€å¤´è¡¨ç¤ºå¼€å§‹ä¸€ä¸ªdocumentï¼Œæ‰€æœ‰çš„åˆ—è¡¨å…ƒç´ ä»¥â€-â€œå¼€å¤´ï¼Œé”®å€¼å¯¹ç”¨â€:â€ï¼Œåé¢å¿…é¡»æœ‰ç©ºæ ¼ã€‚YAMLæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸º.yamlæˆ–.yml</p>
<h3 id="5-2-playbookç®€ä»‹"><a href="#5-2-playbookç®€ä»‹" class="headerlink" title="5.2 playbookç®€ä»‹"></a>5.2 playbookç®€ä»‹</h3><p>playbookæ˜¯ansibleç®¡ç†é…ç½®ã€éƒ¨ç½²åº”ç”¨å’Œç¼–æ’çš„æ–‡ä»¶ï¼Œå¯ç”¨æ¥æè¿°åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„ç­–ç•¥æˆ–ä¸€ç»„ä»»åŠ¡ã€‚</p>
<p>ä¸€ä¸ªplaybookæ–‡ä»¶ç”±ä¸€ä¸ªæˆ–å¤šä¸ªplayç»„æˆï¼Œæ¯ä¸ªplayå®šä¹‰äº†åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„ä¸€ç³»åˆ—çš„taskï¼Œå…¶ä¸­æ¯ä¸ªtaskä¸€èˆ¬å°±æ˜¯è°ƒç”¨ä¸€ä¸ªansibleçš„æ¨¡å—ã€‚</p>
<p>playbookä½¿ç”¨YAMLè¯­è¨€ç¼–å†™ï¼Œæ–‡ä»¶åä»¥.yamlæˆ–.ymlç»“å°¾ã€‚æ­¤å¤–playbookå’Œæ¨¡æ¿æ–‡ä»¶ï¼ˆtemplateï¼‰è¿˜å¯ä½¿ç”¨jinja2è¯­æ³•è¯­æ³•å®ç°é«˜çº§åŠŸèƒ½ã€‚</p>
<p>5.2.1 playbookçš„åŸºæœ¬ç»„æˆ</p>
<ul>
<li>targetsï¼šæŒ‡å®šè¦æ‰§è¡Œplaybookçš„è¿œç¨‹ä¸»æœºç»„</li>
<li>variablesï¼šå®šä¹‰playbookè¿è¡Œæ—¶éœ€è¦ä½¿ç”¨çš„å˜é‡</li>
<li>tasksï¼šè¦æ‰§è¡Œçš„ä»»åŠ¡</li>
<li>handlersï¼šå¤„ç†å™¨ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹è¢«è§¦å‘çš„æ“ä½œ</li>
</ul>
<p>ç®€å•playbookç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># cat nginx.yml</div><div class="line">---</div><div class="line">- hosts: 10.249.6.43</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">    remote_conffile_path: /etc/nginx/sites-enabled/mirror.conf</div><div class="line">  tasks:</div><div class="line">  - name: install nginx</div><div class="line">    apt: name=nginx state=latest</div><div class="line">    when: ansible_distribution == &apos;Ubuntu&apos;</div><div class="line"></div><div class="line">  - name: configration file</div><div class="line">    tags: conf</div><div class="line">    copy: src=/root/mirror.conf dest=&#123;&#123;remote_conffile_path&#125;&#125;</div><div class="line">    notify: restart nginx</div><div class="line"></div><div class="line">  - name: start nginx</div><div class="line">    service: name=nginx enabled=yes state=started</div><div class="line"></div><div class="line">  handlers:</div><div class="line">  - name: restart nginx</div><div class="line">    service: name=nginx state=restarted</div><div class="line"># ansible-playbook  nginx.yml   // æ‰§è¡Œplaybook</div></pre></td></tr></table></figure>
<ul>
<li>hostsã€user</li>
</ul>
<p>hostsç”¨äºæŒ‡å®šè¦æ‰§è¡ŒæŒ‡å®šä»»åŠ¡çš„ä¸»æœºï¼Œå…¶å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç”±é€—å·åˆ†éš”ä¸»æœºç»„ï¼›useråˆ™ç”¨äºæŒ‡å®šè¿œç¨‹ä¸»æœºä¸Šçš„æ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·ï¼Œè¿˜èƒ½ä½¿ç”¨sudo</p>
<ul>
<li>task listã€action</li>
</ul>
<p>task listä¸­çš„å„ä»»åŠ¡æŒ‰æ¬¡åºé€ä¸ªåœ¨hostsä¸­æŒ‡å®šçš„æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼Œå³åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡åå†å¼€å§‹ç¬¬äºŒä¸ªã€‚å¦‚æœä¸­é€”å‘ç”Ÿé”™è¯¯ï¼Œæ‰€æœ‰å·²æ‰§è¡Œä»»åŠ¡éƒ½å°†å›æ»šï¼Œå› æ­¤ï¼Œåœ¨æ›´æ­£playbookåé‡æ–°æ‰§è¡Œä¸€æ¬¡å³å¯ã€‚</p>
<p> taskçš„ç›®çš„æ˜¯ä½¿ç”¨æŒ‡å®šçš„å‚æ•°æ‰§è¡Œæ¨¡å—ï¼Œè€Œåœ¨æ¨¡å—å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å˜é‡ã€‚æ¨¡å—æ‰§è¡Œæ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå…¶ç»“æœå‡ä¸€è‡´ã€‚</p>
<p> æ¯ä¸ªtaskéƒ½åº”è¯¥æœ‰å…¶nameï¼Œç”¨äºplaybookçš„æ‰§è¡Œç»“æœè¾“å‡ºï¼Œå»ºè®®å…¶å†…å®¹å°½å¯èƒ½æ¸…æ™°åœ°æè¿°ä»»åŠ¡æ‰§è¡Œæ­¥éª¤ã€‚å¦‚æœæœªæä¾›nameï¼Œåˆ™actionçš„ç»“æœå°†ç”¨äºè¾“å‡ºã€‚</p>
<p>å®šä¹‰taskçš„å¯ä»¥ä½¿ç”¨â€œaction: module optionsâ€æˆ–â€œmodule: optionsâ€çš„æ ¼å¼ï¼Œæ¨èä½¿ç”¨åè€…ä»¥å®ç°å‘åå…¼å®¹ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">tasks:</div><div class="line">- name: make sure apache is running</div><div class="line">  service: name=httpd state=running</div></pre></td></tr></table></figure>
<p>åœ¨ä¼—å¤šæ¨¡å—ä¸­ï¼Œåªæœ‰commandå’Œshellæ¨¡å—ä»…éœ€è¦ç»™å®šä¸€ä¸ªåˆ—è¡¨è€Œæ— éœ€ä½¿ç”¨â€œkey=valueâ€æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">tasks:</div><div class="line">- name: disable selinux</div><div class="line">  command: /sbin/setenforce 0</div></pre></td></tr></table></figure>
<p>shellæ¨¡å—æ‰§è¡Œå¤šæ¡å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">---</div><div class="line">- name: update zabbix agent conf</div><div class="line">  shell: |</div><div class="line">       ...</div></pre></td></tr></table></figure>
<p>å¦‚æœæ¨¡å—æ‰§è¡Œè¿”å›å€¼ä¸ä¸ºé›¶ï¼Œå³è¡¨ç¤ºæ‰§è¡Œå¤±è´¥ï¼Œä»»åŠ¡ä¼šç«‹å³ä¸­æ­¢ï¼Œåç»­ä»»åŠ¡ä¸å†æ‰§è¡Œã€‚å¯ä»¥ä½¿ç”¨ignore_errorsæ¥å¿½ç•¥é”™è¯¯ä¿¡æ¯ç¡®ä¿åç»­ä»»åŠ¡çš„æ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">tasks:</div><div class="line">    - name: run this command and ignore the result</div><div class="line">      shell: /usr/bin/somecommand</div><div class="line">      ignore_errors: yes</div></pre></td></tr></table></figure>
<ul>
<li>handlers</li>
</ul>
<p>å½“å…³æ³¨çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ä¸€å®šçš„æ“ä½œã€‚handleræ˜¯taskåˆ—è¡¨ï¼Œè¿™äº›taskä¸å‰è¿°çš„taskå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒã€‚</p>
<p>â€œnotifyâ€è¿™ä¸ªactionå¯ç”¨äºåœ¨æ¯ä¸ªplayçš„æœ€åè¢«è§¦å‘ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤šæ¬¡æœ‰æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œå–è€Œä»£ä¹‹ï¼Œä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®Œæˆåä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚åœ¨notifyä¸­åˆ—å‡ºçš„æ“ä½œç§°ä¸ºhandlerï¼Œä¹Ÿå³notifyä¸­è°ƒç”¨handlerä¸­å®šä¹‰çš„æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- name: template configuration file</div><div class="line">  template: src=/root/template.conf dest=/etc/template.conf</div><div class="line"></div><div class="line">notify:</div><div class="line">  - restart memcached</div><div class="line">  - restart apache</div><div class="line"></div><div class="line">handlers:</div><div class="line">  - name: restart memcached</div><div class="line">    service: name=memcached state=restarted</div><div class="line">  - name: restart apache</div><div class="line">    service: name=apache state=restarted</div></pre></td></tr></table></figure>
<ul>
<li>vars</li>
</ul>
<p>å˜é‡åä»…èƒ½ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸”åªèƒ½ä»¥å­—æ¯å¼€å¤´</p>
<ul>
<li>when</li>
</ul>
<p>æ¡ä»¶åˆ¤æ–­ï¼šå¦‚æœéœ€è¦æ ¹æ®å˜é‡ã€factsæˆ–æ­¤å‰ä»»åŠ¡çš„æ‰§è¡Œç»“æœæ¥åšä¸ºæŸtaskæ‰§è¡Œä¸å¦çš„å‰æï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°æ¡ä»¶åˆ¤æ–­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">when: ansible_distribution == &apos;Debian&apos; or ansible_distribution == &apos;Ubuntu&apos;</div><div class="line"></div><div class="line">when: ansible_distribution == &apos;CentOS&apos; or ansible_distribution == &apos;RedHat&apos; and ansible_distribution_version|int &gt;=6</div></pre></td></tr></table></figure>
<p>å¿½ç•¥æ­¤å‰æŸè¯­å¥çš„é”™è¯¯å¹¶åŸºäºå…¶ç»“æœï¼ˆfailedæˆ–è€…sucessï¼‰è¿è¡Œåé¢æŒ‡å®šçš„è¯­å¥:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">---</div><div class="line">- hosts: 10.249.6.64</div><div class="line">  user: root</div><div class="line">  tasks:</div><div class="line">    - name: false test</div><div class="line">      command: /bin/false</div><div class="line">      register: result</div><div class="line">      ignore_errors: yes</div><div class="line">    - name: when false  to do</div><div class="line">      command: touch /tmp/1.txt</div><div class="line">      when: result | failed</div><div class="line">    - name: when success to do</div><div class="line">      command: touch /tmp/2.txt</div><div class="line">      when: result | success</div><div class="line">    - name: when skip to do</div><div class="line">      command: touch /tmp/3.txt</div><div class="line">      when: result | skipped</div></pre></td></tr></table></figure>
<ul>
<li>item</li>
</ul>
<p>item è¿­ä»£ï¼šå½“æœ‰éœ€è¦é‡å¤æ€§æ‰§è¡Œçš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£æœºåˆ¶ã€‚å…¶ä½¿ç”¨æ ¼å¼ä¸ºå°†éœ€è¦è¿­ä»£çš„å†…å®¹å®šä¹‰ä¸ºitemå˜é‡å¼•ç”¨ï¼Œå¹¶é€šè¿‡with_itemsè¯­å¥æ¥æŒ‡æ˜è¿­ä»£çš„å…ƒç´ åˆ—è¡¨å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">- name: install base software</div><div class="line">  apt: pkg=&#123;&#123; item &#125;&#125; state=present force=yes</div><div class="line">  with_items:</div><div class="line">    - gcc</div><div class="line">    - g++</div><div class="line">    - mysql-client-5.5</div><div class="line">    - libmcrypt-dev</div><div class="line">    - libmysqlclient-dev</div><div class="line">    - libgmp10</div><div class="line">    - vim</div><div class="line">    - openssh-client</div><div class="line">    - ethtool</div><div class="line">  when: ansible_distribution == &apos;Debian&apos; or ansible_distribution == &apos;Ubuntu&apos;</div></pre></td></tr></table></figure>
<ul>
<li>tag</li>
</ul>
<p>tagæ ‡ç­¾ï¼šè®©ç”¨æˆ·é€‰æ‹©è¿è¡Œplaybookä¸­çš„æŸä¸ªæˆ–æŸäº›ä»»åŠ¡ã€‚è™½ç„¶ansibleå…·æœ‰å¹‚ç­‰æ€§ï¼Œä¼šè·³è¿‡æ²¡æœ‰å˜åŒ–çš„éƒ¨åˆ†ï¼Œæœ‰äº›ä»£ç ä¸ºæµ‹è¯•å…¶ç¡®å®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¼šè€—è´¹å¾ˆé•¿æ—¶é—´ã€‚æˆ‘ä»¬å°†playbookä¸­çš„æŒ‡å®šä»»åŠ¡æ‰“ä¸Šæ ‡ç­¾ï¼Œåœ¨è¿è¡Œplaybookæ—¶æŒ‡å®šæ ‡ç­¾åç§°ï¼Œè¿™æ ·å°±ä¸ç”¨è¿è¡Œå…¨éƒ¨ä»£ç äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">---</div><div class="line">- hosts: 10.249.6.43</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">    remote_conffile_path: /etc/nginx/sites-enabled/mirror.conf</div><div class="line">  tasks:</div><div class="line">  - name: install nginx</div><div class="line">    apt: name=nginx state=latest</div><div class="line">    when: ansible_distribution == &apos;Ubuntu&apos;</div><div class="line">      </div><div class="line">  - name: configration file</div><div class="line">    tags: conf</div><div class="line">    copy: src=/root/mirror.conf dest=&#123;&#123;remote_conffile_path&#125;&#125;</div><div class="line">    notify: restart nginx</div><div class="line"></div><div class="line">  - name: start nginx</div><div class="line">    service: name=nginx enabled=yes state=started</div><div class="line">  handlers:</div><div class="line">  - name: restart nginx</div><div class="line">    service: name=nginx state=restarted</div><div class="line"># ansible-playbook nginx.yml -t conf   // åªæ‰§è¡Œtagséƒ¨åˆ†</div></pre></td></tr></table></figure>
<h2 id="å…­ã€roles"><a href="#å…­ã€roles" class="headerlink" title="å…­ã€roles"></a>å…­ã€roles</h2><p>roles ç”¨äºå±‚æ¬¡æ€§ã€ç»“æ„åŒ–åœ°ç»„ç»‡playbookã€‚</p>
<p>rolesèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡å‹ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€tasksä»¥åŠhandlersç­‰ã€‚roleså°±æ˜¯é€šè¿‡åˆ†åˆ«å°†å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡å—åŠå¤„ç†å™¨æ”¾ç½®äºå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ã€‚è§’è‰²ä¸€èˆ¬ç”¨äºåŸºäºä¸»æœºæ„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç”¨äºæ„å»ºå®ˆæŠ¤è¿›ç¨‹ç­‰åœºæ™¯ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># ls</div><div class="line">deploy_hosts  deploy.yml  roles  run.sh</div><div class="line"># cat deploy_hosts   //ä¸»æœºæˆ–ä¸»æœºç»„åˆ—è¡¨</div><div class="line">[web]</div><div class="line">10.126.83.30</div><div class="line">10.126.93.83</div><div class="line">[db]</div><div class="line">10.126.87.150</div><div class="line">10.126.92.89</div><div class="line"># cat deploy.yml  // æ€»çš„playbook è°ƒç”¨roles</div><div class="line">---</div><div class="line">- name: init for os</div><div class="line">  hosts: web</div><div class="line">  user: root</div><div class="line">  gather_facts: True</div><div class="line">  roles:</div><div class="line">    - init</div><div class="line">    - raid</div><div class="line">- name: init for os</div><div class="line">  hosts: db</div><div class="line">  user: root</div><div class="line">  gather_facts: True</div><div class="line">  roles:</div><div class="line">    - init</div><div class="line">    - raid</div><div class="line">    - db_init</div><div class="line"></div><div class="line"># cat run.sh  // è¿è¡Œplaybookè„šæœ¬</div><div class="line">#!/bin/bash</div><div class="line">/usr/bin/ansible-playbook -i ./deploy_hosts deploy.yml</div><div class="line"># ls roles/</div><div class="line">db_init   init    raid</div></pre></td></tr></table></figure>
<p>åœ¨æ¯ä¸ªè§’è‰²å‘½åçš„ç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºfilesã€handlersã€metaã€tasksã€templateså’Œvarsç›®å½•ï¼Œç”¨ä¸åˆ°çš„ç›®å½•å¯ä»¥åˆ›å»ºä¸ºç©ºç›®å½•ï¼Œä¹Ÿå¯ä»¥ä¸åˆ›å»ºã€‚</p>
<p>roleå†…å„ç›®å½•ä¸­å¯ç”¨çš„æ–‡ä»¶:</p>
<ul>
<li><p>tasksç›®å½•ï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶å®šä¹‰äº†æ­¤è§’è‰²çš„ä»»åŠ¡åˆ—è¡¨ï¼›æ­¤æ–‡ä»¶å¯ä»¥ä½¿ç”¨includeåŒ…å«å…¶å®ƒçš„ä½äºæ­¤ç›®å½•ä¸­çš„taskæ–‡ä»¶</p>
</li>
<li><p>filesç›®å½•ï¼šå­˜æ”¾ç”±copyæˆ–scriptç­‰æ¨¡å—è°ƒç”¨çš„é™æ€æ–‡ä»¶</p>
</li>
<li><p>templatesç›®å½•ï¼štemplateæ¨¡å—ä¼šè‡ªåŠ¨åœ¨æ­¤ç›®å½•ä¸­å¯»æ‰¾Jinja2æ¨¡æ¿æ–‡ä»¶</p>
</li>
<li><p>handlersç›®å½•ï¼šæ­¤ç›®å½•ä¸­åº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ­¤è§’è‰²ç”¨åˆ°çš„å„handlerï¼›æ­¤æ–‡ä»¶å¯ä»¥ä½¿ç”¨includeåŒ…å«å…¶å®ƒçš„ä½äºæ­¤ç›®å½•ä¸­çš„handleræ–‡ä»¶</p>
</li>
<li><p>varsç›®å½•ï¼šè‡³å°‘æœ‰ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ­¤è§’è‰²ç”¨åˆ°çš„å˜é‡</p>
</li>
<li><p>metaç›®å½•ï¼šè‡³å°‘æœ‰ä¸€ä¸ªmain.ymlæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ­¤è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»ï¼›ansible 1.3åŠå…¶ä»¥åçš„ç‰ˆæœ¬æ‰æ”¯æŒ</p>
</li>
<li><p>defaultç›®å½•ï¼šä¸ºå½“å‰è§’è‰²è®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ï¼›åº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶</p>
</li>
</ul>
<h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="http://9124573.blog.51cto.com/9114573/1769887" target="_blank" rel="external">è½»é‡çº§è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ansible</a></p>
<p><a href="http://docs.ansible.com/ansible/intro.html" target="_blank" rel="external">ansible doc</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€ä½“ç³»ç»“æ„&quot;&gt;&lt;a href=&quot;#ä¸€ã€ä½“ç³»ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€ä½“ç³»ç»“æ„&quot;&gt;&lt;/a&gt;ä¸€ã€ä½“ç³»ç»“æ„&lt;/h2&gt;&lt;p&gt;ansibleæ˜¯ä¸€æ¬¾åŸºäºpythonå¼€å‘ï¼Œæ‰åˆäº†ä¼—å¤šè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·åŠŸèƒ½çš„è½»é‡çº§è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œç›®å‰å®ç°äº†é™¤ç³»ç»Ÿå®‰è£…ä»¥å¤–çš„æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ä»»åŠ¡æ‰§è¡ŒåŠæ‰¹é‡ç¨‹åºéƒ¨ç½²ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/25.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Inventoryï¼šä¸»æœºåº“ï¼Œå®šä¹‰å¯æ§åˆ¶çš„ä¸»æœº&lt;/li&gt;
&lt;li&gt;Modulesï¼šåŸºäºæ¨¡å—åŒ–è®¾è®¡ï¼Œé€šè¿‡æ¨¡å—æ¥å®ç°æ‰¹é‡éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;playbookï¼šå‰§æœ¬ï¼Œä½¿ç”¨YAMLç¼–å†™çš„å£°æ˜æ€§çš„é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;plugins: æ’ä»¶ï¼Œå®Œæˆæ—¥å¿—è®°å½•ã€é‚®ä»¶ç­‰åŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
