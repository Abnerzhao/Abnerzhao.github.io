<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Abnerzhao"><meta name="description" content="DevOps"><title>Abner</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/page/3/"><link rel="alternate" href="/atom.xml" title="Abner"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5832f612aff8681e2ee213a3b8d9548b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Abner</a><ul class="nav"><li class="nav-link"><a href="/" class="active">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><ul class="home"><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/02/28/minicom/" class="post-link">minicom的使用</a></h2><span class="post-time">Feb 28, 2016</span><div class="post-content"><h3 id="minicom的介绍"><a href="#minicom的介绍" class="headerlink" title="minicom的介绍"></a>minicom的介绍</h3><p>Linux下的Minicom的功能与Windows下的超级终端功能相似，<strong>可以通过串口控制外部的硬件设备</strong>，适于在linux通过超级终端对嵌入式设备行管理。</p>
<h3 id="minicom的安装配置和使用"><a href="#minicom的安装配置和使用" class="headerlink" title="minicom的安装配置和使用"></a>minicom的安装配置和使用</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><pre><code># apt-get install minicom
</code></pre><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p> 实际案例：交换机的consle转usb口连接到服务器，通过minicom对交换机进行配置</p>
<pre><code># lsusb   //查看USB的状态
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 002 Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse
Bus 002 Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub
Bus 002 Device 004: ID 0e0f:0008 VMware, Inc.
Bus 002 Device 005: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port

# dmesg |grep ttyUSB  //USB已经连接
[11991.918691] usb 2-2.2: pl2303 converter now attached to ttyUSB0

# minicom -s   //进行配置

+-----[configuration]------+
| Filenames and paths      |
| File transfer protocols  |
| Serial port setup        |
| Modem and dialing        |
| Screen and keyboard      |
| Save setup as dfl        |
| Save setup as..          |
| Exit                     |
| Exit from Minicom        |
+--------------------------+

#选择进入Serial port setup，按照之前查看的信息进行配置

+-----------------------------------------------------------------------+
| A -    Serial Device      : /dev/ttyUSB0                              |
| B - Lockfile Location     : /var/lock                                 |
| C -   Callin Program      :                                           |
| D -  Callout Program      :                                           |
| E -    Bps/Par/Bits       : 115200 8N1                                |
| F - Hardware Flow Control : Yes                                       |
| G - Software Flow Control : No                                        |
|                                                                       |
|    Change which setting?                                              |
+-----------------------------------------------------------------------+
    | Screen and keyboard      |
    | Save setup as dfl        |
    | Save setup as..          |
    | Exit                     |
    | Exit from Minicom        |
    +--------------------------+

#Enter退出，选择Save setup as dfl  保存为默认配置
</code></pre><p>  然后进入终端输入minicom 就能连接进入交换机配置</p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/02/25/ulimit/" class="post-link">ulimit小记</a></h2><span class="post-time">Feb 25, 2016</span><div class="post-content"><h3 id="ulimit简介"><a href="#ulimit简介" class="headerlink" title="ulimit简介"></a>ulimit简介</h3><p>ulimit 用于限制 shell 启动进程所占用的资源，支持以下各种类型的限制：所创建的内核文件的大小、进程数据块的大小、Shell 进程创建文件的大小、内存锁住的大小、常驻内存集的大小、打开文件描述符的数量、分配堆栈的最大大小、CPU 时间、单个用户的最大线程数、Shell 进程所能使用的最大虚拟内存。同时，它支持硬资源和软资源的限制。</p>
<p>作为临时限制，ulimit 可以作用于通过使用其命令登录的 shell 会话，在会话终止时便结束限制，并不影响于其他 shell 会话。而对于长期的固定限制，ulimit 命令语句又可以被添加到由登录 shell 读取的文件中，作用于特定的 shell 用户。</p>
<h3 id="ulimit的设置"><a href="#ulimit的设置" class="headerlink" title="ulimit的设置"></a>ulimit的设置</h3><pre><code>[root@Mr-zhao ~]# ulimit  -a    //查看当前配置文件ulimit全局系数
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 7389
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 10240
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 10240
cpu time               (seconds, -t) unlimited
max user processes              (-u) 10240
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited
</code></pre><p>对于线上环境的机器一般要对<code>open files</code>和<code>max user processes</code>进行修改。</p>
<h4 id="临时性的修改，只对当前shell生效。"><a href="#临时性的修改，只对当前shell生效。" class="headerlink" title="临时性的修改，只对当前shell生效。"></a>临时性的修改，只对当前shell生效。</h4><pre><code>ulimit  -n 65535
ulimit  -u 65535
</code></pre><h4 id="想要ulimit的设置永久性生效，需要修改-etc-security-limits-conf文件。"><a href="#想要ulimit的设置永久性生效，需要修改-etc-security-limits-conf文件。" class="headerlink" title="想要ulimit的设置永久性生效，需要修改/etc/security/limits.conf文件。"></a>想要ulimit的设置永久性生效，需要修改/etc/security/limits.conf文件。</h4><p>对于centos系统/etc/security/limits.d/90-nproc.conf文件的优先级高于/etc/security/limits.conf，所以对全局的设定需修改90-nproc.conf文件。对于单个用户的ulimit的设置并不受etc/security/limits.d/90-nproc.conf影响。</p>
<p>对于ubuntu系统，只需对/etc/security/limits.conf文件进行修改，ubuntu系统没有引入90-nproc.conf文件。但是ubuntux系统也会存在一个问题，就是对全局的设置其实对于root用户是没有效果的。所以ubuntu系统下的设置如下：</p>
<pre><code>root@Mr-zhao:~# grep -Ev &quot;^$|^#&quot; /etc/security/limits.conf
root - nofile 65535
root - nproc  65535
* - nofile 65535
* - nproc 65535
</code></pre><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-ulimit/" target="_blank" rel="external">通过 ulimit 改善系统性能</a><br><a href="http://ss64.com/bash/limits.conf.html" target="_blank" rel="external">limits.conf - configuration file</a></p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/02/24/network-command/" class="post-link">网络相关命令备忘</a></h2><span class="post-time">Feb 24, 2016</span><div class="post-content"><h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p>查看网络连接状态接口等信息。</p>
<h4 id="常用的命令选项："><a href="#常用的命令选项：" class="headerlink" title="常用的命令选项："></a>常用的命令选项：</h4><ul>
<li>a : 显示所有活动连接</li>
<li>n：以数字的形式显示（不使用主机名与服务名称，使用 IP 与 port number ）</li>
<li>p：显示进程名和PID</li>
<li>t：查看TCP协议相关信息</li>
<li>u：查看UDP协议相关信息</li>
<li>l：显示正在监听的进程</li>
</ul>
<p>netstat 的输出主要分为两大部分，分别是 TCP/IP 的网络接口部分，以及传统的 Unix socket 部分:</p>
<pre><code>[root@Mr-zhao ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name
tcp        0      0 0.0.0.0:8080                0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 10.48.156.8:60020           0.0.0.0:*                   LISTEN      12371/./gseAgent
tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      16594/sshd
tcp        0      0 :::22                       :::*                        LISTEN      16594/sshd
</code></pre><p><strong>字段含义：</strong></p>
<ul>
<li>proto  协议</li>
<li>Recv-Q 接受数据</li>
<li>Send-Q 发送数据</li>
<li>Local Address 本地地址和端口号</li>
<li>Foreign Addredd  外部地址和端口号</li>
<li>State 状态</li>
<li>PID/Program name  PID和进程名称</li>
</ul>
<p>在 port 22 的接口中，使用的 :::22 就是针对 IPv6 的显示，事实上他就等同于 0.0.0.0:22</p>
<p><strong> State状态（tcp三次握手）：</strong></p>
<ul>
<li>ESTABLISED：已建立连接的状态；</li>
<li>SYN_SENT：发出主动连接 (SYN 标志) 的连接封包；</li>
<li>SYN_RECV：接收到一个要求连接的主动连接封包；</li>
<li>FIN_WAIT1：该插槽服务(socket)已中断，该联机正在断线当中；</li>
<li>FIN_WAIT2：该连接已挂断，但正在等待对方主机响应断线确认的封包；</li>
<li>TIME_WAIT：该连接已挂断，但 socket 还在网络上等待结束；</li>
<li>LISTEN：通常用在服务的监听 port ！可使用『 -l 』参数查阅。</li>
</ul>
<p>查看目前已经启动的网络服务</p>
<pre><code>netstat -tupln
</code></pre><p>查看本机上所有的网络连接状态</p>
<pre><code>netstat -atunp
</code></pre><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>网络端口扫描命令</p>
<h4 id="常用的扫描类型："><a href="#常用的扫描类型：" class="headerlink" title="常用的扫描类型："></a>常用的扫描类型：</h4><ul>
<li>-sT : TCP连接扫描</li>
<li>-sU：UDP扫描</li>
<li>-sP：ICMP扫描</li>
<li>-A：扫描操作系统类型</li>
<li>-p: 扫描端口</li>
<li>-n ：禁止反向解析</li>
</ul>
<p>检测10.0.2.0/16 网段有那些存活的主机</p>
<pre><code>nmap -n -sP 10.0.2.0/16
</code></pre><p>检测ip地址 10.0.2.100-200 间的存活的主机</p>
<pre><code>nmap -n -sP 10.0.2.100-200
</code></pre><p>检测主机10.0.2.253的tcp连接情况</p>
<pre><code>nmap -n  -sT 10.0.2.253
</code></pre><p> 检测所用操作系统和主机的基本信息</p>
<pre><code>nmap -A  www.baidu.com
nmap -A  10.0.2.253
</code></pre><h3 id="tcpdump-命令行抓包工具"><a href="#tcpdump-命令行抓包工具" class="headerlink" title="tcpdump 命令行抓包工具"></a>tcpdump 命令行抓包工具</h3><p>用途：不间断监控网络通信数据包</p>
<h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><ul>
<li><p>-qnn 可简化输出</p>
</li>
<li><p>-v -vv -vvv  指显示信息的详细程度</p>
</li>
</ul>
<h4 id="过滤条件"><a href="#过滤条件" class="headerlink" title="过滤条件"></a>过滤条件</h4><p>过滤主机</p>
<ul>
<li><p>host 源ip或者目标ip</p>
</li>
<li><p>src host 源ip</p>
</li>
<li><p>dst host 目标ip</p>
</li>
<li><p>ether host 源或者目标MAC地址</p>
</li>
</ul>
<p>过滤端口</p>
<ul>
<li>port 源端口或者目标端口，同样可以搭配 src、dst</li>
</ul>
<p>过滤协议</p>
<ul>
<li>arp | tcp | udp | icmp</li>
</ul>
<p>过滤网络</p>
<ul>
<li>net 网络地址，同样可以搭配 src、dst</li>
</ul>
<h4 id="连接符"><a href="#连接符" class="headerlink" title="连接符"></a>连接符</h4><p>and（&amp;&amp;）、or （||）、not（!）</p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><pre><code>tcpdump -i eth0 -nn prot 22 and src host 192.168.1.6

tcpdump -i eth0 icmp and ether dst host 00:11:22:33:44:55

tcpdump -i eth0 tcp and dst net 172.18 and not dst host 192.168.1.100

tcpdump -i eth0 -nn -vv port 67 and udp

tcpdump -i eth0 -q -n arp         //监控eth0 的arp 协议 （ping）

tcpdump -i eth0 -v -n icmp and host 10.0.2.232

tcpdump -i eth0 -q -n arp -w /tmp/arp   //将结果输入到文本

tcpdump -r /tmp/arp   // 读出结果
</code></pre><h3 id="route"><a href="#route" class="headerlink" title="route"></a>route</h3><p>用于操作基于内核ip路由表，它的主要作用是创建一个静态路由让指定一个主机或者一个网络通过一个网络接口。</p>
<p><strong>直接在命令行下执行route命令来添加路由，不会永久保存，当网卡重启或者机器重启之后，该路由就失效了.</strong>可以在/etc/rc.local中添加route命令来保证该路由设置永久有效。</p>
<h4 id="参数注解"><a href="#参数注解" class="headerlink" title="参数注解"></a>参数注解</h4><pre><code>[root@localhost ~]# route -n  // -n 表示不解析名字,列出速度会比route 快
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.120.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.0.0     192.168.120.1   255.255.0.0     UG    0      0        0 eth0
10.0.0.0        192.168.120.1   255.0.0.0       UG    0      0        0 eth0
0.0.0.0         192.168.120.240 0.0.0.0         UG    0      0        0 eth0
</code></pre><ul>
<li><p>第一行表示主机所在网络的地址为192.168.120.0，若数据传送目标是在本局域网内通信，则可直接通过eth0转发数据包;</p>
</li>
<li><p>第四行表示数据传送目的是访问Internet，则由接口eth0，将数据包发送到网关192.168.120.240</p>
</li>
<li><p>其中Flags为路由标志，标记当前网络节点的状态。</p>
<p>  Flags标志说明：</p>
<ul>
<li><p>U Up表示此路由当前为启动状态</p>
</li>
<li><p>H Host，表示此网关为一主机</p>
</li>
<li><p>G Gateway，表示此网关为一路由器</p>
</li>
<li><p>R Reinstate Route，使用动态路由重新初始化的路由</p>
</li>
<li><p>D Dynamically,此路由是动态性地写入</p>
</li>
<li><p>M Modified，此路由是由路由守护程序或导向器动态修改</p>
</li>
<li><p>! 表示此路由当前为关闭状态</p>
</li>
</ul>
</li>
</ul>
<h4 id="添加和删除路由："><a href="#添加和删除路由：" class="headerlink" title="添加和删除路由："></a>添加和删除路由：</h4><pre><code>route add -net 10.10.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 10.20.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 10.249.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 192.168.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add default gw 10.10.3.252      //添加默认网关，默认网关只能有一条！多块网卡默认网关也只能有一个！

route del default gw 10.10.3.1   // 删除默认网关
</code></pre><p><strong>指定网卡</strong></p>
<pre><code>route add -net 10.249.0.0 netmask 255.255.0.0 gw 10.10.3.1 dev eth0
</code></pre></div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/02/23/cacit/" class="post-link">Cacti监控快速入门</a></h2><span class="post-time">Feb 23, 2016</span><div class="post-content"><h3 id="Cacti简介"><a href="#Cacti简介" class="headerlink" title="Cacti简介"></a>Cacti简介</h3><p>   Cacti 是一套基于 PHP,MySQL,SNMP 及 RRDTool 开发的网络流量监测图形分析工具,它本身并不是监控工具,通俗的讲只是个 php 的网站,但 Cacti 可以利用 snmp 服务获取数据, 然后用 rrdtool 储存和更新数据,当用户需要查看数据的时候用 rrdtool 生成图表呈现给用户。 因此,snmp 和 rrdtool 是 cacti 的关键。snmp 关系着数据的收集,rrdtool 关系着数据存储和图表的生成。除了基本的 snmp 流量跟系统资讯监控外,Cacti 也可外挂 Scripts 及加上 Templates 来作出各式各样的监控图。</p>
<h3 id="Cacti工作原理"><a href="#Cacti工作原理" class="headerlink" title="Cacti工作原理"></a>Cacti工作原理</h3><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/26" alt=""></p>
<h3 id="Cacti工作过程"><a href="#Cacti工作过程" class="headerlink" title="Cacti工作过程"></a>Cacti工作过程</h3><ul>
<li>Cacti 通过 net-snmp 定时采集被监控端的参数</li>
<li>Cacti 使用 RRDTool 采集到的数据储存到 rrd 文件中</li>
<li>当用户要查看某台设备的流量时,点击 Cacti 页面上的这个设备</li>
<li>Cacti 会去 Mysql 中调用该设备对应的 rrd 文件名称</li>
<li>Cacti 通过对找到的 rrd 文件,运行命令让 RRDTool 进行绘图</li>
</ul>
<p>Mysql 配合 PHP 程序存储一些变量数据并对变量数据进行调用,如:主机名、主机 ip、snmp 团体名、端口号、模板信息等变量,并不包括从设备采集过来的数据。</p>
<p>snmp 抓到数据存储在 rrdtool 生成的 rrd 文件中(在 cacti 根目录的 rra 文件夹下)。rrdtool 对数据的更新和存储就是对 rrd 文件的处理,rrd 文件是大小固定的档案文件,它能够存储 的数据笔数在创建时就已经定义。</p>
<h3 id="Cacti安装"><a href="#Cacti安装" class="headerlink" title="Cacti安装"></a>Cacti安装</h3><p>搭建LAMP架构</p>
<pre><code># yum install httpd mysql mysql-server mysql-devel net-snmp net-snmp-devel net-snmp-utils rrdtool  -y
# yum install php*  -y    //安装 php 的软件包
</code></pre><p>配置MySQL</p>
<pre><code># service mysqld restart
# mysqladmin -u root password 123      //为管理员设置密码
# mysqladmin -u root -p create cacti   //创建数据库名称为 cacti
Enter password:
# mysql -u root -p -e &quot;GRANT ALL ON cacti.* TO mike@localhost IDENTIFIED BY &apos;123&apos;&quot;
Enter password:
//创建用户mike、密码 123,并把所有权限给数据库 cacti。
//mysql -e 可以在 shell 中直接运行 mysql 中的指令。
</code></pre><p>Cacti软件包安装</p>
<p> <a href="http://www.cacti.net/download_cacti.php" target="_blank" rel="external">下载链接</a></p>
<p>安装配置</p>
<pre><code># tar xf cacti-0.8.8a.tar.gz -C /var/www/html/
# cd /var/www/html/
# mv cacti-0.8.8a/ cacti
# adduser cactiuser
# chown -R cactiuser cacti/rra cacti/log          
//注意这两个目录一定要让这个用户具备写入权限,否则后面无法产生图形和日志

# mysql -u cactiuser -p cacti &lt; cacti/cacti.sql
Enter password:
//导入 Cacti 自带的数据库,注意是输入 mysql 用户 mike 的密码

# vi cacti/include/config.php
/* make sure these values refect your actual                 database/host/user/password */

$database_type = &quot;mysql&quot;;
$database_default = &quot;cacti&quot;;
$database_hostname = &quot;localhost&quot;;
$database_username = &quot;mike&quot;;
$database_password = &quot;123&quot;;
$database_port = &quot;3306&quot;;
$database_ssl = false;
//一定要保证这些参数和在 mysql 里配置的一样
# crontab -e -u mike
*/5 * * * * php /var/www/html/cacti/poller.php &amp;&gt; /dev/null
//为 cactiuser 用户配置计划任务每 5 分钟运行 poller.php 轮询脚本
</code></pre><p>启动服务</p>
<pre><code># service httpd restart
# service mysqld restart
# service snmpd restart
# chkconfig httpd on
# chkconfig mysqld on
# chkconfig snmpd on
</code></pre><p>web界面安装</p>
<p>在浏览器里输入 <a href="http://172.16.252.1/cacti" target="_blank" rel="external">http://172.16.252.1/cacti</a> 进行安装</p>
<p>设置好snmp的版本，确保/var/www/html/cacti/rra目录下有rra文件，文件目录权限正确。</p>
<h3 id="WEB基本设置"><a href="#WEB基本设置" class="headerlink" title="WEB基本设置"></a>WEB基本设置</h3><p>采用 Spine 轮询器替换默认轮询引擎,默认使用cmd.php轮询引擎每隔 5 分钟进行轮询。</p>
<p>spine 是一个基于 C 语言的, 非常快速的轮询引擎,它是默认的 cmd.php 的可选替代,主要是为了加快 SNMP 轮询。Spine 可以提高采集数据的效率,适合监控服务器数量比较多的情况,而 cmd.php 适合小型、测试、学习所用。</p>
<p><a href="http://www.cacti.net/spine_download.php" target="_blank" rel="external">下载链接</a></p>
<p><a href="http://www.cacti.net/spine_install_rhlnx.php" target="_blank" rel="external">查看安装需求</a></p>
<pre><code># tar xf cacti-spine-0.8.8f.tar.gz
# cd cacti-spine-0.8.8f
# ./configure    //确保有编译环境gcc gcc-c++

# make &amp;&amp; make install
# cd /usr/local/spine/etc/
# cp spine.conf.dist  spine.conf

# vi spine.conf     //和MySQL中得参数配置一致
DB_Host         localhost
DB_Database     cacti
DB_User         zhao
DB_Pass         123
DB_Port         3306

# cd bin/
# ./spine
SPINE: Using spine config file [../etc/spine.conf]
SPINE: Version 0.8.8f starting
SPINE: Time: 4.9910 s, Threads: 1, Hosts: 2
</code></pre><p>  web设置</p>
<p> console–&gt;settings-Paths–&gt;Spine Poller File Path–&gt;/usr/local/spine/bin/spine–&gt;save</p>
<p> poller–&gt;Poller Type–&gt;spine</p>
<p>更多插件</p>
<p><a href="http://docs.cacti.net/plugins" target="_blank" rel="external">下载地址</a></p>
<p>只需将下载的插件解压到 cacti 的插件目录(/var/www/html/cacti/plugins)即可</p>
<ul>
<li>settings</li>
</ul>
<p>Cacti 的插件架构提供常见的基础插件服务,许多插件都需要安装 settings 插件才 能工作,提供邮件 API,根据触发条件生成邮件并发送邮件给管理员。此插件安装后即 可,无需额外操作。</p>
<ul>
<li>thold</li>
</ul>
<p>利用 Cacti 的图形生成警告、可设置警告的级别、警告的上下阶等,必须先安装settings 插件。</p>
<ul>
<li>monitor</li>
</ul>
<p>通过此插件,可查看 Cacti 管理下的所有主机状态,并有声音警告;显示状态(正常、正在重启中、报警、宕机)。</p>
<ul>
<li>clog</li>
</ul>
<p>在 cacti 的页面上新建一个链接,这个链接上就可以直接查看 cacti 的日志。</p>
<ul>
<li>realtime</li>
</ul>
<p>查看实时绘图</p>
<ul>
<li>Weathermap</li>
</ul>
<p>根据被监控的设备,画出网络拓扑图</p>
<h3 id="CactiEZ简介"><a href="#CactiEZ简介" class="headerlink" title="CactiEZ简介"></a>CactiEZ简介</h3><p>CactiEZ中文版是最简单有效的Cacti中文解决方案，整合Spine，RRDTool和美化字体。集成Thold，Monitor，Syslog，Weathermap，Realtime，Errorimage，Mobile，Aggregate以及Apache，Squid，F5，Nginx，MySQL等模板。支持多种硬盘控制器和阵列卡，基于CentOS6，启动速度更快，支持EXT4文件系统，原生rsyslog更稳定。全中文页面，中文图形，支持邮件报警，支持声音报警，安装方便使用简单。</p>
<ul>
<li>更多信息：<a href="http://cactiez.cactiusers.org/" target="_blank" rel="external">CactiEZ官网</a></li>
</ul>
<h3 id="CactiEZ安装"><a href="#CactiEZ安装" class="headerlink" title="CactiEZ安装"></a>CactiEZ安装</h3><ul>
<li><p>CactiEZ ISO文件下载</p>
<p>  32位操作系统：<a href="http://pan.baidu.com/s/1dD0iZCX" target="_blank" rel="external">CactiEZ-10.1-i386.iso</a></p>
<p>  64位操作系统：<a href="http://pan.baidu.com/s/1c0BGvQS" target="_blank" rel="external">CactiEZ-10.1-x86_64.iso</a></p>
</li>
<li><p>利用CactiEZ ISO 引导如同光盘安装操作系统一样，安装完成重启后CactiEZ就安装完成</p>
<p>这种方法的缺点：CactiEZ是一个完整的操作系统，需要专门一台机器才能安装使用</p>
</li>
<li><p>通过拷贝ISO文件在已有linux操作系统上搭建</p>
</li>
</ul>
<p>快速自动安装脚本：<a href="https://github.com/Abnerzhao/CactiEZ/tree/master/doc" target="_blank" rel="external">install.sh</a></p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/15/mysql-duplicate/" class="post-link">MySQL主从复制备忘</a></h2><span class="post-time">Jan 15, 2016</span><div class="post-content"><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li><p>Master:10.249.17.38</p>
</li>
<li><p>Slave:10.249.17.45</p>
</li>
</ul>
<h3 id="主从复制的原理"><a href="#主从复制的原理" class="headerlink" title="主从复制的原理"></a>主从复制的原理</h3><ul>
<li>主从复制的步骤</li>
</ul>
<p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/94D51A80-A0DB-4189-8F30-673260AC6FCC.png" alt=""></p>
<p>1.master将改变记录到二进制日志(binary log)</p>
<p>2.slave将master的binary log events(二进制日志事件)拷贝到它的中继日志(relay log)</p>
<p>3.slave重做中继日志中的事件，将改变反映它自己的数据。</p>
<h3 id="主从复制类型"><a href="#主从复制类型" class="headerlink" title="主从复制类型"></a>主从复制类型</h3><ul>
<li>基于语句的复制：</li>
</ul>
<p>在主服务器上执行的SQL语句，在从服务器上执行同样的语句。MySQL默认采用基于语句的复制，效率比较高。一旦发现没法精确复制时，会自动选着基于行的复制。</p>
<ul>
<li>基于行的复制：</li>
</ul>
<p>把改变的内容复制过去，而不是把命令在从服务器上执行一遍. 从mysql5.0开始支持。</p>
<ul>
<li>混合类型的复制:</li>
</ul>
<p>默认采用基于语句的复制，一旦发现基于语句的无法精确的复制时，就会采用基于行的复制。</p>
<h3 id="配置Master和Slave"><a href="#配置Master和Slave" class="headerlink" title="配置Master和Slave"></a>配置Master和Slave</h3><h4 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h4><pre><code>mysqladmin -u root -p password 123  // 修改密码
mysql&gt; grant replication slave,replication client on *.* to  zzf@10.249.17.45 identified by &quot;zzf&quot;;  //建立内部复制用户

编辑/etc/my.cnf 文件
server_id=1
log-bin=mysql-bin

重启服务
</code></pre><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/BAC-9068-D8174D803F18.png" alt=""></p>
<h4 id="Slave"><a href="#Slave" class="headerlink" title="Slave"></a>Slave</h4><pre><code>mysqladmin -u root -p password 123  // 修改密码
编辑/etc/my.cnf 文件
server_id=2
log-bin=mysql-bin
log_slave_updates=1

mysql&gt; change master to master_host=&apos;10.249.17.38&apos;,master_user=&apos;zzf&apos;,master_password=&apos;zzf&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=106;
mysql&gt; start slave;
</code></pre><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/F2D3964D-8081-4F27-ACFF-39ADF603CCDB.png" alt=""></p>
<p>Slave_IO_Running: Yes</p>
<p>Slave_SQL_Running: Yes</p>
<h3 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h3><h4 id="Master-1"><a href="#Master-1" class="headerlink" title="Master"></a>Master</h4><pre><code>mysql&gt;
mysql&gt; create database zzf;
Query OK, 1 row affected (0.01 sec)
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| test               |
| zzf                |
+--------------------+
4 rows in set (0.00 sec)
</code></pre><h4 id="Slave-1"><a href="#Slave-1" class="headerlink" title="Slave"></a>Slave</h4><pre><code>mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| test               |
| zzf                |
+--------------------+
4 rows in set (0.00 sec)
</code></pre><p>已经同步成功</p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/12/sysstart/" class="post-link">开机自启动脚本设置</a></h2><span class="post-time">Jan 12, 2016</span><div class="post-content"><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><pre><code>touch   /etc/rc3.d/S99init_sys
chmod 777 /etc/rc3.d/S99init_sys
</code></pre><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p>使用update-rc.d命令添加开机自启动脚本的基本步骤：</p>
<p>1./etc/init.d 中加入一个 script</p>
<p>2.在 /etc/rc*.d 中,K 开头是 kill , S 开头是 start , 数字顺序代表启动的顺序，在 /etc/init.d 中建立一个叫作 sys_init 的 script , 执行：</p>
<pre><code>update-rc.d sys_init defaults    #即可实现开机自启动
</code></pre><p>  <strong>update-rc.d命令</strong></p>
<p>  设置启动和关闭顺序、指定运行的系统级别</p>
<pre><code>update-rc.d sys_init defaults

update-rc.d  sys_init  defaults 90  //设置启动顺序

update-rc.d  sys_init  defaults 20 80
//前面的20是start时的运行顺序级别，80为kill时的级别

update-rc.d  sys_init  defaults start 20 2 3 4 5 . stop 80 0 1 6 .
//设定启动运行级别2,3和4的优先级为20，运行级别5的优先级为30。停止运行级别0,1和6的优先级为80
</code></pre></div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/10/ubuntu_deb/" class="post-link">ubuntu源简介</a></h2><span class="post-time">Jan 10, 2016</span><div class="post-content"><h3 id="Ubuntu发行版本代号"><a href="#Ubuntu发行版本代号" class="headerlink" title="Ubuntu发行版本代号"></a>Ubuntu发行版本代号</h3><pre><code>版本         发布日期                代号                 含义
12.04 LTS   2012年4月发布         Precise Pangolin       精确的穿山甲
14.04 LTS   2014年4月发布         Trusty Tahr            可靠的山羊
</code></pre><h3 id="Ubuntu源文件"><a href="#Ubuntu源文件" class="headerlink" title="Ubuntu源文件"></a>Ubuntu源文件</h3><pre><code>$ cat /etc/apt/sources.list
deb http://mirrors.corp.test.com/ubuntu/ precise main restricted universe multiverse
deb http://mirrors.corp.test.com/ubuntu/ precise-updates main restricted universe multiverse
deb http://mirrors.corp.test.com/ubuntu/ precise-security main restricted universe multiverse
deb http://mirrors.corp.test.com/ubuntu/ precise-proposed main restricted universe multiverse
deb http://mirrors.corp.test.com/ubuntu/ precise-backports main restricted universe multiverse
</code></pre><h4 id="源文件各部分含义"><a href="#源文件各部分含义" class="headerlink" title="源文件各部分含义"></a>源文件各部分含义</h4><ul>
<li>deb,deb-src分别表示软件包，源代码包</li>
<li>precise 表示当前ubuntu对应的发型版本</li>
<li>security,backports[补丁],updates[更新]，proposed[推荐的，提议的]等代表dists[存储位置]的子目录，用以区分各种类型的软件包和源代码包,apt-get update用于同步索引，apt-get upgrate用于安装新文件</li>
<li>main,restricted,universe,multiverse为该版本的软件包，每一类中有多种类型软件包。</li>
</ul>
<h3 id="Ubuntu源目录结构"><a href="#Ubuntu源目录结构" class="headerlink" title="Ubuntu源目录结构"></a>Ubuntu源目录结构</h3><ul>
<li><p><strong><code>dists/</code></strong>   发行版，便于理解[各个版本]</p>
</li>
<li><p><strong><code>indices/</code></strong> 维护人员文件和重载文件</p>
</li>
<li><p><strong><code>pool/</code></strong>   软件包的新的物理地址</p>
</li>
<li><p><strong><code>project/</code></strong>  大部分为开发人员的资源</p>
</li>
</ul>
<h4 id="目录结构介绍"><a href="#目录结构介绍" class="headerlink" title="目录结构介绍"></a>目录结构介绍</h4><p><strong><code>dists/</code>   发行版，便于理解[各个版本]</strong></p>
<p>dists目录说明了ubuntu各个版本的5个附加仓库，每个附加仓库表示该版本软件包的 一种类型，每种类型有四种来源的安装包：</p>
<pre><code>precise/

precise-backports/

precise-proposed/

precise-security/

precise-updates/
</code></pre><p> 发行版软件包的每种类型都对应一个如下内容的目录：</p>
<pre><code>Contents-amd64.gz
Contents-i386.gz
main/
multiverse/
Release
Release.gpg
restricted/
universe/
</code></pre><p>在sources.list中设置到main，mulitiverse这一层即可，其中每个该种目录对应文件如下：</p>
<pre><code>.
├── binary-amd64
│   ├── Packages
│   ├── Packages.bz2
│   ├── Packages.gz
│   └── Release
├── binary-i386
│   ├── Packages
│   ├── Packages.bz2
│   ├── Packages.gz
│   └── Release
└── debian-installer
├── binary-amd64
│   ├── Packages
│   ├── Packages.bz2
│   └── Packages.gz
└── binary-i386
    ├── Packages
    ├── Packages.bz2
    └── Packages.gz
</code></pre><p> 在每一个体系中都有一个安装包目录和源代码包目录，其中内容为一个压缩文件，该文件描述了这种类型体系结构的所有安装包的详细信息，包括在/pool目录下的存储位置等等，十分详细，格式如下：</p>
<pre><code>Package: umbrello-kde4
Priority: optionalls
Section: devel
Installed-Size: 4468
Maintainer: Ubuntu MOTU Developers
Original-Maintainer: Debian Qt/KDE Maintainers
Architecture: i386
Source: kdesdk-kde4
Version: 4:4.0.5-0ubuntu1~hardy1
Depends: kde-icons-oxygen, kdebase-runtime, kdebase-runtime-data, kdelibs5 (&gt;= 4:4.0.5-0ubuntu1~hardy2), libc6 (&gt;= 2.4), libqt4-core (&gt;= 4.3.4), libqt4-gui (&gt;= 4.3.4), libqt4-qt3support (&gt;= 4.3.4), libstdc++6 (&gt;= 4.1.1-21), libxml2 (&gt;= 2.6.27), libxslt1.1 (&gt;= 1.1.20)
Suggests: khelpcenter-kde4
Filename: pool/main/k/kdesdk-kde4/umbrello-kde4_4.0.5-0ubuntu1~hardy1_i386.deb
Size: 1782804
MD5sum: f751b63e2c42e3abc0bc714f228cc966 SHA1: 728b30a325f44a8da9e5b53792f475a3f98da048 SHA256: 1e3b0e324a3188ee6605c6d138ecd22d45b15516aabb35d69f17ad27c4e5d6db
Description: UML modelling tool and code generator for KDE 4 Umbrello UML Modeller is a Unified Modelling Language editor for KDE 4. It can create diagrams of software and other systems in the industry-standard UML format, and can also generate code from UML diagrams in a variety of programming languages.
This package is part of KDE4, and a component of the kdesdk-kde4 module.
See the &apos;kde4&apos; and &apos;kdesdk-kde4&apos; packages for more information.
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Origin: Ubuntu
</code></pre><p> <strong><code>pool/</code> 软件包的新的物理地址</strong></p>
<p>pool目录用于实际存储所有新的软件包，索引通过dists分类目录索引，其下内容为：</p>
<pre><code>main/
multiverse/
restricted/
universe/
</code></pre><p>各项定义如下：</p>
<ul>
<li>main/：“main”组件包括了自由软件、可以被自由发布的软件和被Ubuntu团队完全支持的软件。其中包括了大多数流行的和稳定的开源软件，当您安装Ubuntu时默认安装的就是这些软件。</li>
</ul>
<ul>
<li><p>restricted/：“restricted”组件是专供普遍用途，而且没有自由软件版权，但依然被Ubuntu团队支持的软件。请注意，因为不能直接修改软件，因而我们可能不能提供完全的技术支持，即便如此，我们还能向实际作者反馈Bug报告。</p>
</li>
<li><p>universe/：“universe”组件是整个自由、开源Linux世界的缩影。在“universe”组件中，你可以找到大多数开源软件，以及在开源版权下的软件，所有这些都是在公共源的基础上建立的。这些软件都是使用“main”中的组件编写的，它们能与“main”组件相安无事地共同运行，但它们没有安全升级的保障。“universe”组件包含了数以千计的软件。虽然是公共的，用户必须明白它们与稳定的Ubuntu核心的软件的差异和不稳定。</p>
</li>
<li><p>multiverse/：multiverse”组件包含了“不自由”的软件，这意味着这些软件不满足 Ubuntu相对于“main”组件的各种版权政策。当您使用这些软件时，如何调整各种权力以及遵重版权所有者的问题，就完全依靠您自己把握了。这些软件不被我们支持，而且通常不能被修改和更新，您将自己承担任何风险</p>
</li>
</ul>
<p><strong><code>indices/</code>  维护人员文件和重载文件</strong></p>
<p>indices（index复数）表示索引目录</p>
<p><strong><code>project/</code>  大部分为开发人员的资源</strong></p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/09/Create-A-Local-Debian-Ubuntu-Mirror-With-apt-mirror/" class="post-link">Create A Local Debian/Ubuntu Mirror With apt-mirror</a></h2><span class="post-time">Jan 9, 2016</span><div class="post-content"><h3 id="Install-and-Configure-apt-mirror"><a href="#Install-and-Configure-apt-mirror" class="headerlink" title="Install and Configure apt-mirror"></a>Install and Configure apt-mirror</h3><p>Install apt-mirror</p>
<pre><code>$ sudo apt-get install apt-mirror
</code></pre><p>Configure apt-mirror</p>
<p>编辑配置文件/etc/apt/mirror.list，以ubuntu 14.04 为例：</p>
<pre><code>############# config ##################

#

set base_path      /var/spool/apt-mirror

#

set mirror_path    /data/mirror

set skel_path   $base_path/skel

set var_path   $base_path/var

set cleanscript  $var_path/clean.sh      #这个脚本会记录每次同步后那些需要删除的文件

# set defaultarch

# set postmirror_script $var_path/postmirror.sh

# set run_postmirror 0

set nthreads20#用20个线程去wget镜像

set _tilde 0

#

############# end config ##############

deb http://cn.archive.ubuntu.com/ubuntu trusty main restricted universe multiverse

deb http://cn.archive.ubuntu.com/ubuntu trusty-security main restricted universe multiverse

deb http://cn.archive.ubuntu.com/ubuntu trusty-updates main restricted universe multiverse

deb http://cn.archive.ubuntu.com/ubuntu trusty-proposed main restricted universe multiverse

deb http://cn.archive.ubuntu.com/ubuntu trusty-backports main restricted universe multiverse

deb-i386 http://cn.archive.ubuntu.com/ubuntu trusty main restricted universe multiverse

deb-i386 http://cn.archive.ubuntu.com/ubuntu trusty-security main restricted universe multiverse

deb-i386 http://cn.archive.ubuntu.com/ubuntu trusty-updates main restricted universe multiverse

deb-i386 http://cn.archive.ubuntu.com/ubuntu trusty-proposed main restricted universe multiverse

deb-i386 http://cn.archive.ubuntu.com/ubun trustytu-backports main restricted universe multiverse

# 如果这个源是要用来做pxe启动的话需要添加(因为默认没有将这几个文件同步过来)

deb http://cn.archive.ubuntu.com/ubuntu trusty main/debian-installer restricted/debian-installer universe/debian-installer multiverse/debian-installer

deb-i386 ttp://cn.archive.ubuntu.com/ubuntu trusty main/debian-installer restricted/debian-installer universe/debian-installer multiverse/debian-installer
</code></pre><p>镜像官方仓库所有软件</p>
<pre><code>$ sudo apt-mirror          
//apt-mirror成功后会执行/var/spool/apt-mirror/var/clean.sh完成同步后的清理工作
</code></pre><h3 id="源的升级与更新"><a href="#源的升级与更新" class="headerlink" title="源的升级与更新"></a>源的升级与更新</h3><p>日常升级</p>
<pre><code>$ sudo apt-mirror
</code></pre><p>计划任务自动更新</p>
<pre><code>0 4 * * * /usr/bin/apt-mirror &gt;&gt; /var/spool/apt-mirror/var/cron.log
</code></pre><h3 id="使用nginx搭建本地镜像源"><a href="#使用nginx搭建本地镜像源" class="headerlink" title="使用nginx搭建本地镜像源"></a>使用nginx搭建本地镜像源</h3><h4 id="nginx-安装配置"><a href="#nginx-安装配置" class="headerlink" title="nginx 安装配置"></a>nginx 安装配置</h4><p>nginx 安装</p>
<p>参考：<a href="http://nginx.org/en/docs/install.html" target="_blank" rel="external">官方文档</a></p>
<p>nginx 基本配置</p>
<p>编辑配置文件 /usr/local/nginx/conf/sites-enabled/mirror.conf</p>
<pre><code>server {
listen       80;
server_name  _;
root         /data/mirror/web;
autoindex    on;
}
</code></pre><p>在<code>/data/mirror/web</code>目录做一个镜像目录的软连接</p>
<pre><code>$ ln -s /data/mirror/archive.ubuntu.com/ubuntu/ /data/mirror/web/ubuntu
</code></pre><p>启动nginx服务</p>
<pre><code>$ sudo /usr/local/nginx/sbin/nginx -t
$ sudo /usr/local/nginx/sbin/nginx
</code></pre><p>本地测试</p>
<p>在浏览器输入搭建nginx机器IP，也可以配置域名访问</p>
<p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/26720CDE-B91E-40F3-8D46-CAC92FAE90F2.png" alt=""></p>
<h3 id="客户端使用测试"><a href="#客户端使用测试" class="headerlink" title="客户端使用测试"></a>客户端使用测试</h3><p>编辑配置文件 /etc/apt/sources.list 或在/etc/apt/sources.list.d/ 目录下新建文件，并在文件最前面写入如下字段：</p>
<pre><code>deb http://10.249.17.26/ubuntu precise main universe
</code></pre><p>使用</p>
<pre><code>$ apt-get update
$ apt-get install (packagename)
</code></pre></div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/08/make_deb/" class="post-link">Make .deb Package</a></h2><span class="post-time">Jan 8, 2016</span><div class="post-content"><h3 id="deb包初探"><a href="#deb包初探" class="headerlink" title="deb包初探"></a>deb包初探</h3><h4 id="deb包结构包含两部分："><a href="#deb包结构包含两部分：" class="headerlink" title="deb包结构包含两部分："></a>deb包结构包含两部分：</h4><ul>
<li>控制信息（DEBIAN目录）</li>
<li>安装内容（etc、usr等目录）</li>
</ul>
<h4 id="DEBAIN目录一般包含以下文件："><a href="#DEBAIN目录一般包含以下文件：" class="headerlink" title="DEBAIN目录一般包含以下文件："></a>DEBAIN目录一般包含以下文件：</h4><ul>
<li>control</li>
</ul>
<p>主要描述软件包的名称(Package)，版本(Version)以及描述(Description)等，是deb包必须具备的描述性文件，以便于软件的安装管理和索引。同时为了能将软件包进行充分的管理</p>
<ul>
<li>postinst(postinstallation)</li>
</ul>
<p>该脚本的主要任务是完成安装包时的配置工作。许多“postinst”脚本负责执行有关命令为新安装或升级的软件重启服务</p>
<ul>
<li>postrm(postremove)</li>
</ul>
<p>软件卸载后需要执行的脚本，主要负责修改软件包链接文件、或删除创建的文件</p>
<ul>
<li>preinst(preinstallation)</li>
</ul>
<p>在Deb包文件解包之前，将会运行该脚本。<br>许多“preinst”脚本的任务是停止作用于待升级软件包的服务，直到软件包安装或升级完成</p>
<ul>
<li>prerm(preremove)</li>
</ul>
<p>软件卸载前需要执行的脚本，主要负责停止与软件包相关的daemon服务</p>
<ul>
<li>copyright（版权）</li>
<li>changlog（修订记录）</li>
<li>conffiles</li>
</ul>
<h4 id="一个control文件实例："><a href="#一个control文件实例：" class="headerlink" title="一个control文件实例："></a>一个control文件实例：</h4><pre><code>Package: dante
Version: 1.3.2-1
Architecture: amd64
Maintainer: mr-zhao &lt;zhifanzhao@163.com&gt;
Installed-Size: 1438
Depends: libc6 (&gt;&gt; 2.15), libc6 (&lt;&lt; 2.16), libgssapi-krb5-2 (&gt;= 1.10+dfsg~)
Section: unknown  #声明软件类别
Priority: extra   #软件对系统的重要程度（required、standar、option、extra）
Homepage: &lt;insert the upstream URL, if relevant&gt;
Description: &lt;insert up to 60 chars description&gt;
&lt;insert long description, indented with spaces&gt;
</code></pre><h3 id="deb制作"><a href="#deb制作" class="headerlink" title="deb制作"></a>deb制作</h3><p>deb包的制作有三种情况：</p>
<ul>
<li>源码包制作deb包</li>
<li>deb-src包制作deb包</li>
<li>修改现有的deb包制作新的deb包</li>
</ul>
<h4 id="源码包制作deb包"><a href="#源码包制作deb包" class="headerlink" title="源码包制作deb包"></a>源码包制作deb包</h4><p>源码包制作deb包一般常用有两种方法：</p>
<ul>
<li>checkinstall</li>
</ul>
<p>checkinstall不仅可以生成deb包，还可以生成rpm包，使用简单，但是不灵活，功能粗糙</p>
<ul>
<li>dpkg工具 dh-make</li>
</ul>
<p>dpkg是最基本的制作deb包的方法</p>
<p>(1) 利用checkinstall打包</p>
<p>Step 1：安装依赖关系软件包</p>
<pre><code>$ sudo apt-get install build-essential automake autoconf libtool pkg-config libcurl4-openssl-dev intltool libxml2-dev libgtk2.0-dev libnotify-dev libglib2.0-dev libevent-dev checkinstall
</code></pre><p>Step 2: 制作DEB包</p>
<pre><code>$ wget http://www.inet.no/dante/files/dante-1.3.2.tar.gz
$ tar zxvf dante-1.3.2.tar.gz
$ cd dante-1.3.2
$ ./configure
$ make
$ sudo checkinstall      //以一种交互的方式进行打包，过程会显示软件包基本信息，可直接修改

当前目录下就生成 dante_1.3.2-1_amd64.deb
</code></pre><p>Step 3: 测试软件包是否可用</p>
<pre><code>$dpkg -i dante_1.3.2-1_amd64.deb //安装
$dpkg -r dante_1.3.2-1_amd64.deb //卸载
</code></pre><p>(2) 利用dpkg打包</p>
<p>Step 1：安装依赖关系软件包</p>
<pre><code>$ sudo apt-get install dh-make make fakeroot
</code></pre><p>Step 2: 制作DEB包</p>
<pre><code>$ wget http://www.inet.no/dante/files/dante-1.3.2.tar.gz
$ tar zxvf dante-1.3.2.tar.gz
$ cd dante-1.3.2
$ dh_make -s -e zhifanzhao@163.com -f ../dante-1.3.2.tar.gz  //会在当前目录下生成debian目录，可自定义里面的控制信息
$ dpkg-buildpackage -rfakeroot

上级目录就会有 dante_1.3.2-1_amd64.deb
</code></pre><p>Step 3: 测试软件包是否可用</p>
<pre><code>$ dpkg -i dante_1.3.2-1_amd64.deb //安装
$ dpkg -r dante_1.3.2-1_amd64.deb //卸载
</code></pre><h4 id="deb-src制作deb包"><a href="#deb-src制作deb包" class="headerlink" title="deb-src制作deb包"></a>deb-src制作deb包</h4><p>这种方式往往是需要为原有的包进行小幅度优化，简单介绍一下。</p>
<p>Step 1: 获取source包</p>
<pre><code>$ apt-get source &lt;packagename&gt;
</code></pre><p>Step 2: 修改代码和编译信息</p>
<p>Step 3: 准备编译环境和依赖包</p>
<pre><code>$ apt-get install dpkg-buildpackage
$ apt-get build-dep &lt;packagename&gt;
</code></pre><p>Step 4: 重新打包</p>
<pre><code>$ dpkg-buildpackage -uc -d

//完成后上一级目录将会出现一个或多个deb文件 (未测试)
</code></pre><h4 id="修改现有的deb包制作新的deb包"><a href="#修改现有的deb包制作新的deb包" class="headerlink" title="修改现有的deb包制作新的deb包"></a>修改现有的deb包制作新的deb包</h4><pre><code>$ dpkg -X dante_1.3.2-1_amd64.deb  test //解包安装内容
$ cd test
$ dpkg -e ../dante_1.3.2-1_amd64.deb  //解包控制信息，生成DEBAIN目录
$ ls test
DEBIAN  usr
自定义修改内容然后重新打包（一般是对配置文件进行修改，对功能进行调优等）
$ cd ..
$ dpkg -b test test_new.deb
</code></pre><p><strong>Debain库非常丰富，一般都很少用源码包来制作deb包，通过对已有的deb包进行修改即可满足日常需求</strong></p>
</div></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/01/01/command/" class="post-link">运维必备之Linux命令概览</a></h2><span class="post-time">Jan 1, 2016</span><div class="post-content"><h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/C3EB9F70-7F51-4B46-8B14-825CD9B8C11B.png" alt=""></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/BF852F66-2D8E-42D8-A4EB-2826A98C354C.png" alt=""></p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/429014F3-442B-4115-A97D-32D62E6BEE7F.png" alt=""></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://www.brendangregg.com/linuxperf.html" target="_blank" rel="external">Linux Performance</a></p>
</div></article></li></ul><div class="paginator"><a href="/page/2/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/page/4/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div></section><footer><div class="social"><a href="https://github.com/Abnerzhao" title="github" class="iconfont icon-github"></a><a href="mailto:opsabnerzhao@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://weibo.com/2863179107/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="weibo" class="iconfont icon-weibo"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2015-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Abnerzhao</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>