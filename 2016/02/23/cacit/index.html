<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Abnerzhao"><meta name="description" content="Cacti简介Cacti是一套基于PHP,MySQL,SNMP及RRDTool开发的网络流量监测图形分析工具,它本身并不是监控工具,通俗的讲只是个php的网站,但Cacti可以利用snmp服务获取数据,然后用rrdtool储存和更新数据,当用户需"><meta name="keywords" content="Cacti"><title>Cacti监控快速入门 · Abner</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2016/02/23/cacit/"><link rel="alternate" href="/atom.xml" title="Abner"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5832f612aff8681e2ee213a3b8d9548b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Abner</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Cacti监控快速入门</h1><span class="post-time">Feb 23, 2016</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacti简介"><span class="toc-text">Cacti简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacti工作原理"><span class="toc-text">Cacti工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacti工作过程"><span class="toc-text">Cacti工作过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacti安装"><span class="toc-text">Cacti安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB基本设置"><span class="toc-text">WEB基本设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CactiEZ简介"><span class="toc-text">CactiEZ简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CactiEZ安装"><span class="toc-text">CactiEZ安装</span></a></li></ol></div><div class="post-content"><h3 id="Cacti简介"><a href="#Cacti简介" class="headerlink" title="Cacti简介"></a>Cacti简介</h3><p>   Cacti 是一套基于 PHP,MySQL,SNMP 及 RRDTool 开发的网络流量监测图形分析工具,它本身并不是监控工具,通俗的讲只是个 php 的网站,但 Cacti 可以利用 snmp 服务获取数据, 然后用 rrdtool 储存和更新数据,当用户需要查看数据的时候用 rrdtool 生成图表呈现给用户。 因此,snmp 和 rrdtool 是 cacti 的关键。snmp 关系着数据的收集,rrdtool 关系着数据存储和图表的生成。除了基本的 snmp 流量跟系统资讯监控外,Cacti 也可外挂 Scripts 及加上 Templates 来作出各式各样的监控图。</p>
<h3 id="Cacti工作原理"><a href="#Cacti工作原理" class="headerlink" title="Cacti工作原理"></a>Cacti工作原理</h3><p><img src="http://7vzmp5.com1.z0.glb.clouddn.com/26" alt=""></p>
<h3 id="Cacti工作过程"><a href="#Cacti工作过程" class="headerlink" title="Cacti工作过程"></a>Cacti工作过程</h3><ul>
<li>Cacti 通过 net-snmp 定时采集被监控端的参数</li>
<li>Cacti 使用 RRDTool 采集到的数据储存到 rrd 文件中</li>
<li>当用户要查看某台设备的流量时,点击 Cacti 页面上的这个设备</li>
<li>Cacti 会去 Mysql 中调用该设备对应的 rrd 文件名称</li>
<li>Cacti 通过对找到的 rrd 文件,运行命令让 RRDTool 进行绘图</li>
</ul>
<p>Mysql 配合 PHP 程序存储一些变量数据并对变量数据进行调用,如:主机名、主机 ip、snmp 团体名、端口号、模板信息等变量,并不包括从设备采集过来的数据。</p>
<p>snmp 抓到数据存储在 rrdtool 生成的 rrd 文件中(在 cacti 根目录的 rra 文件夹下)。rrdtool 对数据的更新和存储就是对 rrd 文件的处理,rrd 文件是大小固定的档案文件,它能够存储 的数据笔数在创建时就已经定义。</p>
<h3 id="Cacti安装"><a href="#Cacti安装" class="headerlink" title="Cacti安装"></a>Cacti安装</h3><p>搭建LAMP架构</p>
<pre><code># yum install httpd mysql mysql-server mysql-devel net-snmp net-snmp-devel net-snmp-utils rrdtool  -y
# yum install php*  -y    //安装 php 的软件包
</code></pre><p>配置MySQL</p>
<pre><code># service mysqld restart
# mysqladmin -u root password 123      //为管理员设置密码
# mysqladmin -u root -p create cacti   //创建数据库名称为 cacti
Enter password:
# mysql -u root -p -e &quot;GRANT ALL ON cacti.* TO mike@localhost IDENTIFIED BY &apos;123&apos;&quot;
Enter password:
//创建用户mike、密码 123,并把所有权限给数据库 cacti。
//mysql -e 可以在 shell 中直接运行 mysql 中的指令。
</code></pre><p>Cacti软件包安装</p>
<p> <a href="http://www.cacti.net/download_cacti.php" target="_blank" rel="external">下载链接</a></p>
<p>安装配置</p>
<pre><code># tar xf cacti-0.8.8a.tar.gz -C /var/www/html/
# cd /var/www/html/
# mv cacti-0.8.8a/ cacti
# adduser cactiuser
# chown -R cactiuser cacti/rra cacti/log          
//注意这两个目录一定要让这个用户具备写入权限,否则后面无法产生图形和日志

# mysql -u cactiuser -p cacti &lt; cacti/cacti.sql
Enter password:
//导入 Cacti 自带的数据库,注意是输入 mysql 用户 mike 的密码

# vi cacti/include/config.php
/* make sure these values refect your actual                 database/host/user/password */

$database_type = &quot;mysql&quot;;
$database_default = &quot;cacti&quot;;
$database_hostname = &quot;localhost&quot;;
$database_username = &quot;mike&quot;;
$database_password = &quot;123&quot;;
$database_port = &quot;3306&quot;;
$database_ssl = false;
//一定要保证这些参数和在 mysql 里配置的一样
# crontab -e -u mike
*/5 * * * * php /var/www/html/cacti/poller.php &amp;&gt; /dev/null
//为 cactiuser 用户配置计划任务每 5 分钟运行 poller.php 轮询脚本
</code></pre><p>启动服务</p>
<pre><code># service httpd restart
# service mysqld restart
# service snmpd restart
# chkconfig httpd on
# chkconfig mysqld on
# chkconfig snmpd on
</code></pre><p>web界面安装</p>
<p>在浏览器里输入 <a href="http://172.16.252.1/cacti" target="_blank" rel="external">http://172.16.252.1/cacti</a> 进行安装</p>
<p>设置好snmp的版本，确保/var/www/html/cacti/rra目录下有rra文件，文件目录权限正确。</p>
<h3 id="WEB基本设置"><a href="#WEB基本设置" class="headerlink" title="WEB基本设置"></a>WEB基本设置</h3><p>采用 Spine 轮询器替换默认轮询引擎,默认使用cmd.php轮询引擎每隔 5 分钟进行轮询。</p>
<p>spine 是一个基于 C 语言的, 非常快速的轮询引擎,它是默认的 cmd.php 的可选替代,主要是为了加快 SNMP 轮询。Spine 可以提高采集数据的效率,适合监控服务器数量比较多的情况,而 cmd.php 适合小型、测试、学习所用。</p>
<p><a href="http://www.cacti.net/spine_download.php" target="_blank" rel="external">下载链接</a></p>
<p><a href="http://www.cacti.net/spine_install_rhlnx.php" target="_blank" rel="external">查看安装需求</a></p>
<pre><code># tar xf cacti-spine-0.8.8f.tar.gz
# cd cacti-spine-0.8.8f
# ./configure    //确保有编译环境gcc gcc-c++

# make &amp;&amp; make install
# cd /usr/local/spine/etc/
# cp spine.conf.dist  spine.conf

# vi spine.conf     //和MySQL中得参数配置一致
DB_Host         localhost
DB_Database     cacti
DB_User         zhao
DB_Pass         123
DB_Port         3306

# cd bin/
# ./spine
SPINE: Using spine config file [../etc/spine.conf]
SPINE: Version 0.8.8f starting
SPINE: Time: 4.9910 s, Threads: 1, Hosts: 2
</code></pre><p>  web设置</p>
<p> console–&gt;settings-Paths–&gt;Spine Poller File Path–&gt;/usr/local/spine/bin/spine–&gt;save</p>
<p> poller–&gt;Poller Type–&gt;spine</p>
<p>更多插件</p>
<p><a href="http://docs.cacti.net/plugins" target="_blank" rel="external">下载地址</a></p>
<p>只需将下载的插件解压到 cacti 的插件目录(/var/www/html/cacti/plugins)即可</p>
<ul>
<li>settings</li>
</ul>
<p>Cacti 的插件架构提供常见的基础插件服务,许多插件都需要安装 settings 插件才 能工作,提供邮件 API,根据触发条件生成邮件并发送邮件给管理员。此插件安装后即 可,无需额外操作。</p>
<ul>
<li>thold</li>
</ul>
<p>利用 Cacti 的图形生成警告、可设置警告的级别、警告的上下阶等,必须先安装settings 插件。</p>
<ul>
<li>monitor</li>
</ul>
<p>通过此插件,可查看 Cacti 管理下的所有主机状态,并有声音警告;显示状态(正常、正在重启中、报警、宕机)。</p>
<ul>
<li>clog</li>
</ul>
<p>在 cacti 的页面上新建一个链接,这个链接上就可以直接查看 cacti 的日志。</p>
<ul>
<li>realtime</li>
</ul>
<p>查看实时绘图</p>
<ul>
<li>Weathermap</li>
</ul>
<p>根据被监控的设备,画出网络拓扑图</p>
<h3 id="CactiEZ简介"><a href="#CactiEZ简介" class="headerlink" title="CactiEZ简介"></a>CactiEZ简介</h3><p>CactiEZ中文版是最简单有效的Cacti中文解决方案，整合Spine，RRDTool和美化字体。集成Thold，Monitor，Syslog，Weathermap，Realtime，Errorimage，Mobile，Aggregate以及Apache，Squid，F5，Nginx，MySQL等模板。支持多种硬盘控制器和阵列卡，基于CentOS6，启动速度更快，支持EXT4文件系统，原生rsyslog更稳定。全中文页面，中文图形，支持邮件报警，支持声音报警，安装方便使用简单。</p>
<ul>
<li>更多信息：<a href="http://cactiez.cactiusers.org/" target="_blank" rel="external">CactiEZ官网</a></li>
</ul>
<h3 id="CactiEZ安装"><a href="#CactiEZ安装" class="headerlink" title="CactiEZ安装"></a>CactiEZ安装</h3><ul>
<li><p>CactiEZ ISO文件下载</p>
<p>  32位操作系统：<a href="http://pan.baidu.com/s/1dD0iZCX" target="_blank" rel="external">CactiEZ-10.1-i386.iso</a></p>
<p>  64位操作系统：<a href="http://pan.baidu.com/s/1c0BGvQS" target="_blank" rel="external">CactiEZ-10.1-x86_64.iso</a></p>
</li>
<li><p>利用CactiEZ ISO 引导如同光盘安装操作系统一样，安装完成重启后CactiEZ就安装完成</p>
<p>这种方法的缺点：CactiEZ是一个完整的操作系统，需要专门一台机器才能安装使用</p>
</li>
<li><p>通过拷贝ISO文件在已有linux操作系统上搭建</p>
</li>
</ul>
<p>快速自动安装脚本：<a href="https://github.com/Abnerzhao/CactiEZ/tree/master/doc" target="_blank" rel="external">install.sh</a></p>
</div></article><div class="tags"><a href="/tags/Cacti/">Cacti</a></div><div class="paginator"><a href="/2016/02/24/network-command/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2016/01/15/mysql-duplicate/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://yoursite.com/2016/02/23/cacit/index.html" data-title="Cacti监控快速入门" data-url="http://yoursite.com/2016/02/23/cacit/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "wulifun" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="social"><a href="https://github.com/Abnerzhao" title="github" class="iconfont icon-github"></a><a href="mailto:opsabnerzhao@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://weibo.com/2863179107/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="weibo" class="iconfont icon-weibo"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2015-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Abnerzhao</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>