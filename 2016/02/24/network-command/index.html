<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Abnerzhao"><meta name="description" content="netstat查看网络连接状态接口等信息。常用的命令选项：a:显示所有活动连接n：以数字的形式显示（不使用主机名与服务名称，使用IP与portnumber）p：显示进程名和PIDt：查看TCP协议相关信息u：查看UDP协议相关信息l：显示正在监听的进程"><meta name="keywords" content="网络命令"><title>网络相关命令备忘 · Abner</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2016/02/24/network-command/"><link rel="alternate" href="/atom.xml" title="Abner"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5832f612aff8681e2ee213a3b8d9548b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Abner</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">网络相关命令备忘</h1><span class="post-time">Feb 24, 2016</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#netstat"><span class="toc-text">netstat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用的命令选项："><span class="toc-text">常用的命令选项：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-text">nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用的扫描类型："><span class="toc-text">常用的扫描类型：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpdump-命令行抓包工具"><span class="toc-text">tcpdump 命令行抓包工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用选项"><span class="toc-text">常用选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#过滤条件"><span class="toc-text">过滤条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接符"><span class="toc-text">连接符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用示例"><span class="toc-text">使用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#route"><span class="toc-text">route</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#参数注解"><span class="toc-text">参数注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加和删除路由："><span class="toc-text">添加和删除路由：</span></a></li></ol></li></ol></div><div class="post-content"><h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p>查看网络连接状态接口等信息。</p>
<h4 id="常用的命令选项："><a href="#常用的命令选项：" class="headerlink" title="常用的命令选项："></a>常用的命令选项：</h4><ul>
<li>a : 显示所有活动连接</li>
<li>n：以数字的形式显示（不使用主机名与服务名称，使用 IP 与 port number ）</li>
<li>p：显示进程名和PID</li>
<li>t：查看TCP协议相关信息</li>
<li>u：查看UDP协议相关信息</li>
<li>l：显示正在监听的进程</li>
</ul>
<p>netstat 的输出主要分为两大部分，分别是 TCP/IP 的网络接口部分，以及传统的 Unix socket 部分:</p>
<pre><code>[root@Mr-zhao ~]# netstat -ntpl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name
tcp        0      0 0.0.0.0:8080                0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      9356/nginx
tcp        0      0 10.48.156.8:60020           0.0.0.0:*                   LISTEN      12371/./gseAgent
tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      16594/sshd
tcp        0      0 :::22                       :::*                        LISTEN      16594/sshd
</code></pre><p><strong>字段含义：</strong></p>
<ul>
<li>proto  协议</li>
<li>Recv-Q 接受数据</li>
<li>Send-Q 发送数据</li>
<li>Local Address 本地地址和端口号</li>
<li>Foreign Addredd  外部地址和端口号</li>
<li>State 状态</li>
<li>PID/Program name  PID和进程名称</li>
</ul>
<p>在 port 22 的接口中，使用的 :::22 就是针对 IPv6 的显示，事实上他就等同于 0.0.0.0:22</p>
<p><strong> State状态（tcp三次握手）：</strong></p>
<ul>
<li>ESTABLISED：已建立连接的状态；</li>
<li>SYN_SENT：发出主动连接 (SYN 标志) 的连接封包；</li>
<li>SYN_RECV：接收到一个要求连接的主动连接封包；</li>
<li>FIN_WAIT1：该插槽服务(socket)已中断，该联机正在断线当中；</li>
<li>FIN_WAIT2：该连接已挂断，但正在等待对方主机响应断线确认的封包；</li>
<li>TIME_WAIT：该连接已挂断，但 socket 还在网络上等待结束；</li>
<li>LISTEN：通常用在服务的监听 port ！可使用『 -l 』参数查阅。</li>
</ul>
<p>查看目前已经启动的网络服务</p>
<pre><code>netstat -tupln
</code></pre><p>查看本机上所有的网络连接状态</p>
<pre><code>netstat -atunp
</code></pre><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>网络端口扫描命令</p>
<h4 id="常用的扫描类型："><a href="#常用的扫描类型：" class="headerlink" title="常用的扫描类型："></a>常用的扫描类型：</h4><ul>
<li>-sT : TCP连接扫描</li>
<li>-sU：UDP扫描</li>
<li>-sP：ICMP扫描</li>
<li>-A：扫描操作系统类型</li>
<li>-p: 扫描端口</li>
<li>-n ：禁止反向解析</li>
</ul>
<p>检测10.0.2.0/16 网段有那些存活的主机</p>
<pre><code>nmap -n -sP 10.0.2.0/16
</code></pre><p>检测ip地址 10.0.2.100-200 间的存活的主机</p>
<pre><code>nmap -n -sP 10.0.2.100-200
</code></pre><p>检测主机10.0.2.253的tcp连接情况</p>
<pre><code>nmap -n  -sT 10.0.2.253
</code></pre><p> 检测所用操作系统和主机的基本信息</p>
<pre><code>nmap -A  www.baidu.com
nmap -A  10.0.2.253
</code></pre><h3 id="tcpdump-命令行抓包工具"><a href="#tcpdump-命令行抓包工具" class="headerlink" title="tcpdump 命令行抓包工具"></a>tcpdump 命令行抓包工具</h3><p>用途：不间断监控网络通信数据包</p>
<h4 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h4><ul>
<li><p>-qnn 可简化输出</p>
</li>
<li><p>-v -vv -vvv  指显示信息的详细程度</p>
</li>
</ul>
<h4 id="过滤条件"><a href="#过滤条件" class="headerlink" title="过滤条件"></a>过滤条件</h4><p>过滤主机</p>
<ul>
<li><p>host 源ip或者目标ip</p>
</li>
<li><p>src host 源ip</p>
</li>
<li><p>dst host 目标ip</p>
</li>
<li><p>ether host 源或者目标MAC地址</p>
</li>
</ul>
<p>过滤端口</p>
<ul>
<li>port 源端口或者目标端口，同样可以搭配 src、dst</li>
</ul>
<p>过滤协议</p>
<ul>
<li>arp | tcp | udp | icmp</li>
</ul>
<p>过滤网络</p>
<ul>
<li>net 网络地址，同样可以搭配 src、dst</li>
</ul>
<h4 id="连接符"><a href="#连接符" class="headerlink" title="连接符"></a>连接符</h4><p>and（&amp;&amp;）、or （||）、not（!）</p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><pre><code>tcpdump -i eth0 -nn prot 22 and src host 192.168.1.6

tcpdump -i eth0 icmp and ether dst host 00:11:22:33:44:55

tcpdump -i eth0 tcp and dst net 172.18 and not dst host 192.168.1.100

tcpdump -i eth0 -nn -vv port 67 and udp

tcpdump -i eth0 -q -n arp         //监控eth0 的arp 协议 （ping）

tcpdump -i eth0 -v -n icmp and host 10.0.2.232

tcpdump -i eth0 -q -n arp -w /tmp/arp   //将结果输入到文本

tcpdump -r /tmp/arp   // 读出结果
</code></pre><h3 id="route"><a href="#route" class="headerlink" title="route"></a>route</h3><p>用于操作基于内核ip路由表，它的主要作用是创建一个静态路由让指定一个主机或者一个网络通过一个网络接口。</p>
<p><strong>直接在命令行下执行route命令来添加路由，不会永久保存，当网卡重启或者机器重启之后，该路由就失效了.</strong>可以在/etc/rc.local中添加route命令来保证该路由设置永久有效。</p>
<h4 id="参数注解"><a href="#参数注解" class="headerlink" title="参数注解"></a>参数注解</h4><pre><code>[root@localhost ~]# route -n  // -n 表示不解析名字,列出速度会比route 快
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.120.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.0.0     192.168.120.1   255.255.0.0     UG    0      0        0 eth0
10.0.0.0        192.168.120.1   255.0.0.0       UG    0      0        0 eth0
0.0.0.0         192.168.120.240 0.0.0.0         UG    0      0        0 eth0
</code></pre><ul>
<li><p>第一行表示主机所在网络的地址为192.168.120.0，若数据传送目标是在本局域网内通信，则可直接通过eth0转发数据包;</p>
</li>
<li><p>第四行表示数据传送目的是访问Internet，则由接口eth0，将数据包发送到网关192.168.120.240</p>
</li>
<li><p>其中Flags为路由标志，标记当前网络节点的状态。</p>
<p>  Flags标志说明：</p>
<ul>
<li><p>U Up表示此路由当前为启动状态</p>
</li>
<li><p>H Host，表示此网关为一主机</p>
</li>
<li><p>G Gateway，表示此网关为一路由器</p>
</li>
<li><p>R Reinstate Route，使用动态路由重新初始化的路由</p>
</li>
<li><p>D Dynamically,此路由是动态性地写入</p>
</li>
<li><p>M Modified，此路由是由路由守护程序或导向器动态修改</p>
</li>
<li><p>! 表示此路由当前为关闭状态</p>
</li>
</ul>
</li>
</ul>
<h4 id="添加和删除路由："><a href="#添加和删除路由：" class="headerlink" title="添加和删除路由："></a>添加和删除路由：</h4><pre><code>route add -net 10.10.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 10.20.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 10.249.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add -net 192.168.0.0 netmask 255.255.0.0 gw 10.10.3.1

route add default gw 10.10.3.252      //添加默认网关，默认网关只能有一条！多块网卡默认网关也只能有一个！

route del default gw 10.10.3.1   // 删除默认网关
</code></pre><p><strong>指定网卡</strong></p>
<pre><code>route add -net 10.249.0.0 netmask 255.255.0.0 gw 10.10.3.1 dev eth0
</code></pre></div></article><div class="tags"><a href="/tags/网络命令/">网络命令</a></div><div class="paginator"><a href="/2016/02/25/ulimit/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2016/02/23/cacit/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://yoursite.com/2016/02/24/network-command/index.html" data-title="网络相关命令备忘" data-url="http://yoursite.com/2016/02/24/network-command/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "wulifun" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="social"><a href="https://github.com/Abnerzhao" title="github" class="iconfont icon-github"></a><a href="mailto:opsabnerzhao@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://weibo.com/2863179107/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="weibo" class="iconfont icon-weibo"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2015-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Abnerzhao</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>