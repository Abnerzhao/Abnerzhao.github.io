<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Abnerzhao"><meta name="description" content="一、ss简介ssisusedtodumpsocketstatistics.Itallowsshowinginformationsimilartonetstat.Itcandis‐playmoreTCPandstate"><meta name="keywords" content="ss"><title>ss获取内核状态信息 · Abner</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2016/06/16/ss/"><link rel="alternate" href="/atom.xml" title="Abner"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5832f612aff8681e2ee213a3b8d9548b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Abner</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">ss获取内核状态信息</h1><span class="post-time">Jun 16, 2016</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、ss-简介"><span class="toc-text">一、ss 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-选项"><span class="toc-text">1.1 选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、实例"><span class="toc-text">二、实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-显示所有的连接"><span class="toc-text">2.1 显示所有的连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-过滤TCP、UDP和UNIX域套接字"><span class="toc-text">2.2 过滤TCP、UDP和UNIX域套接字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-显示-Sockets-摘要"><span class="toc-text">2.3 显示 Sockets 摘要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-查看进程使用的Socket"><span class="toc-text">2.4 查看进程使用的Socket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-根据TCP状态过滤连接"><span class="toc-text">2.5 根据TCP状态过滤连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-根据IP地址和端口过滤连接"><span class="toc-text">2.6 根据IP地址和端口过滤连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、参考"><span class="toc-text">三、参考</span></a></li></ol></div><div class="post-content"><h2 id="一、ss-简介"><a href="#一、ss-简介" class="headerlink" title="一、ss 简介"></a>一、ss 简介</h2><blockquote>
<p>ss  is  used to dump socket statistics. It allows showing information similar to netstat.  It can dis‐<br>       play more TCP and state informations than other tools.</p>
<p>The ss command is capable of showing more information than the netstat and is faster. The netstat command reads various /proc files to gather information. However this approach falls weak when there are lots of connections to display. This makes it slower.</p>
<p>The ss command gets its information directly from kernel space. The options used with the ss commands are very similar to netstat making it an easy replacement.</p>
</blockquote>
<p>ss 命令用来显示处于活动状态的套接字信息。ss命令可以用来获取socket统计信息，它可以显示和netstat类似的内容。但 ss 的优势在于它能够显示更多更详细的有关TCP和连接状态的信息，而且比netstat更快速更高效。</p>
<p>ss 利用到了TCP协议栈中tcp_diag。tcp_diag是一个用于分析统计的模块，可以获得Linux 内核中第一手的信息，这就确保了ss的快捷高效。</p>
<a id="more"></a>
<h3 id="1-1-选项"><a href="#1-1-选项" class="headerlink" title="1.1 选项"></a>1.1 选项</h3><pre><code>Usage: ss [ OPTIONS ]
    ss [ OPTIONS ] [ FILTER ]
-h, --help      this message
-V, --version   output version information
-n, --numeric   don&apos;t resolve service names  #不解析服务名称，以数字方式显示
-a, --all       display all sockets #显示所有的套接字
-l, --listening display listening sockets #显示处于监听状态的套接字
-o, --options       show timer information #显示计时器信息
-m, --memory        show socket memory usage #显示套接字的内存使用情况
-p, --processes show process using socket #显示使用套接字的进程信息
-i, --info      show internal TCP information #显示内部TCP信息
-t, --tcp       display only TCP sockets #只显示TCP套接字
-u, --udp       display only UDP sockets #只显示UDP套接字
-d, --dccp      display only DCCP sockets #只显示DCCP套接字
-w, --raw       display only RAW sockets #只显示RAW套接字
-x, --unix      display only Unix domain sockets #只显示UNIX域套接字
</code></pre><h2 id="二、实例"><a href="#二、实例" class="headerlink" title="二、实例"></a>二、实例</h2><h3 id="2-1-显示所有的连接"><a href="#2-1-显示所有的连接" class="headerlink" title="2.1 显示所有的连接"></a>2.1 显示所有的连接</h3><pre><code># ss | more
Netid  State      Recv-Q Send-Q   Local Address:Port       Peer Address:Port
u_str  ESTAB      0      0      /var/run/dbus/system_bus_socket 24643                 * 39740
u_str  ESTAB      0      0                    * 26693                 * 26694
u_str  ESTAB      0      0                    * 26683                 * 39746
u_str  ESTAB      0      0      @/com/ubuntu/upstart 16419                 * 101
u_str  ESTAB      0      0      /var/run/mysqld/mysqld.sock 23234                 * 8691
......
</code></pre><h3 id="2-2-过滤TCP、UDP和UNIX域套接字"><a href="#2-2-过滤TCP、UDP和UNIX域套接字" class="headerlink" title="2.2 过滤TCP、UDP和UNIX域套接字"></a>2.2 过滤TCP、UDP和UNIX域套接字</h3><pre><code># ss -t  //仅显示建立的tcp连接
State      Recv-Q Send-Q                      Local Address:Port                          Peer Address:Port
ESTAB      0      0                               127.0.0.1:59954                            127.0.0.1:2633
ESTAB      0      0                               127.0.0.1:2633                             127.0.0.1:59954
ESTAB      0      148                          10.249.7.247:ssh                          10.249.23.101:50285
# ss -ta //显示tcp连接的所有状态
State      Recv-Q Send-Q                      Local Address:Port                          Peer Address:Port
LISTEN     0      128                                     *:40861                                    *:*
LISTEN     0      15                                      *:2633                                     *:*
LISTEN     0      50                              127.0.0.1:mysql                                    *:*
ESTAB      0      0                               127.0.0.1:59956                            127.0.0.1:2633
TIME-WAIT  0      0                               127.0.0.1:2633                             127.0.0.1:59951
# ss -u
# ss -ua
# ss -x
# ss -ltu //查看处于监听状态的tcp和udp连接
</code></pre><h3 id="2-3-显示-Sockets-摘要"><a href="#2-3-显示-Sockets-摘要" class="headerlink" title="2.3 显示 Sockets 摘要"></a>2.3 显示 Sockets 摘要</h3><pre><code># ss -s
Total: 168 (kernel 1734)
TCP:   22 (estab 1, closed 9, orphaned 0, synrecv 0, timewait 8/0), ports 0

Transport Total     IP        IPv6
*     1734      -         -
RAW   0         0         0
UDP   10        7         3
TCP   13        10        3
INET      23        17        6
FRAG      0         0         0
</code></pre><h3 id="2-4-查看进程使用的Socket"><a href="#2-4-查看进程使用的Socket" class="headerlink" title="2.4 查看进程使用的Socket"></a>2.4 查看进程使用的Socket</h3><pre><code># ss -plt
State      Recv-Q Send-Q                      Local Address:Port                          Peer Address:Port
LISTEN     0      128                                     *:40861                                    *:*        users:((&quot;rpc.statd&quot;,1325,9))
LISTEN     0      15                                      *:2633                                     *:*        users:((&quot;oned&quot;,2204,26))
LISTEN     0      50                              127.0.0.1:mysql                                    *:*        users:((&quot;mysqld&quot;,1525,10))
LISTEN     0      100                          10.249.7.247:9869                                     *:*        users:((&quot;ruby&quot;,2070,8))
LISTEN     0      128                                     *:sunrpc                                   *:*        users:((&quot;rpcbind&quot;,1319,8))
LISTEN     0      100                                     *:29876                                    *:*        users:((&quot;python&quot;,2054,0))
</code></pre><h3 id="2-5-根据TCP状态过滤连接"><a href="#2-5-根据TCP状态过滤连接" class="headerlink" title="2.5 根据TCP状态过滤连接"></a>2.5 根据TCP状态过滤连接</h3><pre><code># ss [ OPTIONS ] [ STATE-FILTER ] [ ADDRESS-FILTER ]
# ss -t4 state established
Recv-Q Send-Q                           Local Address:Port                               Peer Address:Port
0      148                               10.249.7.247:ssh                               10.249.23.101:50285
0      0                                    127.0.0.1:60035                                 127.0.0.1:2633
0      0                                    127.0.0.1:2633                                  127.0.0.1:60035
# ss -t4 state time-wait
Recv-Q Send-Q                           Local Address:Port                               Peer Address:Port
0      0                                    127.0.0.1:2633                                  127.0.0.1:60033
0      0                                 10.249.7.247:9869                              10.249.23.101:60243
0      0                                 10.249.7.247:9869                              10.249.23.101:60248
0      0                                 10.249.7.247:9869                              10.249.23.101:60239
0      0                                 10.249.7.247:9869                              10.249.23.101:60245
</code></pre><p>状态如下：</p>
<blockquote>
<p>1.established</p>
<p>2.syn-sent </p>
<p>3.syn-recv </p>
<p>4.fin-wait-1  </p>
<p>5.fin-wait-2 </p>
<p>6.time-wait </p>
<p>7.closed </p>
<p>8.close-wait </p>
<p>9.last-ack </p>
<p>10.closing </p>
<p>11.all - All of the above states </p>
<p>12.connected - All the states except for listen and closed </p>
<p>13.synchronized - All the connected states except for syn-sent </p>
<p>14.bucket - Show states, which are maintained as minisockets, i.e. time-wait and syn-recv. </p>
<p>15.big - Opposite to bucket state.</p>
</blockquote>
<h3 id="2-6-根据IP地址和端口过滤连接"><a href="#2-6-根据IP地址和端口过滤连接" class="headerlink" title="2.6 根据IP地址和端口过滤连接"></a>2.6 根据IP地址和端口过滤连接</h3><pre><code># ss -at &apos;( dport = :ssh or sport = :ssh )&apos;
# ss -nt  dst :443 or dst :80 
# ss -nt dst 74.125.236.178
</code></pre><h2 id="三、参考"><a href="#三、参考" class="headerlink" title="三、参考"></a>三、参考</h2><p><a href="http://www.binarytides.com/linux-ss-command/" target="_blank" rel="external">10 examples of Linux ss command to monitor network connections</a><br><a href="http://man.linuxde.net/ss" target="_blank" rel="external">ss 命令详解</a></p>
</div></article><div class="tags"><a href="/tags/ss/">ss</a></div><div class="paginator"><a href="/2016/10/29/Python-code-style/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2016/06/12/raid_states/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://yoursite.com/2016/06/16/ss/index.html" data-title="ss获取内核状态信息" data-url="http://yoursite.com/2016/06/16/ss/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "wulifun" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="social"><a href="https://github.com/Abnerzhao" title="github" class="iconfont icon-github"></a><a href="mailto:opsabnerzhao@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://weibo.com/2863179107/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="weibo" class="iconfont icon-weibo"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2015-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Abnerzhao</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>