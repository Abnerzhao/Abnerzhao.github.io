<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Abnerzhao"><meta name="description" content="本文主要内容为TheDjangoBook笔记摘录(书有点老但是很多知识点还是值得一看，结合官方文档一起下饭)概览Django提供了通用Web开发模式的高度抽象，提供了频繁进行的编程作业的快速解决方法，以及为“如何解决问题”提供了清晰明了的约定Web框架为应用程序提"><meta name="keywords" content="django"><title>Django笔记 · Abner</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2016/11/20/django-web-framework/"><link rel="alternate" href="/atom.xml" title="Abner"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5832f612aff8681e2ee213a3b8d9548b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">Abner</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Django笔记</h1><span class="post-time">Nov 20, 2016</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概览"><span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC设计模式"><span class="toc-text">MVC设计模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始"><span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库"><span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开始项目"><span class="toc-text">开始项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行"><span class="toc-text">运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图和URL配置"><span class="toc-text">视图和URL配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义视图"><span class="toc-text">定义视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#激活视图"><span class="toc-text">激活视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的请求过程"><span class="toc-text">简单的请求过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态URL"><span class="toc-text">动态URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图函数导入的其他方法"><span class="toc-text">视图函数导入的其他方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-视图函数本身"><span class="toc-text">1.视图函数本身</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-模板函数字符串"><span class="toc-text">2.模板函数字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-公共前缀"><span class="toc-text">3.公共前缀</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多个视图前缀"><span class="toc-text">多个视图前缀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include"><span class="toc-text">include</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板"><span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用模板系统"><span class="toc-text">使用模板系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在视图中使用模板"><span class="toc-text">在视图中使用模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#模板加载"><span class="toc-text">模板加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#视图中使用模板、引用和渲染"><span class="toc-text">视图中使用模板、引用和渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-HttpResponse"><span class="toc-text">1.HttpResponse</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-HttpResponse-get-template-Context"><span class="toc-text">2.HttpResponse get_template Context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-render-to-response"><span class="toc-text">3.render_to_response</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#locals-技巧"><span class="toc-text">locals() 技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板相关其他小知识"><span class="toc-text">模板相关其他小知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#templates子目录"><span class="toc-text">templates子目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#include-1"><span class="toc-text">include</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模板继承"><span class="toc-text">模板继承</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型"><span class="toc-text">模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#视图函数对数据库处理"><span class="toc-text">视图函数对数据库处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTV开发模式"><span class="toc-text">MTV开发模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTV模式中的模型创建"><span class="toc-text">MTV模式中的模型创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库配置"><span class="toc-text">数据库配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建app"><span class="toc-text">新建app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义模型"><span class="toc-text">定义模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模型安装"><span class="toc-text">模型安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#语法检查"><span class="toc-text">语法检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步数据库"><span class="toc-text">同步数据库</span></a></li></ol></li></ol></li></ol></div><div class="post-content"><blockquote>
<p>本文主要内容为<a href="http://djangobook.py3k.cn/2.0/" target="_blank" rel="external">The Django Book</a>笔记摘录<br>(书有点老但是很多知识点还是值得一看，结合官方文档一起下饭)</p>
</blockquote>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><blockquote>
<p>Django提供了通用Web开发模式的高度抽象，提供了频繁进行的编程作业的快速解决方法，以及为“如何解决问题”提供了清晰明了的约定</p>
</blockquote>
<p>Web框架为应用程序提供了一套程序框架，可以让程序员专注于编写清晰、易维护的代码</p>
<h3 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h3><p><code>模型-视图-控制器(MVC)</code>：MVC是一种软件开发的方法，它把代码的定义和数据访问的方法（模型）与请求逻辑（控制器）还有用户接口（视图）分开来</p>
<p>任何一个通过django实现的功能都会包含一下几个文件：</p>
<a id="more"></a>
<ul>
<li><p>models.py 模型(model)<br>通过定义Python类来描述数据表。通过简单的Python的代码实现对数据库的增删改查等操作</p>
</li>
<li><p>views.py 视图(view)<br>视图函数定义的业务逻辑</p>
</li>
<li><p>urls.py 业务逻辑入口<br>URL和视图函数的映射关系</p>
</li>
<li><p>html模板 模板(template)<br>表现逻辑</p>
</li>
</ul>
<p><strong>对于django而言更准确的描述是采用的MTV的架构(Model-Template-View)</strong></p>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pip install Django==1.7.9</div><div class="line"></div><div class="line">&gt;&gt;&gt; import django</div><div class="line">&gt;&gt;&gt; django.VERSION</div><div class="line">(1, 7, 9, &apos;final&apos;, 0)</div></pre></td></tr></table></figure>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>默认使用sqlite3，当然也支持其他主流数据库</p>
<h4 id="开始项目"><a href="#开始项目" class="headerlink" title="开始项目"></a>开始项目</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ pwd</div><div class="line">/Users/Mr-zhao/project/django_project</div><div class="line">$ django-admin.py startproject django_exp</div><div class="line">$ tree django_exp</div><div class="line">django_exp</div><div class="line">├── django_exp</div><div class="line">│   ├── __init__.py</div><div class="line">│   ├── settings.py</div><div class="line">│   ├── urls.py</div><div class="line">│   └── wsgi.py</div><div class="line">└── manage.py</div></pre></td></tr></table></figure>
<blockquote>
<p>__init__.py:让Python把该目录当成一个开发包 (即一组模块)所需的文件</p>
<p>manage.py:命令行工具，允许你以多种方式与该Django项目进行交互(<code>python manage.py help</code>获取更多帮助信息) </p>
<p>settings.py:Django项目配置文件</p>
<p>urls.py:URL设置</p>
</blockquote>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">python manage.py runserver 8080 //只有本机能访问</div><div class="line">python manage.py runserver 0.0.0.0:8080 //任意主机都能访问</div></pre></td></tr></table></figure>
<p>通过runserver启动的django内建的一个轻量web服务，但是在生产环境中一般会使用<code>uwsgi+nginx</code>来部署</p>
<h2 id="视图和URL配置"><a href="#视图和URL配置" class="headerlink" title="视图和URL配置"></a>视图和URL配置</h2><h3 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h3><p>view.py文件定义视图函数，一个视图就是python的一个函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span>  </div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'hello world'</span>)</div></pre></td></tr></table></figure>
<p>每个视图函数至少要有一个request参数，request是一个触发这个视图、包含当前Web请求信息的对象，是类django.http.HttpRequest的一个实例</p>
<h3 id="激活视图"><a href="#激活视图" class="headerlink" title="激活视图"></a>激活视图</h3><p>urls.py文件是django项目网站的url详细描述文件，记录是url和视图函数的映射关系</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">r'^hello/$'</span>,<span class="string">'django_exp.views.hello'</span>), <span class="comment">#增加映射URL模式和view功能的Python元组</span></div><div class="line">    url(<span class="string">r'^admin/'</span>, include(admin.site.urls)),</div><div class="line">)</div></pre></td></tr></table></figure>
<p>这里主要是调用patterns()函数并将返回结果保存到urlpatterns变量中</p>
<blockquote>
<p>django在检查URL模式前会自动移除URL开头的斜杠(/)。所以我们为/hello/写URL模式不用包含斜杠(/)</p>
</blockquote>
<h3 id="简单的请求过程"><a href="#简单的请求过程" class="headerlink" title="简单的请求过程"></a>简单的请求过程</h3><p>1.web请求/hello/<br>2.django在setting文件中找到ROOT_URLCONF配置的URLconf文件<br>3.在URLconf文件中找到匹配/hello/的条目并调用相应的视图函数<br>4.视图函数返回一个HttpResponse<br>5.Django转换HttpResponse为一个适合的HTTP response，以Web page显示出来</p>
<h3 id="动态URL"><a href="#动态URL" class="headerlink" title="动态URL"></a>动态URL</h3><p>URL支持正则表达式，可以通过通配符实现动态URL</p>
<pre><code>(r&apos;^time/plus/\d{1,2}/$&apos;, hours_ahead),
</code></pre><blockquote>
<p>\d 表示数字<br>{1，2}表示一个或两个数字<br>正则表达式字符串的开头字母’r’表示不需要处理里面的反斜杠(即转义字符)</p>
</blockquote>
<h3 id="视图函数导入的其他方法"><a href="#视图函数导入的其他方法" class="headerlink" title="视图函数导入的其他方法"></a>视图函数导入的其他方法</h3><h4 id="1-视图函数本身"><a href="#1-视图函数本身" class="headerlink" title="1.视图函数本身"></a>1.视图函数本身</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line"><span class="keyword">from</span> django_exp.views <span class="keyword">import</span> hello  <span class="comment">#随着url的增多维护管理将变得麻烦</span></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">'^hello/$'</span>,hello),</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="2-模板函数字符串"><a href="#2-模板函数字符串" class="headerlink" title="2.模板函数字符串"></a>2.模板函数字符串</h4><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">'^hello/$'</span>,<span class="string">'django_exp.views.hello'</span>),</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="3-公共前缀"><a href="#3-公共前缀" class="headerlink" title="3.公共前缀"></a>3.公共前缀</h4><p>当采用模板函数字符串的方式时，如果有视图前缀一样那么可以作为patterns函数的第一个参数传入</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">urlpatterns = patterns(<span class="string">'django_exp.views'</span>,</div><div class="line">    url(<span class="string">'^hello/$'</span>,<span class="string">'hello'</span>),</div><div class="line">    url(<span class="string">'^foo/$'</span>,<span class="string">'foo'</span>),</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="多个视图前缀"><a href="#多个视图前缀" class="headerlink" title="多个视图前缀"></a>多个视图前缀</h3><p>有的时候我们并不是所有的视图函数都在一个文件中，即导入视图函数时前缀不相同。对于这种混合视图，我们只要增加多个patterns()对象，patterns()返回的对象是可相加的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">'^hello/$'</span>,<span class="string">'django_exp.views.hello'</span>),</div><div class="line">    url(<span class="string">r'^admin/'</span>, include(admin.site.urls)),</div><div class="line">)</div><div class="line">urlpatterns += patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">r'^index/$'</span>,<span class="string">'blog.views.blog_index'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><p>include可实现在setting.py中定义的urlconf文件中包含其他urlconf</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#urls.py</span></div><div class="line">urlpatterns += patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">r'^mydata/'</span>,include(<span class="string">'blog.urls'</span>)),</div><div class="line">    url(<span class="string">r'^(?P&lt;username&gt;\w+)/'</span>,include(<span class="string">'blog.urls'</span>)),</div><div class="line">)</div><div class="line"></div><div class="line">---</div><div class="line"><span class="comment">#blog.urls.py</span></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">r'^(?P&lt;month&gt;\w&#123;3&#125;)/(?P&lt;day&gt;\d\d)/$'</span>,<span class="string">'blog.views.data_view'</span>),</div><div class="line">    url(<span class="string">r'^$'</span>,<span class="string">'blog.views.user_login'</span>),</div><div class="line">    url(<span class="string">r'^bloglist/$'</span>,<span class="string">'blog.views.blog_list'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<blockquote>
<p>导入视图函数时能同时传入参数</p>
</blockquote>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>模板通常是一个HTML文档，用于分离文档的表现形式和内容</p>
<h3 id="使用模板系统"><a href="#使用模板系统" class="headerlink" title="使用模板系统"></a>使用模板系统</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; from django import template</div><div class="line">&gt;&gt;&gt; t = template.Template(&apos;My name is &#123;&#123; name &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = template.Context(&#123;&apos;name&apos;: &apos;Adrian&apos;&#125;)</div><div class="line">&gt;&gt;&gt; print t.render(c)</div><div class="line">My name is Adrian.</div><div class="line">&gt;&gt;&gt; c = template.Context(&#123;&apos;name&apos;: &apos;Fred&apos;&#125;)</div><div class="line">&gt;&gt;&gt; print t.render(c)</div><div class="line">My name is Fred.</div></pre></td></tr></table></figure>
<p>1.创建一个Template对象(用指定模板文件路径的方式来创建Template对象同样可以)<br>2.调用模板对象的render方法，并且传入一套变量context。它将返回一个基于模板的展现字符串，模板中的变量和标签会被context值替换</p>
<h3 id="在视图中使用模板"><a href="#在视图中使用模板" class="headerlink" title="在视图中使用模板"></a>在视图中使用模板</h3><h4 id="模板加载"><a href="#模板加载" class="headerlink" title="模板加载"></a>模板加载</h4><p><strong>setting.py</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ROOT_DIR = os.getcwd()</div><div class="line">TEMPLATE_DIRS = (</div><div class="line">    os.path.join(ROOT_DIR,&apos;templates&apos;),</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="视图中使用模板、引用和渲染"><a href="#视图中使用模板、引用和渲染" class="headerlink" title="视图中使用模板、引用和渲染"></a>视图中使用模板、引用和渲染</h4><p><strong>在视图中引用渲染模板方法有三种：</strong></p>
<h5 id="1-HttpResponse"><a href="#1-HttpResponse" class="headerlink" title="1.HttpResponse"></a>1.HttpResponse</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># encoding=utf-8</span></div><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,Http404</div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'hello world'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;it is now %s. &lt;/body&gt;&lt;/html&gt;"</span> %now</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hour_ahead</span><span class="params">(request,offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404()</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;in %s hours,it will be %s &lt;/body&gt;&lt;/html&gt;"</span> %(offset,dt)</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure>
<h5 id="2-HttpResponse-get-template-Context"><a href="#2-HttpResponse-get-template-Context" class="headerlink" title="2.HttpResponse get_template Context"></a>2.HttpResponse get_template Context</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,Http404</div><div class="line"><span class="keyword">from</span> django.template.loader <span class="keyword">import</span> get_template</div><div class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Template,Context</div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    t = get_template(<span class="string">'hello.html'</span>)</div><div class="line">    html = t.render(Context())</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    t = get_template(<span class="string">'current_time.html'</span>) <span class="comment">#载入模板</span></div><div class="line">    html = t.render(Context(&#123;<span class="string">'now'</span>:now&#125;)) <span class="comment"># Context渲染</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hour_ahead</span><span class="params">(request,offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    t = get_template(<span class="string">'hour_ahead.html'</span>)</div><div class="line">    html = t.render(Context(&#123;<span class="string">'dt'</span>:dt,<span class="string">'offset'</span>:offset&#125;))</div><div class="line">    <span class="keyword">return</span> HttpResponse(html)</div></pre></td></tr></table></figure>
<h5 id="3-render-to-response"><a href="#3-render-to-response" class="headerlink" title="3.render_to_response"></a>3.render_to_response</h5><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'hello.html'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'current_time.html'</span>,&#123;<span class="string">'now'</span>:now&#125;)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hour_ahead</span><span class="params">(request,offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'hour_ahead.html'</span>,&#123;<span class="string">'dt'</span>:dt,<span class="string">'offset'</span>:offset&#125;)</div></pre></td></tr></table></figure>
<h3 id="locals-技巧"><a href="#locals-技巧" class="headerlink" title="locals() 技巧"></a>locals() 技巧</h3><p>利用python的内建函数locals()它返回的字典对所有局部变量的名称与值进行映射,它包含了函数执行到该时间点时所定义的一切变量</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(request)</span>:</span></div><div class="line">    now = datetime.datetime.now()</div><div class="line">    <span class="comment"># return render_to_response('current_time.html',&#123;'now':now&#125;)</span></div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'current_time.html'</span>, locals()) //实现上面语句的同样功能</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hour_ahead</span><span class="params">(request,offset)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        offset = int(offset)</div><div class="line">    <span class="keyword">except</span> ValueError:</div><div class="line">        <span class="keyword">raise</span> Http404</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    <span class="comment"># return render_to_response('hour_ahead.html',&#123;'dt':dt,'offset':offset&#125;)</span></div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'hour_ahead.html'</span>, locals()) //实现上面语句同样功能</div></pre></td></tr></table></figure>
<h3 id="模板相关其他小知识"><a href="#模板相关其他小知识" class="headerlink" title="模板相关其他小知识"></a>模板相关其他小知识</h3><h4 id="templates子目录"><a href="#templates子目录" class="headerlink" title="templates子目录"></a>templates子目录</h4><p><strong>setting.py</strong>文件中定义了模板文件的位置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ROOT_DIR = os.getcwd()</div><div class="line">TEMPLATE_DIRS = (</div><div class="line">    os.path.join(ROOT_DIR,&apos;templates&apos;),</div><div class="line">)</div></pre></td></tr></table></figure>
<p>假设现在有个basehome.html文件位于ROOT_DIR/templates/base/basehome.html那么我们通过如下方式引用：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'base/base.html'</span>)</div></pre></td></tr></table></figure>
<h4 id="include-1"><a href="#include-1" class="headerlink" title="include"></a>include</h4><p>允许在模板中包含其它的模板的内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>django test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    &#123;% include 'base/base.html' %&#125;  <span class="comment">&lt;!--显示base/base.html的内容--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>it is now &#123;&#123; now &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h4><p>减少共用页面区域所引起的重复和冗余代码，模板继承就是先构造一个基础框架模板，而后在其子模板中对它所包含站点公用部分和定义块进行重载</p>
<p>基础模板base/base.html：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="comment">&lt;!--子模板可自定义标题--&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My helpful test site<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    &#123;% block content %&#125;&#123;% endblock %&#125; <span class="comment">&lt;!--子模板可自定义body内容--&gt;</span></div><div class="line">    &#123;% block footer %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for visiting my site.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    &#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>子模板hello.html:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line">&#123;%  extends 'base/base.html' %&#125;</div><div class="line">&#123;% block title %&#125;hello world&#123;% endblock %&#125; <span class="comment">&lt;!--子模板标题--&gt;</span></div><div class="line">&#123;% block content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span>   <span class="comment">&lt;!--子模板内容--&gt;</span></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>对于大多数网站而言数据库是必不可少的。web服务在后台连接数据库服务器，从中取出一些数据然后在Web页面用漂亮的格式展示这些数据，同样也能接收用户的输入将必要信息写入数据库。</p>
<h3 id="视图函数对数据库处理"><a href="#视图函数对数据库处理" class="headerlink" title="视图函数对数据库处理"></a>视图函数对数据库处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</div><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_list</span><span class="params">(request)</span>:</span></div><div class="line">    db = MySQLdb.connect(user=<span class="string">'root'</span>,db=<span class="string">'django'</span>,passwd=<span class="string">'123456'</span>,host=<span class="string">'localhost'</span>)</div><div class="line">    cursor = db.cursor()</div><div class="line">    cursor.execute(<span class="string">'select title from hello_book'</span>)</div><div class="line">    names = [row[<span class="number">0</span>] <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall()]</div><div class="line">    db.close()</div><div class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'book_list.html'</span>,&#123;<span class="string">'names'</span>:names&#125;)</div></pre></td></tr></table></figure>
<p>上面的视图函数对mysql数据库进行连接、查询，然后将查询结果传递给book_list.html。这种方法有不少缺点：<br>1.数据库的连接参数写入代码中不安全，应该写在配置文件中<br>2.每次进行查询时需要进行重复的操作：创建数据库、创建游标、执行语句、关闭数据库<br>3.如果使用其他数据库那么关于数据库的代码全部都要改</p>
<h3 id="MTV开发模式"><a href="#MTV开发模式" class="headerlink" title="MTV开发模式"></a>MTV开发模式</h3><p>把<code>数据存取逻辑</code>、<code>业务逻辑</code>和<code>表现逻辑</code>组合在一起的概念被称为软件架构的 <code>Model-View-Controller(MVC)模式</code>。在这个模式中Model代表数据存取层，View 代表的是系统中选择显示什么和怎么显示的部分，Controller指的是系统中根据用户输入并视需要访问模型，以决定使用哪个视图的那部分</p>
<p><strong>Django紧紧地遵循这种MVC模式，可以称得上是一种 MVC 框架。以下是 Django 中M、V和 C各自的含义：</strong></p>
<blockquote>
<p>M:数据存取部分，由django数据库层处理</p>
<p>V:选择显示哪些数据要显示以及怎样显示的部分，由视图和模板处理</p>
<p>C:根据用户输入委派视图的部分，由django框架根据URLconf设置，对给定URL调用适当的 python函数</p>
</blockquote>
<p>由于C由框架自行处理，而django里更关注的是模型（Model）、模板(Template)和视图（Views），Django 也被称为 MTV 框架 。在 MTV 开发模式中：</p>
<blockquote>
<p>M代表模型（Model），即数据存取层<br>该层处理与数据相关的所有事务：如何存取、如何验证有效性、包含哪些行为以及数据之间的关系等</p>
<p>T代表模板(Template)，即表现层<br>该层处理与表现相关的决定：如何在页面或其他类型文档中进行显示</p>
<p>V代表视图（View），即业务逻辑层<br>该层包含存取模型及调取恰当模板的相关逻辑。 你可以把它看作模型与模板之间的桥梁</p>
</blockquote>
<h3 id="MTV模式中的模型创建"><a href="#MTV模式中的模型创建" class="headerlink" title="MTV模式中的模型创建"></a>MTV模式中的模型创建</h3><h4 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h4><p>settings.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,  # Add &apos;postgresql_psycopg2&apos;, &apos;mysql&apos;, &apos;sqlite3&apos; or &apos;oracle&apos;.</div><div class="line">        &apos;NAME&apos;: &apos;django&apos;,  # Or path to database file if using sqlite3.</div><div class="line">        &apos;USER&apos;: &apos;root&apos;,  # Not used with sqlite3.</div><div class="line">        &apos;PASSWORD&apos;: &apos;123456&apos;,  # Not used with sqlite3.</div><div class="line">        &apos;HOST&apos;: &apos;127.0.0.1&apos;,  # Set to empty string for localhost. Not used with sqlite3.</div><div class="line">        &apos;PORT&apos;: &apos;3306&apos;,  # Set to empty string for default. Not used with sqlite3.</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建数据库</p>
<pre><code>&gt; create database django default character set utf8 collate utf8_general_ci;
</code></pre><h4 id="新建app"><a href="#新建app" class="headerlink" title="新建app"></a>新建app</h4><p>django app为一个包含模型，视图和Django代码，并且形式为独立Python包的完整Django应用</p>
<blockquote>
<p>app和project区别<br>1.一个project包含很多个Django app以及对它们的配置<br>(project的作用是提供配置文件，比方说哪里定义数据库连接信息,安装的app列表，TEMPLATE_DIRS等)<br>2.一个app是一套Django功能的集合，通常包括模型和视图，按Python的包结构的方式存在<br>(Django本身内建有一些app，例如注释系统和自动管理界面。<code>app的一个关键点是它们是很容易移植到其他project和被多个project复用</code>)</p>
</blockquote>
<pre><code>$ django-admin.py startapp django_exp
</code></pre><h4 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h4><p>Django模型是用python代码形式表述的数据在数据库中的定义</p>
<p>在project目录下新建models.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    address = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    city = models.CharField(max_length=<span class="number">60</span>)</div><div class="line">    website = models.URLField()  //url类型字段</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">40</span>)</div><div class="line">    email = models.EmailField()  //邮件类型字段</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></div><div class="line">    title = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    authors = models.ManyToManyField(Author)</div><div class="line">    publisher = models.ForeignKey(Publisher)</div><div class="line">    publication_date = models.DateField() //日期时间类型字段</div></pre></td></tr></table></figure>
<blockquote>
<p>每个数据模型都是django.db.models.Model的子类。它的父类Model包含了所有必要的和数据库交互的方法，并提供了一个简洁漂亮的定义数据库字段的语法</p>
</blockquote>
<p>通过上面的python类，我们定义了三张表：<br>1.出版商，包含名字、地址、城市、网址字段<br>2.作者，包含名字、邮箱地址字段<br>3.书，包含标题、作者(多对多类型)、出版商(外键)、出版时间字段</p>
<h4 id="模型安装"><a href="#模型安装" class="headerlink" title="模型安装"></a>模型安装</h4><p>setting.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">INSTALLED_APPS = (</div><div class="line">    &apos;django.contrib.admin&apos;,</div><div class="line">    &apos;django.contrib.auth&apos;,</div><div class="line">    &apos;django.contrib.contenttypes&apos;,</div><div class="line">    &apos;django.contrib.sessions&apos;,</div><div class="line">    &apos;django.contrib.messages&apos;,</div><div class="line">    &apos;django.contrib.staticfiles&apos;,</div><div class="line">    &apos;django_exp&apos;</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="语法检查"><a href="#语法检查" class="headerlink" title="语法检查"></a>语法检查</h4><p>validate 命令检查你的模型的语法和逻辑是否正确</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ python manage.py validate</div><div class="line">System check identified no issues (0 silenced).</div><div class="line"></div><div class="line">$ python manage.py sqlall django_exp //打印sql语句</div></pre></td></tr></table></figure>
<h4 id="同步数据库"><a href="#同步数据库" class="headerlink" title="同步数据库"></a>同步数据库</h4><p>Django 1.7及以上的版本用以下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ python manage.py makemigrations</div><div class="line">$ python manage.py migrate</div></pre></td></tr></table></figure>
<p>执行完成后数据库表就已经建好了，我们就可以对数据库模型进行一系列的操作</p>
<p>未完待续…</p>
</div></article><div class="tags"><a href="/tags/django/">django</a></div><div class="paginator"><a href="/2016/11/27/python-excel/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2016/11/16/python-datetime/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://yoursite.com/2016/11/20/django-web-framework/index.html" data-title="Django笔记" data-url="http://yoursite.com/2016/11/20/django-web-framework/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "wulifun" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="social"><a href="https://github.com/Abnerzhao" title="github" class="iconfont icon-github"></a><a href="mailto:opsabnerzhao@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://weibo.com/2863179107/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="weibo" class="iconfont icon-weibo"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2015-2017<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Abnerzhao</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>